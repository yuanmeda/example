!function(t,n,i){var a,s;!function(){var e={},t={},n=function(i){if(i&&(i=i.toLowerCase()),t[i]){var a=t[i];delete t[i];for(var s=[],r=0;r<a.deps.length;r++){var o=a.deps[r];s[r]=n(o)}var l=a.callback.apply(a.callback,s);e[i]=l}return e[i]};s=function(e,n,i){if(e&&(e=e.toLowerCase()),n instanceof Array||(i=n,n=[]),t[e])throw new Error("the key already has been  used");t[e]={deps:n,callback:i,module:null}},a=function(e){return n(e)}}(),s("model/ajax",["model/logger","model/event"],function(e,n){var a={_logger:e,_event:n};return t.XDomainRequest?(e.debug("_ajax:使用XDomainRequest加载数据"),a._getUrl=function(t,n,i){var a=this,s=new XDomainRequest;s.open("GET",t),s.onload=function(){n(this.responseText)},s.onprogress=function(){},s.ontimeout=function(){e.error("_ajax:XDomainRequest加载超时"),i&&i(ex)},s.onerror=function(){e.error("_ajax:XDomainRequest加载失败"),a._event.trigger("load","error",t),i&&i(ex)},s.send()}):(e.debug("_ajax:使用jquery ajax加载数据"),a._getUrl=function(t,n,a){var s=this;i.ajax({method:"GET",url:t,dataType:"text",cache:!1}).done(function(e){n(e)}).fail(function(){e.error("_ajax:jquery ajax加载失败"),s._event.trigger("load","error",t),a&&a(ex)})}),a}),s("model/convertTextToMultiple",["model/logger","model/utils"],function(e,t){var n=function(e){var n=!0,i="",a="",s=e.modelMap;for(var r in s){a||(a=r);var o=s[r];if("textEntryInteraction"!==o.modelType){n=!1;break}}if(n){i=e.prompt.replace(/<(div|span) class="_qp-model"[\s\S]*?><\/(div|span)>/g,function(e){var n=t.getValue(e,/data-model-id="([\s\S]*?)"/),i=s[n];return'<textEntry textentryid="" keyboard="'+i.keyboard+'"  style="'+i.style+'" width="'+i.width+'" expectedLength="'+i.expectedLength+'" />'});var l={modelId:a,modelType:"textEntryMultipleInteraction",prompt:i,questionType:"",style:""},c=[];for(var d in e.correctAnswer){var u=e.correctAnswer[d].value;c.push(u[0])}e.correctAnswer={},e.correctAnswer[a]={value:c,identifier:a,cardinality:"multiple",baseType:"pair"},e.modelMap={},e.modelMap[a]=l,e.prompt='<div class="_qp-model" data-model-id="'+a+'" ></div>'}};return n}),s("model/event",["model/logger"],function(e){var t=function(){},n={_logger:e,_eventHandler:{load:{error:t}},trigger:function(e,t,n){this._logger.debug("model trigger event:"+e+"-"+t),this._eventHandler[e][t](n)},bind:function(e,t,n){this._eventHandler[e]&&this._eventHandler[e][t]&&"function"===i.type(n)&&(this._logger.debug("model bind event:"+e+"-"+t),this._eventHandler[e][t]=n)}};return n}),s("model/exception",["model/logger","model/event"],function(e,t){"use strict";var n={create:function(e,t,n){return t.message=e+"： "+t.message,t.code=n||0,t.type="qtiplayerException",t}};return n}),"undefined"==typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++){var n=this[t];e.apply(this,[n,t,this])}}),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}),"undefined"==typeof Array.prototype.clear&&(Array.prototype.clear=function(){for(;this.length;)this.pop()}),"undefined"==typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(){for(var e=this.concat.apply([],arguments),t=0,n=e.length;t<n;++t)this.push(e[t])}),"undefined"==typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),i.prototype._xml=function(){if(this.length<=0)return null;var e=this[0],n="";if(t.DOMParser){var i=new XMLSerializer;n=i.serializeToString(e)}else n=e.xml;var a=/^\s*<[\s\S]*?>([\s\S]*)<[\s\S]*?>\s*$/,s=n.match(a);return s&&s.length>=2?s[1]:void 0},s("model/logger",function(){for(var e,n=function(){},i=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],a=i.length,s=t.console=t.console||{};a--;)e=i[a],s[e]||(s[e]=n);var r={_level:0,_console:s,setLevel:function(e){switch(e){case"debug":this._level=3;break;case"info":this._level=2;break;case"warn":this._level=1;break;case"error":this._level=0;break;default:this._level=-1}},_log:function(e,t){try{this._console[e].apply(this._console,t)}catch(n){var i=this;this._log=function(e,t){t.length<=1?i._console[e](t[0]):i._console[e](t)},this._log(e,t)}},debug:function(e){this._level>=3&&this._log("log",arguments)},info:function(e){this._level>=2&&this._log("info",arguments)},warn:function(e){this._level>=1&&this._log("warn",arguments)},error:function(e){this._level>=0&&this._log("error",arguments)}};return r}),t.QtiPlayer||(t.QtiPlayer={}),s("model/qtiModel",["model/logger","model/event","model/utils","model/ajax"],function(e,n,s,r){var o=a("model/json/jsonParser"),l=a("model/xml/xmlParser"),c=a("model/convertTextToMultiple"),d=t.QtiPlayer;d.getLogger=function(){return e},d.getUtils=function(){return s},d.setLoggerLevel=function(t){return e.setLevel(t)},d.load=function(t,n,a,s){try{t&&t instanceof Object&&(t=JSON.stringify(t));var d,u=t.substring(0,1);"{"===u||"["===u?(d=o.parse(t,n,null),n.unifyTextEntry===!0&&c(d),a&&a(d)):(e.debug("_ajax:加载"+t),r._getUrl(t,function(r){try{r=i.trim(r),u=r.substring(0,1),d="{"===u||"["===u?o.parse(r,n,t):l.parse(r,n,t),n.unifyTextEntry===!0&&c(d),a&&a(d)}catch(h){e.error("load解析数据:",h),s&&s(h)}},function(t){e.error("load加载数据:",t),s&&s(t)}))}catch(h){e.error("load解析数据:",h),s&&s(h)}},d.loadOnError=function(e){n.bind("load","error",e)}}),s("model/utils",function(){var e={_encodeLeftRegex:/</g,_decodeLeftRegex:/&lt;/g,_encodeRightRegex:/>/g,_decodeRightRegex:/&gt;/g,_encodeAndRegex:/&/g,_decodeAndRegex:/&amp;/g,_decodeBlankRegex:/&nbsp;/g,xmlEncode:function(e){return e=e.replace(this._encodeAndRegex,"&amp;"),e=e.replace(this._encodeLeftRegex,"&lt;"),e=e.replace(this._encodeRightRegex,"&gt;")},xmlDecode:function(e){return e=e.replace(this._decodeBlankRegex," "),e=e.replace(this._decodeLeftRegex,"<"),e=e.replace(this._decodeRightRegex,">"),e=e.replace(this._decodeAndRegex,"&")},stringToBoolean:function(e){var t=!1;return e&&"true"===e&&(t=!0),t},getValue:function(e,t,n){var i="",a=e.match(t);return"number"==typeof n&&a&&a.length>n?i=a[n]:a&&2===a.length&&(i=a[1]),i},getValues:function(e,t,n){var i,a=[],s=e.match(t);if(s)for(var r=0;r<s.length;r++)i=this.getValue(s[r],n),i&&a.push(i);return a},getIntValue:function(e,t){var n=0,i=e.match(t);return i&&2===i.length&&(n=parseInt(i[1])),n},getBasePath:function(e){if("undefined"==typeof e)throw new Error("path not defined");var t=e.lastIndexOf("#");t==-1&&(t=e.length);var n=e.indexOf("?");n==-1&&(n=e.length);var i=e.lastIndexOf("/",Math.min(n,t));return i>=0?e.substring(0,i):""},template:function(e,t){var n=/\$\{(.+?)(?:\:(.+?))?\}/g;return e.replace(n,function(e,n,i){return void 0!==t[n]?t[n]:e})},getUuid:function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var i=e.join("");return i},getPathSuffix:function(e){e=e.toLowerCase();var t=e.indexOf("#");t==-1&&(t=e.length);var n=e.indexOf("?");n==-1&&(n=e.length);var i=Math.min(n,t),a=i>=0?e.substring(0,i):"",s=a.indexOf(".");return s>=0?a.substring(s+1):""}};return e}),s("model/json/jsonConvert",["model/utils","model/logger"],function(e,t){var n=function(e){var t={baseType:e.base_type,cardinality:e.cardinality,identifier:e.identifier,value:e.corrects};return t},i={_subjectiveRegex:/class="subjectivebase_text"/i,_subjectiveBaseAssetRegex:/<div[^<>]*?class="asset"[^<>]*?><\/div>/g,_subjectiveBaseAssetPosterRegex:/data-poster="([\s\S]*?)"/,_subjectiveBaseAssetSrcRegex:/data-src="([\s\S]*?)"/,_subjectiveBaseAssetTypeRegex:/data-type="([\s\S]*?)"/,_subjectiveBaseTextRegex:/<div class="subjectivebase_text">([\s\S]*?)<\/div>\s*?<div class="subjectivebase_asset"/,_widthRegex:/width="([\s\S]+)"/,_heightRegex:/height="([\s\S]+)"/,parse:function(t,n){if(this._subjectiveRegex.test(t)){var i=[],a="",s=t.match(this._subjectiveBaseAssetRegex);if(s)for(var r=0;r<s.length;r++){var o=s[r];i.push({poster:e.getValue(o,this._subjectiveBaseAssetPosterRegex),src:e.getValue(o,this._subjectiveBaseAssetSrcRegex),type:e.getValue(o,this._subjectiveBaseAssetTypeRegex),width:e.getIntValue(o,this._widthRegex),height:e.getIntValue(o,this._heightRegex)})}a=e.getValue(t,this._subjectiveBaseTextRegex),n.contentData={asset:i,text:a}}}},a=function(e,t){var n={content:e.content,identifier:e.identifier,modelId:t,showHide:e.show_hide};return i.parse(e.content,n),n},s=function(e){var t={choice:"choiceInteraction",multiplechoice:"choiceInteraction",vote:"choiceInteraction_vote",judge:"choiceInteraction",order:"orderInteraction",match:"matchInteraction",extendedtext:"extendedTextInteraction",graphicgapmatch:"graphicGapMatchInteraction",textentry:"textEntryInteraction",textentrymultiple:"textEntryMultipleInteraction",drawing:"drawingInteraction_drawing",handwrite:"drawingInteraction_handwrite",subjectivebase:"extendedTextInteraction",inlinechoice:"inlineChoiceInteraction"};return t[e]},r=function(e){for(var t=0;t<e.length;t++)if(e[t]&&e[t].indexOf("<latex")!=-1)return!0;return!1},o=/^-?[0-9]+\.?[0-9]*$/,l=function(e,t,n){for(var i=0;i<t.length;i++){var a="text";if(n)for(var s=0;s<n.length;s++){var r=n[s],l=r.identifier;if(l===t[i]){r.corrects&&o.test(r.corrects[0])&&(a="number");break}}e.modelMap[t[i]]={modelId:t[i],modelType:"textEntryInteraction",questionType:"",keyboard:a,width:0,expectedLength:0,style:""}}},c=function(e,n,i){t.debug(d(n.prompt,i)),e.modelMap[n.response_identifier]={modelId:n.response_identifier,modelType:"textEntryMultipleInteraction",questionType:"",prompt:d(n.prompt,i),style:""}},d=function(e,t){if(!e)return"";var n=0;return e.replace(/<textentryinteraction[^>]*?responseidentifier="([^\"]+)"[^>]*?><\/textentryinteraction>/gm,function(e,i,a){var s="";return t&&t.corrects&&"undefined"!==t.corrects[n]&&o.test(t.corrects[n])&&(s="number"),n++,'<textEntry textentryid="'+i+'" keyboard="'+s+'" />'})},u={subjectivebase:{_subjectiveBaseAssetRegex:/<div[^<>]*?class="asset"[^<>]*?><\/div>/g,_subjectiveBaseAssetPosterRegex:/data-poster="([\s\S]*?)"/,_subjectiveBaseAssetSrcRegex:/data-src="([\s\S]*?)"/,_subjectiveBaseAssetTypeRegex:/data-type="([\s\S]*?)"/,_subjectiveBaseTextRegex:/<div class="subjectivebase_text">([\s\S]*?)<\/div>\s*?<div class="subjectivebase_asset"/,_widthRegex:/width="([\s\S]+)"/,_heightRegex:/height="([\s\S]+)"/,parse:function(t,n){var i=this,a=[],s="",r=t.prompt,o=r.match(i._subjectiveBaseAssetRegex);if(o)for(var l=0;l<o.length;l++){var c=o[l];a.push({poster:e.getValue(c,i._subjectiveBaseAssetPosterRegex),src:e.getValue(c,i._subjectiveBaseAssetSrcRegex),type:e.getValue(c,i._subjectiveBaseAssetTypeRegex),width:e.getIntValue(c,i._widthRegex),height:e.getIntValue(c,i._heightRegex)})}s=e.getValue(r,i._subjectiveBaseTextRegex),n.text=s,n.asset=a}},rubricBlock:{_subjectiveBaseAssetRegex:/<div[^<>]*?class="asset"[^<>]*?><\/div>/g,_subjectiveBaseAssetPosterRegex:/data-poster="([\s\S]*?)"/,_subjectiveBaseAssetSrcRegex:/data-src="([\s\S]*?)"/,_subjectiveBaseAssetTypeRegex:/data-type="([\s\S]*?)"/,_responseTextRegex:/<div class="response_text">([\s\S]*?)<\/div>\s*?<div class="subjectivebase_asset"/,_widthRegex:/width="([\s\S]+)"/,_heightRegex:/height="([\s\S]+)"/,parse:function(t,n){var i,a=this,s="scorer",r=a._responseTextRegex.test(t);if(r){var o=[],l="",c=t.match(a._subjectiveBaseAssetRegex);if(c)for(var d=0;d<c.length;d++){var u=c[d];o.push({poster:e.getValue(u,a._subjectiveBaseAssetPosterRegex),src:e.getValue(u,a._subjectiveBaseAssetSrcRegex),type:e.getValue(u,a._subjectiveBaseAssetTypeRegex),width:e.getIntValue(u,a._widthRegex),height:e.getIntValue(u,a._heightRegex)})}l=e.getValue(t,a._responseTextRegex),i={view:s,text:l,asset:o}}else i={prompt:t,view:s};n.rubricBlock=i}},drawing:{parse:function(e,n){if(t.debug(e),n.asset=[],e.prompt_object.assets){var i=e.prompt_object.assets;n.asset=i}if(e.prompt_object.asset_titles){var a=e.prompt_object.asset_titles;n.assetTitle=a}n.content=e.prompt_object.content,n.object=e.object,n.paperType=e.papertype,n.title=p(e.prompt_object.title,[],!0),n.titleType=e.titletype}},handwrite:{parse:function(e,t){t.object=e.object,t.object.width=t.object.width?parseInt(t.object.width):0,t.object.height=t.object.height?parseInt(t.object.height):0}},graphicgapmatch:{parse:function(e,t){if(t.object={},t.object=e.object,t.object.param=[],e.object.params.blankImage){t.object.data=e.object.params.blankImage;for(var n=["rows","columns","blankImage","originalImage"],i=0;i<n.length;i++){var a=n[i],s=e.object.params[a];t.object.param.push({name:a,value:s,valueType:"DATA"})}}else{t.object.param=e.object.params;for(var r=0;r<e.object.params.length;r++){var o=e.object.params[r];"blankImage"===o.name&&(t.object.data=o.value)}}if(t.object.width=t.object.width?parseInt(t.object.width):0,t.object.height=t.object.height?parseInt(t.object.height):0,t.gapImg=e.gap_imgs,t.gapImg)for(var i=0;i<t.gapImg.length;i++){var l=t.gapImg[i];"undefined"==typeof l.matchMax&&(l.matchMax=1),"undefined"!=typeof l.text&&(l.identifier=l.text)}if(t.associableHotspot=e.associable_hotspots,t.associableHotspot)for(var i=0;i<t.associableHotspot.length;i++){var l=t.associableHotspot[i];"undefined"==typeof l.matchMax&&(l.matchMax=1)}}},match:{parse:function(e,t){for(var n={},i=[],a=0;a<e.choices.length;a++){var s=e.choices[a],r={content:s.text,fixed:s.fixed,matchMax:s.match_max,identifier:s.identifier},o=s.group_id;if(!n[o]){var l=[];n[o]=l,i.push(l)}n[o].push(r)}t.simpleMatchSet=i}}},h=function(e,n){var i=[],a={layout:e.layout||"",modelId:e.response_identifier,modelType:s(e.type),prompt:p(e.prompt,i),questionType:e.type,shuffle:e.shuffle,style:""};if("drawing"!=e.type&&"textentrymultiple"!=e.type&&l(n,i,n.correctAnswer),"match"!=e.type?(a.maxChoices=e.max_choices,a.minChoices=e.min_choices||0):(a.maxAssociations=e.max_choices,a.minAssociations=e.min_choices||0),e.choices&&e.choices.length>0&&"match"!=e.type){a.simpleChoice=[];for(var r=0;r<e.choices.length;r++){var o=e.choices[r];a.simpleChoice.push({content:o.text,fixed:o.fixed,identifier:o.identifier})}}return u[e.type]&&u[e.type].parse(e,a),t.debug(a),a},g=function(e,t){return e.modelMap[t]},p=function(e,t,n){return e?e.replace(/<textentryinteraction[^>]*?responseidentifier="([^\"]+)"[^>]*?><\/textentryinteraction>/gm,function(e,i){return t.push(i),n?"<textEntry/>":'<span class="_qp-model" data-model-id="'+i+'" ></span>'}):""},f=function(e,t){for(var n,i=0;i<t.children.length;i++){n=[];for(var a=t.children[i],s=0;s<a.choices.length;s++){var r={content:a.choices[s].text,identifier:a.choices[s].identifier};n.push(r)}e[a.response_identifier]={inlineChoice:n,modelId:a.response_identifier,modelType:"inlineChoiceInteraction",questionType:"inlinechoice",shuffle:!1}}},m={convert:function(e){t.debug(e);for(var i=[],s={answerFeedback:{},correctAnswer:{},hasMath:!1,hintFeedback:{},modelMap:{},prompt:""},o=0;o<e.feedbacks.length;o++){var d=e.feedbacks[o],m="RESPONSE_"+(d.sequence||1)+"-1",v=a(d,m);"showHint"==d.identifier?s.hintFeedback[m]=v:"showAnswer"==d.identifier&&(s.answerFeedback[m]=v),i.push(d.content)}for(var _="",o=0;o<e.items.length;o++){var x=e.items[o],m=x.response_identifier;if("data"==x.type||"textentry"==x.type){var w=[];_=_+" "+p(x.prompt,w),l(s,w,e.responses)}else if("textentrymultiple"==x.type){for(var y,b=0;b<e.responses.length;b++)if(e.responses[b].identifier===x.response_identifier){y=e.responses[b];break}_=_+' <div class="_qp-model" data-model-id="'+x.response_identifier+'" ></div>',c(s,x,y)}else if("inlinechoice"===x.type){var q=/<inlinechoiceinteraction(?:.*?)responseidentifier="([\s\S]*?)"(?:.*?)shuffle=(["'])([^"']*?)\2><\/inlinechoiceinteraction>/gi;_=x.prompt.replace(q,function(e,t,n,i){return'<span class="_qp-model" data-model-id="'+t+'" style=""></span>'}),f(s.modelMap,x)}else{_=_+' <div class="_qp-model" data-model-id="'+m+'" style=""></div>';var A=h(x,s);A.full_score=x.full_score||0,A.user_score=x.user_score||0,s.modelMap[m]=A}if(i.push(x.prompt),x.choices&&x.choices.length>0)for(var b=0;b<x.choices.length;b++)i.push(x.choices[b].text);if(x.prompt_object&&(i.push(x.prompt_object.title),i.push(x.prompt_object.content),x.prompt_object.assets))for(var R=x.prompt_object.assets,b=0;b<R.length;b++)i.push(R[b])}for(var o=0;o<e.responses.length;o++){for(var S=e.responses[o],m=S.identifier,y=g(s,m),I=n(S),b=0;b<S.corrects.length;b++)i.push(S.corrects[b]);!y||"subjectivebase"!==y.questionType&&"extendedtext"!=y.questionType||u.rubricBlock.parse(S.corrects[0],y),s.correctAnswer[m]=I}return s.hasMath=r(i),s.prompt=_,t.debug(s),s}};return m}),s("model/json/jsonParser",["model/logger","model/utils","model/json/jsonConvert"],function(e,t,n){var i={_logger:e,_refPathRegex:/\$\{ref-path\}/g,_refBaseRegex:/\$\{ref-base\}/g,_imgFilterRegex:/<img([^<>]*?)><\/img>/g,_convert:null,parseJson:function(e,n,i){var a=this,s="",r="";n&&n.refPath&&(s=n.refPath),n&&n.basePath&&(r=n.basePath),e=e.replace(a._refPathRegex,s),e=i?e.replace(a._refBaseRegex,t.getBasePath(i)):e.replace(a._refBaseRegex,r),e=e.replace(a._imgFilterRegex,function(e,t){var n="<img"+t+"/>";return n});var o,l,c=JSON.parse(e),d=a._convert(c);for(var u in d.modelMap)if(l=d.modelMap[u],("textEntryInteraction"===l.modelType||"textEntryMultipleInteraction"===l.modelType)&&(o=d.correctAnswer[u],o&&o.value.length>0))for(var h=0;h<o.value.length;h++){g=o.value[h];var g=t.xmlDecode(g);o.value[h]=g}return d},parse:function(e,t,i){var a=this;if(a._convert=n.convert,!a._convert)throw"_json:convert未加载";return a.parseJson(e,t,i)}};return i}),s("model/xml/choiceInteraction",["model/utils"],function(e){var t={_choiceInteractionRegex:/<choiceInteraction[^\/]*?>[\s\S]*?<\/choiceInteraction>/g,_choiceInteractionAttrRegex:/<choiceInteraction([\s\S]*?)>/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_shuffleRegex:/shuffle="([\s\S]*?)"/,_maxChoicesRegex:/maxChoices="(\d+)"/,_minChoicesRegex:/minChoices="(\d+)"/,_promptRegex:/<prompt>([\s\S]*?)<\/prompt>/,_simpleChoiceRegex:/<simpleChoice[\s\S]*?<\/simpleChoice>/g,_simpleChoiceValueRegex:/<simpleChoice[\s\S]*?>([\s\S]*?)<\/simpleChoice>/,_identifierRegex:/identifier="([\s\S]*?)"/,_fixedRegex:/fixed="([\s\S]*?)"/,_questionTypeRegex:/questionType="([\s\S]*?)"/,_layoutRegex:/layout="([\s\S]*?)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._choiceInteractionRegex,function(t){var a=e.getValue(t,i._choiceInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r="choiceInteraction",o=e.getValue(a,i._questionTypeRegex);"vote"===o&&(r=r+"_"+o);var l,c,d,u,h=e.getValue(a,i._styleRegex),g=e.stringToBoolean(e.getValue(a,i._shuffleRegex)),p=e.getIntValue(a,i._maxChoicesRegex),f=e.getIntValue(a,i._minChoicesRegex),m=e.getValue(a,i._layoutRegex),v=e.getValue(t,i._promptRegex),_=t.match(i._simpleChoiceRegex),x=[];if(_)for(var w=0;w<_.length;w++)l=_[w],c=e.getValue(l,i._identifierRegex),d=e.stringToBoolean(e.getValue(l,i._fixedRegex)),u=e.getValue(l,i._simpleChoiceValueRegex),x.push({identifier:c,fixed:d,content:u});var y={modelId:s,modelType:r,questionType:o,style:h,layout:m,prompt:v,shuffle:g,maxChoices:p,minChoices:f,simpleChoice:x};n.modelMap[s]=y}return'<div class="_qp-model" data-model-id="'+s+'" style="'+h+'"></div>'})}};return t}),s("model/xml/correctAnswerParser",["model/utils"],function(e){var t={_correctAnswerRegex:/<responseDeclaration[^\/]*?>[\s\S]*?<\/responseDeclaration>/g,_identifierRegex:/identifier="([\s\S]*?)"/,_cardinalityRegex:/cardinality="([\s\S]*?)"/,_baseTypeRegex:/baseType="([\s\S]*?)"/,_answerRegex:/<value>[\s\S]*?<\/value>/g,_answerValueRegex:/<value>([\s\S]*?)<\/value>/,parse:function(t,n){var i,a,s,r,o,l=t.match(this._correctAnswerRegex);if(l)for(var c=0;c<l.length;c++)a=l[c],i=e.getValue(a,this._identifierRegex),i&&(o=e.getValues(a,this._answerRegex,this._answerValueRegex),s=e.getValue(a,this._cardinalityRegex),r=e.getValue(a,this._baseTypeRegex),n.correctAnswer[i]={identifier:i,cardinality:s,baseType:r,value:o})}};return t}),s("model/xml/drawingInteraction",["model/utils"],function(e){var t={_drawingInteractionRegex:/<drawingInteraction[^\/]*?>[\s\S]*?<\/drawingInteraction>/g,_drawingInteractionAttrRegex:/<drawingInteraction([\s\S]*?)>/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_questionTypeRegex:/questionType="([\s\S]*?)"/,_titleTypeRegex:/titletype="([\s\S]*?)"/,_paperTypeRegex:/papertype="([\s\S]*?)"/,_titleRegex:/<div class="drawingInteraction_title">([\s\S]*)<\/div>\s*?<div class="drawingInteraction_content">/,_contentRegex:/<div class="drawingInteraction_content">([\s\S]*)<\/div>\s*?<div class="drawingInteraction_asset">/,_assetRegex:/<div class="drawingInteraction_asset">([\s\S]*)<\/div>\s*?<\/prompt>/,_assetValueRegex:/<div class="asset">([\s\S]*?)<\/div>\s*?<div class="asset">/,_assetTitleRegex:/<div class="drawingInteraction_asset_title">([\s\S]*)<\/div>\s*?<\/prompt>/,_assetTitleValueRegex:/<div class="asset_title">([\s\S]*?)<\/div>\s*?<div class="asset_title">/,_emptyAssetRegex:/<div class="asset"\/>/g,_emptyAssetTitleRegex:/<div class="asset_title"\/>/g,_objectRegex:/(<object[\s\S]*?<\/object>)/,_dataRegex:/data="([\s\S]*?)"/,_typeRegex:/type="([\s\S]*?)"/,_widthRegex:/width="(\d+)"/,_heightRegex:/height="(\d+)"/,_promptRegex:/<prompt>([\s\S]*?)<\/prompt>/,parse:function(t,n){var i=this,a="";return a=t.replace(i._drawingInteractionRegex,function(t){var a=e.getValue(t,i._drawingInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r,o=e.getValue(a,i._questionTypeRegex);""===o&&(o="drawing");var l="drawingInteraction_"+o,c=e.getValue(a,i._styleRegex);if("drawingInteraction_handwrite"===l){var d=e.getValue(t,i._promptRegex);r={modelId:s,modelType:l,questionType:o,style:c,prompt:d}}else{var u=e.getValue(a,i._titleTypeRegex),h="";"1"===u&&(h=e.getValue(t,i._titleRegex));var g=e.getValue(a,i._paperTypeRegex),p=e.getValue(t,i._contentRegex),f=[],m=e.getValue(t,i._assetRegex);m=m.replace(i._emptyAssetRegex,'<div class="asset"></div>'),m+='<div class="asset">';for(var v=!0;v;)v=!1,m=m.replace(i._assetValueRegex,function(e,t){return v=!0,f.push(t),'<div class="asset">'});var _=e.getValue(t,i._assetTitleRegex);_=_.replace(i._emptyAssetTitleRegex,'<div class="asset_title"></div>'),_+='<div class="asset_title">';for(var x=!0,w=[];x;)x=!1,_=_.replace(i._assetTitleValueRegex,function(e,t){return x=!0,w.push(t),'<div class="asset_title">'});r={modelId:s,modelType:l,questionType:o,style:c,titleType:u,paperType:g,title:h,content:p,asset:f,assetTitle:w}}var y={},b=e.getValue(t,i._objectRegex);y.type=e.getValue(b,i._typeRegex),y.data=e.getValue(b,i._dataRegex),y.width=e.getIntValue(b,i._widthRegex),y.height=e.getIntValue(b,i._heightRegex),r.object=y,n.modelMap[s]=r}return'<div class="_qp-model" data-model-id="'+s+'" style="'+c+'"></div>'})}};return t}),s("model/xml/extendedTextInteraction",["model/utils"],function(e){var t={_extendedTextInteractionRegex:/<extendedTextInteraction[^\/]*?>[\s\S]*?<\/extendedTextInteraction>/g,_extendedTextInteractionAttrRegex:/<extendedTextInteraction([\s\S]*?)>/,_styleRegex:/style="([\s\S]*?)"/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_promptRegex:/<prompt>([\s\S]*?)<\/prompt>/,_questionTypeRegex:/questionType="([\s\S]*?)"/,_subjectiveBaseAssetRegex:/<div[^<>]*?class="asset"[^<>]*?><\/div>/g,_subjectiveBaseAssetPosterRegex:/data-poster="([\s\S]*?)"/,_subjectiveBaseAssetSrcRegex:/data-src="([\s\S]*?)"/,_subjectiveBaseAssetTypeRegex:/data-type="([\s\S]*?)"/,_subjectiveBaseTextRegex:/<div class="subjectivebase_text">([\s\S]*?)<\/div>\s*?<div class="subjectivebase_asset"/,_widthRegex:/width="([\s\S]+)"/,_heightRegex:/height="([\s\S]+)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._extendedTextInteractionRegex,function(t){var a=e.getValue(t,i._extendedTextInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r,o=e.getValue(a,i._questionTypeRegex),l="extendedTextInteraction",c=e.getValue(a,i._styleRegex),d=e.getValue(t,i._promptRegex);if("subjectivebase"===o){var u=[],h="",g=d.match(i._subjectiveBaseAssetRegex);if(g)for(var p=0;p<g.length;p++){var f=g[p];u.push({poster:e.getValue(f,i._subjectiveBaseAssetPosterRegex),src:e.getValue(f,i._subjectiveBaseAssetSrcRegex),type:e.getValue(f,i._subjectiveBaseAssetTypeRegex),width:e.getIntValue(f,i._widthRegex),height:e.getIntValue(f,i._heightRegex)})}h=e.getValue(d,i._subjectiveBaseTextRegex),r={text:h,asset:u,modelId:s,modelType:l,questionType:o,style:c,rubricBlock:{text:"",asset:[],view:"scorer"}}}else r={modelId:s,modelType:l,questionType:o,style:c,prompt:d,rubricBlock:{prompt:"",view:"scorer"}};n.modelMap[s]=r}return'<div class="_qp-model" data-model-id="'+s+'" style="'+c+'"></div>'})}};return t}),s("model/xml/feedbackParser",["model/utils"],function(e){var t={_feedbackRegex:/<modalFeedback[^\/]*?>[\s\S]*?<\/modalFeedback>/g,_showHideRegex:/showHide="([\s\S]*?)"/,_sequenceRegex:/sequence="([\s\S]*?)"/,_identifierRegex:/identifier="([\s\S]*?)"/,_contentRegex:/<modalFeedback[\s\S]*?>([\s\S]*?)<\/modalFeedback>/,_subjectiveRegex:/class="subjectivebase_text"/i,_subjectiveBaseAssetRegex:/<div[^<>]*?class="asset"[^<>]*?><\/div>/g,_subjectiveBaseAssetPosterRegex:/data-poster="([\s\S]*?)"/,_subjectiveBaseAssetSrcRegex:/data-src="([\s\S]*?)"/,_subjectiveBaseAssetTypeRegex:/data-type="([\s\S]*?)"/,_subjectiveBaseTextRegex:/<div class="subjectivebase_text">([\s\S]*?)<\/div>\s*?<div class="subjectivebase_asset"/,_widthRegex:/width="([\s\S]+)"/,_heightRegex:/height="([\s\S]+)"/,parse:function(t,n){var i,a,s,r,o,l,c=t.match(this._feedbackRegex);if(c)for(var d=0;d<c.length;d++)if(a=c[d],r=e.getValue(a,this._sequenceRegex)){i="RESPONSE_"+r+"-1",s=e.getValue(a,this._identifierRegex),l=e.getValue(a,this._showHideRegex),o=e.getValue(a,this._contentRegex);var u={modelId:i,showHide:l,identifier:s,content:o};if(this._subjectiveRegex.test(o)){var h=[],g="",p=o.match(this._subjectiveBaseAssetRegex);if(p)for(var f=0;f<p.length;f++){var m=p[f];h.push({poster:e.getValue(m,this._subjectiveBaseAssetPosterRegex),src:e.getValue(m,this._subjectiveBaseAssetSrcRegex),type:e.getValue(m,this._subjectiveBaseAssetTypeRegex),width:e.getIntValue(m,this._widthRegex),height:e.getIntValue(m,this._heightRegex)})}g=e.getValue(o,this._subjectiveBaseTextRegex),u.contentData={asset:h,text:g}}"showHint"===s?n.hintFeedback[i]=u:n.answerFeedback[i]=u}}};return t}),s("model/xml/gapMatchInteraction",["model/utils"],function(e){var t={_gapMatchInteractionRegex:/<gapMatchInteraction[^\/]*?>[\s\S]*?<\/gapMatchInteraction>/g,_gapMatchInteractionAttrRegex:/<gapMatchInteraction([\s\S]*?)>/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_promptRegex:/<prompt>([\s\S]*?)<\/prompt>/,_shuffleRegex:/shuffle="([\s\S]*?)"/,_gapTextRegex:/<gapText[\s\S]*?<\/gapText>/g,_gapTextValueRegex:/<gapText[\s\S]*?>([\s\S]*?)<\/gapText>/,_identifierRegex:/identifier="([\s\S]*?)"/,_matchMaxRegex:/matchMax="([\s\S]*?)"/,_fixedRegex:/fixed="([\s\S]*?)"/,_tableContentRegex:/(<div class="gapMatchInteraction_table_content">[\s\S]*<\/div>)/,_questionTypeRegex:/questionType="([\s\S]*?)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._gapMatchInteractionRegex,function(t){var a=e.getValue(t,i._gapMatchInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r="gapMatchInteraction",o=e.getValue(a,i._questionTypeRegex),l=e.getValue(a,i._styleRegex),c=e.stringToBoolean(e.getValue(a,i._shuffleRegex)),d=e.getValue(t,i._promptRegex),u=[],h=t.match(i._gapTextRegex);if(h)for(var g,p,f=0;f<h.length;f++)g=h[f],p={},p.identifier=e.getValue(g,i._identifierRegex),p.matchMax=e.getValue(g,i._matchMaxRegex),p.content=e.getValue(g,i._gapTextValueRegex),u.push(p);var m=e.getValue(t,i._tableContentRegex),v={modelId:s,modelType:r,questionType:o,style:l,prompt:d,shuffle:c,gapText:u,tableMatchContent:m};n.modelMap[s]=v}return'<div class="_qp-model" data-model-id="'+s+'" style="'+l+'"></div>'})}};return t}),s("model/xml/graphicGapMatchInteraction",["model/utils"],function(e){var t={_graphicGapMatchInteractionRegex:/<graphicGapMatchInteraction[^\/]*?>[\s\S]*?<\/graphicGapMatchInteraction>/g,_graphicGapMatchInteractionAttrRegex:/<graphicGapMatchInteraction([\s\S]*?)>/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_promptRegex:/<prompt>([\s\S]*?)<\/prompt>/,_objectRegex:/(<object[\s\S]*?<\/object>)/,_paramRegex:/<param[\s\S]*?><\/param>/g,_nameRegex:/name="([\s\S]*?)"/,_valueRegex:/value="([\s\S]*?)"/,_valueTypeRegex:/valuetype="([\s\S]*?)"/,_gapImgRegex:/<gapImg[\s\S]*?<\/gapImg>/g,_identifierRegex:/identifier="([\s\S]*?)"/,_matchMaxRegex:/matchMax="([\s\S]*?)"/,_dataRegex:/data="([\s\S]*?)"/,_typeRegex:/type="([\s\S]*?)"/,_widthRegex:/width="(\d+)"/,_heightRegex:/height="(\d+)"/,_associableHotspotRegex:/<associableHotspot[\s\S]*?><\/associableHotspot>/g,_shapeRegex:/shape="([\s\S]*?)"/,_coordsRegex:/coords="([\s\S]*?)"/,_questionTypeRegex:/questionType="([\s\S]*?)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._graphicGapMatchInteractionRegex,function(t){var a=e.getValue(t,i._graphicGapMatchInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r="graphicGapMatchInteraction",o=e.getValue(a,i._questionTypeRegex),l=e.getValue(a,i._styleRegex),c=e.getValue(t,i._promptRegex),d={},u=e.getValue(t,i._objectRegex);d.data=e.getValue(u,i._dataRegex),d.type=e.getValue(u,i._typeRegex),d.width=e.getIntValue(u,i._widthRegex),d.height=e.getIntValue(u,i._heightRegex),d.param=[];var h=u.match(i._paramRegex);if(h)for(var g,p,f=0;f<h.length;f++)g=h[f],p={},p.name=e.getValue(g,i._nameRegex),p.value=e.getValue(g,i._valueRegex),p.valueType=e.getValue(g,i._valueTypeRegex),d.param.push(p);var m=[],v=t.match(i._gapImgRegex);if(v)for(var _,x,f=0;f<v.length;f++)_=v[f],x={},x.identifier=e.getValue(_,i._identifierRegex),x.matchMax=e.getValue(_,i._matchMaxRegex),x.data=e.getValue(_,i._dataRegex),x.type=e.getValue(_,i._typeRegex),x.width=e.getIntValue(_,i._widthRegex),x.height=e.getIntValue(_,i._heightRegex),m.push(x);var w=[],y=t.match(i._associableHotspotRegex);if(y)for(var b,q,f=0;f<y.length;f++)b=y[f],q={},q.identifier=e.getValue(b,i._identifierRegex),q.matchMax=e.getValue(b,i._matchMaxRegex),q.shape=e.getValue(b,i._shapeRegex),q.coords=e.getValue(b,i._coordsRegex),w.push(q);var A={modelId:s,modelType:r,questionType:o,style:l,prompt:c,object:d,gapImg:m,associableHotspot:w};n.modelMap[s]=A}return'<div class="_qp-model" data-model-id="'+s+'" style="'+l+'"></div>'})}};return t}),s("model/xml/inlineChoiceInteraction",["model/utils"],function(e){var t={_inlineChoiceInteractionRegex:/<inlineChoiceInteraction[^\/]*?>[\s\S]*?<\/inlineChoiceInteraction>/g,_inlineChoiceInteractionAttrRegex:/<inlineChoiceInteraction([\s\S]*?)>/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_shuffleRegex:/shuffle="([\s\S]*?)"/,_inlineChoiceRegex:/<inlineChoice [\s\S]*?<\/inlineChoice>/g,_inlineChoiceValueRegex:/<inlineChoice [\s\S]*?>([\s\S]*?)<\/inlineChoice>/,_identifierRegex:/identifier="([\s\S]*?)"/,_questionTypeRegex:/questionType="([\s\S]*?)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._inlineChoiceInteractionRegex,function(t){var a=e.getValue(t,i._inlineChoiceInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r="inlineChoiceInteraction",o=e.getValue(a,i._questionTypeRegex),l=e.getValue(a,i._styleRegex),c=e.stringToBoolean(e.getValue(a,i._shuffleRegex)),d=[],u=t.match(i._inlineChoiceRegex);if(u)for(var h,g,p,f=0;f<u.length;f++)h=u[f],g=e.getValue(h,i._identifierRegex),p=e.getValue(h,i._inlineChoiceValueRegex),d.push({identifier:g,content:p});var m={modelId:s,modelType:r,questionType:o,shuffle:c,style:l,inlineChoice:d};n.modelMap[s]=m}return'<span class="_qp-model" data-model-id="'+s+'" style="'+l+'"></span>'})}};return t}),s("model/xml/matchInteraction",["model/utils"],function(e){var t={_matchInteractionRegex:/<matchInteraction[^\/]*?>[\s\S]*?<\/matchInteraction>/g,
_matchInteractionAttrRegex:/<matchInteraction([\s\S]*?)>/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_shuffleRegex:/shuffle="([\s\S]*?)"/,_maxAssociationsRegex:/maxAssociations="(\d+)"/,_minAssociationsRegex:/minAssociations="(\d+)"/,_promptRegex:/<prompt>([\s\S]*?)<\/prompt>/,_simpleMatchSetRegex:/<simpleMatchSet[\s\S]*?<\/simpleMatchSet>/g,_simpleMatchSetValueRegex:/<simpleMatchSet[\s\S]*?>([\s\S]*?)<\/simpleMatchSet>/,_simpleAssociableChoiceRegex:/<simpleAssociableChoice[\s\S]*?<\/simpleAssociableChoice>/g,_simpleAssociableChoiceValueRegex:/<simpleAssociableChoice[\s\S]*?>([\s\S]*?)<\/simpleAssociableChoice>/,_identifierRegex:/identifier="([\s\S]*?)"/,_fixedRegex:/fixed="([\s\S]*?)"/,_matchMaxRegex:/matchMax="(\d+)"/,_questionTypeRegex:/questionType="([\s\S]*?)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._matchInteractionRegex,function(t){var a=e.getValue(t,i._matchInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r,o,l,c,d,u,h,g,p="matchInteraction",f=e.getValue(a,i._questionTypeRegex),m=e.getValue(a,i._styleRegex),v=e.stringToBoolean(e.getValue(a,i._shuffleRegex)),_=e.getIntValue(a,i._maxAssociationsRegex),x=e.getIntValue(a,i._minAssociationsRegex),w=e.getValue(t,i._promptRegex),y=t.match(i._simpleMatchSetRegex),b=[];if(y)for(var q=0;q<y.length;q++)if(r=y[q],o=r.match(i._simpleAssociableChoiceRegex)){c=[];for(var A=0;A<o.length;A++)l=o[A],d=e.getValue(l,i._identifierRegex),u=e.stringToBoolean(e.getValue(l,i._fixedRegex)),g=e.getIntValue(l,i._matchMaxRegex),h=e.getValue(l,i._simpleAssociableChoiceValueRegex),c.push({identifier:d,fixed:u,matchMax:g,content:h});b.push(c)}var R={modelId:s,modelType:p,questionType:f,style:m,prompt:w,shuffle:v,maxAssociations:_,minAssociations:x,simpleMatchSet:b};n.modelMap[s]=R}return'<div class="_qp-model" data-model-id="'+s+'" style="'+m+'"></div>'})}};return t}),s("model/xml/orderInteraction",["model/utils"],function(e){var t={_orderInteractionRegex:/<orderInteraction[^\/]*?>[\s\S]*?<\/orderInteraction>/g,_orderInteractionAttrRegex:/<orderInteraction([\s\S]*?)>/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_shuffleRegex:/shuffle="([\s\S]*?)"/,_maxChoicesRegex:/maxChoices="(\d+)"/,_minChoicesRegex:/minChoices="(\d+)"/,_promptRegex:/<prompt>([\s\S]*?)<\/prompt>/,_simpleChoiceRegex:/<simpleChoice[\s\S]*?<\/simpleChoice>/g,_simpleChoiceValueRegex:/<simpleChoice[\s\S]*?>([\s\S]*?)<\/simpleChoice>/,_identifierRegex:/identifier="([\s\S]*?)"/,_fixedRegex:/fixed="([\s\S]*?)"/,_questionTypeRegex:/questionType="([\s\S]*?)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._orderInteractionRegex,function(t){var a=e.getValue(t,i._orderInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r,o,l,c,d="orderInteraction",u=e.getValue(a,i._questionTypeRegex),h=e.stringToBoolean(e.getValue(a,i._shuffleRegex)),g=e.getValue(a,i._styleRegex),p=e.getIntValue(a,i._maxChoicesRegex),f=e.getIntValue(a,i._minChoicesRegex),m=e.getValue(t,i._promptRegex),v=t.match(i._simpleChoiceRegex),_=[];if(v)for(var x=0;x<v.length;x++)r=v[x],o=e.getValue(r,i._identifierRegex),l=e.stringToBoolean(e.getValue(r,i._fixedRegex)),c=e.getValue(r,i._simpleChoiceValueRegex),_.push({identifier:o,fixed:l,content:c});var w={modelId:s,modelType:d,questionType:u,style:g,prompt:m,shuffle:h,maxChoices:p,minChoices:f,simpleChoice:_};n.modelMap[s]=w}return'<div class="_qp-model" data-model-id="'+s+'" style="'+g+'"></div>'})}};return t}),s("model/xml/rubricBlock",["model/utils"],function(e){var t={_rubricBlockRegex:/<rubricBlock[^\/]*?>[\s\S]*?<\/rubricBlock>/g,_idRegex:/id="([\s\S]*?)"/,_viewRegex:/view="([\s\S]*?)"/,_promptRegex:/<rubricBlock[\s\S]*?>([\s\S]*?)<\/rubricBlock>/,_subjectiveBaseAssetRegex:/<div[^<>]*?class="asset"[^<>]*?><\/div>/g,_subjectiveBaseAssetPosterRegex:/data-poster="([\s\S]*?)"/,_subjectiveBaseAssetSrcRegex:/data-src="([\s\S]*?)"/,_subjectiveBaseAssetTypeRegex:/data-type="([\s\S]*?)"/,_responseTextRegex:/<div class="response_text">([\s\S]*?)<\/div>\s*?<div class="subjectivebase_asset"/,_widthRegex:/width="([\s\S]+)"/,_heightRegex:/height="([\s\S]+)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._rubricBlockRegex,function(t){var a=e.getValue(t,i._idRegex);if(a){var s,r=e.getValue(t,i._promptRegex),o=e.getValue(t,i._viewRegex),l=i._responseTextRegex.test(r);if(l){var c=[],d="",u=r.match(i._subjectiveBaseAssetRegex);if(u)for(var h=0;h<u.length;h++){var g=u[h];c.push({poster:e.getValue(g,i._subjectiveBaseAssetPosterRegex),src:e.getValue(g,i._subjectiveBaseAssetSrcRegex),type:e.getValue(g,i._subjectiveBaseAssetTypeRegex),width:e.getIntValue(g,i._widthRegex),height:e.getIntValue(g,i._heightRegex)})}d=e.getValue(r,i._responseTextRegex),s={view:o,text:d,asset:c}}else s={prompt:r,view:o};n.rubricBlockMap[a]=s}return""})}};return t}),s("model/xml/textEntryInteraction",["model/utils"],function(e){var t={_textEntryInteractionRegex:/<textEntryInteraction[\s\S]*?\/>/g,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_expectedLengthRegex:/expectedLength="(\d+)"/,_keyboardRegex:/keyboard="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_questionTypeRegex:/questionType="([\s\S]*?)"/,_widthRegex:/width="(\d+)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._textEntryInteractionRegex,function(t){var a=e.getValue(t,i._responseIdentifierRegex);if(a){var s="textEntryInteraction",r=e.getValue(t,i._questionTypeRegex),o=e.getIntValue(t,i._expectedLengthRegex),l=e.getValue(t,i._styleRegex),c=e.getValue(t,i._keyboardRegex),d=e.getIntValue(t,i._widthRegex);c||(c="text");var u={modelId:a,modelType:s,questionType:r,style:l,expectedLength:o,keyboard:c,width:d};n.modelMap[a]=u}return'<span class="_qp-model" data-model-id="'+a+'" style="'+l+'"></span>'})}};return t}),s("model/xml/textEntryMultipleInteraction",["model/utils"],function(e){var t={_textEntryMultipleInteractionRegex:/<textEntryMultipleInteraction[^\/]*?>[\s\S]*?<\/textEntryMultipleInteraction>/g,_textEntryMultipleInteractionAttrRegex:/<textEntryMultipleInteraction([\s\S]*?)>/,_responseIdentifierRegex:/responseIdentifier="([\s\S]*?)"/,_styleRegex:/style="([\s\S]*?)"/,_promptRegex:/<prompt>([\s\S]*?)<\/prompt>/,_questionTypeRegex:/questionType="([\s\S]*?)"/,parse:function(t,n){var i=this,a="";return a=t.replace(i._textEntryMultipleInteractionRegex,function(t){var a=e.getValue(t,i._textEntryMultipleInteractionAttrRegex),s=e.getValue(a,i._responseIdentifierRegex);if(s){var r="textEntryMultipleInteraction",o=e.getValue(a,i._questionTypeRegex),l=e.getValue(t,i._promptRegex),c=e.getValue(a,i._styleRegex),d={modelId:s,modelType:r,questionType:o,prompt:l,style:c};n.modelMap[s]=d}return'<div class="_qp-model" data-model-id="'+s+'" style="'+c+'"></div>'})}};return t}),s("model/xml/xmlParser",["model/logger","model/utils","model/event"],function(e,t,n){var i=t,s=a("model/xml/choiceInteraction"),r=a("model/xml/correctAnswerParser"),o=a("model/xml/drawingInteraction"),l=a("model/xml/extendedTextInteraction"),c=a("model/xml/feedbackParser"),d=a("model/xml/gapMatchInteraction"),u=a("model/xml/graphicGapMatchInteraction"),h=a("model/xml/inlineChoiceInteraction"),g=a("model/xml/matchInteraction"),p=a("model/xml/orderInteraction"),f=a("model/xml/rubricBlock"),m=a("model/xml/textEntryInteraction"),v=a("model/xml/textEntryMultipleInteraction"),_={_event:n,_logger:e,_refPathRegex:/\$\{ref-path\}/g,_refBaseRegex:/\$\{ref-base\}/g,_mathLeftDecodeRegex:/&lt;latex( class="math-tex")?&gt;/g,_mathRightDecodeRegex:/&lt;\/latex&gt;/g,_mathRegex:/<latex( class="math-tex")?>[\s\S]*?<\/latex>/g,_imgFilterRegex:/<img([^<>]*?)><\/img>/g,_textEntryInteractionFilterRegex:/<textEntryInteraction([^<>]*?)><\/textEntryInteraction>/g,_modelFeedbackFilterRegex:/<modalFeedback([^<>]*?)\/>/g,_textEntryFilterRegex:/<textEntry([^<>]*?)><\/textEntry>/g,_paramFilterRegex:/<param([^<>]*?)\/>/g,_associableHotspotFilterRegex:/<associableHotspot([^<>]*?)\/>/g,_objectFilterRegex:/<object([^<>]*?)\/>/g,correctAnswerParser:r,feedbackParser:c,modelParser:{_itemBodyRegex:/<itemBody[\s\S]*?>([\s\S]*?)<\/itemBody>/,_parserMap:{textEntryInteraction:m,inlineChoiceInteraction:h,textEntryMultipleInteraction:v,choiceInteraction:s,orderInteraction:p,matchInteraction:g,graphicGapMatchInteraction:u,gapMatchInteraction:d,extendedTextInteraction:l,rubricBlock:f,drawingInteraction:o},parse:function(e,t){var n,a=i.getValue(e,this._itemBodyRegex);t.rubricBlockMap={};for(var s in this._parserMap)n=this._parserMap[s],a=n.parse(a,t);var r,o;for(var s in t.rubricBlockMap)r=t.modelMap[s],r&&(o=t.rubricBlockMap[s],r.rubricBlock=o);return delete t.rubricBlockMap,a}}};return _.parseXml=function(e,t,n){var a=this,s="";t&&t.refPath&&(s=t.refPath),e=e.replace(a._refPathRegex,s),e=e.replace(a._refBaseRegex,i.getBasePath(n)),e=e.replace(a._imgFilterRegex,function(e,t){var n="<img"+t+"/>";return n}),e=e.replace(a._textEntryInteractionFilterRegex,function(e,t){var n="<textEntryInteraction"+t+"/>";return n}),e=e.replace(a._textEntryFilterRegex,function(e,t){var n="<textEntry"+t+"/>";return n}),e=e.replace(a._associableHotspotFilterRegex,function(e,t){var n="<associableHotspot"+t+"></associableHotspot>";return n}),e=e.replace(a._paramFilterRegex,function(e,t){var n="<param"+t+"></param>";return n}),e=e.replace(a._objectFilterRegex,function(e,t){var n="<object"+t+"></object>";return n}),e=e.replace(a._modelFeedbackFilterRegex,function(e,t){var n="<modalFeedback"+t+"></modalFeedback>";return n}),e=e.replace(a._mathLeftDecodeRegex,'<latex class="math-tex">'),e=e.replace(a._mathRightDecodeRegex,"</latex>");var r=!1;e.match(a._mathRegex)&&(r=!0);var o={hasMath:r,prompt:"",correctAnswer:{},hintFeedback:{},answerFeedback:{},modelMap:{}},l=e;a.correctAnswerParser.parse(l,o),a.feedbackParser.parse(l,o);var c=a.modelParser.parse(l,o);o.prompt=c;var d,u,h,g=/&amp;/g;for(var p in o.modelMap)if(d=o.modelMap[p],("textEntryInteraction"===d.modelType||"textEntryMultipleInteraction"===d.modelType)&&(u=o.correctAnswer[p],u&&u.value.length>0))for(var f=0;f<u.value.length;f++)h=u.value[f],h=h.replace(g,"&"),h=i.xmlDecode(h),u.value[f]=h;return o},_.parse=function(e,t,n){var i=this;return i.parseXml(e,t,n)},_}),s("player/assessment/assessmentItem",["model/logger","player/utils/imageLoader","player/utils/extendUtils"],function(e,n,s){var r=a("player/model/modelItem"),o={_event:null,_media:null,_itemModel:null,_answer:null,_isComposite:!1,_sequenceNumber:null,_stat:null,_modelItem:null,_score:0,_supportType:["choiceInteraction","textEntryMultipleInteraction","extendedTextInteraction"],_fullScoreMap:null,_userScoreMap:null,_state:"INCOMPLETE",_logger:e,_titleExtras:null,_answerExtras:null,_imageLoader:n,_mediaClass:"_mediaMark",_videoMinSize:{height:300,width:300},_audioMinSize:{height:200,width:200},_videoTagRegex:/<video(([\s\S])*?)<\/video>/g,_audioTagRegex:/<audio(([\s\S])*?)<\/audio>/g,_mediaSrcAttrRegex:/src="([^"]*)"/,_posterAttrRegex:/poster="([^"]*)"/,_heightAttrRegex:/height="([^"]*)"/,_widthAttrRegex:/width="([^"]*)"/,_modelRegex:/<(div|span) class="_qp-model"[\s\S]*?><\/(div|span)>/g,_modelIdRegex:/data-model-id="([\s\S]*?)"/,_modelNumRegex:/_(\d*?)-/,_modelHtmlRegex:/<[\s\S]*class="_qp-model"[\s\S]*?>([\s\S]*?)<\/[\s\S]*>/g,_modelLatexRegex:/<latex(?: class="math-tex")?>([\s\S]*?)<\/latex>/g,_modelIsWYSIWYG:/<div style=(["'])[^"']*?position:absolute;overflow:hidden[^"']*?\1 questionType="(data|textentry|handwrite)">/i,create:function(e,t,n){var a=i.extend({},this);a._event=t,a._score=0,a._state="INCOMPLETE",a._answer={},a._stat={},a._titleExtras={},a._answerExtras={},a._fullScoreMap={totalFullScore:0},a._userScoreMap={totalUserScore:0},a._modelItem={},a._itemModel=e,a._media=n;var s,o=0;for(var l in a._itemModel.modelMap){s=a._itemModel.modelMap[l],++o,a._answer[l]={state:"INCOMPLETE",value:[]},a._stat[l]={},a._titleExtras[l]={},a._answerExtras[l]={},a._fullScoreMap[l]=s.full_score||0,a._userScoreMap[l]=s.user_score||0;var c=r.create(a,s,t);a._modelItem[c._model.modelId]=c}return o>1&&(a._isComposite=!0),this._logger.debug("_assessmentTest:解析xml后得到的assessmentItem对象"),this._logger.debug(a),a},getScore:function(){return this._score},setScore:function(e){this._score=e},getAnswer:function(){return i.extend(!0,{},this._answer)},getItemModel:function(){return i.extend(!0,{},this._itemModel)},setAnswer:function(e){var t=!0,n={};for(var i in this._answer)n[i]={state:"INCOMPLETE",value:[]};var a,s;for(var i in n)a=e[i],a&&a.value&&(s=a.state,s||(s=""),n[i].state=s,n[i].value.pushArray(a.value));return this._answer=n,this._checkAnswer(),t},setStat:function(e){var t=!0,n={};for(var i in this._stat)n[i]={};for(var i in n)n[i]=e[i];return this._stat=n,t},setTitleExtras:function(e){var t=!0,n={};for(var i in this._titleExtras)n[i]={};n.composite={};for(var i in n)n[i]=e[i];return this._titleExtras=n,t},setExtrasAnswer:function(e,t,n){var a=!0,s=t.modelId,r=t.extraHtml;for(var s in this._answerExtras)this._answerExtras[s]=r;var o=i(r),l=s,c=s;return n||this.cleanExtras(e,c),this.appendToExtras(e,o,l),a},setFullScore:function(e){var t=e.modelId,n=e.fullScore||0;this._fullScoreMap&&void 0!==this._fullScoreMap[t]&&(this._fullScoreMap[t]=n,this._calTotalScore())},getFullScore:function(e){if(0==arguments.length){var t=this._calTotalScore();return t.totalFullScore}if(this._fullScoreMap&&void 0!==this._fullScoreMap[e])return this._fullScoreMap[e]},setUserScore:function(e){var t=e.modelId,n=e.userScore||0;this._userScoreMap&&void 0!==this._userScoreMap[t]&&(this._userScoreMap[t]=n,this._calTotalScore())},getUserScore:function(e){return 1!=arguments.length?(this._calTotalScore(),this._userScoreMap.totalUserScore):this._userScoreMap&&void 0!==this._userScoreMap[e]?this._userScoreMap[e]:void 0},_calTotalScore:function(){var e=0,t=0;for(var n in this._itemModel.modelMap){var i=this._itemModel.modelMap[n];e+=parseFloat(i.user_score),t+=parseFloat(i.full_score)}return{totalUserScore:e,totalFullScore:t}},getAnswerState:function(){var e,t,n,a=this,s={completionStatus:a._state,score:a._score,duration:0,numAttempts:0,responseVariable:[]};for(var r in a._answer)e=a._itemModel.correctAnswer[r],e?(t=a._answer[r],n={baseType:e.baseType,cardinality:e.cardinality,identifier:e.identifier,state:t.state,correctResponse:[],candidateResponse:[]},i(e.value).each(function(e,t){n.correctResponse.push(t)}),i(t.value).each(function(e,t){n.candidateResponse.push(t)}),s.responseVariable.push(n)):"INCOMPLETE"!==s.completionStatus&&(s.completionStatus="FAILED");return s},setAnswerState:function(e){var t=!1,n={},i=e.responseVariable;if(i){for(var a,s,r=0;r<i.length;r++)s=i[r],a={state:s.state,value:s.candidateResponse},n[s.identifier]=a;t=this.setAnswer(n)}return t},getState:function(){var e,t,n=this,a='<assessmentResult xmlns="http://edu.nd.com.cn/xsd/assessmentResult" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://edu.nd.com.cn/xsd/assessmentResult http://nd-schema.dev.web.nd/xsd/assessmentResult.xsd">    <itemResult>        <outcomeVariable identifier="completionStatus">            <value>'+n._state+'</value>        </outcomeVariable>        <outcomeVariable identifier="SCORE">            <value>'+n._score+'</value>        </outcomeVariable>        <responseVariable identifier="duration">            <candidateResponse><value>0</value></candidateResponse>        </responseVariable>        <responseVariable identifier="numAttempts">            <candidateResponse><value>0</value></candidateResponse>        </responseVariable>';for(var r in n._answer)e=n._itemModel.correctAnswer[r],e&&(t=n._answer[r],a+='<responseVariable baseType="'+e.baseType+'" cardinality="'+e.cardinality+'" identifier="'+e.identifier+'" state="'+t.state+'"><correctResponse>',i(e.value).each(function(e,t){t=s.xmlEncode(t),a+="<value>"+t+"</value>"}),a+="</correctResponse><candidateResponse>",i(t.value).each(function(e,t){t=s.xmlEncode(t),a+="<value>"+t+"</value>"}),a+="</candidateResponse></responseVariable>");return a+="</itemResult></assessmentResult>"},_stateParser:{responseVariableRegex:/<responseVariable[^\/]*?>[\s\S]*?<\/responseVariable>/g,identifierRegex:/identifier="([\s\S]*?)"/,baseTypeRegex:/baseType="([\s\S]*?)"/,cardinalityRegex:/cardinality="([\s\S]*?)"/,stateRegex:/state="([\s\S]*?)"/,candidateResponseRegex:/<candidateResponse[^\/]*?>([\s\S]*?)<\/candidateResponse>/,valueRegex:/<value>([\s\S]*?)<\/value>/g},setState:function(e){for(var t,n,i,a,r,e,o,l,c=!0,d=this,u=e.match(d._stateParser.responseVariableRegex),h={},g=0;g<u.length;g++)t=u[g],n=s.getValue(t,d._stateParser.baseTypeRegex),i=s.getValue(t,d._stateParser.cardinalityRegex),a=s.getValue(t,d._stateParser.identifierRegex),""!==n&&""!==i&&""!==a&&(e=s.getValue(t,d._stateParser.stateRegex),o={state:e,value:[]},r=s.getValue(t,d._stateParser.candidateResponseRegex),""!==r&&r.replace(d._stateParser.valueRegex,function(e,t){return l=s.xmlDecode(t),o.value.push(l),e}),h[a]=o);return c=this.setAnswer(h)},_checkAnswerValue:function(e,t,n){t=t.replace(this._modelLatexRegex,function(e,t){return t});var i=!1;if("multipleString"===e){for(var a=t.split("|"),s=0;s<a.length;s++)if(a[s].trim()==n){i=!0;break}}else t==n&&(i=!0);return i},_checkTextAnswerValue:function(e,t,n){var i=this._itemModel.correctAnswer[e];return i.value.length>0&&this._checkAnswerValue(i.baseType,t,n)},_checkModelAnswer:function(e,t){var n=this._itemModel.correctAnswer[e],i=this._answer[e];if(t)i.state="INCOMPLETE",this._score=0,this._state="INCOMPLETE";else if(n&&n.value.length>0)if(i.value.length>0){var a=!0;if(i.value.length!==n.value.length)a=!1;else if("single"===n.cardinality)a=this._checkAnswerValue(n.baseType,n.value[0],i.value[0]);else if("ordered"===n.cardinality)for(var s=0;s<n.value.length&&(a=this._checkAnswerValue(n.baseType,n.value[s],i.value[s]),a!==!1);s++);else{var r=[];r.pushArray(i.value);for(var o,s=0;s<n.value.length;s++){o=!1;for(var l=0;l<r.length;){var c=r.shift();if(o=this._checkAnswerValue(n.baseType,n.value[s],c))break;r.push(c),l++}if(o===!1){a=!1;break}}}a?(i.state="PASSED",this._checkAnswer()):(i.state="FAILED",this._score=0,this._state="FAILED")}else i.state="FAILED",this._score=0,this._state="FAILED";else i.state="FAILED",this._checkAnswer()},_checkAnswer:function(){var e,t=!0,n=!0;for(var i in this._answer)e=this._answer[i],""===e.state&&this._checkModelAnswer(i),"PASSED"!==e.state&&(t=!1),"INCOMPLETE"!==e.state&&(n=!1);t?(this._score=1,this._state="PASSED"):n?(this._score=0,this._state="INCOMPLETE"):(this._score=0,this._state="FAILED")},_getTitleExtras:function(e){return this._titleExtras[e]||{}},_getCompositeTitleExtras:function(){return this._titleExtras.composite||{}},createHintHtml:function(e,t){var n=this,i="",a=n._itemModel.hintFeedback[e];if(a&&"show"===a.showHide&&""!==a.content){var r=s.getLangText("prompt",t),o=s.getLangText("confirm",t);i='<div class="nqti-com-pop-content nqti-hide-dom _hint-pop-content" data-model-id="'+e+'">    <div class="nqti-com-pop-box com-pop-hint-box _hint-pop-content-box">        <p class="nqti-com-pop-hd">            <span class="nqti-pop-dec nqti-dec-1"></span>            <span class="nqti-pop-dec nqti-dec-2"></span>        </p>        <div class="nqti-com-pop-bd nqti-scrollbar-style-gray _hint-pop-bd">            <div class="nqti-com-remind-text">                <span class="nqti-text-size">'+a.content+'</span>            </div>        </div>        <div class="nqti-com-pop-bt">            <a class="nqti-hint-btn _hint-confirm-btn" href="javascript:;">                <span class="nqti-tip-icon-text">'+o+'</span>            </a>        </div>    </div></div><a class="nqti-hint-btn _hint-pop-btn " href="javascript:;" data-model-id="'+e+'">    <span class="nqti-tip-icon"></span>    <span class="nqti-tip-icon-text">'+r+"</span></a>"}return i},hintEventHandle:function(e){var n=e.find("._hint-pop-btn"),a=e.find("._hint-pop-content");if(n&&n.length>0&&a&&a.length>0){var s=e.find("._hint-pop-bd"),r=e.find("._hint-confirm-btn");a.qpStopMouseWheel&&a.qpStopMouseWheel(),s.bind("qpMouseWheel",function(e){var t=1.5*e.deltaY;e.currentTarget.scrollTop=e.currentTarget.scrollTop+t});var o=function(){a.addClass("nqti-hide-dom")};n.bind("qpTap",function(){a.removeClass("nqti-hide-dom");var e=parseInt(s.css("maxHeight")),n=parseInt(a.height()),r=i(t).height();!isNaN(r)&&r>0&&r-n<80&&(isNaN(e)||(r-n<0?s.css("maxHeight",Math.abs(e-80+(r-n))+"px"):s.css("maxHeight",Math.abs(e-80)+"px"))),a.css("height",a.height()+1+"px")}),a.bind("qpTap",function(e){var t=i(e.target),n=t.closest("._hint-pop-content-box");0===n.length&&o()}),r.bind("qpTap",o)}},_setExtrasTitleHtml:function(e,t,n,i){var a='<span class="_qti-title-prefix">';"undefined"!=typeof t.prefix&&t.prefix.length>0&&(a+=t.prefix),i.showQuestionName&&(a+=' <span class="_qti-title-prefix-qtype">('+n+")</span>"),a+="</span>";var s="";return"undefined"!=typeof t.suffix&&t.suffix.length>0&&(s='<span class="_qti-title-suffix">'+t.suffix+"</span>"),e=e.trim(),""!==a&&(e=/^(<(div|p)(.*?)>(\s*?))+/.test(e)?e.replace(/^(<(div|p)(.*?)>(\s*?))+/,function(e){return e+a}):a+e),""!==s&&(/(<\/(div|p)[^<>]*?>(\s*?))+$/.test(e)?e=e.replace(/(<\/(div|p)[^<>]*?>(\s*?))+$/,function(e){return s+e}):e+=s),e},createExtrasHtml:function(e,t,n){var i=this,a="",r=i._itemModel.hintFeedback[t]?i._itemModel.hintFeedback[t].content:"",o=i._itemModel.answerFeedback[t]?i._itemModel.answerFeedback[t].content:"",l="",c="";"choiceInteraction"===e.getModel().modelType?(l=e.getAnswer().join(""),c=e.getCorrectAnswer().join("")):(l=e.getAnswer().join(","),c=e.getCorrectAnswer().join(","));var d=[];if(d.push('<div class="nqti-module-extras-default">'),n.showUserAnswer||n.showCorrectAnswer){var u=s.getLangText("extras_user_answer",this._option),h=s.getLangText("extras_correct_answer",this._option);if(d.push('    <div class="nqti-extras-answer"> '),n.showUserAnswer){var g="PASSED"===this._answer[t].state?"nqti-correct":"nqti-wrong";d.push('        <span class="nqti-answer-user '+g+'">【'+u+"】"+l+"</span> ")}n.showCorrectAnswer&&d.push('        <span class="nqti-answer-correct">【'+h+"】"+c+"</span>  "),d.push("    </div> ")}return n.showHint&&(d.push('    <div class="nqti-extras-hint">  '),d.push("        <span>【"+s.getLangText("prompt",this._option)+"】</span> "),d.push("        <span>"+r+"</span>"),d.push("    </div>")),n.showAnalyse&&(d.push('    <div class="nqti-extras-analyse">'),d.push("        <span>【"+s.getLangText("analyse",this._option)+"】</span>"),d.push("        <span>"+o+"</span>"),d.push("    </div>")),d.push("</div>"),a=d.join("")},_parseHtml:function(e,n,i){var a=this,r=!1,o=e.replace(a._modelRegex,function(e){var t="",i=s.getValue(e,a._modelIdRegex);if(0===n.modelId.length||n.modelId.indexOf(i)>-1){var o=a._modelItem[i],l=o.getModel().modelType;o.init&&o.init(n),r=a._supportType.indexOf(l)!==-1;var c="",d="",u="",h="",g="";if(n.showNum&&o.hasNum()){var p;p=n.isElearningSkin?null===a._sequenceNumber?"null":a._isComposite?s.getValue(i,a._modelNumRegex):a._sequenceNumber:s.getValue(i,a._modelNumRegex),c='<div class="nqti-module-listnum"><em class="nqti-listnum-text">'+p+'</em><span class="nqti-listnum-dot">、</span></div>'}if(n.showTitleArea&&o.hasTitle()&&(u=o.createTitleHtml(n),""===u.trim()&&(u="无题目信息"),"textEntryInteraction"!==l&&(u=a._setExtrasTitleHtml(u,o.getTitleExtras(),o.getName(),n)),u='<div class="nqti-module-title"><em class="nqti-title-text">'+u+"</em></div>"),r){if(n.hideAnswerArea===!1||o.isBlock()===!1){var f="div";o.isBlock()===!1&&(f="span"),d=o.createAnswerHtml(n),d="<"+f+' class="nqti-module-content">'+d+"</"+f+">"}o.hasHint()&&(h=a.createHintHtml(i,n),h='<div class="nqti-hint-box '+(n.showHint?"":"nqti-hide-dom")+'">'+h+"</div>"),"textEntryInteraction"!==l&&(g='<div class="nqti-module-extras _qti-module-extras"></div>')}var m;""===u?r?m=d+h:(u="该题没有题目信息",m=u+d+h):m=u+h+d,m+=g,m+=r?"":"<p style='color: #e02222;font-size: 18px;margin-top: 5px;text-align: left'>当前qtiPlayer不支持该题型</p>",t+=o.hasNum()?c+m:m,t=a._parseHtml(t,n);var v=e.split("><");t=v[0]+">"+t+"<"+v[1]}return t});return n.swfHost&&t.Video&&(o=o.replace(a._videoTagRegex,function(e){var t=e.match(a._mediaSrcAttrRegex),n=e.match(a._heightAttrRegex),i=e.match(a._widthAttrRegex),s=e.match(a._posterAttrRegex);return t?(t=t[1],""===t&&console.log("没有指定视频来源...")):(t="",console.log("没有指定视频来源...")),s=s?s[1]:"",n?(n=parseFloat(n[1]),isNaN(n)&&(n=a._videoMinSize.height)):n=a._videoMinSize.height,n<a._videoMinSize.height&&(n=a._videoMinSize.height),i?(i=parseFloat(i[1]),isNaN(i)&&(i=a._videoMinSize.width)):i=a._videoMinSize.width,i<a._videoMinSize.width&&(i=a._videoMinSize.width),'<div poster_src="'+s+'" style="margin-bottom:5px;width:'+i+"px;height:"+n+'px;" media_src="'+t+'" class="'+a._mediaClass+'"></div>'}),o=o.replace(a._audioTagRegex,function(e){var t=e.match(a._mediaSrcAttrRegex),n=e.match(a._heightAttrRegex),i=e.match(a._widthAttrRegex),s=e.match(a._posterAttrRegex);return t?(t=t[1],""===t&&console.log("没有指定音频来源...")):(t="",console.log("没有指定音频来源...")),s=s?s[1]:"",n?(n=parseFloat(n[1]),isNaN(n)&&(n=a._audioMinSize.height)):n=a._audioMinSize.height,n<a._audioMinSize.height&&(n=a._audioMinSize.height),i?(i=parseFloat(i[1]),isNaN(i)&&(i=a._audioMinSize.width)):i=a._audioMinSize.width,i<a._audioMinSize.width&&(i=a._audioMinSize.width),'<div poster_src="'+s+'" style="margin-bottom:5px;width:'+i+"px;height:"+n+'px;" media_src="'+t+'" class="'+a._mediaClass+'"></div>'})),o},_parseCompositeHtml:function(e,t){var n={compositeTitle:'<div class="nqti-composite-title _qti-composite-title">                <div class="nqti-composite-title-content _qti-composite-title-content">       <div class="nqti-composite-title-inside _qti-composite-title-inside">            ${title}           </div>                                        </div>                                        <div class="nqti-composite-title-bar">            <div class="nqti-bar _qti-composite-bar">                            <div class="nqti-icon nqti-up"></div>             </div>                                        <div class="nqti-line" ></div>            </div>                                    </div>                                        ',compositeBody:' <div class="nqti-composite-body _qti-composite-body">'},i=/^([\w\W]*?)<div class="_qp-model/,a="",r=i.exec(e);return r&&r.length>1&&(a=r[1]),a=this._setExtrasTitleHtml(a,this._getCompositeTitleExtras(),s.getLangText("complex",this._option),t),t.showCompositeSeparate&&(a=s.template(n.compositeTitle,{title:a}),a+=n.compositeBody),e=e.replace(r[1],a)+"</div>"},_compositeSeparateEventHandler:function(e){var t,n=e.find("._qti-composite-title"),i=e.find("._qti-composite-title-content"),a=e.find("._qti-composite-title-inside"),s=e.find("._qti-composite-bar"),r=e.find("._qti-composite-body"),o=a.height(),l=parseInt(i.css("lineHeight")),c=parseInt(i.css("fontSize"));t=l<=1||l<c?2*c+10:2*l,isNaN(t)&&(t=30);var d=parseInt(i.css("paddingTop"))||0,u=parseInt(i.css("paddingBottom"))||0;t=t+d+u;var h=function(l){var c=s.height(),h=e.height();h-=c,o=a.height(),o=o+d+u,l?n.hasClass("nqti-down")?(n.removeClass("nqti-down"),o>h/2?i.css("height",h/2+"px"):i.css("height",o+"px")):(n.addClass("nqti-down"),t<o?i.css("height",t+"px"):i.css("height",o+"px")):n.hasClass("nqti-down")?t<o?i.css("height",t+"px"):i.css("height",o+"px"):o>h/2?i.css("height",h/2+"px"):i.css("height",o+"px"),r.css("height",h+c-n.height()+"px")};h(!1),a.resize(function(){h(!1)}),s.on("qpTap",function(){h(!0)})},render:function(e,t,n){var a=this;this._option=t;for(var r in a._modelItem)u=a._modelItem[r],u.setOption(t);var o="";a._itemModel.hasMath&&"undefined"!=typeof MathJax&&(o="nqti-player-run-loading");var l="";t.showNum&&(l="nqti-module-show-num");var c="";t.showScore=!0,t.showScore&&(c="nqti-module-show-score");var d,u,h,g=!0,p=!0,f="",m=0;for(var r in a._modelItem)if(d||(d=r),u=a._modelItem[r],f=u.getName(),"textEntryInteraction"!==u._model.modelType&&(p=!1),"textEntryInteraction"!==u._model.modelType&&"inlineChoiceInteraction"!==u._model.modelType){if(g=!1,m++,h&&h!==u._model.modelType){m++,f="复合题";break}h=u._model.modelType}m=m>1;var v=a._itemModel.prompt;m&&(v=a._parseCompositeHtml(a._itemModel.prompt,t)),p&&(v=a._setExtrasTitleHtml(v,a._modelItem[d].getTitleExtras(),a._modelItem[d].getName(),t));var v=a._parseHtml(v,t,e);if(v=a._imageLoader.parseImage(e,v,t),g){var _="";for(var r in a._itemModel.hintFeedback){_=r;break}if(""!==_){var x=a.createHintHtml(_,t);v+=x}}var w=s.getLangText("mathjax_loading",t),y=" "+t.skin+" "+t.platForm,b="nqti-show-composite-num",q=t.isElearningSkin;if(q&&t.showNum&&a._isComposite){var A;A=null===a._sequenceNumber?"一":a._sequenceNumber;var R='<div class="nqti-composite-listnum"><em class="text">'+A+"</em></div>";v='<div class="nqti-composite-container">'+R+v+"</div>"}v=q?'<div class="_qti-player '+y+'">    <div class="_qti-player-body nqti-player-body nqti-scrollbar-style-gray '+b+" "+l+'">'+v+'        <div class="nqti-player-loading '+o+'">            <em>'+w+'<span class="nqti-loading-dotting"></span></em>        </div>    </div></div>':'<div class="_qti-player '+y+'">    <div class="_qti-player-body nqti-player-body nqti-scrollbar-style-gray '+l+'">'+v+'        <div class="nqti-player-loading '+o+'">            <em>'+w+'<span class="nqti-loading-dotting"></span></em>        </div>    </div></div>',e.html(v),t.showMedia?a._media.render(e,t):e.find("audio,video").each(function(){var e=i(this),t=e.attr("poster");t&&e.before('<img src="'+t+'" alt=""/>'),e.remove()});var S=e.find("._qti-player-body"),I=S.find("._qp-model");I.each(function(){var e=i(this),n=e.data("model-id");e.addClass("nqti-module-body"),q&&t.showNum&&e.addClass("npti-show-onlymodule-num");var s=a._modelItem[n],r=s.getClassName(t);e.addClass(r),s.render&&s.render(e,t)});var C=function(){I.each(function(){var e=i(this),n=e.data("model-id"),s=a._modelItem[n];s.getModel();s.eventHandle(e,t),a.hintEventHandle(e,t),s.renderLock&&s.renderLock(e),t.showAnswer?s.renderAnswer&&s.renderAnswer(e):t.showCheckedAnswer?s.renderCheckedAnswer&&s.renderCheckedAnswer(e):t.showCorrectAnswer?s.renderCorrectAnswer&&s.renderCorrectAnswer(e):t.showStatisAnswer&&s.renderStatisAnswer&&s.renderStatisAnswer(e)}),g&&a.hintEventHandle(S,t),e.find("img").bind("qpTap",function(){var e=i(this),t=e.data("src");t||(t=e.attr("src")),a._event.trigger("image","click",{url:t})}),a._imageLoader.load(),a._compositeSeparateEventHandler(e),a._media.setLock(t.lockMedia,e),n&&n()};a._itemModel.hasMath&&"undefined"!=typeof MathJax?(MathJax.Hub.Queue(["Typeset",MathJax.Hub]),MathJax.Hub.Queue(["End",function(){try{C()}catch(e){a._logger.error("异步渲染异常处理"),a._logger.error(e)}S.removeClass("nqti-player-run-loading"),a._event.trigger("latex","onEnded"),a._event.trigger("render","rendered",a._option)}])):(C(),a._event.trigger("latex","onEnded"),a._event.trigger("render","rendered",a._option))},_modelEach:function(e,t){var n=this,a=e.find("._qti-player-body ._qp-model");a.each(function(){var e=i(this),a=e.data("model-id"),s=n._modelItem[a];t.apply(n,[e,s,a])})},setLock:function(e,t){this._modelEach(e,function(e,n){n.setLock&&n.setLock(e,t)}),this._event.trigger("render","renderChanged",this._option)},showAnswer:function(e){this._modelEach(e,function(e,t){t.showAnswer&&t.showAnswer(e)}),this._event.trigger("render","renderChanged",this._option)},setSequenceNumber:function(e){this._sequenceNumber=e},getSupportType:function(){return this._supportType},showCheckedAnswer:function(e){this._modelEach(e,function(e,t){t.showCheckedAnswer&&t.showCheckedAnswer(e)}),this._event.trigger("render","renderChanged",this._option)},showUsrAndCorrectAnswer:function(e){this._modelEach(e,function(e,t){var n=t._model.questionType,i="choice"===n||"multiplechoice"===n;i?t.showUsrAndCorrectAnswer&&t.showUsrAndCorrectAnswer(e):console.warn("只有单项选择和多项选择才支持showUsrAndCorrectAnswer接口")}),this._event.trigger("render","renderChanged",this._option)},showCorrectAnswer:function(e){this._modelEach(e,function(e,t){t.showCorrectAnswer&&t.showCorrectAnswer(e)}),
this._event.trigger("render","renderChanged",this._option)},showStatisAnswer:function(e){this._modelEach(e,function(e,t){t.showStatisAnswer&&t.showStatisAnswer(e)}),this._event.trigger("render","renderChanged",this._option)},reset:function(e){this._modelEach(e,function(e,t){t.reset&&t.reset(e)}),this._event.trigger("render","renderChanged",this._option)},showDefaultExtras:function(e,t){var n=this;this._modelEach(e,function(e,a,s){var r=n.createExtrasHtml(a,s,t);e.find("._qti-module-extras").html(r);var o=i.extend(!0,n._option,{img:{render:!0}});n._media.render(e,o)}),"undefined"!=typeof MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,e[0]])},appendToExtras:function(e,t,n){var a=this;this._modelEach(e,function(e,s,r){if(n&&"undefined"!=typeof n){if(n===r){e.find("._qti-module-extras").append(t);var o=i.extend(!0,a._option,{img:{render:!0}});a._media.render(e,o)}}else e.find("._qti-module-extras").append(t),a._media.render(e,a._option)}),"undefined"!=typeof MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,e[0]])},cleanExtras:function(e,t){this._modelEach(e,function(e,n,i){console.log(i),t&&"undefined"!=t&&t===i&&e.find("._qti-module-extras").html("")})},destroy:function(){var e;for(var t in this._modelItem)e=this._modelItem[t],e.destroy&&"function"===i.type(e.destroy)&&e.destroy();this._media.destroy()}};return o}),s("player/assessment/assessmentTest",["model/logger","player/utils/extendUtils"],function(e,t){var n=a("player/assessment/assessmentItem"),s={_assessmentItem:null,_sequenceNumber:null,_option:null,_event:null,_media:null,_logger:e,create:function(e,t,n){var a=i.extend({},this);return a._event=t,a._option=e,a._media=n,a._sequenceNumber=e.sequenceNumber||null,a},loadAssessmentItem:function(e){this._assessmentItem=n.create(e,this._event,this._media),this._sequenceNumber&&this._assessmentItem.setSequenceNumber(this._sequenceNumber)},getAssessmentItem:function(){return this._assessmentItem},render:function(e,t,n){this._sequenceNumber=t.sequenceNumber||null,this._sequenceNumber&&this._assessmentItem.setSequenceNumber(this._sequenceNumber),this._assessmentItem?this._assessmentItem.render(e,t,n):this._logger.warn("_assessmentTest:render失败,请先加载数据")}};return s}),s("player/cls/baseInteraction",function(){var e=a("player/cls/class"),t=a("player/utils/extendUtils"),n=a("player/config/lang"),s=function(){};s.prototype.base=function(){function e(t){var n=t.Base;return n.Base?function(){this.base=e(n),n.apply(this,arguments)}:n}var t=this.Type.Base;t.Base?(this.base=e(t),t.apply(this,arguments),delete this.base):t.apply(this,arguments)};var r=e(s,function(){var e={Create:function(e){this.base(),null!=n&&void 0!=n||(n={});var i=e.getModel();this.name=i.modelType,this.interactionId=t.Rd.getRandom(this.name),this.modalItem=e,this.modalModel=i},setOption:function(e){this.option=e},isDomExist:function(){return i('[data-key="'+this.interactionId+'"]').length>0},getLangText:function(e,t){return null!=n[e]&&void 0!=n[e]?n[e]:t},getAnswerRandom:function(e,t){return n.Rd.getAnswerRandom(e-1,t,this.option.randomSeed)},isLock:function(){return this.option.showLock},getAnswer:function(){return this.modalItem.getAnswer()},getCorrectAnswer:function(){return this.modalItem.getCorrectAnswer()},setAnswer:function(e){return this.modalItem.setAnswer(e)},getLogger:function(){return this.modalItem.getLogger()},getShuffle:function(){return!!this.modalItem.getModel().shuffle}};return e}());return r}),s("player/cls/class",function(){var e=function(e,t){function n(){}n.prototype=e.prototype;var i=new n;for(var a in t)"Create"!=a&&(i[a]=t[a]);t.toString()!=Object.prototype.toString()&&(i.toString=t.toString),t.toLocaleString()!=Object.prototype.toLocaleString()&&(i.toLocaleString=t.toLocaleString),t.valueOf()!=Object.prototype.valueOf()&&(i.valueOf=t.valueOf);var s=null;return s=t.Create?t.Create:function(){this.base.apply(this,[e,t])},s.prototype=i,s.Base=e,s.prototype.Type=s,s};return e}),s("player/config/extrasOption",function(){var e={showHint:!0,showUserAnswer:!0,showCorrectAnswer:!0,showAnalyse:!0};return e}),s("player/config/lang",function(){var e={mathjax_loading:"正在努力解析中...",confirm:"确定",prompt:"提示",drawing_source_material:"素材",drawing_stem:"题干",drawing_view_material:"查看素材",drawing_view_topics:"查看题目",drawing_continue_write:"继续书写",gapmath_title:"将以下选项进行归类",inline_choice_choose:"请选择",vote_sigleitem:"单项投票",vote_mutipleitem:"不定项投票",vote_tip_pre:"总共有",vote_tip_end:"个投票项，投票时请注意查看，避免遗漏。",choice_screenshot_title:"请选择正确的答案",text_title:"请完成下面的填空",extras_user_answer:"您的答案",extras_correct_answer:"正确答案",analyse:"解析",single_choise:"单选题",multiple_choise:"多选题",blank_filling:"填空题",connection:"连线题",sort:"排序题",question:"问答题",voting:"投票题",true_or_false:"判断题",puzzle:"拼图题",complex:"复合题"},t={mathjax_loading:"解析中...",confirm:"OK",prompt:"ヒント",drawing_source_material:"素材",drawing_stem:"問題テキスト",drawing_view_material:"素材をみる",drawing_view_topics:"問題をみる",drawing_continue_write:"書き続ける",gapmath_title:"以下の選択肢を分類してください",inline_choice_choose:"ご選択を",vote_sigleitem:"単一選択肢投票",vote_mutipleitem:"複数選択肢投票",vote_tip_pre:"合計",vote_tip_end:"投票選択肢，投票の時に、見逃さないようにしてください。",choice_screenshot_title:"正しい回答を選択してください",text_title:"以下の穴埋めを完成してください",extras_user_answer:"ご解答",extras_correct_answer:"正解",analyse:"解析",single_choise:"単一選択問題",multiple_choise:"複数選択問題",blank_filling:"穴埋め問題",connection:"リンク問題",sort:"並べ替え問題",question:"記述問題",voting:"投票問題",true_or_false:"正誤問題",puzzle:"ジグソーパズル問題",complex:"複合問題"},n={zh:e,ja:t,ja_jp:t,en:{mathjax_loading:"Loading...",confirm:"Confirm",prompt:"Hints",drawing_source_material:"Material",drawing_stem:"Question Stem",drawing_view_material:"查看素材",drawing_view_topics:"查看题目",drawing_continue_write:"继续书写",gapmath_title:"将以下选项进行归类",inline_choice_choose:"Please select",vote_sigleitem:"Single Vote",vote_mutipleitem:"Multiple Votes",vote_tip_pre:"There is ",vote_tip_end:" voting items, please check carefully to avoid the omission.",choice_screenshot_title:"Please choose the correct answer",text_title:"Please fill in the following blanks",extras_correct_answer:"Correct Answer",analyse:"Analysis",single_choise:"Single Choice",multiple_choise:"Multiple Choice",blank_filling:"Fill-in-the-blank ",connection:"Matching",sort:"Sorting Exercise",question:"Question",voting:"Voting",true_or_false:"True or False",puzzle:"Puzzle",complex:"Mixed Question Types"},es_ec:{mathjax_loading:"正在努力解析中...",confirm:"Confirmar",prompt:"Sugerencia",drawing_source_material:"Materiales",drawing_stem:"Tema",drawing_view_material:"Consultar Materiales",drawing_view_topics:"Consultar Ejercicios",drawing_continue_write:"Sigue escribiendo",gapmath_title:"Clasificar siguientes opciones",inline_choice_choose:"请选择",vote_sigleitem:"单项投票",vote_mutipleitem:"不定项投票",vote_tip_pre:"总共有",vote_tip_end:"个投票项，投票时请注意查看，避免遗漏。",choice_screenshot_title:"请选择正确的答案",text_title:"请完成下面的填空",extras_correct_answer:"正确答案",analyse:"解析"}};return n}),s("player/config/option",function(){var e={refPath:"",unifyTextEntry:!1,lang:"zh",skin:"wood",platForm:"",showNum:!1,screenshotLayout:!1,showTitleArea:!0,hideAnswerArea:!1,showAnswerArea:!0,showSubSequence:!1,showHint:!0,showStat:!1,showLock:!1,showAnswer:!1,showCheckedAnswer:!1,showCorrectAnswer:!1,showStatisAnswer:!1,showMedia:!0,lockMedia:!1,modelId:[],randomSeed:[],event:!0,expectWidth:0,expectHeight:0,thumbnailEnable:!0,showQuestionName:!1,showCompositeSeparate:!1,graphicGapMatchImageLoaderEnable:!0};return e}),s("player/config/platForm",function(){var e={pptshell:"qp-player-pptshell",statis:"qp-statis"};return e}),s("player/config/skin",function(){var e={wood:"nqti-player-skin-wood",elearning:"nqti-player-skin-elearning"};return e}),s("player/media/defaultMediaPlayer",function(){var e=function(){},t={_$medias:null,_eventHandler:null,create:function(){var t=i.extend({},this);return t._eventHandler={play:e,pause:e,ended:e,timeupdate:e,seeked:e,volumeChange:e,fullScreenChange:e},t._$medias={},t},render:function(e,t){},renderImg:function(){},eventHandle:function(e,t){var n=this,a=function(e){var t=i(this),a=t[0].tagName,s=a+"-"+e;n._$medias[s]=t;var r={mediaId:s,index:e,mediaType:a},o=["play","pause","ended","timeupdate","seeked"];i(o).each(function(e,i){"seeked"===i?r.seeked=t[0].currentTime:delete r.seeked,t.bind(i,function(){n._eventHandler[i](r)})})};e.find("audio").each(a),e.find("video").each(a)},mediaOnStart:function(e){"function"===i.type(e)&&(this._eventHandler.play=e)},mediaOnPause:function(e){"function"===i.type(e)&&(this._eventHandler.pause=e)},mediaOnEnded:function(e){"function"===i.type(e)&&(this._eventHandler.ended=e)},mediaOnTimeupdate:function(e){"function"===i.type(e)&&(this._eventHandler.timeupdate=e)},mediaOnVolumeChange:function(e){"function"===i.type(e)&&(this._eventHandler.volumeChange=e)},mediaOnSeeked:function(e){"function"===i.type(e)&&(this._eventHandler.seeked=e)},_getMedia:function(e,t){var n=e+"-"+t,i=this._$medias[n];return i},mediaPlay:function(e,t){var n=this._getMedia(e,t);n&&n.trigger("play")},mediaPause:function(e,t){var n=this._getMedia(e,t);n&&n.trigger("pause")},mediaPauseAll:function(e){},mediaSkip:function(e,t,n){var i=this._getMedia(e,t);i&&(i[0].currentTime=n,i.trigger("pause"))},mediaVolumeChange:function(e,t,n,i){},mediaOnFullScreenChange:function(e){},destroy:function(){},setLock:function(e,t){}};return t}),s("player/media/eLearningMediaPlayer",function(){if(!t.Video)throw new Error("未加载elearning媒体播放器资源，请手动加载");var e=function(){};t.ELMediaPlayer={_players:[],_eventHandler:{play:e,pause:e,ended:e,timeupdate:e,seeked:e,volumeChange:e,fullScreenChange:e,fullScreen:e,fullScreenExit:e},_getMedia:function(e,t){var n=this,i=e+"-"+t;for(var a in this._$medias)if(n._getKeyMedia(a)===i){var s=this._$medias[a];return s}return null},render:function(e,n){var a=this;a._players.length=0;for(var s=e.find("._mediaMark"),r=0;r<s.length;++r){var o=i(s[r]).attr("media_src"),l={video:{swfHost:n.swfHost||"http://static.auxo.test.huayu.nd/auxo/addins/flowplayer/v1.0.0/",url:o,autoPlay:!1}},c=new t.Video.Player(s[r],l);c.addEventListener("onStart",function(){console.log("onStart...");for(var e=0;e<a._players.length;++e)this!=a._players[e]&&a._players[e].pause();a._eventHandler.play()}),c.addEventListener("onPause",function(){console.log("onPause..."),a._eventHandler.pause()}),c.addEventListener("onFullscreen",function(){console.log("onFullscreen..."),a._eventHandler.fullScreenChange(),a._eventHandler.fullScreen()}),c.addEventListener("onFullscreenExit",function(){console.log("onFullscreenExit..."),a._eventHandler.fullScreenChange(),a._eventHandler.fullScreenExit()}),c.addEventListener("onFinish",function(){console.log("onFinish..."),a._eventHandler.ended()}),c.addEventListener("onSeek",function(){console.log("onSeek..."),a._eventHandler.seeked()}),c.addEventListener("onResume",function(){console.log("onResume");for(var e=0;e<a._players.length;++e)this!=a._players[e]&&a._players[e].pause()}),this._players.push(c)}},mediaOnStart:function(e){"function"==typeof e&&(this._eventHandler.play=e)},mediaOnPause:function(e){"function"==typeof e&&(this._eventHandler.pause=e)},mediaOnEnded:function(e){"function"==typeof e&&(this._eventHandler.ended=e)},mediaOnTimeupdate:function(e){"function"==typeof e&&(this._eventHandler.timeupdate=e)},mediaOnSeeked:function(e){"function"==typeof e&&(this._eventHandler.seeked=e)},mediaOnVolumeChange:function(e){"function"==typeof e&&(this._eventHandler.volumeChange=e)},getMedia:function(){},mediaPlay:function(){for(var e=this,t=0;t<e._players.length;++t)e._players[t].replay()},mediaPause:function(){for(var e=this,t=0;t<e._players.length;++t)e._players[t].pause()},mediaPauseAll:function(){},mediaSkip:function(){},mediaVolumeChange:function(){},mediaOnFullScreenChange:function(e){"function"==typeof e&&(this._eventHandler.fullScreenChange=e)},mediaOnFullScreen:function(e){"function"===i.type(e)&&(this._eventHandler.fullScreen=e)},mediaOnFullScreenExit:function(e){"function"==typeof e&&(this._eventHandler.fullScreenExit=e)},destroy:function(){var e=this;this._fullChangeEvent.remove(this._eventHandler.fullScreenChange);for(var t=0;t<e._players.length;++t)e._players[t].close();e._players=null}};var n={_mediaImpl:t.ELMediaPlayer,_eventHandler:null,_fullChangeEvent:{onFullScreenChange:[],trigger:function(e){this.onFullScreenChange.forEach(function(t){t&&t(e)})},push:function(e){this.onFullScreenChange.push(e)},remove:function(e){for(var t=this.onFullScreenChange.length,n=0;n<t;n++)e===this.onFullScreenChange[n]&&(this.onFullScreenChange.splice(n,1),n--,t--)}},create:function(){var t=i.extend({},this);return t._eventHandler={play:e,pause:e,ended:e,timeupdate:e,seeked:e,volumeChange:e,fullScreenChange:e},t},render:function(e,t){t.onPlay=this._eventHandler.play,t.onPause=this._eventHandler.pause,t.onEnd=this._eventHandler.ended,t.onSeek=this._eventHandler.seeked,t.onVolumeChange=this._eventHandler.volumeChange,t.onTimeUpdate=this._eventHandler.timeupdate,t.onFullScreenChange=this._eventHandler.fullScreenChange,this._mediaImpl.render(e,t)},renderImg:function(){},mediaOnStart:function(e){"function"===i.type(e)&&this._mediaImpl.mediaOnStart(e)},mediaOnPause:function(e){"function"===i.type(e)&&this._mediaImpl.mediaOnPause(e)},mediaOnEnded:function(e){"function"===i.type(e)&&this._mediaImpl.mediaOnEnded(e)},mediaOnTimeupdate:function(e){"function"===i.type(e)&&(this._eventHandler.timeupdate=e)},mediaOnVolumeChange:function(e){"function"===i.type(e)&&(this._eventHandler.volumeChange=e)},mediaOnSeeked:function(e){"function"===i.type(e)&&this._mediaImpl.mediaOnSeeked(e)},mediaPlay:function(){this._mediaImpl.mediaPlay()},mediaPause:function(){this._mediaImpl.mediaPause()},mediaPauseAll:function(){this._mediaImpl.mediaPauseAll()},mediaSkip:function(){this._mediaImpl.seek()},mediaVolumeChange:function(){this._mediaImpl.setVolume()},mediaOnFullScreenChange:function(e){"function"===i.type(e)&&(this._mediaImpl.mediaOnFullScreenChange(e),this._fullChangeEvent.push(this._eventHandler.fullScreenChange))},mediaOnFullScreen:function(e){"function"===i.type(e)&&this._mediaImpl.mediaOnFullScreen(e)},mediaOnFullScreenExit:function(e){"function"===i.type(e)&&this._mediaImpl.mediaOnFullScreenExit(e)},destroy:function(){this._fullChangeEvent.remove(this._eventHandler.fullScreenChange),this._mediaImpl.destroy()},setLock:function(){}};return n}),s("player/media/eMedia",function(){var e=a("player/media/eLearningMediaPlayer"),t=a("player/media/mediaApi"),n=function(e){for(var n,a=["create","render","renderImg","mediaOnStart","mediaOnPause","mediaOnEnded","mediaOnTimeupdate","mediaOnSeeked","mediaOnVolumeChange","mediaPlay","mediaPause","mediaSkip","mediaVolumeChange","mediaOnFullScreenChange","mediaPauseAll","setLock"],s=!0,r=0;r<a.length;r++)if(n=a[r],!e[n]||"function"!==i.type(e[n])){s=!1;break}if(!s)throw"QtiPlayer.extendMedia输入错误,请确认输入的对象是否有实现所有的api";i.extend(t,e)};return n(e),t}),s("player/media/lowVersionMediaPlayer",[],function(){var e=function(){},n={_fullChangeEvent:{onFullScreenChange:[],trigger:function(e){this.onFullScreenChange.forEach(function(t){t&&t(e)})},push:function(e){this.onFullScreenChange.push(e)},remove:function(e){for(var t=this.onFullScreenChange.length,n=0;n<t;n++)e===this.onFullScreenChange[n]&&(this.onFullScreenChange.splice(n,1),n--,t--)}},_mediaImpl:t.NDMediaPlayer,_eventHandler:null,create:function(){var t=i.extend({},this);return t._eventHandler={play:e,pause:e,ended:e,timeupdate:e,seeked:e,volumeChange:e,fullScreenChange:e},t},render:function(e,t){t.onPlay=this._eventHandler.play,t.onPause=this._eventHandler.pause,t.onEnd=this._eventHandler.ended,t.onSeek=this._eventHandler.seeked,t.onVolumeChange=this._eventHandler.volumeChange,t.onTimeUpdate=this._eventHandler.timeupdate,t.onFullScreenChange=this._eventHandler.fullScreenChange,e.find("audio").removeAttr("height"),e.find("audio").removeAttr("width"),e.find("audio").removeAttr("poster"),e.find("video,audio").mediaelementplayer({})},renderImg:function(e,t){},mediaOnStart:function(e){"function"===i.type(e)&&(this._eventHandler.play=e)},mediaOnPause:function(e){"function"===i.type(e)&&(this._eventHandler.pause=e)},mediaOnEnded:function(e){"function"===i.type(e)&&(this._eventHandler.ended=e)},mediaOnTimeupdate:function(e){"function"===i.type(e)&&(this._eventHandler.timeupdate=e)},mediaOnVolumeChange:function(e){"function"===i.type(e)&&(this._eventHandler.volumeChange=e)},mediaOnSeeked:function(e){"function"===i.type(e)&&(this._eventHandler.seeked=e)},mediaPlay:function(e,t){this._mediaImpl.mediaPlay(e,t)},mediaPause:function(e,t){this._mediaImpl.mediaPause(e,t)},mediaPauseAll:function(e){this._mediaImpl.mediaPauseAll(e)},mediaSkip:function(e,t,n){this._mediaImpl.mediaSkip(e,t,n)},mediaVolumeChange:function(e,t,n,i){this._mediaImpl.mediaVolumeChange(e,t,n,i)},mediaOnFullScreenChange:function(e){"function"===i.type(e)&&(this._eventHandler.fullScreenChange=e,this._fullChangeEvent.push(this._eventHandler.fullScreenChange))},destroy:function(){this._fullChangeEvent.remove(this._eventHandler.fullScreenChange)},setLock:function(e,t){}};return n}),s("player/media/media",function(){var e=a("player/media/lowVersionMediaPlayer"),n=a("player/media/defaultMediaPlayer"),s=a("player/media/ndMediaPlayer"),r=a("player/media/mediaApi"),o=function(e){for(var t,n=["create","render","renderImg","mediaOnStart","mediaOnPause","mediaOnEnded","mediaOnTimeupdate","mediaOnSeeked","mediaOnVolumeChange","mediaPlay","mediaPause","mediaSkip","mediaVolumeChange","mediaOnFullScreenChange","mediaPauseAll","setLock"],a=!0,s=0;s<n.length;s++)if(t=n[s],!e[t]||"function"!==i.type(e[t])){a=!1;break}if(!a)throw"QtiPlayer.extendMedia输入错误,请确认输入的对象是否有实现所有的api";i.extend(r,e)};return"undefined"==typeof Audio?(o(e),t.NDMediaPlayer&&(r.renderImg=function(){var e=s;return function(){var t=Array.prototype.slice.apply(arguments,[0]);return s.renderImg.apply(e,t)}}())):o(t.NDMediaPlayer?s:n),r}),s("player/media/mediaApi",function(){var e={create:function(){},render:function(e,t){},renderImg:function(e){},mediaOnStart:function(e){},mediaOnPause:function(e){},mediaOnEnded:function(e){},mediaOnTimeupdate:function(e){},mediaOnVolumeChange:function(e){},mediaOnSeeked:function(e){},mediaPlay:function(e,t){},mediaPause:function(e,t){},mediaPauseAll:function(){},mediaSkip:function(e,t,n){},mediaVolumeChange:function(e,t,n,i){},mediaOnFullScreenChange:function(e){},destroy:function(){},setLock:function(e,t){}};return e}),s("player/media/ndMediaPlayer",function(){var e=function(){},n={_fullChangeEvent:{onFullScreenChange:[],trigger:function(e){this.onFullScreenChange.forEach(function(t){t&&t(e)})},push:function(e){this.onFullScreenChange.push(e)},remove:function(e){for(var t=this.onFullScreenChange.length,n=0;n<t;n++)e===this.onFullScreenChange[n]&&(this.onFullScreenChange.splice(n,1),n--,t--)}},_mediaImpl:t.NDMediaPlayer,_eventHandler:null,create:function(){var t=i.extend({},this);return t._eventHandler={play:e,pause:e,ended:e,timeupdate:e,seeked:e,volumeChange:e,fullScreenChange:e},t},render:function(e,t){t.onPlay=this._eventHandler.play,t.onPause=this._eventHandler.pause,t.onEnd=this._eventHandler.ended,t.onSeek=this._eventHandler.seeked,t.onVolumeChange=this._eventHandler.volumeChange,t.onTimeUpdate=this._eventHandler.timeupdate,t.onFullScreenChange=this._eventHandler.fullScreenChange,t&&"undefined"==typeof Audio&&(t.video||(t.video={}),t.video.render=!1,t.audio||(t.audio={}),t.audio.render=!1),t.lock=t.lockMedia,this._mediaImpl.render(e,t)},renderImg:function(e,t,n,a){var s=this,r={video:{render:!1},audio:{render:!1},img:{render:!0,renderUI:!0,renderImmediately:!0},lang:n,lock:a};r.onFullScreenChange=function(e){s._fullChangeEvent.trigger(e)},i.extend(r.img,t),this._mediaImpl.renderMediaEle(e,r)},mediaOnStart:function(e){"function"===i.type(e)&&(this._eventHandler.play=e)},mediaOnPause:function(e){"function"===i.type(e)&&(this._eventHandler.pause=e)},mediaOnEnded:function(e){"function"===i.type(e)&&(this._eventHandler.ended=e)},mediaOnTimeupdate:function(e){"function"===i.type(e)&&(this._eventHandler.timeupdate=e)},mediaOnVolumeChange:function(e){"function"===i.type(e)&&(this._eventHandler.volumeChange=e)},mediaOnSeeked:function(e){"function"===i.type(e)&&(this._eventHandler.seeked=e)},mediaPlay:function(e,t){this._mediaImpl.mediaPlay(e,t)},mediaPause:function(e,t){this._mediaImpl.mediaPause(e,t)},mediaPauseAll:function(e){this._mediaImpl.mediaPauseAll(e)},mediaSkip:function(e,t,n){this._mediaImpl.mediaSkip(e,t,n)},mediaVolumeChange:function(e,t,n,i){this._mediaImpl.mediaVolumeChange(e,t,n,i)},mediaOnFullScreenChange:function(e){"function"===i.type(e)&&(this._eventHandler.fullScreenChange=e,this._fullChangeEvent.push(this._eventHandler.fullScreenChange))},destroy:function(){this._fullChangeEvent.remove(this._eventHandler.fullScreenChange)},setLock:function(e,t){this._mediaImpl.setLock(e,t)}};return n}),s("player/model/modelHandlerFactory",["model/logger"],function(e){var t={_modelHandler:{},_logger:e,isSupport:function(e){var t=!1;return this._modelHandler[e]&&(t=!0),t},register:function(e){e.getName&&e.create&&(this._logger.debug("_modelHandlerFactory:regiser modelHandler:"+e.getName()),this._modelHandler[e.getName()]=e)},getModelHandler:function(e){return this._modelHandler[e]}};return t}),s("player/model/modelItem",["model/logger","player/model/modelHandlerFactory"],function(e,t){var n={_logger:e,_modelHandlerFactory:t,_event:null,_assessmentItem:null,_model:null,_option:null,create:function(e,t,n){var a=i.extend({},this);a._model=t,a._assessmentItem=e,a._event=n;var s=this._modelHandlerFactory.getModelHandler(a._model.modelType);return s?s.create(a):this._logger.error("model:"+a._model.modelType+"不存在"),a},setOption:function(e){this._option=e},getOption:function(){return this._option},triggerOptionClick:function(e,t){var n={identifier:this._model.modelId,index:e,val:t};this._event.trigger("assessmentItem","optionClick",n)},hasNum:function(){return!0},hasHint:function(){return!0},hasTitle:function(){return!0},isBlock:function(){return!0},getName:function(){return""},getClassName:function(){return""},getLogger:function(){return this._logger},getModel:function(){return i.extend(!0,{},this._model)},getAnswer:function(){var e=this._assessmentItem._answer[this._model.modelId].value,t=[];return t.pushArray(e),t},getStat:function(){return this._assessmentItem._stat[this._model.modelId]||{}},getTitleExtras:function(){return this._assessmentItem._titleExtras[this._model.modelId]||{}},getCorrectAnswer:function(){var e=[],t=this._assessmentItem._itemModel.correctAnswer[this._model.modelId];return t&&e.pushArray(t.value),e},setAnswer:function(e,t){var n=this._assessmentItem._answer[this._model.modelId].value,a=!1,s=!0;if(e&&e.forEach(function(e){""!==e&&(s=!1)}),0===n.length&&s?a=!1:n.length!==e.length?a=!0:i(n).each(function(t,n){if(n!==e[t])return a=!0,!1}),n.clear(),e&&n.pushArray(e),a){this._assessmentItem._checkModelAnswer(this._model.modelId,t);var r=i.extend(!0,{},this._assessmentItem._answer);this._event.trigger("answer","change",r)}},checkTextAnswer:function(e,t){return this._assessmentItem._checkTextAnswerValue(this._model.modelId,e,t)},showAnswer:function(e){this._option.showAnswer=!0,this._option.showCorrectAnswer=!1,this._option.showCheckedAnswer=!1,this._option.showStatisAnswer=!1,this.renderReset&&this.renderReset(e),this.renderAnswer&&this.renderAnswer(e),this.renderLock&&this.renderLock(e)},showCheckedAnswer:function(e){this._option.showCorrectAnswer=!0,this._option.showAnswer=!0,this._option.showCheckedAnswer=!0,this._option.showStatisAnswer=!0,this.renderReset&&this.renderReset(e),this.renderCheckedAnswer&&this.renderCheckedAnswer(e),this.renderLock&&this.renderLock(e)},showUsrAndCorrectAnswer:function(e){this._option.showCorrectAnswer=!0,this._option.showAnswer=!0,this._option.showCheckedAnswer=!1,this._option.showStatisAnswer=!1,this.renderReset&&this.renderReset(e),this.renderAnswer&&this.renderAnswer(e),this.renderCorrectAnswer&&this.renderCorrectAnswerNoneGrayBg(e),this.renderLock&&this.renderLock(e)},showCorrectAnswer:function(e){this._option.showCorrectAnswer=!0,this._option.showAnswer=!1,this._option.showCheckedAnswer=!1,this._option.showStatisAnswer=!1,this.renderReset&&this.renderReset(e),this.renderCorrectAnswer&&this.renderCorrectAnswer(e),this.renderLock&&this.renderLock(e)},showStatisAnswer:function(e){this._option.showAnswer=!1,this._option.showCorrectAnswer=!1,this._option.showCheckedAnswer=!1,this._option.showStatisAnswer=!0,this.renderReset&&this.renderReset(e),this.renderStatisAnswer&&this.renderStatisAnswer(e),this.renderLock&&this.renderLock(e)},reset:function(e){if(this._option.showCorrectAnswer=!1,this._option.showAnswer=!1,this._option.showCheckedAnswer=!1,this._option.showStatisAnswer=!1,this.setAnswer([],!0),this.renderReset){var t=this.renderReset(e);t&&this.setAnswer(t)}this.setLock(e,!1)},setLock:function(e,t){this._option.showLock=t,this.renderLock&&this.renderLock(e)},isLock:function(){return this._option.showLock||this._option.showCorrectAnswer||this._option.showCheckedAnswer}};return n}),s("player/utils/area",function(){var e={getRectIntersectArea:function(e,t){var n=0;if(e.l>t.l&&e.l<t.r&&e.t>t.t&&e.t<t.b&&(n=(t.r-e.l)*(t.b-e.t)),e.r>t.l&&e.r<t.r&&e.t>t.t&&e.t<t.b){var i=(e.r-t.l)*(t.b-e.t);i>n&&(n=i)}if(e.l>t.l&&e.l<t.r&&e.b>t.t&&e.b<t.b){var i=(t.r-e.l)*(e.b-t.t);i>n&&(n=i)}if(e.r>t.l&&e.r<t.r&&e.b>t.t&&e.b<t.b){var i=(e.r-t.l)*(e.b-t.t);i>n&&(n=i)}if(e.l<t.l&&e.r>t.r&&e.t>t.t&&e.b<t.b){var i=(t.r-t.l)*(e.b-e.t);i>n&&(n=i)}return n},getInteractRect:function(e,t,n,i,a){var s,r,o=this,l=0,c=0;return a.forEach(function(a,s){var d=o.getRectIntersectArea({l:e,t:t,r:e+i,b:t+n},a),u=o.getRectIntersectArea(a,{l:e,t:t,r:e+i,b:t+n});u>d&&(d=u),d>0&&c++,d>l&&(l=d,r=s)}),c>1?s=a[r]:l>=i*n*2/5&&(s=a[r]),s},pointToLine:function(e,t,n,i,a,s){var r,o,l,c=0;if(r=this.lineSpace(e,t,n,i),o=this.lineSpace(e,t,a,s),l=this.lineSpace(n,i,a,s),l<=1e-6||o<=1e-6)return c=0;if(r<=1e-6)return c=o;if(l*l>=r*r+o*o)return c=o;if(o*o>=r*r+l*l)return c=l;var d=(r+o+l)/2,u=Math.sqrt(d*(d-r)*(d-o)*(d-l));return c=2*u/r},lineSpace:function(e,t,n,i){var a=Math.sqrt((e-n)*(e-n)+(t-i)*(t-i));return a}};return e}),s("player/utils/browser",function(){var e=t.navigator.userAgent.toLowerCase();jQuery.browser={version:(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)};var i={Android:function(){return!!navigator.userAgent.match(/Android/i)},BlackBerry:function(){return!!navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return!!navigator.userAgent.match(/iPhone|iPad|iPod/i)},Windows:function(){return!!navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Windows()},Mobile:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Windows()},IEVersion:function(){var e=999999;if("Microsoft Internet Explorer"==t.navigator.appName||t.navigator.appVersion.indexOf("MSIE")>0)n.documentMode?e=n.documentMode:(e=5,n.compatMode&&"CSS1Compat"==n.compatMode&&(e=7));else{var i=/Trident\/7\./.test(navigator.userAgent);i&&(e=11)}return e},isIE:function(){return 999999!=this.IEVersion()}};return i}),s("player/utils/checkOption",["player/config/skin","player/config/platform"],function(e,t){var n=function(n){if(n&&"object"===i.type(n)){n=i.extend({},n);for(var a in n)null!==n[a]&&void 0!==n[a]||delete n[a];for(var s,r=["showAnswerArea","showAnswer","showCheckedAnswer","showCorrectAnswer","showStatisAnswer","hideAnswerArea"],o=!1,l=0;l<r.length;l++)if(s=r[l],void 0!==n[s]){o=!0;break}if(o){for(var c=!1,l=0;l<r.length;l++)s=r[l],n[s]&&c===!1?(c=!0,n[s]=!0):n[s]=!1;c===!1&&(n.hideAnswerArea=!0)}if(n.modelId&&"array"!==i.type(n.modelId)&&(n.modelId=[]),n.randomSeed&&"array"!==i.type(n.randomSeed)&&(n.randomSeed=[]),n.platForm){var d=t[n.platForm];n.platForm=d||""}if(n.lang&&"string"===i.type(n.lang)&&(n.lang=n.lang.toLowerCase()),!n.skin&&n.theme&&(n.skin=n.theme),n.skin){n.isElearningSkin="elearning"===n.skin;var u=e[n.skin];n.skin=u||e.wood}else n.skin=e.wood}else n={};return n};return n}),s("player/utils/dom",function(){var e={getParentElement:function(e,t){for(;!e.hasClass(t)&&"body"!=e[0].nodeName.toLocaleLowerCase();)e=e.parent();return e},toCenter:function(e){var a=0;t.innerHeight?a=t.innerHeight:n.body&&n.body.clientHeight&&(a=n.body.clientHeight),n.documentElement&&n.documentElement.clientHeight&&(a=n.documentElement.clientHeight);var s=i(n).scrollTop(),r=(a-e.height())/2+s;r<0&&(r=50),i(e).css("top",r+"px"),i(e).css("position","absolute"),i(e).show()},addListener:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},allowNumKeyCodes:[48,49,50,51,52,53,54,55,56,57,110,109,96,97,98,99,100,101,102,103,104,105,108,190,8,37,38,40,39,46,189],allowNumKeyDown:function(){var e=event.keyCode;event.shiftKey&&(e=0);for(var t=event.srcElement||event.target,n=t.value,i=!1,a=0;a<this.allowNumKeyCodes.length;a++){var s=this.allowNumKeyCodes[a];if(e===s){109==e||189==e?0==n.length?(t.value="",i=!0):i=!(n.toString().indexOf("-")>-1):190==e||110==e?(0==n.length&&(t.value=""),i=!(n.toString().indexOf(".")>-1)):i=!0;break}}return t.setAttribute("key-result",i+"|"+e+"|"+event.ctrlKey),i},allowNumInput:function(){var e=event.srcElement||event.target,t=e.getAttribute("key-result"),n=null!=t?t.split("|"):[];if(n.length<3)return""==e.value&&(e.value=""),!1;if(!(e.value.length>0)){var i=n[0],a=n[1],s=n[2],r=e.getAttribute("pre-v")||"";return"true"==i||"true"==s?(""==r||""!=e.value||37==a||39==a||8==a||46==a||38==a||40==a||s&&88==a?s&&86==a&&(e.value=e.value):e.value=r,e.setAttribute("pre-v",e.value)):e.value=r,e.setAttribute("key-result",""),!1}},getCursorPos:function(e){var t=e.get(0),i=0;if("selectionStart"in t)i=t.selectionStart;else if("selection"in n){t.focus();var a=n.selection.createRange(),s=n.selection.createRange().text.length;a.moveStart("character",-t.value.length),i=a.text.length-s}return i},getSelectedText:function(){var e="";if(t.getSelection){var i=n.activeElement;if(!i||"textarea"!=i.tagName.toLowerCase()&&("input"!=i.tagName.toLowerCase()||"text"!=i.getAttribute("type").toLowerCase()&&"number"!=i.getAttribute("type").toLowerCase())){var a=t.getSelection();e=a.toString()}else{var s=i.value;e=s.substring(i.selectionStart,i.selectionEnd)}}else if(n.getSelection)r=n.getSelection(),e=r.toString();else if(n.selection.createRange){var r=n.selection.createRange();e=r.text}return e},inputNumberKeydown:function(e,t){var n=e.val(),a=t.keyCode,s=!0,r=this.getCursorPos(e),o=this.getSelectedText(),l=o.length;if(109==a||189==a)0==n.length?(e.val(""),s=!0):s=n.toString().indexOf("-")<=-1||o.indexOf("-")>=0;else if(190==a||110==a){0==n.length&&e.val("");var c=n.toString().indexOf(".");s=c<=-1||o.indexOf(".")>=0}else s=!0;if(!s)return!1;if(!((""===n||0===this.getCursorPos(e))&&(189===t.keyCode||109===t.keyCode)&&n.indexOf("-")<0||"-"===n.substring(0,1)&&0===r&&l>0&&(189===t.keyCode||109===t.keyCode))){var c=n.indexOf(".");if(!(i.inArray(t.keyCode,[46,8,9,27,13,110,190])!==-1||65==t.keyCode&&(t.ctrlKey===!0||t.metaKey===!0)||t.keyCode>=35&&t.keyCode<=40))return"-"===n.substring(0,1)&&0===this.getCursorPos(e)&&l<=0&&(189!==t.keyCode||109!==t.keyCode)?(t.preventDefault(),!1):(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)?(t.preventDefault(),!1):void 0}}};return e}),s("player/utils/extendUtils",["model/utils","player/config/lang","player/utils/checkOption","player/config/platForm"],function(e,t,n,i){var s=a("player/utils/random"),r=a("player/utils/img"),o=a("player/utils/svg"),l=a("player/utils/area"),c=a("player/utils/dom"),d=a("player/utils/browser");return e.getPlatForm=function(){return i},e.getLangText=function(e,n){var i=t[n.lang]?t[n.lang]:t.zh,a=i[e];return null!==a&&void 0!==a&&""!==a||(a=""),a},e.checkOption=n,e.Svg=o,e.Img=r,e.Rd=s,e.Area=l,e.Dom=c,e.Broswer=d,e}),s("player/utils/imageLoader",["model/logger","player/utils/extendUtils"],function(e,t){var n=a("player/media/media"),s=function(){},r={
_waitingQueue:null,_loadQueue:null,_loadingIconData:null,_imageLoaderPool:null,_emptyIconData:null,_errorIconData:null,_imageRegex:/<img([\s\S]*?)\/>/g,_srcRegex:/src="([\s\S]*?)"/,_widthRegex:/width="([\s\S]*?)"/,_heightRegex:/height="([\s\S]*?)"/,_dataClassRegex:/data-class="([\s\S]*?)"/,_dataWidthRegex:/data-width="([\s\S]*?)"/,_dataHeightRegex:/data-height="([\s\S]*?)"/,_lazyLoadRegex:/data-lazy-load="(true|false)"/,_renderMediaImgRegex:/data-media-img-render=(["'])([\s\S]*?)\1/,_loadingImageStart:!1,_imageIndex:0,_imageLoaderMaxNum:6,create:function(){var e=i.extend({},this);e._waitingQueue=[],e._loadQueue=[],e._emptyIconData="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",e._errorIconData="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADKUlEQVRIS6WVX0hTcRTHv2eba//UVuhLVBD5FAhRIJVNLZAoFAOF/hDOUIqiMiRRJIQso6QgJYTqYWXoQ1YK+hJhcyhUEBTRQ+JT9JKG+W+bTHdP5+76b7rNW56ny73nnM/5nnN+v0vQaQwYkGVPi7h/8I8SoOgJFT99xnmWHJCxSbyFFb5GfTM+PZG6AJwNJ5Lsz0F0VEvKPeOK/4zTi/G1IPoALttZGOmhACxafg6Kjgvk9XvWDeD9lu3YYOyU5HujkrHyEbNcQgPBH4kgCRVEBptjq5Pq66ViI5SwlstgBAhhKFwPb+B2ooEnBrhsu2EydEpLdiB1E5B7XAN4XwMTY/JAw6KimAb8X+KpiAvgXTAjzdEsGs4hPAcUVYAv3YvkoZYqoOsxYDSpO9WKkelK+oZQLEh8gMueDxO1S9BmzAnAXQMuq9cAngbA07gA+C0KT8rA3+oGjO1BqjPZ1gaDoSASpCooKANXNkt2AjVfXVKgfleUbkwFSukTJlZCYirgXEupHKpWSWaNBKjD3XcEfP2ZBrjpBgZ7tWFHjAMy8vPU729bE8Au61bZmhcgQ9aisyK3QkYmuKlH3R5QdSHw/bMADEv5FLwXqSXkDf5cDolSIGtJyLPVSpU35HGhPClQAGlbwA/eqBMAXckHRiUPLQOAZW1RB6//riSVVJpFAw6aM2Eyv5S3O6OksvinOMGNnVK1AGqKgUlZU2nXChvCXKiYfKGvqwCRtUy33ZeqLq7aBhVgsYJrn2gzaCwHZgKxAKraFkwGqmTgs1EK5LY8LHvXIQm0KzmWueu0t55bcV2EMIIwnaD+6XeLAM5CCuwOj7yYP6or4lUFyRuBY6Xah96nwJRcpKtbpH1nvEJo2k2DmIo0kV320zDhkUTYYpamnoPCcvDlZSe5W9qlnuSYxn7Z7QrqC3YQZ1u3IcnYLoM9EFf3PwPUqpUBhPkUca6jAQaulurNcQHzWwRXkebi65It+hO/RVqfQnKF3CE+ZP8lnukJpjbfV5lD1HWt51/FIwJwDEmGjDUB/+PAyrC0yJot2+CSySf9T464MSTngNmnR+e6uH8BvXgVNfoEydIAAAAASUVORK5CYII=",e._loadingIconData="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAAvCAYAAACsaemzAAAHnklEQVRoQ9WZa2xTZRjHn3N6ejnttq7bgDEYhTHNGLDB5CIk4ETAEOWabCRqjPgJ1Eg0ihATQ2KMaCKaIeoHgQ/GKAYhYQQCARMkwrhs2QXGBiwwUMdtjN26de3p8f+ctlvXtYOtXS1vc3Ju7Tnv7/0/t/etQEHt8uXLL4qi+B0uZwXfi+dzVVWvC4KwRQjs5IULF/QJCQm/4cYqvu69qcYzh9ZLfw89Hk95P6DS0lJzdnb2ESi0kL/UIsjkFCQfWPxxcR+NqkI21aH1UVGUW2GBPCSoteJo5aEoS31jEF9QKjCsahdNVe6SCJ0eE8gEoPhsrFCy2k25kQGxXiLpyAkN3TjWkSIYfZYcW3+LApBAOoxIZvcxmtB1jIyeFnKJCXTLtIQa5WXkEiwBLjryqkYMJJBCeW0llNu5myTYLtsw66WQga5Ziqki6SNyC+aYRcaIgNi0xvScpcIHG8jgadNg+pqKc4lO27bRdXkV7igjL49v2IbtQwyU3/415bXv0PwmuInkpqvmtVSW/FlMYPwZMgIgkWa3fkpTOveQB2qEArouL6e/bF9pQSMWLWKTm+z4nZ59uCWk47OZVSa+RzWJ7+C+JxY8WoUQgUICyZ5mWvDgXUp3lpFHYLNjP2I9FGqRptDJlB3UJmUNG0jwKevB81TVQyLe4b3GPjowJUQE5LVZkWyuOvhRCQLEOS3ScYS7b5gJZd6mu4aCYYVt7rRbdVKz6x+647pBbe771IP0kCAmU4p+HI01TCaLzjoAKmIgP5SE2snqbvDmISGRWvXZ1IP9UE2Ngz6r0eRsoKtd5+lOzw1yAYQ76tWetBRuldIoW55Fk+WZpEcS96sVFSCvc3irBX/zggytSmBVujztdKnzFDV0VWggfpMLdkAGEPGxm6bTzMQlZBaTeo0wrA9t3bpVXLx4sSU1NfUQV9t9xWn0aznueIv7NlW0H6Wmnmu+jPboipHBMo05NDdpBZlQoXhwHhaourra5nK5Us1m848Aem6kgNjM7rlu0fm2Q/TA/W9YVcKHSZWeMs+hgoSlCBoGAHWFLk4rKyufxqzPajKZvgRQ4UgAsTLNrr/pTNsBeui+MwwYv8GLML2llGOep00fQlbbly5dWoAZn06SpE8A9PxgQDzK3iquv9/4r4UKsV4za6IzrQeGqUz/Qouj3sLkVyhLl0JTlNsD50MAehU/aQbMpkcBcVi957qphVe32qO9ySDKlIRoZJPGUpIulXSCHrjeBMugDgSAM637fT4TeSXBz86SC2gplJqm3B8IVFdX9zF8qFKv17+PNYVFwQpxp9yqi651lVOd4zR1Kq1ah/0asUtjcgFnNVOaPhMvm4H8kU0S7NyFHFPefkT7LT8nOk1FCJdpuXU1LdLxtEXpm7FyhCsuLt6JKeyhUEAivu6CEtUdJ+iK4xz/NGzHvOaG2hsgdtM0mm4ppJvOWqpsP96rWHSACMPpofnybHrNPMOb0fxrCljtMWO1Zx8U2hkM1Io1BQUwVYCpd5wNWYKE6yDD2aQxyDcd1O3pjKI63jcqgJhjyqd1ljn9gaqqqsYbjcZDINyi0+k+CDa5WiS/6o4/hgTjh2Qor5FFy9T6ho8VYqA3goGwuDgPEPsBtA5AH/qBLovpykXXDYmduQfhMXr2Hx2jGwxoDSLbbpjcWoTtTQyEYkM9q+qU0raDUsuwEmB0Oj3YU8ICIcJtBMQ2AK0KBPrFcVE51VUmcVCIxxYWqLa29hsotMHtdq8IBNrTUaacc9ZIuhjNQIc6aCGBeD3bYrH8CoVeDgV0HkBc6cZjCwdkBRCvZxfA5FYGK/TEASFkT0JBehwKZAT7EJvcEwdUU1MzH8m0FCYnA2j1E68QitIiQPyEqYMCH1oTCLRbCwrVcRsUuFKYa5rRv1JAUt0M//kcQI5AIGR2dZ+jQq1wXhHjNcox0DOmHFqDQlhbkuZaDiF7F6qDNwcCETlQJXejwo7nZsI0xYyFE622U5RGAUn1hFYZQCH40Es4LoJPveWfx8QzTGC9yMfo/0Ghvr6+Acf8BzGvsK9vbGw8nJaWth7Hdl9FObTlnNiOAMbfu+IJQW60tLTsYoWcuGjw9eMWbuwE6VVMx0X+dmz79/hv477BxBwQ4OTKlSs78Ett4AUEhbsICqMCHgUm/BMb5w08IvpZ39HR8cKsWbOa/N0VysvL12EutBFQ47Al4oYhnpUJHGdY0Z+dnZ3LAOToBWKVjh49OgrVwhjkoLGAmwCwTGwTEP3GY58OwFR8LwnHJp/NxoV+APp57969r2MJoffvjsF8RNi+fbspJycnAbApAGVgVjET+4mAHQe4DJyPxmYFoRl7fSxJ4UNf5Obmbg5857CdHqNisNvt5oyMDBtWW0cDcgzCvR17O0BZWd4Y1obzETFlFAIbpk6d+kNUgAZToqioSFdYWChDXSsgU6FmusFgYDPOxDFDZwJyNLY0bFZsxqGaMgJCD9rqvLy8wyMO9Aiz6zVlQNpkWWZYNuXxbMqsLraxAOfIa8V1MwMHPxP+cxNAS/Pz8+v/b6BBeUtKSozp6emW5ORk/uMgnVUFcBZgJwFsEs4nsjrIld82NDR8j/XEfinmP8t8qmxgb+JWAAAAAElFTkSuQmCC",e._imageLoaderPool=[];for(var t=0;t<e._imageLoaderMaxNum;)e._imageLoaderPool.push(new Image),t++;return e},_getImageLoader:function(){return this._imageLoaderPool.shift()},_returnImageLoader:function(e){e.onerror=s,e.onload=s,e.src=this._emptyIconData,this._imageLoaderPool.push(e)},parseImage:function(e,n,i){var a=this,s=n.replace(a._imageRegex,function(n){var s=t.getValue(n,a._srcRegex),r="";if(""!==s){var o=t.getValue(n,a._lazyLoadRegex);if("false"===o)r=n;else{var l="qp-loading-image-"+a._imageIndex,c=t.getValue(n,a._dataClassRegex),d=parseInt(t.getValue(n,a._dataWidthRegex));d||(d=parseInt(t.getValue(n,a._widthRegex)),d||(d=0));var u=parseInt(t.getValue(n,a._dataHeightRegex));u||(u=parseInt(t.getValue(n,a._heightRegex)),u||(u=0));var h=t.getValue(n,a._renderMediaImgRegex,2);i.thumbnailEnable||(h=!1),r='<img class="'+l+" "+c+'" data-src="'+s+"\" data-media-img-render='"+h+"' data-lang=\""+i.lang+'" data-lockmedia="'+i.lockMedia+'" src="'+a._loadingIconData+'" />',a._imageIndex++,a._waitingQueue.push({$view:e,imageId:l,src:s,width:d,height:u})}}return r});return s},_renderMediaImg:function(e,t,i){var a=180,s=260,r=e.data("media-img-render"),o=e.data("lang"),l=e.data("lockmedia"),c=!(r===!1);return"object"==typeof r&&(s=r.minWidth,a=r.minHeight),!!(e[0]&&c&&e[0].parentNode&&(t>s||i>a))&&(n.renderImg(e[0],"object"==typeof r?r:{},o,l),!0)},_loadImage:function(){var e=this,t=function(t,n){n.onerror=function(){e._returnImageLoader(n),t.$image[0].src=e._errorIconData},n.onload=function(){var i=this.width,a=this.height,s=t.width,r=t.height;if(t.$image.length>0){t.$image[0].src=e._emptyIconData;var o=0,l=0;if(s&&r){if(o=s,l=r,i>s||a>r){var c=i/s,d=a/r;c>d?(l=parseInt(a/c),o=s):(l=r,o=parseInt(i/d)),t.$image.attr("width",o),t.$image.attr("height",l)}t.$image[0].src=t.src}else t.$image[0].src=t.src,o=i,l=a,s&&t.$image.attr("width",s),r&&t.$image.attr("height",r);e._renderMediaImg(t.$image,o,l)}e._returnImageLoader(n)},n.src=t.src},n=function(){for(var i,a=e._loadQueue.shift();a;)i=e._imageLoaderPool.shift(),i?(t(a,i),a=e._loadQueue.shift()):(e._loadQueue.unshift(a),a=null);e._loadQueue.length>0?setTimeout(n,500):e._loadingImageStart=!1};e._loadingImageStart===!1&&e._loadQueue.length>0&&(e._loadingImageStart=!0,n())},load:function(){var e,t=this,n=t._waitingQueue;t._waitingQueue=[];for(var i=0;i<n.length;i++)e=n[i],e.$image=e.$view.find("."+e.imageId),1===e.$image.length&&this._loadQueue.push(e);t._loadImage()}},o=r.create();return o}),s("player/utils/img",function(){var e={PreLoadingImg:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjFFQjM3Q0UzNDAxRDExRTFCMDY2RjdDNTdFQjYzRUM1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjFFQjM3Q0U0NDAxRDExRTFCMDY2RjdDNTdFQjYzRUM1Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MUVCMzdDRTE0MDFEMTFFMUIwNjZGN0M1N0VCNjNFQzUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MUVCMzdDRTI0MDFEMTFFMUIwNjZGN0M1N0VCNjNFQzUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4pDOh4AAAABlBMVEX///8AAABVwtN+AAAAAXRSTlMAQObYZgAAABhJREFUeNpiYBgFo2AUjIJRMApoBwACDAAGaAABg+4RpgAAAABJRU5ErkJggg==",resizeImage:function(e,t,n,a){var s=i(e),r=s.attr("data-load");if("true"!=r){var o=function(){var e=l.width,i=l.height;l.width>n&&(e=n,i=l.height*(e/l.width)),i>a&&(i=a,e=l.width*(i/l.height)),s.attr("src",t),s.attr("width",e+"px"),s.attr("height",i+"px"),s.attr("data-load",!0)},l=new Image;l.src=t,l.complete?o(l.width,l.height):l.onload=function(){o(l.width,l.height),l.onload=null}}},resize:function(e,t,n,i,a,s){var r=e,o=t,l=1;return a&&r<a&&(l=(a/r).toFixed(3),o=parseInt(l*o),r=a),s&&o<s&&(l=(s/o).toFixed(3),r=parseInt(l*r),o=s),e>n&&(l=(n/e).toFixed(3),o=parseInt(l*t),r=n),o>i&&(l=(i/t).toFixed(3),r=parseInt(l*e),o=i),{w:r,h:o,scale:l}}};return e}),s("player/utils/playerEvent",["model/logger"],function(e){var t=function(t){e.debug("empty func invoke:"),e.debug(t)},n={_logger:e,_eventHandler:null,create:function(){var e=i.extend({},this);return e._eventHandler={answer:{change:t},image:{click:t},latex:{onEnded:t},assessmentItem:{optionClick:t},render:{rendered:t,renderChanged:t,destroy:t,resize:t},on:{error:t}},e},trigger:function(e,t,n){this._logger.debug("player trigger event:"+e+"-"+t),this._eventHandler[e][t](n)},bind:function(e,t,n){this._eventHandler[e]&&this._eventHandler[e][t]&&"function"===i.type(n)&&(this._logger.debug("player bind event:"+e+"-"+t),this._eventHandler[e][t]=n)}};return n}),s("player/utils/random",function(){var e=function(e,t){var n=t-e+1;return Math.floor(Math.random()*n+e)},t=function(t,n){var i=t+1;"undefined"!=typeof n&&n>0&&(i=t-n+1);for(var a=function(t,i){var s=0;"undefined"!=typeof n&&n>0&&(s=n);for(var r=e(s,t),o=!1,l=0;l<i.length;l++)if(r==i[l]){o=!0;break}o?a(t,i):i.push(r)},s=[],r=0;r<i;r++)a(t,s);return s},n={getRandom:function(e){var t=(10*Math.random()+(new Date).getMilliseconds()).toString().replace(".","");return e?e+t:t},getRandomRange:e,getRandomArray:function(e){for(var t=[],n=[],i=0;i<e;i++)t[i]=i;for(;t.length;){var a=Math.random();n.push(t.splice(Math.floor(a*t.length),1)[0])}return n},shuffleArray:function(e,t){var n=e;if(t&&t.length>0){n=[];for(var i,a,s=0;s<t.length;s++)i=t[s],a=e[i],a&&n.push(a);for(var s=0;s<e.length;s++)a=e[s],n.indexOf(a)===-1&&n.push(a)}else for(var r,o,s=n.length-1;s>0;s--)r=Math.floor(Math.random()*(s+1)),o=n[s],n[s]=n[r],n[r]=o;return n},getAnswerRandom:function(e,n,i){if(n||(n=0),i&&i instanceof Array&&!(i.length<=0)){for(var a=i,s=[],r=0;r<a.length;r++){var o=parseInt(a[r]);o>e||"undefined"!=typeof n&&o<n||s.push(o)}if(e+1>s.length)for(var l=n;l<e+1;l++){for(var c=!1,d=0;d<s.length;d++)if(s[d]==l){c=!0;break}c||s.push(l)}return s}return t(e,n)}};return n}),s("player/utils/svg",function(){var e={twConstants:{DIALECT_SVG:"svg",DIALECT_VML:"vml",NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink"},getSVGDocument:function(e){if(!e)return null;var t=null,n=!1;if(n){if("embed"==e.tagName.toLowerCase())try{t=e.getSVGDocument()}catch(i){alert(i+" may be svg embed not init")}}else t=e.ownerDocument;return t},getSVGRoot:function(e,t){return e?"embed"==e.tagName.toLowerCase()?t?t.documentElement:this.getSVGDocument(e).documentElement:"svg"==e.tagName.toLowerCase()?e:null:null},addLine:function(e,t,n,i,a,s,r,o,l){var c=e.createElementNS(this.twConstants.NS_SVG,"line");return c.setAttribute("id",n),c.setAttribute("x1",i),c.setAttribute("y1",a),c.setAttribute("x2",s),c.setAttribute("y2",r),c.setAttribute("style",l),c.setAttribute("class",o),t.appendChild(c),c},addImgLine:function(e,t,n,i,a,s,r,o,l,c,d){var u=e.createElementNS(this.twConstants.NS_SVG,"line");if(u.setAttribute("id",n),u.setAttribute("x1",i),u.setAttribute("y1",a),u.setAttribute("x2",s),u.setAttribute("y2",r),u.setAttribute("style",l),u.setAttribute("class",o),t.appendChild(u),d){var h=e.createElementNS(this.twConstants.NS_SVG,"foreignObject");h.setAttribute("x",(parseInt(i)+parseInt(s))/2-19),h.setAttribute("y",(parseInt(a)+parseInt(r))/2-20),h.setAttribute("id","foreignObject_"+n),h.setAttribute("height","39px"),h.setAttribute("width","38px");var g=e.createElement("div");c?g.setAttribute("class","qp-correct-answer"):g.setAttribute("class","qp-wrong-answer"),h.appendChild(g),t.appendChild(h)}}};return e}),s("player/player",["model/logger","player/utils/extendUtils"],function(e,n){var s,r=t.QtiPlayer,o=a("player/assessment/assessmentTest"),l=a("player/utils/playerEvent"),c=a("player/config/extrasOption"),d=a("player/config/option"),u=a("model/exception"),h={_event:null,_media:null,_assessmentTest:null,_option:null,_uuid:null,create:function(e){var t=i.extend({},this);e=n.checkOption(e);var r,c=i.extend({},d,e),u=l.create();e.swfHost?(s=a("player/media/eMedia"),r=s.create()):(s=a("player/media/media"),r=s.create());var h=o.create(c,u,r);return t._option=c,t._event=u,t._media=r,t._assessmentTest=h,t},setOption:function(e){i.extend(this._option,e)},load:function(e,t){var n=this;r.load(e,n._option,function(e){n._assessmentTest.loadAssessmentItem(e),t&&t()},function(e){var t=u.create("load",e);n._event.trigger("on","error",t)})},_render:function(t,a,s){try{var r=i.type(t),o=null;"string"===r?o=i("#"+t):"object"===r&&(o=t instanceof jQuery?t:i(t)),this._uuid=n.getUuid(),o.attr("data-qti-id",this._uuid);var l=i.extend(!0,{},a);l=n.checkOption(l),i.extend(this._option,l),l.randomSeed&&"array"===i.type(l.randomSeed)&&l.randomSeed.length>0&&(this._option.randomSeed=l.randomSeed),this._assessmentTest.render(o,this._option,s)}catch(c){var d=u.create("render",c);e.error("render异常",d),this._event.trigger("on","error",d)}},render:function(e,t,n){this._render(e,t,n)},_destroy:function(){r.closeCustomKeyBoard(),r.resetMedia();var e=this._assessmentTest.getAssessmentItem();e&&e.destroy()},destroy:function(){this._destroy()},getModelType:function(){var e={},t=this._assessmentTest.getAssessmentItem();if(t){var n,i=t.getItemModel();for(var a in i.modelMap)n=i.modelMap[a],e[a]=n.modelType}return e},getSupportType:function(){return this._assessmentTest.getAssessmentItem().getSupportType()},getModelQuestionType:function(){var e={},t=this._assessmentTest.getAssessmentItem();if(t){var n,i=t.getItemModel();for(var a in i.modelMap)n=i.modelMap[a],e[a]=n.questionType}return e},isMultipleModel:function(){var e=!1,t=this._assessmentTest.getAssessmentItem();if(t){var n=t.getItemModel(),i=0;for(var a in n.modelMap)i++;i>1&&(e=!0)}return e},getScore:function(){var e=this._assessmentTest.getAssessmentItem();return e?e.getScore():0},_setScore:function(e){var t=this._assessmentTest.getAssessmentItem();t.setScore(e)},getAnswerState:function(){var e=this._assessmentTest.getAssessmentItem();return e?e.getAnswerState():{}},setAnswerState:function(e){var t=!1,n=this._assessmentTest.getAssessmentItem();return n&&(t=n.setAnswerState(e)),t},getAnswer:function(){var e=this._assessmentTest.getAssessmentItem();return e?e.getAnswer():{}},answerOnChange:function(e){this._event.bind("answer","change",e)},latexOnEnded:function(e){this._event.bind("latex","onEnded",e)},answerOnClick:function(e){this._event.bind("assessmentItem","optionClick",e)},getAssessmentModel:function(){var e=this._assessmentTest.getAssessmentItem();return e?e.getItemModel():{}},setAnswer:function(e){var t=!1,n=this._assessmentTest.getAssessmentItem();return n&&(t=n.setAnswer(e),this._event.trigger("answer","change",n.getAnswer())),t},setStat:function(e){var t=!1,n=this._assessmentTest.getAssessmentItem();return n&&(t=n.setStat(e)),t},setTitleExtras:function(e){var t=!1,n=this._assessmentTest.getAssessmentItem();return n&&(t=n.setTitleExtras(e)),t},getState:function(){var e=this._assessmentTest.getAssessmentItem();return e?e.getState():""},setState:function(e){var t=!1,n=this._assessmentTest.getAssessmentItem();return n&&(t=n.setState(e),this._event.trigger("answer","change",n.getAnswer())),t},mediaOnStart:function(e){this._media.mediaOnStart(e)},mediaOnPause:function(e){this._media.mediaOnPause(e)},mediaOnEnded:function(e){this._media.mediaOnEnded(e)},mediaOnTimeupdate:function(e){this._media.mediaOnTimeupdate(e)},mediaOnVolumeChange:function(e){this._media.mediaOnVolumeChange(e)},mediaOnSeeked:function(e){this._media.mediaOnSeeked(e)},mediaPlay:function(e,t){this._option.swfHost&&0===arguments.length?this._media.mediaPlay():this._media.mediaPlay(e,t)},mediaPause:function(e,t){this._option.swfHost&&0===arguments.length?this._media.mediaPause():this._media.mediaPause(e,t)},mediaPauseAll:function(){this._option.swfHost?this._media.mediaPauseAll():this._media.mediaPauseAll(this._getView())},mediaSkip:function(e,t,n){this._option.swfHost?this._media.mediaSkip():this._media.mediaSkip(e,t,n)},mediaVolumeChange:function(e,t,n,i){this._option.swfHost||this._media.mediaVolumeChange(e,t,n,i)},_mediaOnFullScreenChange:function(e){this._media.mediaOnFullScreenChange(e)},mediaOnFullScreenChange:function(e){this._media.mediaOnFullScreenChange(e)},mediaOnFullScreen:function(e){this._media.mediaOnFullScreen(e)},mediaOnFullScreenExit:function(e){this._media.mediaOnFullScreenExit(e)},loadOnError:function(e){r.loadOnError(e)},imageOnClick:function(e){this._event.bind("image","click",e)},showQuestion:function(e,t){var n=i.type(e),a=null;"string"===n?a=i("#"+e):"object"===n&&(a=e instanceof jQuery?e:i(e)),"array"!==i.type(t)&&(t=[]),0===t.length?a.find("._qp-model").show():a.find("._qp-model").each(function(){var e=i(this),n=!1;t.forEach(function(t){e.attr("data-model-id")===t&&(n=!0)}),n?e.show():e.hide()}),r.resetMedia(),r.closeCustomKeyBoard()},showAnswer:function(){r.resetMedia(),r.closeCustomKeyBoard(),this._assessmentTest.getAssessmentItem().showAnswer(this._getView())},showCheckedAnswer:function(){r.resetMedia(),r.closeCustomKeyBoard(),this._assessmentTest.getAssessmentItem().showCheckedAnswer(this._getView())},showUsrAndCorrectAnswer:function(){r.resetMedia(),r.closeCustomKeyBoard(),this._assessmentTest.getAssessmentItem().showUsrAndCorrectAnswer(this._getView())},showCorrectAnswer:function(){r.resetMedia(),r.closeCustomKeyBoard(),this._assessmentTest.getAssessmentItem().showCorrectAnswer(this._getView())},showStatisAnswer:function(){r.resetMedia(),r.closeCustomKeyBoard(),this._assessmentTest.getAssessmentItem().showStatisAnswer(this._getView())},showDefaultExtras:function(e){e=i.extend(!0,c,e),this._assessmentTest.getAssessmentItem().showDefaultExtras(this._getView(),e)},appendToExtras:function(e,t){this._assessmentTest.getAssessmentItem().appendToExtras(this._getView(),e,t)},setExtrasAnswer:function(e,t){this._assessmentTest.getAssessmentItem().setExtrasAnswer(this._getView(),e,t)},cleanExtrasAnswer:function(e){this._assessmentTest.getAssessmentItem().cleanExtras(this._getView(),e)},getFullScore:function(e){return this._assessmentTest.getAssessmentItem().getFullScore(e)},setFullScore:function(e){this._assessmentTest.getAssessmentItem().setFullScore(e)},getUserScore:function(e){return this._assessmentTest.getAssessmentItem().getUserScore(e)},setUserScore:function(e){this._assessmentTest.getAssessmentItem().setUserScore(e)},reset:function(){r.resetMedia(),r.closeCustomKeyBoard(),this._assessmentTest.getAssessmentItem().reset(this._getView())},setLock:function(e,t){r.resetMedia(),r.closeCustomKeyBoard(),this._option.showLock=e,this._assessmentTest._option.showLock=e,this._assessmentTest.getAssessmentItem().setLock(this._getView(),e),"undefined"!=typeof t&&this.lockMedia(t,this._getView())},setHintVisible:function(e){r.resetMedia(),r.closeCustomKeyBoard();var t=this._getView();this._option.showHint=e,this._assessmentTest._option.showHint=e,e?t.find("._hint-pop-btn").removeClass("nqti-hide-dom"):t.find("._hint-pop-btn").addClass("nqti-hide-dom")},lockMedia:function(e,t){this._media.setLock(e,t)},_getView:function(){return i('[data-qti-id="'+this._uuid+'"]')},on:function(e,t){this._event.bind("on",e,t)}};return h}),s("player/qtiPlayer",["model/qtiModel"],function(){var e=t.QtiPlayer;if(!e)throw"请先加载qti-model";var n=a("player/player"),i=a("player/model/modelHandlerFactory"),s=a("player/cls/baseInteraction"),r=a("player/cls/class");e.createPlayer=function(t){return e._createPlayer(t)},e._createPlayer=function(e){var t=n.create(e);return t},e.registerModelHandler=function(e){i.register(e)},e.BaseInteraction=s,e.Class=r,e.closeCustomKeyBoard=function(){if("undefined"!=typeof DigitalInput&&DigitalInput.InputManager&&DigitalInput.InputManager.getInstance){var e=DigitalInput.InputManager.getInstance();e&&e.closeKeyBoard&&e.closeKeyBoard()}},e.resetMedia=function(){t.NDMediaPlayer&&t.NDMediaPlayer.reset&&t.NDMediaPlayer.reset()}}),a("player/qtiPlayer"),function(e){e.support.touch="ontouchend"in n,e.support.mobile=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);var t={};e.support.touch&&e.support.mobile?(t.mouseDown="touchstart",t.mouseUp="touchend",t.mouseWheel="touchmove",t.getEventX=function(e){return e.originalEvent.changedTouches[0].clientX},t.getEventY=function(e){return e.originalEvent.changedTouches[0].clientY}):(t.mouseDown="mousedown",t.mouseUp="mouseup",t.mouseWheel="mousewheel",t.getEventX=function(e){return e.clientX},t.getEventY=function(e){return e.clientY}),e.support.fixed=function(){var t=n.getElementsByTagName("body");t&&t.length>0&&e(t[0]).on("touchstart",function(){}),e.support.fixed=!0},e.support.fixed(),e.event.special.qpTap={setup:function(){var n=e(this);if(e.support.touch&&e.support.mobile){e.support.fixed!==!0&&e.support.fixed();var i=t.mouseDown,a=t.mouseUp,s=0,r=0,o=0;n.bind(i,function(e){0===e.which&&1===e.which||(s=(new Date).getTime(),r=t.getEventX(e),o=t.getEventY(e))}),n.bind(a,function(i){if(0!==i.which||1!==i.which){var a=(new Date).getTime(),l=t.getEventX(i),c=t.getEventY(i),d=a-s,u=Math.abs(l-r),h=Math.abs(c-o);d<=850&&u<6&&h<6&&(i=e.event.fix(i),i.type="qpTap",n.triggerHandler(i))}})}else n.bind("click",function(t){t=e.event.fix(t),t.type="qpTap",n.triggerHandler(t)})},teardown:function(){var n=t.mouseDown,i=t.mouseUp,a=e(this);a.unbind(i).unbind(n)}},e.fn.qpTap=function(e){return this.bind("qpTap",e)},e.event.special.qpMouseWheel={setup:function(){var t=e(this);if(e.support.touch&&e.support.mobile){var n=0;t.unbind("touchstart").unbind("touchmove"),t.bind("touchstart",function(e){n=e.originalEvent.changedTouches[0].pageY}),t.bind("touchmove",function(i){var a=i.originalEvent.changedTouches[0].pageY;a!==n&&(i=e.event.fix(i),i.type="qpMouseWheel",i.deltaY=a-n,t.trigger(i),n=a)})}else t.unbind("mousewheel"),t.bind("mousewheel",function(n){n=e.event.fix(n),n.type="qpMouseWheel",n.deltaY=n.originalEvent.deltaY,t.trigger(n)})},teardown:function(){var t=e(this);e.support.touch&&e.support.mobile?t.unbind("touchstart").unbind("touchmove"):t.unbind("mousewheel")}},e.fn.qpMouseWheel=function(e){return this.bind("qpMouseWheel",e)},e.fn.qpStopMouseWheel=function(){this.bind(t.mouseWheel,function(e){e.preventDefault()})}}(jQuery),function(e){"use strict";function t(t){return t=t||{},this.each(function(){var n=e(this);if("string"==typeof t)return void n.data("disabled",t);var a=n.data("my.draggable");e.extend({},n.data(),"object"==typeof t&&t);a||(a=new i(n),n.data("my.draggable",a))})}var i,a=function(e,t){return function(){return e.apply(t,arguments)}},s=([].slice,function(e){if(e&&e.length>0){var t=e[0].offsetWidth;return(t>0?e[0].getBoundingClientRect().width/t:1)||1}return 1});i=function(){function t(n,i){this.click=a(this.click,this),this.moved=a(this.moved,this),this.ended=a(this.ended,this),this.began=a(this.began,this),this.coordinate=a(this.coordinate,this),this.off=a(this.off,this),this.on=a(this.on,this),this.toggle=a(this.toggle,this),this.bind=a(this.bind,this),this.$container=n,this.getElements=a(this.getElements,this),this.resetElements=a(this.getElements,this),this.options=e.extend({},t.DEFAULTS,i),this.$elements=this.$container.find(this.options.selector),0!==this.$elements.length&&(this.elementOpts={count:this.$elements.length,width:this.$elements.eq(0).width(),height:this.$elements.eq(0).height()},this.toggle())}return t.DEFAULTS={"z-index":999,opacity:"0.8",version:"0.01",selector:' [data-toggle="draggable"]'},t.prototype.getElements=function(){return this.$container.find(this.options.selector)},t.prototype.resetElements=function(){return delete this.$elements,this.$elements=this.getElements(),this.$elements},t.prototype.bind=function(e){return null==e&&(e="on"),this.$container[e]("mousemove touchmove",this.moved),this.$container[e]("mouseup mouseleave touchend touchcancel",this.ended)},t.prototype.toggle=function(e){return null==e&&(e="on"),this.$container[e]("mousedown touchstart",this.options.selector,this.began),this.$container[e]("click",this.options.selector,this.click)},t.prototype.on=function(){return this.toggle("on")},t.prototype.off=function(){return this.toggle("off")},t.prototype.coordinate=function(e){switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return e.originalEvent.touches[0];default:return e}},t.prototype.began=function(t){this.bodyRect={height:e(n.body).height(),width:e(n.body).width()};var i;if("disabled"!==this.$container.data("disabled")&&"true"!==this.$container.data("disabled")&&!this.$target){if(this.scale||(this.scale=s(this.$container)),this.bind("on"),this.$target=e(t.target).closest('[data-toggle="draggable"]'),this.containerOpts&&this.containerOpts.width===this.$container.width()||(this.containerOpts={width:this.$container.width(),height:this.$container.height()}),this.$elements.length>1){var a=this.$elements.first().position(),r=this.$elements.eq(1).position(),o=(this.$elements.last().position(),r.left-a.left-this.elementOpts.width);this.elementOpts.columns=Math.floor((this.containerOpts.width-this.elementOpts.width-o/2)/(r.left-a.left)+1),this.elementOpts.rows=Math.ceil(this.elementOpts.count/this.elementOpts.columns)}else this.elementOpts={columns:this.$elements.length,rows:this.$elements.length};var l=this.$target.position();return this.$target.css({position:"absolute"}),this.$placeHolder=e(this.$target[0].outerHTML).css({visibility:"hidden",position:""}),this.$target.after(this.$placeHolder),this.resetElements(),this.$target.css({position:"absolute",left:l.left/this.scale,top:l.top/this.scale,opacity:this.options.opacity}),/^(?:a|\d)/.test(this.$target.css("z-index"))&&(this.$target[0].style["z-index"]="999"),this.$target.addClass("on"),this.origin={x:this.coordinate(t).pageX-this.$target.position().left,y:this.coordinate(t).pageY-this.$target.position().top},null!=(i=this.options)&&"function"==typeof i.began?i.began(t):void 0}},t.prototype.moved=function(t){var n=this.coordinate(t);if("touchmove"===t.type&&(Math.abs(n.clientY-this.bodyRect.height)<=15||Math.abs(n.clientX-this.bodyRect.width)<=15||n.clientX<=15||n.clientY<=15))return void this.ended(t);var i;if(null!=this.$target){t.preventDefault(),this.$target.css({left:(this.coordinate(t).pageX-this.origin.x)/this.scale,top:(this.coordinate(t).pageY-this.origin.y)/this.scale});var a=-1,s=-1,r=this.$target,o=this.$target.position();0==this.elementOpts.width&&(this.elementOpts.width=this.$elements.eq(0).width());var l=this.elementOpts.width,c=this.elementOpts.height,d=l*c/4;this.$placeHolder.index();if(this.$elements=this.getElements(),this.$elements.each(function(t){if(r.index()!==t){var n=e(this).position();if(!(Math.abs(o.left-n.left)>l||Math.abs(o.top-n.top)>c)){var i=o.left-n.left,u=o.top-n.top;i=i<=0?i+l:i=l-i,u=u<=0?u+c:c-u;var h=i*u;s<h&&d<=h&&(s=h,a=t)}}}),a!==-1&&this.$placeHolder.index()!==a){var u=this.$elements.eq(a),h=this.$placeHolder.index()<u.index();h?this.$elements.eq(a).after(this.$placeHolder):this.$elements.eq(a).before(this.$placeHolder),this.$elements=this.$container.find(this.options.selector)}return this.dragged=this.$target,null!=(i=this.options)&&"function"==typeof i.moved?i.moved(t):void 0}},t.prototype.ended=function(e){var t;if(null!=this.$target)return this.bind("off"),this.$placeHolder.before(this.$target),this.$target.removeClass("on"),this.$target.attr("style",this.$placeHolder.attr("style")),this.$placeHolder.remove(),this.$target.css({visibility:""}),delete this.$target,delete this.$placeHolder,delete this.origin,this.$elements=this.resetElements(),null!=(t=this.options)&&"function"==typeof t.ended?t.ended(e):void 0},t.prototype.click=function(e){if(this.dragged)return delete this.dragged},t}(),e.fn.draggabled=t,e.fn.draggabled.Constructor=i}(jQuery),function(e){"use strict";function t(t){return t=t||{},this.each(function(){var i=e(this);if("string"==typeof t)return void i.data("disabled",t);if(t.disabled)return void i.data("disabled",t.disabled);i.attr("id")||i.attr("id","dragsort"),t.id=i.attr("id"),/^(?:r|a|f)/.test(i.css("position"))||(this.style.position="relative");var a=i.data("my.dragsort"),s=e.extend({},i.data(),"object"==typeof t&&t);a||(a=new n(i,s),i.data("my.dragsort",a))})}var n,i=function(e,t){return function(){return e.apply(t,arguments)}};[].slice;n=function(){function t(n,a){return this.draggingMoved=i(this.draggingMoved,this),this.draggingEnded=i(this.draggingEnded,this),this.draggingBegan=i(this.draggingBegan,this),this.draggable=i(this.draggable,this),this.$=i(this.$,this),this.options=e.extend({},t.DEFAULTS,a),this.$container=n,this.$elements=this.$(this.options.draggable.selector),this.$elements.each(function(){var t=e(this);t.attr("data-toggle")||t.attr("data-toggle","draggable")}),this.options.tagName=this.$elements.length>0?this.$elements.get(0).tagName.toLowerCase():"div",this.options.draggable!==!1&&this.draggable(),this}return t.DEFAULTS={base:60,gutter:20,columns:12,draggable:{zIndex:999,selector:"> *"},placeHolderTemplate:""},t.prototype.$=function(e){return this.$container.find(e)},t.prototype.draggable=function(t){null==this._draggable&&(this._draggable=new e.fn.draggabled.Constructor(this.$container,{id:this.options.id,selector:this.options.draggable.selector,ended:this.draggingEnded}))},t.prototype.draggingBegan=function(e){},t.prototype.draggingEnded=function(e){var t,n;return null!=(t=this.options)&&null!=(n=this.options.update)&&"function"==typeof n?n(e):void 0},t.prototype.draggingMoved=function(e){},t}(),e.fn.dragsort=t,e.fn.dragsort.Constructor=n}(jQuery),function(e,t){var n=e.QtiPlayer.getUtils(),i={_name:"choiceInteraction",getName:function(){return this._name},create:function(e){var a=e.getModel(),s=function(e,n,a,s){e&&a.each(function(){for(var a=t(this),r=0;r<e.length;r++)if(a.attr("identifier")===e[r]){if(i.isElearningSkin){a.addClass("nqti-option-on"),s&&(n.indexOf(e[r])>-1?a.addClass("nqti-option-right"):a.addClass("nqti-option-wrong"));break}a.addClass("nqti-option-on"),s&&(n.indexOf(e[r])>-1?a.addClass("nqti-option-right"):a.addClass("nqti-option-wrong"));break}})},r=function(e,n,a,s){e&&a.each(function(){for(var a=t(this),r=0;r<e.length;r++)if(a.attr("identifier")===e[r]){if(i.isElearningSkin){s&&(n.indexOf(e[r])>-1?a.addClass("nqti-option-right"):a.addClass("nqti-option-wrong"));break}console.warn("非elearning皮肤，不支持同时显示用户答案和正确答案...")}})};e.getName=function(){var e=a.simpleChoice;if(2===e.length){var t=e[0].identifier.toLowerCase(),i=e[1].identifier.toLowerCase();if("yes"===t&&"no"===i)return n.getLangText("true_or_false",this.getOption())}return 1===a.maxChoices?n.getLangText("single_choise",this.getOption()):n.getLangText("multiple_choise",this.getOption())},e.getClassName=function(e){var t="nqti-base-choice";return e.screenshotLayout&&1===a.maxChoices&&(t="nqti-player-srcm-body"),t},e.createTitleHtml=function(){return a.prompt},e._createCommonAnswerHtml=function(e,t){var n="",i=a.simpleChoice;n+=e?'<ul class="nqti-base-judment-list">':1===a.maxChoices?'<ul class="nqti-base-choice-list">':'<ul class="nqti-base-choice-multiple">';
for(var s,r=0;r<i.length;r++)s=i[r],n+='<li class="nqti-option _qp-option" data-index="'+r+'" identifier="'+s.identifier+'">',n+=e||1===a.maxChoices?'<i class="nqti-option-radio-icon"></i>':'<i class="nqti-option-checkbox-icon"></i>',n+='<span class="nqti-check">',e===!1&&(n+='<em class="size">'+s.identifier+"</em>"),n+='</span><div class="nqti-content"><em class="size">'+s.content+"</em></div></li>";return n+="</ul>"},e._createScreenshotAnswerHtml=function(e,t){var i="",s=n.getLangText("choice_screenshot_title",t),r=a.simpleChoice;i+='<div class="nqti-srcm-layout-options"><p class="nqti-com-layout-title-answer"><span class="nqti-txt">'+s+" :</span>";for(var o,l,c=0;c<r.length;c++)o=r[c],l=o.identifier,e&&(l=o.content),i+='<label class="nqti-com-btn-radio _qp-option" data-index="'+c+'" identifier="'+o.identifier+'"><i class="nqti-option-radio-icon"></i><span class="nqti-txt">'+l+"</span></label>";return i+="</p></div>"},e.createAnswerHtml=function(e){var t=a.simpleChoice,n=!1;if(2===t.length){var i=t[0].identifier.toLowerCase(),s=t[1].identifier.toLowerCase();"yes"===i&&"no"===s&&(n=!0)}var r="";return r=e.screenshotLayout&&(n||1===a.maxChoices)?this._createScreenshotAnswerHtml(n,e):this._createCommonAnswerHtml(n,e)},e.render=function(e,n){var a=this;i.isElearningSkin=n.isElearningSkin;var s=e.find("._qp-option");s.bind("qpTap",function(){var e=t(this).attr("identifier"),n=t(this).data("index");a.triggerOptionClick(n,e)})},e.eventHandle=function(e,n){var i=this,s=e.find("._qp-option"),r=function(){var e=[];return s.each(function(){var n=t(this);n.hasClass("nqti-option-on")&&e.push(n.attr("identifier"))}),e};s.each(function(){var e=t(this);e.bind("qpTap",function(){i.isLock()||(1===a.maxChoices?e.hasClass("nqti-option-on")===!1&&(s.each(function(){t(this).removeClass("nqti-option-on")}),e.addClass("nqti-option-on")):e.hasClass("nqti-option-on")?e.removeClass("nqti-option-on"):e.addClass("nqti-option-on"),i.setAnswer(r()))})})},e.renderReset=function(e){var n=e.find("._qp-option");n.each(function(){var e=t(this);e.removeClass("nqti-option-on"),e.removeClass("nqti-option-right"),e.removeClass("nqti-option-wrong")})},e.renderAnswer=function(e){s(this.getAnswer(),this.getCorrectAnswer(),e.find("._qp-option"),!1)},e.renderCheckedAnswer=function(e){s(this.getAnswer(),this.getCorrectAnswer(),e.find("._qp-option"),!0)},e.renderCorrectAnswer=function(e){s(this.getCorrectAnswer(),this.getCorrectAnswer(),e.find("._qp-option"),!0)},e.renderCorrectAnswerNoneGrayBg=function(e){r(this.getCorrectAnswer(),this.getCorrectAnswer(),e.find("._qp-option"),!0)},e.renderLock=function(e){}}},a=e.QtiPlayer;a.registerModelHandler(i)}(t,jQuery),function(e,t){var n=e.QtiPlayer.getUtils(),i={_name:"choiceInteraction_vote",getName:function(){return this._name},create:function(e){for(var i,a,s=e.getModel(),r=!0,o=!1,l=/<img[\s\S]*?\/>/g,c=/src="([\s\S]*?)"/,d=/<p[\s\S]*?>([\s\S]*)<\/p>/,u=/^&(gt|lt|amp);$/i,h=s.simpleChoice,g=0;g<h.length;g++){i=h[g],i.identifier=i.identifier.replace("ndvote_","");var p="";i.content=i.content.replace(l,function(e){var t=n.getValue(e,c);return p='<img data-media-img-render="false" src="'+t+'" alt=""/>',""}),i.image=p,a=n.getValue(i.content,d).trim(),i.content=a,(""!==i.image||1!==a.length&&!u.test(a))&&(r=!1),""===a&&(i.content="")}r===!1&&h.length>8&&(o=!0),e.getName=function(){return n.getLangText("voting",this.getOption())},e.getClassName=function(){return"nqti-vote"},e.hasHint=function(){return!1},e.createTitleHtml=function(e){var t=n.getLangText("vote_sigleitem",e),i=n.getLangText("vote_mutipleitem",e),a="<div>("+t+")</div>";return 1!==s.maxChoices&&(a="<div>("+i+")</div>"),a+s.prompt},e.createAnswerHtml=function(e){var t,i="",a=n.getLangText("vote_tip_pre",e),l=n.getLangText("vote_tip_end",e),c=s.simpleChoice;o&&(i+='<div class="nqti-base-vote-hint"><span class="nqti-base-vote-txt">'+a+c.length+l+"</span></div>");var d="nqti-fixed";r&&(d=""),i+='<ul class="nqti-base-vote-list '+d+'">';for(var u,h=0;h<c.length;h++){t=c[h],r?u='<span class="nqti-base-vote-list-txt">'+t.content+"</span>":t.image.length>0?(u=t.image,t.content.length>0&&(u+='<p class="nqti-base-vote-list-desc"><i class="opacity_black_bg" style="display: none;"></i><sapn class="nqti-base-vote-list-desc-txt">'+t.content+"</span></p>")):u='<p class="nqti-base-vote-list-txt">'+t.content+"</p>";var g=t.identifier;if(e.showStat){var p=this.getStat();"undefined"!=typeof p[g]&&""!==p[g]&&(g=g+"("+p[g]+")")}i+='<li class="nqti-base-vote-list-cell _qp-option" data-identifier="'+t.identifier+'"><div class="nqti-base-vote-list-box"><div class="nqti-base-vote-list-views">'+u+'<i class="nqti-checked-icon"></i></div><p class="nqti-base-vote-list-index">'+g+"</p></div></li>"}return i+="</ul>"},e.render=function(e,t){},e.eventHandle=function(e,n){var i=this,a=e.find("._qp-option");a.each(function(){var e=t(this);e.bind("qpTap",function(){if(!i.isLock()){var n=e.data("identifier");e.hasClass("nqti-checked")?e.removeClass("nqti-checked"):(e.addClass("nqti-checked"),1===s.maxChoices&&a.each(function(){var e=t(this),i=e.data("identifier");i!=n&&e.removeClass("nqti-checked")}));var r=[];a.each(function(){var e=t(this);e.hasClass("nqti-checked")&&r.push(e.data("identifier").toString())}),i.setAnswer(r)}})})},e.renderReset=function(e){e.find("._qp-option").each(function(){var e=t(this);e.removeClass("nqti-checked")})},e.renderAnswer=function(e){var n=this.getAnswer();e.find("._qp-option").each(function(){for(var e=t(this),i=0;i<n.length;i++)if(e.data("identifier")==n[i]){e.addClass("nqti-checked");break}})},e.renderCheckedAnswer=function(e){this.renderAnswer(e)},e.renderCorrectAnswer=function(e){},e.renderLock=function(e){}}},a=e.QtiPlayer;a.registerModelHandler(i)}(t,jQuery),function(t,n){var i=QtiPlayer.getUtils(),a={_name:"drawingInteraction_handwrite",getName:function(){return this._name},create:function(t){var a=t.getModel(),s=a.object.width-4,r=a.object.height-8,o="cvs";t.getName=function(){return"手写题"},t.hasNum=function(){return!1},t.createTitleHtml=function(){return'<div class="qp-model-header">'+a.prompt+"</div>"},t.createAnswerHtml=function(e){var t="",n=a.object.data,i="",s="";return n.length>0?i="background-image: url('"+n+"');":s=" qp-hw-cavs-nobg",t+='      <div class="qp-hw-drawing-content qp-hw-bar-visible"  ">                                                                                                                       ',t+='      <div style="position: relative" class="qp-hw-drawing-box '+s+'" >                                                                                                                       ',t+='        <div  class="qp-hw-writing_edit" >                                                                                                                          ',t+='          <a href="javascript:void(0)" class="qp-hw-writing_botton qp-hw-classlink"  style="display: none" id="btn_back">                                                                  ',t+='              <ins class="qp-hw-icon_back"></ins>                                                                                                                ',t+="          </a>                                                                                                                                                ",t+='          <a href="javascript:void(0)" class="qp-hw-writing_botton qp-hw-classlink qp-on" id="write">                                                                     ',t+='              <ins class="qp-hw-icon_writing"></ins>                                                                                                             ',t+="          </a>                                                                                                                                                ",t+='              <a href="javascript:void(0)" class="qp-hw-writing_botton qp-hw-botton_clear" id="clear">                                                              ',t+='                  <ins class="qp-hw-icon_clear"></ins>                                                                                                           ',t+="              </a>                                                                                                                                            ",t+='              <a href="javascript:void(0)"  class="qp-hw-writing_botton qp-hw-botton_allclear qp-hw-classlink" id="clearall">                                          ',t+='                  <ins class="qp-hw-icon_allclear"></ins>                                                                                                        ',t+="              </a>                                                                                                                                            ",t+="        </div>                                                                                                   ",t+='          <canvas class="qp-hw-cavs " id="'+o+'" style="'+i+'">               ',t+="              Fallback content, in case the browser does not support Canvas.                                                                                  ",t+="          </canvas>                                                                                                                                           ",t+="      </div>                                                                                                                                                  ",t+="      </div>                                                                                                                                                  "},t.render=function(e,t){var n=this,a=e.find(".qp-hw-drawing-content canvas"),o=e.find(".qp-hw-writing_edit");if(i.Broswer.any()&&(o.hide(),e.find(".qp-hw-bar-visible").removeClass("qp-hw-bar-visible")),a.css({width:s,height:r}),a.length>0&&a[0]&&(a[0].width=s,a[0].height=r),e.find(".qp-hw-drawing-box").css({width:s}),t.showAnswer||t.showCorrectAnswer||t.showCheckedAnswer){var l=t.showCorrectAnswer?n.getCorrectAnswer():n.getAnswer();if(l&&l.length>0&&l[0]){var l=l[0].split("|$*-*$|")[1],c=a[0].getContext("2d"),d=new Image;d.onload=function(){c.drawImage(d,0,0)},d.src=l}}},t.eventHandle=function(t,i){if(!i.hideAnswerArea&&!i.showLock){var a=this,l=t.find(".qp-hw-drawing-content canvas"),c=!1,d=-1,u=-1,h=!1,g=l[0].getContext("2d");g.lineJoin="round";var p=function(e){var t=l[0].getBoundingClientRect(),n={};switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":n={x:e.originalEvent.targetTouches[0].clientX-t.left,y:e.originalEvent.targetTouches[0].clientY-t.top};break;default:n={x:e.clientX-t.left,y:e.clientY-t.top}}return n},f=function(e){var t=e.x,n=e.y;g.clearRect(t-15,n-15,30,30)},m=function(e){var t=e.x,n=e.y;g.beginPath(),d===-1?g.moveTo(t-1,n):g.moveTo(d,u),g.lineTo(t,n),g.closePath(),g.stroke(),d=t,u=n},v=function(){g.clearRect(0,0,s,r),a.setAnswer(_())},_=function(){var e=[],t={img:{width:s,height:r}};return e.push(JSON.stringify(t)+"|$*-*$|"+l[0].toDataURL()),e},x=function(){return{move:"touchmove mousemove",down:"touchstart mousedown",up:"touchend touchcancel mouseup mouseleave"}}();l.on(x.move,function(e){if(c){e.preventDefault(),e.stopPropagation();var t=p(e);h?f(t):m(t)}}),l.on(x.down,function(e){n("input").blur(),e.preventDefault(),e.stopPropagation();var t=p(e);h?f(t):m(t),c=!0}),l.on(x.up,function(e){e.preventDefault(),e.stopPropagation(),c=!1,a.setAnswer(_()),d=-1,u=-1}),l.on("click",function(e){n("input").blur()}),t.on(x.move,function(t){if(c){e.preventDefault(),e.stopPropagation();var n=t.originalEvent||x;n.target.id!=o&&(c=!1,a.setAnswer(_()))}});var w=t.find("#clear"),y=t.find("#write"),b=t.find("#clearall");w.on("click",function(){h=!0,w.addClass("qp-on"),y.removeClass("qp-on")}),y.on("click",function(){h=!1,y.addClass("qp-on"),w.removeClass("qp-on")}),b.on("click",function(){v()})}}}},s=t.QtiPlayer;s.registerModelHandler(a)}(t,jQuery),function(e,t){var n=e.QtiPlayer.getUtils(),i={_modalName:"drawingInteraction_drawing",getName:function(){return this._modalName},create:function(e){var i=e.getModel(),a=/<textEntry([\s\S])*?\/>/g;e.getName=function(){return"作文题"},e.hasNum=function(){return!1},e.hasHint=function(){return!1},e.createTitleHtml=function(){return""},e.createAnswerHtml=function(e){var t=n.getLangText("drawing_stem",e),s=n.getLangText("drawing_source_material",e),r=n.getLangText("drawing_view_topics",e),o=n.getLangText("drawing_view_material",e),l=n.getLangText("drawing_continue_write",e),c='<div class="qp-drawing-navigation-wrapper"><ul class="qp-drawing-navigation qp-clearfix">';c+='<li class="qp-drawing-navigation-item selected qp-drawing-navigation-title">'+t+"</li>",i.asset.length>0&&(c+='<li class="qp-drawing-navigation-item qp-drawing-navigation-asset">'+s+"</li>"),c+="</ul></div>";var d='<div class="qp-drawing-toolbar qp-clearfix"><a href="javascript:void(0)" class="qp-drawing-button qp-view-title-button">'+r+"</a>";i.asset.length>0&&(d+='<a href="javascript:void(0)" class="qp-drawing-button qp-view-asset-button">'+o+"</a>"),d+="</div>";var u=i.title.replace(a,'<span class="qp-underline"></span>'),h='<div class="qp-drawing-content-item " data-index="title"><div class="qp-title-contnet"><div class="qp-text">'+u+'</div><div class="qp-text">'+i.content+"</div></div></div>",g="";1===i.asset.length?g="qp-asset-one":2===i.asset.length&&(g="qp-asset-two");for(var p='<ul class="qp-asset-navigation '+g+'">',f='<div class="qp-asset-content">',m="selected",v=0;v<i.asset.length;v++)p+='<li data-index="asset'+v+'" class="qp-asset-navigation-item '+m+'">'+s+(v+1)+"</li>",f+='<div data-index="asset'+v+'" class="qp-asset-content-item '+(0==v?"":" qp-left-hide")+'"><div class="qp-text">'+i.asset[v]+"</div></div>",m="";p+="</ul>",f+="</div>";var _='<div class="qp-drawing-content-item qp-left-hide" data-index="asset">'+p+f+"</div>",x='<div class="qp-drawing-content">'+h+_+"</div>",w='<div class="qp-drawing-edit-toolbar"><a href="javascript:void(0)" class="qp-edit-button qp-edit-button-back"><ins class="qp-edit-button-icon"></ins></a><a href="javascript:void(0)" class="qp-edit-button qp-edit-button-clear"><ins class="qp-edit-button-icon"></ins></a><a href="javascript:void(0)" class="qp-edit-button qp-edit-button-allclear"><ins class="qp-edit-button-icon"></ins></a><a href="javascript:void(0)" class="qp-edit-button qp-edit-button-writing qp-on"><ins class="qp-edit-button-icon"></ins></a></div>',y=0,b='<div class="qp-drawing-edit-content-title">';b+=i.title.replace(a,function(e){var t='<span class="qp-textentry"><input class="qp-textentry-input" type="text" placeholder="" data-index="'+y+'"/></span>';return y++,t}),b+="</div>";var q='<div class="qp-drawing-edit-content">'+b+'    <div class="qp-drawing-edit-content-canvas-wrapper">    <canvas class="qp-drawing-edit-content-canvas" width="770" height="750">Fallback content, in case the browser does not support Canvas.</canvas>    </div></div>',A='<div class="qp-drawing-edit qp-left-hide">'+w+q+"</div>",R='<div class="qp-drawing-bottom"><a href="javascript:void(0)" class="qp-drawing-button qp-write-button">'+l+"</a></div>",S='<div class="qp-model-content qp-drawing">'+c+d+x+A+R;return S},e.render=function(e,n){var a=e.find(".qp-drawing-edit-content-canvas");if(a.length>0){var s=i.object.data;if(""===s)a.addClass("qp-edit-default-background");else{var r=new Image;r.onerror=function(){a.addClass("qp-edit-default-background")},r.onload=function(){a.css("background-image","url("+s+")")},r.src=s}}var o=e.find(".qp-drawing-navigation-title"),l=e.find(".qp-drawing-navigation-asset"),c=e.find(".qp-drawing-content-item");o.bind("qpTap",function(){o.hasClass("selected")===!1&&(l.removeClass("selected"),o.addClass("selected"),c.each(function(){var e=t(this),n=e.data("index");"title"===n?e.removeClass("qp-left-hide"):e.addClass("qp-left-hide")}))}),l.bind("qpTap",function(){l.hasClass("selected")===!1&&(o.removeClass("selected"),l.addClass("selected"),c.each(function(){var e=t(this),n=e.data("index");"asset"===n?e.removeClass("qp-left-hide"):e.addClass("qp-left-hide")}))});var d=e.find(".qp-asset-navigation-item"),u=e.find(".qp-asset-content-item");d.bind("qpTap",function(){var e=t(this);if(e.hasClass("selected")===!1){d.removeClass("selected"),e.addClass("selected");var n=e.data("index");u.each(function(){var e=t(this),i=e.data("index");n===i?e.removeClass("qp-left-hide"):e.addClass("qp-left-hide")})}})},e.eventHandle=function(e,n){var i=this,a=e.find(".qp-drawing"),s=e.find(".qp-drawing-navigation-title"),r=e.find(".qp-drawing-navigation-asset"),o=e.find(".qp-view-title-button"),l=e.find(".qp-view-asset-button"),c=e.find(".qp-write-button"),d=e.find(".qp-drawing-edit-content-canvas"),u=e.find(".qp-edit-button-writing"),h=e.find(".qp-edit-button-allclear"),g=e.find(".qp-edit-button-clear"),p=e.find(".qp-edit-button-back"),f=e.find(".qp-drawing-edit");if(c.bind("qpTap",function(){a.addClass("qp-writing"),f.removeClass("qp-left-hide")}),o.bind("qpTap",function(){a.removeClass("qp-writing"),f.addClass("qp-left-hide"),s.triggerHandler("qpTap")}),l.bind("qpTap",function(){a.removeClass("qp-writing"),f.addClass("qp-left-hide"),r.triggerHandler("qpTap")}),d.length>0){var m=a.find("input"),v=d[0],_=v.getContext("2d");_.lineJoin="round",_.lineWidth=1;var x={edit:!1,type:"draw",lastX:-1,lastY:-1,dataUrl:[],inputState:{},inputAnswer:[]};m.each(function(){var e=t(this),n=e.data("index");x.inputState[n]={timer:null,lastValue:""}});var w=function(){var e="";x.dataUrl.length>0&&(e=x.dataUrl[0]);var t={img:e,answer:x.inputAnswer},n=[];n.push(t),i.setAnswer(n)},y=function(e,t){if(0===x.inputAnswer.length)for(var n=m.length;n>0;)x.inputAnswer.push(""),n--;x.inputAnswer[e]=t,w()};m.bind("focus",function(){var e=t(this),n=e.data("index"),i=x.inputState[n];i.timer=setInterval(function(){var t=e.val();t!==i.lastValue&&(i.lastValue=t,y(n,t))},500)}),m.bind("blur",function(){var e=t(this),n=e.data("index"),i=x.inputState[n];clearInterval(i.timer),i.timer=null;var a=e.val();e.val(a),y(n,a),i.lastValue=a});var b=function(e){var t=v.getBoundingClientRect(),n={};switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":n={x:e.originalEvent.targetTouches[0].clientX-t.left,y:e.originalEvent.targetTouches[0].clientY-t.top};break;default:n={x:e.clientX-t.left,y:e.clientY-t.top}}return n.x=n.x*(v.width/t.width),n.y=n.y*(v.height/t.height),n},q=function(e){var t=b(e),n=t.x,i=t.y;_.beginPath(),x.lastX===-1?_.moveTo(n-1,i):_.moveTo(x.lastX,x.lastY),_.lineTo(n,i),_.closePath(),_.stroke(),x.lastX=n,x.lastY=i},A=function(e){var t=b(e),n=t.x,i=t.y;_.clearRect(n-15,i-15,30,30)},R=function(){var e=v.toDataURL();x.dataUrl.unshift(e),w()};u.bind("qpTap",function(){x.type="draw",u.addClass("qp-on"),g.removeClass("qp-on")}),g.bind("qpTap",function(){x.type="clear",u.removeClass("qp-on"),g.addClass("qp-on")}),h.bind("qpTap",function(){_.clearRect(0,0,v.width,v.height),R()}),p.bind("qpTap",function(){if(x.dataUrl.shift(),x.dataUrl.length>0){var e=x.dataUrl[0],t=new Image;t.onload=function(){_.clearRect(0,0,v.width,v.height),_.drawImage(t,0,0),w()},t.src=e}else _.clearRect(0,0,v.width,v.height),w()}),d.bind("mousedown touchstart",function(e){e.preventDefault(),x.edit=!0,"draw"===x.type?q(e):A(e),d.bind("mousemove touchmove",function(e){x.edit&&(e.preventDefault(),"draw"===x.type?q(e):A(e))})}),d.bind("mouseup mouseout touchend touchcancel",function(e){x.edit&&(e.preventDefault(),R(),d.unbind("mousemove"),x.edit=!1,x.lastX=-1,x.lastY=-1)})}}}},a=e.QtiPlayer;a.registerModelHandler(i)}(t,jQuery),function(e,t){var n=e.QtiPlayer.getUtils(),i={_name:"extendedTextInteraction",getName:function(){return this._name},create:function(e){var t=e.getModel();e.getName=function(){return n.getLangText("question",this.getOption())},e.getClassName=function(){return"nqti-base-essayQuestion"},e.createTitleHtml=function(){return t.prompt},e.createAnswerHtml=function(e){var n="",i=t.rubricBlock;return i&&i.prompt&&(n+='<div class="_nqti-answer nqti-hide-dom">'+i.prompt+"</div>"),n+='<div class="nqti-base-essayQuestion-wrap _nqti-textarea"><textarea class="nqti-base-essay-area nqti-scrollbar-style-gray _essay-area"></textarea></div>'},e.render=function(e,t){},e.eventHandle=function(e,t){var n=this,i=e.find("._essay-area");i.bind("input propertychange",function(e){var t=[];t.push(i.val()),"propertychange"===e.type?"value"===e.originalEvent.propertyName&&n.setAnswer(t):n.setAnswer(t)})},e.__unbind=function(e){},e.renderReset=function(e){e.find("._nqti-answer").addClass("nqti-hide-dom"),e.find("._nqti-textarea").removeClass("nqti-hide-dom");var t=e.find("._essay-area");t.text("")},e.renderAnswer=function(e){this.__unbind(e);var t=e.find("._essay-area"),n=this.getAnswer(),i="";n.length>0&&(i=n[0]),t.text(i)},e.renderCheckedAnswer=function(e){this.__unbind(e),this.renderAnswer(e);var t=e.find("._essay-area");t.attr("readonly","readonly")},e.renderCorrectAnswer=function(e){this.__unbind(e),e.find("._nqti-answer").removeClass("nqti-hide-dom"),e.find("._nqti-textarea").addClass("nqti-hide-dom")},e.renderLock=function(e){var t=e.find("._essay-area");this.isLock()?t.attr("readonly","readonly"):t.removeAttr("readonly")}}},a=e.QtiPlayer;a.registerModelHandler(i)}(t,jQuery),function(e,t){var n=e.QtiPlayer.getUtils(),i=e.QtiPlayer.getLogger(),a={_modalName:"gapMatchInteraction",getName:function(){return this._modalName},create:function(e){var t=null;e.getName=function(){return"表格题"},e.init=function(){t=new r(e)},e.hasNum=function(){return!1},e.hasHint=function(){return!1},e.createTitleHtml=function(){return""},e.createAnswerHtml=function(e){return t.setOption(e),t.createHtml()},e.render=function(e,n){t.setOption(n)},e.eventHandle=function(e,n){n.hideAnswerArea||t.eventHandle(e)}}},s=e.QtiPlayer;s.registerModelHandler(a);var r=e.QtiPlayer.Class(e.QtiPlayer.BaseInteraction,function(){var e={Left:"Left",Right:"Right",LeftTop:"LeftTop",RightTop:"RightTop",LeftBottom:"LeftBottom",RightBottom:"RightBottom",Bottom:"Bottom",Middle:"Middle",Top:"Top",TopToBottom:"TopToBottom",None:"None"},a={Create:function(e,t,n){this.base(e,t,n),this.RESBOX_HEIGHT=70,this.TARGET_MARGIN_TOP=5,this.TARGET_BOX_WIDTH=140,this.RES_BORDER=1,this.TD_BORDER=0,this.TABLE_SPACING=10,this.RESBOX_MARGIN_RIGHT=15,this.resBoxRects=[],this.targetBoxsRects=[],this.absOffset=null,this.zindex=1},eventHandle:function(a){var s=this,r=a.find(" .qp-gapText-td"),o={};a.find(" .edu-question-list-container").each(function(e){o[t(this).attr("identifier")]=t(this)});var l=a.find(".edu-question-gm_theme_wood_bg"),c=function(){if(r&&o){var e=l.offset();if(u(e),s.resBoxRects&&s.resBoxRects.length>0)for(var t in o){var n=o[t],i=n.width()+2*s.RES_BORDER,a=n.height()+2*s.RES_BORDER,c=n.offset(),d=s.resBoxRects[t];d.l=c.left-e.left,d.t=c.top-e.top,d.r=c.left+i-e.left,d.b=c.top+a-e.top,d.w=i,d.h=a,s.resBoxRects[t]=d}}},d=function(){s.resBoxRects=[];var e=l.offset();for(var t in o){var n=o[t],i=n.width()+2*s.RES_BORDER,a=n.height()+2*s.RES_BORDER,r=n.offset();s.resBoxRects[t]={l:r.left-e.left,t:r.top-e.top,r:r.left+i-e.left,b:r.top+a-e.top,w:i,h:a,id:t,f:"",tid:""}}u(e)},u=function(e){s.targetBoxsRects=[],r.each(function(){var n=t(this),i=n.width(),a=n.height(),r=n.offset();s.targetBoxsRects.push({l:r.left-e.left,t:r.top-e.top,r:r.left+i-e.left,b:r.top+a-e.top,w:i,h:a,id:n.attr("identifier")})})},h=function(e,t,i,a,r){var o=n.Area.getInteractRect(e,t,i,a,s.targetBoxsRects);return o?s.resBoxRects[r].f=o.id:s.resBoxRects[r].f="",o},g=function(e,t,i,o,l){var c=n.Area.getInteractRect(e,t,i,o,s.targetBoxsRects);return r.removeClass("qp-move"),c&&a.find("td[identifier='"+c.id+"']").addClass("qp-move"),c},p=function(e,t,n,i){n?(e.css({left:t.l,top:t.t}),i&&i()):e.stop().animate({left:t.l,top:t.t},function(){i&&i()})},f=function(){var i,u,f,_,w,y,b=null,q=!0,A=a.find(".edu-question-table_footer").width(),R=a.find(".qp-gapmatch-container .edu-question-main"),S=a.find(".qp-gapmatch-container>table"),I=function(e){e?r.addClass("qp-active"):r.removeClass("qp-active")},C=function(a,r){if(!s.isLock()){var o=n.Dom.getParentElement(t(r.target),"qp-gapText");if(o.hasClass("edu-question-list-container")){r.preventDefault(),r.stopPropagation(),i&&i.attr("id")===o.attr("id")&&i.stop(),i=o,u=i.width(),f=i.height(),_=i.attr("identifier");var d=l.offset();s.absOffset&&d.left===s.absOffset.left&&d.top===s.absOffset.top||c(),s.absOffset=d,i.attr("location")!==e.None&&"undefined"!=typeof i.attr("location")||i.parent().css({width:u+s.RESBOX_MARGIN_RIGHT+2*s.RES_BORDER});var h=R.offset();S.css({left:h.left-s.absOffset.left,top:h.top-s.absOffset.top}),I(!0),b=H(a,r);var g=i.offset();y={x:b.x-g.left+s.absOffset.left,y:b.y-g.top+s.absOffset.top},w=i[0].style.cssText.replace("left","").replace("top","").replace("position","").replace("z-index",""),i[0].style.cssText=w+";position:absolute;z-index:"+s.zindex++ +";left:"+(b.x-y.x)+"px;top:"+(b.y-y.y)+"px;",w=i[0].style.cssText.replace("left","").replace("top",""),k(_,b.y-y.y,f)}}},T=function(e,t){s.isLock()||b&&(t.preventDefault(),t.stopPropagation(),b=H(e,t),i[0].style.cssText=w+";left:"+(b.x-y.x)+"px;top:"+(b.y-y.y)+"px;",g(b.x-y.x,b.y-y.y,f,u,_))},M=function(e){b&&y&&(e.preventDefault(),e.stopPropagation(),E(),I(!1),null!=b&&s.setAnswer(x()),b=null,y=null)},E=function(){var t=V(_),n=h(b.x-y.x,b.y-y.y,f,u,_);if(r.removeClass("qp-move"),n){t!==n.id&&i.attr("location",e.None);var a=i.attr("location"),o=m(i,n,f,u,a,v(n.id));i.parent().css({width:0}),p(i,o,!1,function(){})}else i.attr("location",e.None),i.parent().css({width:u+s.RESBOX_MARGIN_RIGHT+2*s.RES_BORDER}),function(e){j(e,e.parent(),!1,function(){e.attr("style","")})}(i)},k=function(t,n,a){var r=V(t);if(r&&i.attr("location")===e.TopToBottom)for(var l in s.resBoxRects){var c=s.resBoxRects[l];if(c.f===r&&t!==c.id){var d=o[c.id];if(d.attr("location")!==e.TopToBottom)continue;var u=parseInt(d.css("top"));u>n&&d.animate({top:u-a-2*s.RES_BORDER})}}},V=function(e){return s.resBoxRects[e]&&s.resBoxRects[e].f},j=function(e,t,n,i){var a=t.width(),r=t.height(),o=t.offset(),l=(s.RESBOX_HEIGHT-e.height())/2,c={l:o.left-s.absOffset.left,t:o.top-s.absOffset.top+l,w:a,h:r};c.l<0&&(c.l=0),c.l>A-u&&(c.l=A-u),p(e,c,n,i),e.attr("center",!1)},H=function(e,t){var n,i,a={};return e?(n=t.targetTouches[0].pageX-s.absOffset.left,i=t.targetTouches[0].pageY-s.absOffset.top,a={x:n,y:i}):(n="undefined"!=typeof t.pageX?t.pageX-s.absOffset.left:t.layerX,i="undefined"!=typeof t.pageY?t.pageY-s.absOffset.top:t.layerY,a={x:n,y:i}),a},L=function(){var e=a.find(".edu-question-gm_theme_wood_bg")[0];n.Dom.addListener(e,"mousedown",function(e){C(!1,e)}),n.Dom.addListener(e,"mousemove",function(e){T(!1,e)}),n.Dom.addListener(e,"click",function(e){}),n.Dom.addListener(e,"mouseup",M),n.Dom.addListener(e,"mouseleave",M),n.Dom.addListener(e,"touchstart",function(e){q&&(q=!1,C(!0,e))}),n.Dom.addListener(e,"touchmove",function(e){q||T(!0,e)}),n.Dom.addListener(e,"touchend",function(e){q=!0,M(e)}),n.Dom.addListener(e,"touchcancel",function(e){q=!0,M(e)})},B=function(){var t=a.find(".edu-question-list_box"),n=0,i=t.width(),s=!1;a.find(".edu-question-icon_right").bind("click touchstart",function(){if(!s){var a=t.scrollLeft();n=0;for(var r in o){var l=o[r];l.attr("location")!==e.None&&"undefined"!=typeof l.attr("location")||(n+=l.parent().width())}var c=n-a-i;c>0&&(c=c<=a?a+c:a>0?2*a:i,s=!0,t.animate({scrollLeft:c},function(){s=!1}))}}),a.find(".edu-question-icon_left").bind("click touchstart",function(){if(!s){var e=t.scrollLeft();e>0&&(e>i?e-=i:e=0,s=!0,t.animate({scrollLeft:e},function(){s=!1}))}})},O=function(){s.absOffset=l.offset(),d(),L(),B()};O()},m=function(t,n,i,a,r,l){for(var c=t.attr("identifier"),d={Left:function(){return{l:n.l,t:n.t+(n.h-i+2*s.RES_BORDER+s.TD_BORDER)/2}},Right:function(){return{l:n.l+n.w-a,t:n.t+(n.h-i+2*s.RES_BORDER+s.TD_BORDER)/2}},Bottom:function(){return{l:n.l+(n.w-a+2*s.RES_BORDER+s.TD_BORDER)/2,t:n.t+n.h-i}},LeftTop:function(){return{l:n.l,t:n.t}},RightTop:function(){return{l:n.l+n.w-a,t:n.t}},LeftBottom:function(){return{l:n.l,t:n.t+n.h-i}},RightBottom:function(){return{l:n.l+n.w-a,t:n.t+n.h-i}},Middle:function(){return{l:n.l+(n.w-a+2*s.RES_BORDER+s.TD_BORDER)/2,t:n.t+(n.h-i+2*s.RES_BORDER+s.TD_BORDER)/2}}},u=function(e){var i=!1;for(var a in o)o[a].attr("location")===e&&(t?a!==t.attr("identifier")&&s.resBoxRects[a].f==n.id&&(i=!0):i=!0);return i},h={l:n.l,t:n.t,h:n.h,w:n.w},g=0,p=0;p<l.length;p++){var f=l[p],m=o[f.id];c!==f.id?m.attr("location")===e.TopToBottom&&(g+=f.h,h.t=h.t+f.h):(h.l=h.l+(h.w-f.w+2*s.RES_BORDER+s.TD_BORDER)/2,location!==e.TopToBottom&&(g+=f.h))}if(h.t=h.t+s.TARGET_MARGIN_TOP,g+=s.TARGET_MARGIN_TOP,g>n.h){if(r&&r!==e.None&&r!==e.Top&&r!==e.TopToBottom)return d[r]();for(var v in e)if(v!==e.None&&v!==e.TopToBottom&&v!==e.Top&&!u(v))return t.attr("location",v),d[v]();return t.attr("location",e.Middle),d[e.Middle]()}return t.attr("location",e.TopToBottom),h},v=function(e){var t=[];for(var n in s.resBoxRects){var i=s.resBoxRects[n];i.f===e&&t.push(i)}return t},_=function(){for(var t=[],n=0;n<s.targetBoxsRects.length;n++){for(var i=s.targetBoxsRects[n],r=v(i.id),l=a.find(" [identifier='"+i.id+"']"),c=[],d=0;d<r.length;d++){var u={},h=r[d];u.index=o[h.id].css("z-index"),u.$targetBox=l,u.targetRect=i,u.$resBox=o[h.id],c.push(u)}t.push(c)}for(var g=0;g<t.length;g++){var f=t[g];if(f.length>0)for(var _=v(f[0].targetRect.id),x=0;x<f.length;x++){var w=f[x],y=m(w.$resBox,w.targetRect,w.$resBox.height(),w.$resBox.width(),e.None,_);p(w.$resBox,y,!0)}}},x=function(){var e=[];for(var t in s.resBoxRects){var n=s.resBoxRects[t];n.f&&e.push(n.id+" "+n.f)}return i.debug(e),e},w=function(e){if(e&&!(e.length<=0)){for(var t=0;t<e.length;t++){var n=e[t],i=n.split(" ");if(2===i.length){var a=i[0],r=i[1];s.resBoxRects[a].f=r,o[a].css("position","absolute")}}s.zindex=e.length+1,_(),s.setAnswer(x())}},y=function(){var e=a.find(".qp-gapmatch-container .edu-question-main"),n=a.find(".qp-gapmatch-container > table"),i=e.offset(),r=a.find(".edu-question-gm_theme_wood_bg").offset();a.find(".qp-gapmatch-container> table").css({left:i.left-r.left,top:i.top-r.top});var o=e.find(".edu-question-title_hang").height()-2*s.TABLE_SPACING,l=e.find(".edu-question-table_lie_side").width()-2*s.TABLE_SPACING,c=(e.find(".edu-question-table_lie_side").height()-s.TABLE_SPACING*(n.find("  tr").length-2))/(n.find("  tr").length-1),d=e.find(".edu-question-table_box").width()-s.TABLE_SPACING;n.find("tr:eq(0)").find("td").css({height:o,width:d}),n.find("tr:eq(0)").find(" td:eq(0)").css({width:l}),n.find(" tr ").each(function(e){0!==e&&(t(this).find(" td").css({height:c,width:d}),t(this).find("td:eq(0)").css({width:l}),t(this).find("td:eq(0)").html(""))}),n.attr("cellspacing","10px")},b=function(){y(),s.option.event&&f(),s.option.showAnswer&&!s.option.showCorrectAnswer&&w(s.getAnswer()),s.option.showCorrectAnswer&&w(s.getCorrectAnswer())};b()},createHtml:function(){var e=this,i=function(){var i=e.modalModel.prompt.length>105?"edu-question-text_s":"edu-question-text_m",a=t(e.modalModel.tableMatchContent).find(" thead td"),o=t(e.modalModel.tableMatchContent).find(" tbody tr"),l="main_lie0"+o.length,c="main_hang0"+(a.length-1),d=n.getLangText("gapmath_title",e.option),u="";u+='<div class="edu-question-gm_theme_wood_bg" id="'+e.interactionId+'">                                                                                                                                                                                                          ',u+='    <div class="edu-question-qp_gm_header clearfix">                                                                                                                                                                                                        ',u+='        <h1 class="edu-question-title_s">'+d+"</h1>                                                                                                      ",u+="    </div>                                                                                                                                                                                                                               ",
u+='    <div class="clearfix">                                                                                                                                                                                                       ',u+='        <div class="edu-question-side">                                                                                                                                                                                                               ',u+='            <div class="edu-question-side_content">                                                                                                                                                                                                     ',u+='                <p class="'+i+'" > '+e.modalModel.prompt+"</p>                                                                                                                                                                                ",u+="            </div>                                                                                                                                                                                                                       ",u+="        </div>                                                                                                                                                                                                                           ",u+="                                                                                                                                                                                                                                         ",u+='        <div class="qp-gapmatch-container">                                                                                                                                                                                              ',u+="                                                                                                                                                                                                                                         ",u+='            <div class="edu-question-main '+l+" "+c+'">                                                                                                                                                                                    ',u+='                <div class="edu-question-title_hang">                                                                                                                                                                                                 ',a.each(function(e){e>0&&(u+='            <div class="edu-question-table_box"><span class="edu-question-table_btn">'+t(this).html()+"</span></div>                                                                                                                                                     ")}),u+="                </div>                                                                                                                                                                                                                   ",u+='                <div class="edu-question-table_lie_side clearfix">                                                                                                                                                                                    ',o.each(function(){u+='                 <span class="edu-question-table_lie_btn">'+t(this).find("td:eq(0)").html()+"</span>                                                                                                                                                    "}),u+="                </div>                                                                                                                                                                                                                   ",u+='                <div class="edu-question-table_lie clearfix">                                                                                                                                                                                         ';for(var h=0;h<o.length;h++){u+='                    <div class="edu-question-table_lie_box">                                                                                                                                                                                          ';for(var g=1;g<a.length;g++)u+='                        <div class="edu-question-table_img_box">                                                                                                                                                                                      ',u+="                        </div>                                                                                                                                                                                                           ";u+="                    </div>                                                                                                                                                                                                               "}return u+="                </div>                                                                                                                                                                                                                   ",u+="            </div>                                                                                                                                                                                                                       ",u+=r(),u+="                                                                                                                                                                                                                                         ",u+="        </div>                                                                                                                                                                                                                           ",u+="    </div>                                                                                                                                                                                                                               ",u+="                                                                                                                                                                                                                                         ",u+=s(),u+="</div>                                                                                                                                                                                                                                   ",u+="                                                                                                                                                                                                                                         "},a=function(e){for(var t=/<img([\s\S]*?)\/>/g,n=e.match(t),i=0;i<n.length;i++)e=e.replace(n[i],n[i].replace("<img",'<img data-media-img-render="false" data-width="112" data-height="70"'));return e},s=function(){var t="";t+='    <div class="edu-question-table_footer">                                                                                                                                                                                                           ',t+='        <a href="javascript:void(0)" class="edu-question-icon_left"></a>                                                                                                                                                                                             ',t+="                                                                                                                                                                                                                                         ",t+='        <div class="edu-question-list_box">                                                                                                                                                                                                           ',t+='<div class="qp-gaptxt-container" > ';for(var i=e.getAnswerRandom(e.modalModel.gapText.length),s=0;s<e.modalModel.gapText.length;s++){var r=e.modalModel.gapText[e.getShuffle()?i[s]:s],o=n.getRandom(e.interactionId+"-container"+s);t+='<div class="qp-gapTxt-parent"  >',r.content.indexOf("<img")>-1?(t+='   <div class="qp-gapText qp-gapText-img  edu-question-list-container"  id="'+o+'"  identifier="'+r.identifier+'" > ',t+=a(r.content)):(t+='   <div class="qp-gapText edu-question-list-container"  id="'+o+'"  identifier="'+r.identifier+'" > ',t+='<span class="qp-gapText-span">'+r.content+"</span>"),t+="   </div>",t+="</div>"}return t+="</div>  ",t+="        </div>                                                                                                                                                                                                                           ",t+='        <a href="javascript:void(0)" class="edu-question-icon_right"></a>                                                                                                                                                                                            ',t+="    </div>"},r=function(){var n=t(e.modalModel.tableMatchContent),i=n.find("gap");i.parent().parent().addClass("qp-gapText-td");for(var a=0;a<i.length;a++){var s=t(i[a]),r=s.attr("identifier");s.parent().parent().attr("identifier",r)}return n.find("thead td").html(""),n._xml().replace(/<thead>/gi,"").replace(/<\/thead>/gi,"").replace(/<tbody>/gi,"").replace(/<\/tbody>/gi,"")};return i()}};return a}())}(t,jQuery),function(e,t){var i=e.QtiPlayer.getUtils(),a=e.QtiPlayer.getLogger(),s={TR:"<tr>${content}</tr>",TD:'<td id="${id}" width="${width}" height="${height}" class="_nqti-js-td">${content}</td>',SIDE_ITEM:'<li  class="on ${cls}"><span  class="nqti-base-puzzle-img-con ${orientation} _nqti-js-img"  id="${id}"><img   data-lazy-load="${lazyloader}"  data-media-img-render="false"  ${width} src="${src}"/></span></li>',QUS_BODY:'<div class="nqti-base-puzzle-wrap clearfix _nqti-js-wrap" style="${c-height}">               <div class="nqti-base-puzzle-module" style="${c-width}">                   <table class="nqti-base-puzzle-table" style="${width};${height}"><tbody>${tbody}</tbody></table>               </div>               <div class="nqti-base-side-puzzle _nqti-js-side">                    <ul class="nqti-base-puzzle-list nqti-scrollbar-style-gray _nqti-js-side-ul">${list}</ul>               </div>           </div>'},r=600,o=500,l=100,c=100,d=2,u=5,h=7.25/5.25,g={winSize:function(){var e=0,t=0;return n.documentElement&&n.documentElement.clientHeight&&n.documentElement.clientWidth&&(e=n.documentElement.clientWidth,t=n.documentElement.clientHeight),{width:e,height:t}},qtiMaxSize:function(e){var t=e.closest("._qti-player").parent(),n=t.width(),i=0,a=0;if(n>0){var s=n/1080;i=r*s,a=o*s,i<300&&(i=300),a<300&&(a=300)}return{maxW:i,maxH:a}},mathMaxSize:function(){var e=this.winSize(),t=1,n=0,i=0;return t=e.width/e.height>1.6?e.height/800:e.width/1280,n=parseInt(r*t),i=parseInt(o*t),i<c&&(i=c),n<l&&(n=l),{maxW:n,maxH:i}},getOffsetInt:function(e){var t=e.offset();if(t)return{left:parseInt(t.left),top:parseInt(t.top)}},getScale:function(e){if(e&&e.length>0){var t=e[0].offsetWidth;return(t>0?e[0].getBoundingClientRect().width/t:1)||1}return 1},getTableData:function(e){for(var t=0,n=0,i=0,a=0,s=e.gapImg[0].width,r=e.gapImg[0].height,o={},l=0;l<e.associableHotspot.length;l++){var c=e.associableHotspot[l],d=c.coords.split(",");parseInt(d[3])>n&&(n=parseInt(d[3])),parseInt(d[2])>t&&(t=parseInt(d[2]));var u=c.identifier.split("_"),h=parseInt(u[1]),g=parseInt(u[2]);g>a&&(a=g),o[h]||(o[h]=[],i++),o[h][g-1]=c}return{matrix:o,width:t,height:n,rows:i,cols:a,oneWidth:s,oneHeight:r}},getAreaSize:function(e,t,n,a,s,r,o,u,h,g){var p=i.Img.resize(e,t,h,g,l,c),f=p.scale;if(e=p.w,t=p.h,(n||a)&&(n-=s*d+d,a-=r*d+d,n<e||a<t)){var m=!0;n<e&&a<t?m=n/e<a/t:n<e?m=!0:a<t&&(m=!1),m?(p.w=n,p.scale=(n/e).toFixed(3),p.h=parseInt(p.scale*t)):(p.h=a,p.scale=(a/t).toFixed(3),p.w=parseInt(p.scale*e)),p.scale=p.scale*f}var v=p.h%r,_=p.w%s;return n&&a?(_>0&&(p.w=p.w-(s-_)),v>0&&(p.h=p.h-(r-v))):(_>0&&(p.w=p.w+(s-_)),v>0&&(p.h=p.h+(r-v)),u/o>p.h/r/(p.w/s)&&(p.h+=r)),p.w+=s*d+d,p.h+=r*d+d,p},getRects:function(e,n){var i=[],a=this.getScale(t(n[0]));return n.each(function(){var n=t(this),s=n.width(),r=n.height(),o=n.attr("id"),l=g.getOffsetInt(n);l.left=l.left-e.left,l.top=l.top-e.top,i.push({l:l.left,t:l.top,r:l.left+s*a,b:l.top+r*a,w:s*a,h:r*a,id:o})}),i},initFill:function(e,t){e.forEach(function(e){var n="";t.forEach(function(t){var i=t.split(" ");i[1]===e.id&&(n=i[0])}),e.f=n})},removeFill:function(e,t){e.forEach(function(e){e.f===t&&(e.f="")})},removeAllFill:function(e){e.forEach(function(e){e.f=""})},addFill:function(e,t,n){this.removeFill(e,n),e.forEach(function(e){e.id===t&&(e.f=n)})},getEventPoint:function(e,t){var n,i,a={},s=e.originalEvent&&(e.originalEvent.targetTouches||e.originalEvent.changedTouches);if(s){var r=e.originalEvent.targetTouches&&e.originalEvent.targetTouches.length>0?e.originalEvent.targetTouches:e.originalEvent.changedTouches;n=r[0].pageX-t.left,i=r[0].pageY-t.top,a={x:n,y:i,touch:!0}}else{var r=e.originalEvent||e;n=r.pageX-t.left,i=r.pageY-t.top,a={x:n,y:i,touch:!1}}return a},coordinate:function(e){switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":var t=e.originalEvent.targetTouches&&e.originalEvent.targetTouches.length>0?e.originalEvent.targetTouches:e.originalEvent.changedTouches;return t[0];default:return e}},intersectRect:function(e,t,n,a,s,r){var o,l,c=!1,d=0,u=0,h=s*a*2/5;return e.forEach(function(e,g){if(!(c||e.f&&e.f!=r)){var p=i.Area.getRectIntersectArea({l:t,t:n,r:t+s,b:n+a},e),f=i.Area.getRectIntersectArea(e,{l:t,t:n,r:t+s,b:n+a});f>p&&(p=f),p>0&&u++,p>d&&(d=p,o=g),p>h&&(c=!0,l=e)}}),!c&&u>1&&(c=!0,l=e[o]),l},renderAnswer:function(e,n,i){n.each(function(n){var a=t(this),s=a.attr("id"),r="",o=!1;if(i&&i.forEach(function(e){var t=e.split(" ");t[0]===s&&(r=t[1],o=!0)}),o){var l=a.parent();a.attr("data-parent-style",l.attr("style")),a.attr("data-parent-class",l.attr("class")),l.remove(),e.find("#"+r).append(a)}})}},p={_name:"graphicGapMatchInteraction",getName:function(){return this._name},create:function(e){var l=e.getModel();e.getName=function(){return i.getLangText("puzzle",this.getOption())},e.getClassName=function(){return"nqti-base-puzzle"},e.createTitleHtml=function(){return l.prompt},e.createAnswerHtml=function(e){var t=g.getTableData(l),n=g.getAreaSize(t.width,t.height,e.expectWidth,e.expectHeight,t.cols,t.rows,t.oneWidth,t.oneHeight,r,o),a="";for(var c in t.matrix){var d="";t.matrix[c].forEach(function(e){d+=i.template(s.TD,{id:e.identifier,content:"",width:100/t.matrix[c].length+"%",height:100/t.rows+"%"})}),a+=i.template(s.TR,{content:d})}l.gapImg=i.Rd.shuffleArray(l.gapImg,e.randomSeed);for(var p="",f=0;f<l.gapImg.length;f++){var m=l.gapImg[f],v=m.width/m.height<=h?"_horizontal":"",_=m.width/m.height>h?"_autoh":"";p+=i.template(s.SIDE_ITEM,{src:m.data,width:"",id:m.identifier,orientation:v,cls:_,lazyloader:!!e.graphicGapMatchImageLoaderEnable})}var x=i.getPlatForm().statis===e.platForm?0:u,w=i.template(s.QUS_BODY,{list:p,tbody:a,width:"width:"+n.w+"px",height:"height:"+n.h+"px","c-width":"width:"+(n.w+2*x)+"px","c-height":"height:"+(n.h+2*x)+"px"});return w},e.render=function(e,t){var n=this,a=e.find("._nqti-js-side"),s=i.getPlatForm().statis===t.platForm;s&&e.closest("._qti-player").addClass("nqti-base-puzzle-stati");var r=e.find(".nqti-base-puzzle-table"),o=e.find("._nqti-js-wrap"),c=e.find(".nqti-base-puzzle-module");a.hide();var d=function(){var t=n.getOption(),d=g.qtiMaxSize(e);if(!t.expectWidth&&!t.expectHeight){var h=i.getPlatForm().statis===t.platForm?0:u;if(d.maxW){var p=g.getTableData(l),f=g.getAreaSize(p.width,p.height,t.expectWidth,t.expectHeight,p.cols,p.rows,p.oneWidth,p.oneHeight,d.maxW,d.maxH);r.css({width:f.w+"px",height:f.h+"px"}),o.css("height",f.h+2*h+"px"),c.css("width",f.w+2*h+"px")}}!d.maxW||t.showCorrectAnswer||s||a.show();var m=e.find("._nqti-js-side-ul li").height();l.gapImg[0].height<m&&e.find("._nqti-js-side-ul li").css("height","auto")};d(),e.find(".nqti-module-content").resize(function(){d()})},e.eventHandle=function(e,s){var r=this,o=e.find("._nqti-js-wrap"),l=e.find("._nqti-js-td"),c=e.find("._nqti-js-side-ul"),d=o.offset();r.__rects=[],r.__rects=g.getRects(d,l);var u=function(){d=g.getOffsetInt(o);var e=g.getRects(d,l);e.forEach(function(e,t){e.f=r.__rects[t].f}),r.__rects=e},h=function(){var e=[];return r.__rects.forEach(function(t){t.f&&e.push(t.f+" "+t.id)}),a.debug(e),e},p=function(){var s,p,f,m,v,_,x,w,y=null,b=1,q=0,A="ontouchend"in n,R=function(e){var n=t(e.target).closest("._nqti-js-img");if(n&&n[0]&&!n.hasClass("_move")){b=g.getScale(o),q=0,e.preventDefault(),_=n.find("img").width(),x=n.find("img").height(),w=n.attr("id");var i=n.find("img").offset();s=n.clone(),o.append(s),"LI"===n.parent()[0].tagName?(s.attr("data-parent-style",n.parent().attr("style")),s.attr("data-parent-class",n.parent().attr("class")),n.parent().addClass("_old")):n.addClass("_old");var a=g.getOffsetInt(o);d&&a.left===d.left&&a.top===d.top||u(),d=a,y=g.getEventPoint(e,d),f={x:y.x-i.left+d.left,y:y.y-i.top+d.top},s.addClass("_move"),s.css({width:_+"px",height:x+"px",left:(y.x-f.x)/b+"px",top:(y.y-f.y)/b+"px"}),p=s[0].style.cssText.replace("left","").replace("top","")}},S=function(t){if(y){if(!A){var n=g.getOffsetInt(o);d&&n.left===d.left&&n.top===d.top||(u(),d=n)}y=g.getEventPoint(t,d),t.preventDefault(),t.stopPropagation(),q%3===0&&(v=g.intersectRect(r.__rects,y.x-f.x,y.y-f.y,x*b,_*b,w),v?(m&&m.removeClass("td-move"),m=e.find("#"+v.id),m.addClass("td-move")):m&&m.removeClass("td-move")),q++,s[0].style.cssText=p+";left:"+(y.x-f.x)/b+"px;top:"+(y.y-f.y)/b+"px;"}},I=function(n){if(y&&f){if(0===q&&(v=g.intersectRect(r.__rects,y.x-f.x,y.y-f.y,x*b,_*b,w)),e.find("._old").remove(),v)g.addFill(r.__rects,v.id,w),e.find("#"+v.id).append(s),s.removeClass("_move").attr("style","");else{g.removeFill(r.__rects,w);var i=t('<li style="'+s.attr("data-parent-style")+'" class="'+s.attr("data-parent-class")+'"></li>');s.removeClass("_move").attr("style",""),i.append(s),c.append(i)}l.removeClass("td-move"),null!=y&&r.setAnswer(h()),y=null,f=null,v=null}},C=function(e){var i=!1,s=null,o=function(e){if(!r.isLock())switch("touchmove"!==e.type&&"mousemove"!==e.type&&a.debug(e.type),e.type){case"touchstart":case"mousedown":if(i)return;i=!0,R(e),s={height:t(n.body).height(),width:t(n.body).width()};break;case"touchmove":case"mousemove":if(!i)return;S(e);var o=g.coordinate(e);if("touchmove"===e.type&&(Math.abs(o.clientY-s.height)<=15||Math.abs(o.clientX-s.width)<=15||o.clientX<=12||o.clientY<=12))return i=!1,void I(e);break;case"touchend":case"touchcancel":case"mouseup":case"mouseleave":i=!1,I(e)}};return o}();i.Broswer.any()?o.on("touchstart touchmove touchend touchcancel ",C):o.on("touchstart touchmove touchend touchcancel mousedown mousemove mouseup mouseleave",C)};p(),o.resize(function(){d=g.getOffsetInt(o),u()})},e.renderReset=function(e){var n=e.find("._nqti-js-td ._nqti-js-img"),i=e.find("._nqti-js-side-ul"),a=e.find("._nqti-js-side");a.show(),n.each(function(){var e=t(this),n=t('<li style="'+e.attr("data-parent-style")+'" class="'+e.attr("data-parent-class")+'"></li>');e.removeClass("_move").attr("style",""),n.append(e),i.append(n)}),g.removeAllFill(this.__rects)},e.renderAnswer=function(e){var t=this.getAnswer();g.initFill(this.__rects,t);var n=e.find("._nqti-js-img");g.renderAnswer(e,n,t)},e.renderCheckedAnswer=function(e){this.renderAnswer(e)},e.renderCorrectAnswer=function(e){var t=this.getCorrectAnswer();g.initFill(this.__rects,t);var n=e.find("._nqti-js-side"),i=e.find("._nqti-js-img");n.hide(),g.renderAnswer(e,i,t)},e.destroy=function(){}}},f=e.QtiPlayer;f.registerModelHandler(p)}(t,jQuery),function(e,t){var n=e.QtiPlayer.getUtils(),i={_name:"inlineChoiceInteraction",getName:function(){return this._name},create:function(e){var t=e.getModel();e.getName=function(){return"文本选择题"},e.hasNum=function(){return!1},e.hasHint=function(){return!1},e.createTitleHtml=function(){return""},e.createAnswerHtml=function(e){var i,a="",s=n.getLangText("inline_choice_choose",e),r=t.inlineChoice;a+='<span class="qp-model-content"><select class="qp-inline-choice"><option>--'+s+"--</option>";for(var o=0;o<r.length;o++)i=r[o],a+='<option value="'+i.identifier+'">'+i.content+"</option>";return a+="</select></span>"},e.render=function(e,t){var n=this,i=e.find(".qp-inline-choice"),a=null;t.showAnswer||t.showCheckedAnswer?a=n.getAnswer():t.showCorrectAnswer&&(a=n.getCorrectAnswer()),a&&a.length>0&&i.val(a[0]),t.showLock&&i.attr("disabled","disabled")},e.eventHandle=function(e,t){var n=this,i=e.find(".qp-inline-choice");i.change(function(){var e=[];e.push(i.val()),n.setAnswer(e)})}}},a=e.QtiPlayer;a.registerModelHandler(i)}(t,jQuery),function(e,t){var i=e.QtiPlayer.getUtils(),a=e.QtiPlayer.getLogger(),s=5,r=8,o=15,l={_imageRegex:/<img([\s\S]*?)\/>/g,_srcRegex:/src="([\s\S]*?)"/,_widthRegex:/width="([\s\S]*?)"/,_heightRegex:/height="([\s\S]*?)"/},c={SORT_ITEM:' <li identifier="${identifier}" class="nqti-base-connectLine-sort-list _nqti-js-sort-list">               <span class="nqti-base-connectLine-sort-text"><em class="nqti-base-connectLine-sort-text-word">${index}</em></span>           </li>',PIC_TEXT:'<li id="${id}" matchMax="${max}" class="nqti-base-connectLine-list nqti-base-connectLine-pic-text ${jscls}">               <div class="nqti-base-connectLine-list-img">${img}</div>               <span class="nqti-base-connectLine-list-btm"><i class="opacity_black_bg" style="display: none;"></i><em class="nqti-base-connectLine-list-btm-word">${text}</em></span>           </li>',PIC:'<li id="${id}" matchMax="${max}"  class="nqti-base-connectLine-list nqti-base-connectLine-only-pic ${jscls}"><div class="nqti-base-connectLine-list-img">${img}</div></li>',TEXT:'<li id="${id}" matchMax="${max}"  class="nqti-base-connectLine-list nqti-base-connectLine-only-text ${jscls}"><em class="nqti-base-connectLine-only-text-word">${text}</em></li>',ITEM_BODY:'<ul class="nqti-base-connectLine-list-ul">${content}</ul>',QUS_BODY:'<div class="nqti-base-connectLine-content ">               <div class="nqti-base-connectLine-container clearfix">                   <ul class="nqti-base-connectLine-sort-num-ul _nqti-js-sort">${sort}</ul>                   ${item}               </div>               <svg class="nqti-base-connectLine-svg _nqti-js-svg" xmlns="http://www.w3.org/2000/svg" version="1.1"><defs></defs></svg>           </div>'},d={getScale:function(e){if(e&&e.length>0){var t=e[0].offsetWidth;return(t>0?e[0].getBoundingClientRect().width/t:1)||1}return 1},getFill:function(e){var t=e.attr("fill");return void 0!==t&&""!=t?t.split(","):[]},_removeFill:function(e,t){var n=this.getFill(e),i=n.indexOf(t);i>=0&&(n.splice(i,1),e.attr("fill",n.join(",")))},removeFill:function(e,t,n){var i=e.find("#"+t),a=e.find("#"+n);this._removeFill(i,n),this._removeFill(a,t),this.updateItemLineStyle(i),this.updateItemLineStyle(a)},removeAllFill:function(e){var t=e.find("._nqti-js-resbox,._nqti-js-targetbox");t.attr("fill",""),e.find("._nqti-js-svg line").remove(),t.removeClass("error"),t.removeClass("correct"),t.removeClass("on")},_addFill:function(e,t){var n=this.getFill(e),i=n.indexOf(t);i<0&&(n.push(t),e.attr("fill",n.join(",")))},addFill:function(e,t,n){var i=e.find("#"+t),a=e.find("#"+n);console.log("match",t,n),this._addFill(i,n),this._addFill(a,t),this.updateItemLineStyle(i),this.updateItemLineStyle(a)},hasFill:function(e,t){var n=this.getFill(e),i=n.indexOf(t);return i>=0},canFill:function(e){var t=this.getFill(e);return!(t.length>=parseInt(e.attr("matchMax")))},getRect:function(e,t,n){var i=e.width()*n,a=e.height()*n,r=e.offset(),o=r.left+i;return t&&(o=r.left+i+s),{l:r.left,t:r.top,r:o,b:r.top+a,w:i,h:a,id:e.attr("id"),matchMax:parseInt(e.attr("matchMax"))}},getLinePos:function(e,t,n,i){var a=this.getScale(e),r=this.getRect(e.find("#"+n),!0,a),o=this.getRect(e.find("#"+i),!1,a),l={};return l.y1=r.h/2+r.t-t.top,l.x1=r.r-t.left-s,l.x2=o.l-t.left,l.y2=o.t-t.top+o.h/2,l},getAnswer:function(e){var n=[],i=this;return e.find("._nqti-js-resbox").each(function(){for(var e=i.getFill(t(this)),a=t(this).attr("id"),s=0;s<e.length;s++)""!=e[s]&&n.push(a+" "+e[s])}),n},isAnswerItemRight:function(e,t){for(var n=!1,i=0;i<e.length;i++){var a=e[i];if(a===t){n=!0;break}}return n},getEventPoint:function(e,t){var n,i,a={},s=e.originalEvent&&(e.originalEvent.targetTouches||e.originalEvent.changedTouches);if(s){var r=e.originalEvent.targetTouches&&e.originalEvent.targetTouches.length>0?e.originalEvent.targetTouches:e.originalEvent.changedTouches;n=r[0].pageX-t.left,i=r[0].pageY-t.top,a={x:n,y:i,touch:!0}}else{var r=e.originalEvent||e;n=r.pageX-t.left,i=r.pageY-t.top,a={x:n,y:i,touch:!1}}return a},coordinate:function(e){switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":var t=e.originalEvent.targetTouches&&e.originalEvent.targetTouches.length>0?e.originalEvent.targetTouches:e.originalEvent.changedTouches;return t[0];default:return e}},updateItemLineStyle:function(e){var t=this.getFill(e);t.length<=0?e.removeClass("on"):e.addClass("on")},isRes:function(e){return e.hasClass("_nqti-js-resbox")},_intersectedRect:function(e,t,n,i){e+=i.left,t+=i.top;for(var a,s=!1,r=0;r<n.length;r++){var o=n[r];if(e>o.l&&e<o.r&&t>o.t&&t<o.b){s=!0,a=o;break}}return a},intersectedRect:function(e,t,n,i){var a=this._intersectedRect(t.x,t.y,i,n);return null==a?null:this.getFill(e.find("#"+a.id)).length>=a.matchMax?null:a},renderAnswer:function(e,n,a,s){var r=e.find("._nqti-js-sort"),o=e.find("._nqti-js-resbox,._nqti-js-targetbox"),l=e.find("._nqti-js-svg"),c=i.Svg.getSVGDocument(l[0]),u=i.Svg.getSVGRoot(l[0]),h=d.getScale(e);if(n.forEach(function(t){var n=t.split(" ");2===n.length&&d.addFill(e,n[0],n[1])}),a.showCheckedAnswer){var g=i.getPlatForm().pptshell===a.platForm;g||r.hide(),o.each(function(){var e=t(this),n=e.attr("fill");(void 0===n||n.length<=0)&&(g||e.hide())})}for(var p=!1,f=0;f<n.length;f++){var m=n[f],v=m.split(" ");if(2===v.length){var _=v[0],x=v[1],w=d.getLinePos(e,l.offset(),_,x);if(w){var y;if(a.showCheckedAnswer){var b=e.find("#"+_).attr("fill"),q=d.isAnswerItemRight(s,_+" "+b);y=i.Svg.addLine(c,u,"",w.x1/h,w.y1/h,w.x2/h,w.y2/h,q?"nqti-base-connectLine-normal nqti-base-connectLine-correct":"nqti-base-connectLine-normal nqti-base-connectLine-error","");var A=e.find("#"+_+" ,#"+x);q?A.addClass("correct"):A.addClass("error")}else a.showCorrectAnswer?(e.find("#"+_+",#"+x).addClass("correct"),y=i.Svg.addLine(c,u,"",w.x1/h,w.y1/h,w.x2/h,w.y2/h,"nqti-base-connectLine-normal nqti-base-connectLine-correct","")):(e.find("#"+_+",#"+x).addClass("on"),y=i.Svg.addLine(c,u,"",w.x1/h,w.y1/h,w.x2/h,w.y2/h,"nqti-base-connectLine-normal",""));t(y).attr("rid",_),t(y).attr("tid",x),(w.x1<=5||w.x2<=5)&&(p=!0)}}}p===!0?e.find("line").hide():e.find("line").show()}},u={_name:"matchInteraction",getName:function(){return this._name},create:function(e){var u=e.getModel();e.getName=function(){return i.getLangText("connection",this.getOption())},e.getClassName=function(){return"nqti-connectLine"},e.init=function(){},e.createTitleHtml=function(){return u.prompt},e.createAnswerHtml=function(e){var t=function(e){var t=e.replace(l._imageRegex,function(e,t){var n=e;return n=n.replace(/\<img/,'<img data-media-img-render="false"').replace(/width=/,"").replace(/height=/,"")});return t},n=function(e){var t=e.match(l._imageRegex);return t.length>0?t[0]:""},a=function(e){return e.replace(l._imageRegex,function(e){return""})},s=function(s,r){var o="",l=s.length,d=i.Rd.getAnswerRandom(2*l-1,l,e.randomSeed);r&&(d=i.Rd.getAnswerRandom(l-1,0,e.randomSeed));for(var h=r?"_nqti-js-resbox":"_nqti-js-targetbox",g=0;g<s.length;g++){var p=s[g];u.shuffle&&(p=s[r?d[g]:d[g]-l]);var f=t(p.content.trim());o+=/^<img([^<>]*?)\/>$/.test(f)?i.template(c.PIC,{id:p.identifier,max:p.matchMax,img:f,jscls:h}):/<img([^<>]*?)\/>/.test(f)?i.template(c.PIC_TEXT,{id:p.identifier,max:p.matchMax,img:n(f),text:a(f),jscls:h}):i.template(c.TEXT,{id:p.identifier,max:p.matchMax,text:f,jscls:h})}return o=i.template(c.ITEM_BODY,{content:o})},r=s(u.simpleMatchSet[0],!0);r+=s(u.simpleMatchSet[1],!1);var o="";u.simpleMatchSet[0].forEach(function(e,t){o+=i.template(c.SORT_ITEM,{index:t+1,identifier:e.identifier})});var d=i.template(c.QUS_BODY,{item:r,sort:o});return d},e.render=function(e,n){var i=this,a=e.find("._nqti-js-sort-list");e.find("._nqti-js-svg").on("click",function(e){var n={x:e.pageX,y:e.pageY},s=i.getCorrectAnswer();a.each(function(){var e=t(this),a=e.offset(),r=e.width(),o=e.height(),l=parseInt(e.text())-1,c=e.attr("identifier");if(n.x>=a.left-20&&n.x<=a.left+r+20&&n.y>=a.top-20&&n.y<=a.top+o+20){for(var d,u=0;u<s.length;u++){var h=s[u],g=h.split(" ");if(2===g.length){var p=g[0];if(p==c){d=h;break}}}i.triggerOptionClick(l,d)}})})},e.eventHandle=function(e,l){var c=this,u=e.find("._nqti-js-resbox"),h=e.find("._nqti-js-targetbox"),g=e.find("._nqti-js-svg"),p=g[0],f=i.Svg.getSVGDocument(p),m=i.Svg.getSVGRoot(p),v=[],_=[],x=d.getScale(e),w=function(){h&&u&&(v=[],_=[],u.each(function(){var e=d.getRect(t(this),!0,x);v.push(e)}),h.each(function(){_.push(d.getRect(t(this),!1,x))}))},y=function(){var l,u=null,h=null,p=function(t,n){var i={};h=!1;var a=d.intersectedRect(e,t,n,v);return a||(h=!0,a=d.intersectedRect(e,t,n,_)),i.rect=a,a?(i.y1=(a.b-a.t)/2+a.t-n.top,h?i.x1=a.r-n.left-a.w:i.x1=a.r-n.left-s,i):(t=null,i)},y=function(e,n,a){var s=p(n,a);if(s.rect){var r=i.Svg.addLine(f,m,"",s.x1/x,s.y1/x,n.x/x,n.y/x,"nqti-base-connectLine-normal","");u=t(r),u.attr("rid",s.rect.id)}},b=function(e,t){null!=u&&(e.preventDefault(),u.attr("x2",t.x/x),u.attr("y2",t.y/x))},q=function(n,a){var s=e.find(".nqti-base-connectLine-normal");s.attr("class","nqti-base-connectLine-normal");var r=null,o=100;return s.each(function(){var e=this.x1.baseVal.value,a=this.y1.baseVal.value,s=this.x2.baseVal.value,l=this.y2.baseVal.value,c=i.Area.pointToLine(e,a,s,l,n.x/x,n.y/x);c<=o&&(o=c,r=t(this))}),r&&(o<=a?r.attr("class","nqti-base-connectLine-normal nqti-base-connectLine-hover"):r=null),r},A=function(t,n,i){if(null!=u){var a=u.attr("rid"),r=d.intersectedRect(e,n,i,h?v:_);!r||d.hasFill(e,a,r.id)?u.remove():(h?u.attr("x2",(r.r-i.left-s)/x):u.attr("x2",(r.l-i.left)/x),u.attr("y2",(r.t-i.top+(r.b-r.t)/2)/x),d.addFill(e,a,r.id),u.attr("tid",r.id)),c.setAnswer(d.getAnswer(e))}u=null},R=function(n){var a=d.getEventPoint(n,g.offset()),s=q(a,a.touch?o:r);if(s)s.remove(),d.removeFill(e,s.attr("rid"),s.attr("tid")),c.setAnswer(d.getAnswer(e));else{var u=d.intersectedRect(e,a,g.offset(),v);if(u||(u=d.intersectedRect(e,a,g.offset(),_)),u){var h=e.find("#"+u.id),p=h.hasClass("_nqti-js-resbox");if(!d.canFill(h))return;if(l&&d.canFill(l)){var w=d.isRes(l),y=h.attr("id"),b=l.attr("id");if(l[0]==h[0])l=null,h.removeClass("on");else if(p===w)l.removeClass("on"),l=h,l.addClass("on");else if(!d.hasFill(l,y)){var a={};a=w?d.getLinePos(e,g.offset(),b,y):d.getLinePos(e,g.offset(),y,b);var A=i.Svg.addLine(f,m,"",a.x1/x,a.y1/x,a.x2/x,a.y2/x,"nqti-base-connectLine-normal","");t(A).attr("tid",y),t(A).attr("rid",b),d.addFill(e,y,b),c.setAnswer(d.getAnswer(e)),l.addClass("on"),h.addClass("on"),l=null}}else h.addClass("on"),l=h}}},S=function(e){var i,s=!1,o=null,l=null,u=null,h=null,p=null,f=function(e){if(!c.isLock())switch("touchmove"!==e.type&&"mousemove"!==e.type&&a.debug(e.type),e.type){case"touchstart":case"mousedown":if(s)return;s=!0;var f=g.offset();h&&f.left===h.left&&f.top===h.top||w(),
h=f,o=d.getEventPoint(e,h),l=o,i=(new Date).getTime(),o.x=o.x,o.y=o.y,y(e,o,h),p={height:t(n.body).height(),width:t(n.body).width()};break;case"touchmove":case"mousemove":if(!s)return void("mousemove"===e.type&&q(d.getEventPoint(e,g.offset()),r));o=d.getEventPoint(e,h),o.x=o.x,o.y=o.y,u=o;var m=d.coordinate(e);if("touchmove"===e.type&&(Math.abs(m.clientY-p.height)<=15||Math.abs(m.clientX-p.width)<=15||m.clientX<=12||m.clientY<=12))return A(e,o,h),s=!1,void(o=null);b(e,o);break;case"touchend":case"touchcancel":case"mouseup":case"mouseleave":if(o=d.getEventPoint(e,g.offset()),u=o,A(e,o,h),s=!1,o=null,u&&"mouseup"===e.type){var v=(new Date).getTime()-i,_=Math.abs(u.x-l.x),x=Math.abs(u.y-l.y);if(v>800||_>=5||x>=5)return;R(e)}break;case"qpTap":if(u&&"click"===e.type){var v=(new Date).getTime()-i,_=Math.abs(u.x-l.x),x=Math.abs(u.y-l.y);if(v>800||_>=5||x>=5)return}R(e)}};return f}();i.Broswer.any()?g.on("qpTap touchstart touchmove touchend touchcancel ",S):g.on("click touchstart touchmove touchend touchcancel mousedown mousemove mouseup mouseleave ",S)};w(),y()},e.renderReset=function(e,t){var n=e.find("._nqti-js-sort"),i=e.find("._nqti-js-resbox,._nqti-js-targetbox");t!==!1&&e.find("._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content").off("resize"),n.show(),i.show(),d.removeAllFill(e)},e.renderAnswer=function(e){var t=this,n=this.getAnswer(),i=this.getCorrectAnswer(),a=t.getOption();e.find("._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content").off("resize");var s=function(){t.renderReset(e,!1),d.renderAnswer(e,n,a,i)};e.find("._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content").resize(function(){s()}),s()},e.renderCheckedAnswer=function(e){this.renderAnswer(e)},e.renderCorrectAnswer=function(e){var t=this,n=this.getCorrectAnswer(),i=t.getOption();e.find("._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content").off("resize");var a=function(){t.renderReset(e,!1),d.renderAnswer(e,n,i,n)};e.find("._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content").resize(function(){a()}),a()},e.destroy=function(){}}},h=e.QtiPlayer;h.registerModelHandler(u)}(t,jQuery),function(e,t){var n=e.QtiPlayer.getUtils(),i={PIC_TEXT:'<li data-id="${identifier}" class="nqti-base-sequence-list nqti-base-sequence-pic-text">               ${img}               <span class="nqti-base-sequence-list-btm-text">                   <i class="opacity_black_bg" style="display: none;"></i>                   <em class="nqti-base-sequence-list-btm-word">${text}</em>               </span>           </li>',PIC:'<li data-id="${identifier}" class="nqti-base-sequence-list nqti-base-sequence-only-pic">${img}</li>',TEXT:'<li data-id="${identifier}" class="nqti-base-sequence-list nqti-base-sequence-only-text"><em class="nqti-base-sequence-only-text-word">${text}</em></li>',ITEM_BODY:'<ul class="nqti-base-sequence-list-ul clearfix _nqti-js-sequence-ul ">${content}</ul>'},a={_name:"orderInteraction",getName:function(){return this._name},create:function(e){for(var a,s=e.getModel(),r=s.simpleChoice,o=/<img[\s\S]*?\/>/g,l=0;l<r.length;l++){a=r[l];var c="";a.content=a.content.replace(o,function(e){var t=e.substring(4,e.length-2);return c='<img data-class="qp-order-image" data-media-img-render=\'{"renderUI":false,"minWidth":205,"minHeight":165}\'  '+t+" />".replace(/width=/,"").replace(/height=/,""),""}),a.image=c}var d=function(e){var n=[];return e.children("li").each(function(){n.push(t(this).data("id"))}),n},u=function(e,t,i){var a=[];if(a.pushArray(e.simpleChoice),e.shuffle){a=n.Rd.shuffleArray(a,i);for(var s=!0,r=0;r<a.length;r++)if(a[r].identifier!=t[r]){s=!1;break}if(s){var o=a.shift();a.push(o)}}return a};e.getName=function(){return n.getLangText("sort",this.getOption())},e.getClassName=function(){return"nqti-sequence"},e.createTitleHtml=function(){return s.prompt},e.createAnswerHtml=function(e){for(var t,a,r=this,o=u(s,r.getCorrectAnswer(),e.randomSeed),l="",c=0;c<o.length;c++)a=o[c],l+=""===a.image?n.template(i.TEXT,{text:a.content,identifier:a.identifier}):a.content&&""!==a.content.trim()?n.template(i.PIC_TEXT,{img:a.image,text:a.content,identifier:a.identifier}):n.template(i.PIC,{img:a.image,identifier:a.identifier});return t=n.template(i.ITEM_BODY,{content:l})},e.render=function(e,t){},e.renderReset=function(e){var t=u(s,this.getCorrectAnswer(),this.getOption().randomSeed),n=e.find("._nqti-js-sequence-ul");return t.forEach(function(e){n.find('[data-id="'+e.identifier+'"]').appendTo(n)}),d(n)},e.renderAnswer=function(e){var t=e.find("._nqti-js-sequence-ul"),n=this.getAnswer();n.forEach(function(e){t.find('[data-id="'+e+'"]').appendTo(t)}),this.setAnswer(d(t))},e.renderCheckedAnswer=function(e){this.renderAnswer(e)},e.renderCorrectAnswer=function(e){var t=e.find("._nqti-js-sequence-ul"),n=this.getCorrectAnswer();n.forEach(function(e){t.find('[data-id="'+e+'"]').appendTo(t)})},e.renderLock=function(e){var t=e.find("._nqti-js-sequence-ul");this.isLock()?t.dragsort("disabled"):t.dragsort("enable")},e.eventHandle=function(e,t){var n=this,i=e.find("._nqti-js-sequence-ul");(t.showAnswerArea||t.showStatisAnswer)&&n.setAnswer(d(i)),i.dragsort({draggable:{zIndex:999,selector:"li"},update:function(){n.setAnswer(d(i))}})}}},s=e.QtiPlayer;s.registerModelHandler(a)}(t,jQuery),function(e,t){var n=e.QtiPlayer,i=n.getUtils(),a={_name:"textEntryInteraction",getName:function(){return this._name},create:function(e){var t=e.getModel();e.getName=function(){return i.getLangText("blank_filling",this.getOption())},e.hasNum=function(){return!1},e.hasHint=function(){return!1},e.hasTitle=function(){return!1},e.isBlock=function(){return!1},e.createTitleHtml=function(){return""},e.createAnswerHtml=function(e){var n=this,a="";t.expectedLength>0&&(a=' maxlength="'+t.expectedLength+'" ');var s=t.modelId,r=s.substring(s.lastIndexOf("-")+1),o="",l=n.getCorrectAnswer(),c="";l.length>0&&(c=l[0]);var d=e.showSubSequence&&e.showCorrectAnswer,u='<span class="nqti-base-fill-index _qp-text-showcorrectanswer-num '+(d?"":"nqti-hide-dom")+'">'+r+"</span>";o+='<span data-num="'+r+'" class="nqti-base-fill-cell nqti-correct _qp-text-input _qp-text-showcorrectanswer '+(e.showCorrectAnswer?"":"nqti-hide-dom")+'">'+u+c+"</span>",o+='<span data-num="'+r+'" class="nqti-base-fill-cell  _qp-text-input _qp-text-showcheckedanswer fill-cell-min-width '+(e.showCheckedAnswer?"":"nqti-hide-dom")+'"></span>',o+='<span class="nqti-base-fill-cell _qp-text-input _qp-text-showstatisanswer '+(e.showStatisAnswer?"":"nqti-hide-dom")+'"><span class="nqti-base-fill-index">'+r+"</span></span>";var h=!e.showCorrectAnswer&&!e.hideAnswerArea&&!e.showStatisAnswer,g=t.keyboard;if("undefined"!=typeof DigitalInput&&"number"===t.keyboard)o+='<span data-index="0" class="nqti-base-fill-cell span-to-div _qp-text-input qp-digital-container _qp-text-normal '+(h?"":"nqti-hide-dom")+'"  id="'+i.Rd.getRandom()+'"></span>';else{var p="";"number"===t.keyboard&&(p="input-number");var f="0.000000000001";i.Broswer.isIE()&&(f="any"),o+='<input data-index="0" step="'+f+'" class="nqti-base-fill-cell '+p+" _qp-text-input _qp-text-normal "+(h?"":"nqti-hide-dom")+'"  data-type="'+g+'"'+a+'  type="'+g+'"/>'}var o='<span class="nqti-base-fill _qp-base-fill">'+o+'<input style="position: absolute;left: -10000px;top: -10000px;" class="nqti-base-fill-cell _qp-text-hidden "  type="text"></span>';return o},e.render=function(e,n){var i=this;e.find("._qp-base-fill").bind("qpTap",function(){var e=i.getCorrectAnswer();i.triggerOptionClick(0,e[0])}),i.__digitalReset=!1;var a=e.find("._qp-text-input._qp-text-normal");if(!(a.length<=0)){"number"!==a.attr("type")&&a.qtiAutogrow({maxWidth:"._qti-player",shadow:"nqti-base-fill-cell",vertical:!1,horizontal:!0,postGrowCallback:function(e){e.closest("._qp-model").css("-webkit-box-shadow","0 0 1px rgba(0, 0, 0, 0)"),setTimeout(function(){e.closest("._qp-model").css("-webkit-box-shadow","")},50)}});var s=a.hasClass("qp-digital-container");if(n.showAnswerArea&&t.width){var r=18*t.width;r=r<60?60:r,a.css("width",r+"px")}s&&DigitalInput.InputManager.getInstance().register(a.get(0),function(){if(i.__digitalReset)return void(i.__digitalReset=!1);var e=DigitalInput.InputManager.getInstance().getText4Dom(a.get(0)),t=[];t.push(e.toString()),i.setAnswer(t)})}},e.eventHandle=function(e,t){var n=this,a=e.find("._qp-text-input._qp-text-normal"),s=a.hasClass("qp-digital-container");if(!s){var r=null,o="",l=function(e){var t=[];t.push(e),n.setAnswer(t)};a.bind("focus",function(){r=setInterval(function(){var e=a.val().trim();e!==o&&(o=e,l(e))},500)}),a.bind("blur",function(){clearInterval(r),r=null;var e=a.val().trim();"number"===a.attr("data-type")&&8===i.Broswer.IEVersion()&&("-"!==e&&"."!==e||(e="")),a.val(e),o=e,l(e)}),i.Broswer.isIE()&&"number"===a.attr("data-type")&&a.keydown(function(e){return i.Dom.inputNumberKeydown(a,e)})}},e.renderReset=function(e){var t=e.find("._qp-text-input._qp-text-normal");t.removeClass("nqti-error"),t.removeClass("nqti-correct");var n=t.hasClass("qp-digital-container");n?(this.__digitalReset=!0,DigitalInput.InputManager.getInstance().setText4DOM("",t.get(0))):(t.val(""),t.trigger("input")),e.find("._qp-text-showcorrectanswer").addClass("nqti-hide-dom"),e.find("._qp-text-showcorrectanswer-num").addClass("nqti-hide-dom"),e.find("._qp-text-showstatisanswer").addClass("nqti-hide-dom"),e.find("._qp-text-normal").removeClass("nqti-hide-dom");var i=e.find("._qp-text-showcheckedanswer");i.addClass("nqti-hide-dom"),i.removeClass("nqti-error"),i.removeClass("nqti-correct"),i.addClass("fill-cell-min-width")},e.renderAnswer=function(e){var t=e.find("._qp-text-input._qp-text-normal"),n=t.hasClass("qp-digital-container"),i=this.getAnswer();i.length>0&&(n?DigitalInput.InputManager.getInstance().setText4DOM(i[0],t.get(0)):(t.val(i[0]),t.trigger("input")))},e.renderCheckedAnswer=function(e){var t=this,n=e.find("._qp-text-showcheckedanswer");n.removeClass("nqti-hide-dom"),e.find("._qp-text-normal").addClass("nqti-hide-dom");var i=this.getAnswer(),a=this.getCorrectAnswer();i=i.length>0?i[0]:"",n.html(""!==i?i:"&nbsp;");var s=this.checkTextAnswer(a[0],i)?"nqti-correct":"nqti-error";n.addClass(s),"undefined"!=typeof MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,n[0]]),this.__resizeCheckWidth(e),n.resize(function(){t.__resizeCheckWidth(e)})},e.__resizeCheckWidth=function(e){var t=e.find("._qp-text-hidden")[0].clientWidth,n=e.find("._qp-text-showcheckedanswer");n.width()<t+5?n.addClass("fill-cell-min-width"):n.removeClass("fill-cell-min-width")},e.__unbindResize=function(e){var t=e.find("._qp-text-showcheckedanswer");t.off("resize")},e.renderStatisAnswer=function(e){e.find("._qp-text-showstatisanswer").removeClass("nqti-hide-dom"),e.find("._qp-text-normal").addClass("nqti-hide-dom")},e.renderCorrectAnswer=function(e){e.find("._qp-text-showcorrectanswer").removeClass("nqti-hide-dom"),this.getOption().showSubSequence&&e.find("._qp-text-showcorrectanswer-num").removeClass("nqti-hide-dom"),e.find("._qp-text-normal").addClass("nqti-hide-dom")},e.renderLock=function(e){var t=e.find("._qp-text-input._qp-text-normal"),n=t.hasClass("qp-digital-container");this.isLock()?n?DigitalInput.InputManager.getInstance().setDisabled4DOM(t.get(0),!0):t.attr("disabled","disabled"):n?DigitalInput.InputManager.getInstance().setDisabled4DOM(t.get(0),!1):t.removeAttr("disabled")}}};n.registerModelHandler(a)}(t,jQuery),function(e,t){var n=e.QtiPlayer,i=n.getUtils(),a={_name:"textEntryMultipleInteraction",getName:function(){return this._name},create:function(e){var n=e.getModel();n.textEntry=[];for(var a,s,r,o=[],l=/<textEntry[\s\S]*?\/>/g,c=/keyboard="([\s\S]*?)"/,d=/width="(\d+)"/,u=n.prompt.match(l),h=/expectedLength="(\d+)"/,g=0;g<u.length;g++)a=i.getIntValue(u[g],h),s=i.getValue(u[g],c),r=i.getIntValue(u[g],d),s||(s="text"),n.textEntry.push({expectedLength:a,keyboard:s,width:r}),o.push("");var p=function(e,t,n){var i=e.getAnswer();0===i.length&&(i=o),i[t]=n,e.setAnswer(i)};e.getName=function(){return i.getLangText("blank_filling",this.getOption())},e.createTitleHtml=function(e){return i.getLangText("text_title",e)},e.createAnswerHtml=function(e){var t=this,a=n.textEntry,s=n.prompt,r=0;s=s.replace(l,function(n){var s=r+1,o=a[r],l="";o.expectedLength>0&&(l=' maxlength="'+o.expectedLength+'" ');var c=t.getCorrectAnswer(),d="";c.length>0&&(d=c[r]);var u="",h=e.showSubSequence&&e.showCorrectAnswer;e.showSubSequence&&(u='<span class="nqti-base-fill-index _qp-text-showcorrectanswer-num '+(h?"":"nqti-hide-dom")+'">'+s+"</span>");var g='<span data-index="'+r+'" class="nqti-base-fill-cell nqti-correct _qp-text-input _qp-text-showcorrectanswer '+(e.showCorrectAnswer?"":"nqti-hide-dom")+'">'+u+d+"</span>";g+='<span data-index="'+r+'" class="nqti-base-fill-cell  _qp-text-input _qp-text-showcheckedanswer fill-cell-min-width '+(e.showCheckedAnswer?"":"nqti-hide-dom")+'"></span>',g+='<span data-index="'+r+'" class="nqti-base-fill-cell _qp-text-input _qp-text-showstatisanswer '+(e.showStatisAnswer?"":"nqti-hide-dom")+'"><span class="nqti-base-fill-index">'+s+"</span></span>";var p=!e.showCorrectAnswer&&!e.hideAnswerArea&&!e.showStatisAnswer;if("undefined"!=typeof DigitalInput&&"number"===o.keyboard)g+='<span class="_qp-text-input nqti-base-fill-cell span-to-div qp-digital-container  _qp-text-normal '+(p?"":"nqti-hide-dom")+'"  data-index="'+r+'" id="'+i.Rd.getRandom()+'"></span>';else{var f="";"number"===o.keyboard&&(f="input-number");var m="0.000000000001";i.Broswer.isIE()&&(m="any"),g+='<input step="'+m+'" class="nqti-base-fill-cell '+f+" _qp-text-input  _qp-text-normal "+(p?"":"nqti-hide-dom")+'" '+l+' data-index="'+r+'" data-type="'+o.keyboard+'" type="'+o.keyboard+'"/>'}return r++,g});var o='<div class="nqti-base-fill _qp-base-fill">'+s+'<input style="position: absolute;left: -10000px;top: -10000px;" class="nqti-base-fill-cell _qp-text-hidden "  type="text"></div>';return o},e.render=function(e,i){var a=this;a.__digitalResetCount=0;var s=e.find("._qp-text-input._qp-text-normal");s.each(function(){var e=t(this),s=e.data("index");if(i.showAnswerArea&&n.textEntry[s].width){var r=18*n.textEntry[s].width;r=r<60?60:r,e.css("width",r+"px")}e.hasClass("qp-digital-container")&&DigitalInput.InputManager.getInstance().register(e.get(0),function(){if(a.__digitalResetCount>0)return void a.__digitalResetCount--;var t=DigitalInput.InputManager.getInstance().getText4Dom(e.get(0)),n=e.data("index");p(a,n,t.toString())})}),e.find("._qp-base-fill").bind("qpTap",function(e){var n=t(e.target).closest("._qp-text-input");if(n&&n.length>0){var i=n.data("index"),s=a.getCorrectAnswer();a.triggerOptionClick(i,s[i])}})},e.eventHandle=function(e,n){var a=this,s=e.find("._qp-text-input._qp-text-normal"),r={};s.each(function(){var e=t(this),n=e.data("index");r[n]={timer:null,lastValue:""},"number"!==e.attr("type")&&e.qtiAutogrow({maxWidth:"._qti-player",shadow:"nqti-base-fill-cell",vertical:!1,horizontal:!0,postGrowCallback:function(e){e.closest("._qp-model").css("-webkit-box-shadow","0 0 1px rgba(0, 0, 0, 0)"),setTimeout(function(){e.closest("._qp-model").css("-webkit-box-shadow","")},50)}})}),s.each(function(){var e=t(this);e.hasClass("qp-digital-container")||(e.bind("focus",function(){var e=t(this),n=e.data("index"),i=r[n];i.timer=setInterval(function(){var t=e.val().trim();t!==i.lastValue&&(i.lastValue=t,p(a,n,t))},500)}),e.bind("blur",function(){var e=t(this),n=e.data("index"),s=r[n];clearInterval(s.timer),s.timer=null;var o=e.val().trim();"number"===e.attr("data-type")&&8===i.Broswer.IEVersion()&&("-"!==o&&"."!==o||(o="")),e.val(o),s.lastValue=o,p(a,n,o)}),i.Broswer.isIE()&&"number"===e.attr("data-type")&&e.keydown(function(t){return i.Dom.inputNumberKeydown(e,t)}))})},e.renderReset=function(e){var n=this,i=e.find("._qp-text-input._qp-text-normal");i.removeClass("nqti-error"),i.removeClass("nqti-correct"),n.__digitalResetCount=0,i.each(function(){var e=t(this),i=e.hasClass("qp-digital-container");i?(n.__digitalResetCount++,DigitalInput.InputManager.getInstance().setText4DOM("",e.get(0))):(e.val(""),e.trigger("input"))}),e.find("._qp-text-showcorrectanswer").addClass("nqti-hide-dom"),e.find("._qp-text-showcorrectanswer-num").addClass("nqti-hide-dom"),e.find("._qp-text-showstatisanswer").addClass("nqti-hide-dom"),e.find("._qp-text-normal").removeClass("nqti-hide-dom");var a=e.find("._qp-text-showcheckedanswer");a.addClass("nqti-hide-dom"),a.removeClass("nqti-error"),a.removeClass("nqti-correct"),a.addClass("fill-cell-min-width")},e.renderAnswer=function(e){var n=e.find("._qp-text-input._qp-text-normal"),i=this.getAnswer();i.length>0&&i.length===n.length&&n.each(function(){var e=t(this),n=e.data("index");e.hasClass("qp-digital-container")?DigitalInput.InputManager.getInstance().setText4DOM(i[n],e.get(0)):(e.val(i[n]),e.trigger("input"))})},e.renderCheckedAnswer=function(e){var n=this,i=e.find("._qp-text-showcheckedanswer");i.removeClass("nqti-hide-dom"),e.find("._qp-text-normal").addClass("nqti-hide-dom");var a=this.getAnswer(),s=this.getCorrectAnswer();i.each(function(){var e=t(this),i=e.data("index"),r=a[i]&&""!==a[i]?a[i]:"";e.html(""!==r?r:"&nbsp;");var o=n.checkTextAnswer(s[i],r)?"nqti-correct":"nqti-error";e.addClass(o),"undefined"!=typeof MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,e[0]])}),this.__resizeCheckWidth(e),i.resize(function(){n.__resizeCheckWidth(e)})},e.__resizeCheckWidth=function(e){var n=e.find("._qp-text-hidden")[0].clientWidth,i=e.find("._qp-text-showcheckedanswer");i.each(function(){var e=t(this);e.width()<n+5?e.addClass("fill-cell-min-width"):e.removeClass("fill-cell-min-width")})},e.__unbindResize=function(e){var t=e.find("._qp-text-showcheckedanswer");t.off("resize")},e.renderStatisAnswer=function(e){e.find("._qp-text-showstatisanswer").removeClass("nqti-hide-dom"),e.find("._qp-text-normal").addClass("nqti-hide-dom")},e.renderCorrectAnswer=function(e){e.find("._qp-text-showcorrectanswer").removeClass("nqti-hide-dom"),this.getOption().showSubSequence&&e.find("._qp-text-showcorrectanswer-num").removeClass("nqti-hide-dom"),e.find("._qp-text-normal").addClass("nqti-hide-dom")},e.renderLock=function(e){var n=e.find("._qp-text-input._qp-text-normal");this.isLock()?n.each(function(){var e=t(this),n=e.hasClass("qp-digital-container");n?DigitalInput.InputManager.getInstance().setDisabled4DOM(e.get(0),!0):e.attr("disabled","disabled")}):n.each(function(){var e=t(this),n=e.hasClass("qp-digital-container");n?DigitalInput.InputManager.getInstance().setDisabled4DOM(e.get(0),!1):e.removeAttr("disabled")})}}};n.registerModelHandler(a)}(t,jQuery),function(e,t,n){"$:nomunge";function i(){a=t[o](function(){g++,s.forEach(function(n){var i=n.width(),a=n.height(),r=n.data(c);i===r.w&&a===r.h||n.trigger(l,[r.w=i,r.h=a]),g%50===0&&n.get(0)!==t&&0===e("["+u+'="'+n.attr(u)+'"]').length&&(f(s,n),n.removeData(c),n.unbind(l))}),s.length?i():clearTimeout(a)},r[d])}var a,s=[],r=e.resize=e.extend(e.resize,{}),o="setTimeout",l="resize",c=l+"-special-event",d="delay",u="data-resize",h="throttleWindow",g=0;r[d]=350,r[h]=!0;var p=function(e){return e+(10*Math.random()+(new Date).getMilliseconds()).toString().replace(".","")},f=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(isNaN(t)||(i=n),i[0]==t[0]){for(var a=n;a<e.length;a++)e[a]=e[a+1];e.length=e.length-1}}};e.event.special[l]={setup:function(){if(!r[h]&&this[o])return!1;var t=e(this);t.attr(u,p(u)),s.push(t),t.data(c,{w:t.width(),h:t.height()}),1===s.length&&i()},teardown:function(){if(!r[h]&&this[o])return!1;var t=e(this);f(s,t),t.removeData(c),s.length||clearTimeout(a)},add:function(t){function i(t,i,s){var r=e(this),o=r.data(c);o.w=i!==n?i:r.width(),o.h=s!==n?s:r.height(),a.apply(this,arguments)}if(!r[h]&&this[o])return!1;var a;return e.isFunction(t)?(a=t,i):(a=t.handler,void(t.handler=i))}}}(jQuery,this),function(){var e;!function(t,n){return t.fn.qtiAutogrow=function(n){if(null==n&&(n={}),null==n.horizontal&&(n.horizontal=!0),null==n.vertical&&(n.vertical=!0),null==n.debugx&&(n.debugx=-1e4),null==n.debugy&&(n.debugy=-1e4),null==n.debugcolor&&(n.debugcolor="yellow"),null==n.flickering&&(n.flickering=!0),null==n.postGrowCallback&&(n.postGrowCallback=function(){}),null==n.verticalScrollbarWidth&&(n.verticalScrollbarWidth=e()),n.horizontal!==!1||n.vertical!==!1)return this.filter("input,textarea").each(function(){var e,i,a,s,r,o,l;if(e=t(this),!e.data("autogrow-enabled"))return e.data("autogrow-enabled"),s=parseInt(e.attr("data-minHeight"))||e.height(),r=parseInt(e.attr("data-minWidth"))||e.width(),a=1*e.css("lineHeight")||0,e.hasVerticalScrollBar=function(){return e[0].clientHeight<e[0].scrollHeight},l=parseInt(e.css("max-width")),i=t('<div class="'+n.shadow+'"></div>').css({position:"fixed",display:"inline-block","background-color":n.debugcolor,top:n.debugy,left:n.debugx,"max-width":e.css("max-width"),padding:e.css("padding"),boxSizing:e.css("boxSizing"),fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),lineHeight:e.css("lineHeight"),resize:"none","word-wrap":"break-word","word-break":"break-all"}).appendTo(e.parent()),n.horizontal===!1&&i.css({width:e.width()}),o=function(o){return function(l){if(r&&!isNaN(r)||("object"==typeof n.minWidth?(!n.minWidth instanceof jQuery&&(n.minWidth=t(n.minWidth)),r=n.minWidth.width()):r=e.width()),(!c||isNaN(c))&&"string"==typeof n.maxWidth){var c=i.closest(n.maxWidth).width()-30;i.css({"max-width":c+"px"})}var d,u,h;return u=o.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n /g,"<br/>&nbsp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(e){return Array(e.length-1).join("&nbsp;")+" "}),i.html(u),n.vertical===!0&&(s=parseInt(e.attr("data-minheight"))||e.height(),d=Math.max(i.height()+a,s),e.height(d)),n.horizontal===!0&&(r=parseInt(e.attr("data-minwidth"))||r,h=Math.max(i.width(),r),e.width(h)),n.postGrowCallback(e)}}(this),e.on("input",o),e.resize(o),o()})}}(t.jQuery,t),e=function(){var e,t,i,a;return e=n.createElement("p"),e.style.width="100%",e.style.height="200px",t=n.createElement("div"),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),n.body.appendChild(t),i=e.offsetWidth,t.style.overflow="scroll",a=e.offsetWidth,i===a&&(a=t.clientWidth),n.body.removeChild(t),i-a}}.call(this)}(window,document,jQuery);
//# sourceMappingURL=qti-player-all.min.js.map
