!function(e,t){var n=!1,a=/sys=homework/i.test(location.search);if(a||n){var r=e.QtiPlayer;if(!r||!r.createPlayer)throw"请先加载qti-player.js";var i=r.getUtils(),s=r.getLogger(),o={callNative:function(e,t){s.debug(e+"---------"),"undefined"!=typeof Bridge&&Bridge&&Bridge.callNative("com.nd.android.homework.ui.HomeworkJsBridge",e,t)},initHWPanel:function(e){this.callNative("initHWPanel",e)},destroyHWPanel:function(){this.callNative("destroyHWPanel",{})},showHWPanel:function(e){this.callNative("showHWPanel",{show:e})}},l={NUM:/^\d+?$/,NUM_SYMBOL:/^[+-]?[0-9]+\.?[0-9]*$/,ABC:/^[a-zA-z]+$/,CN:/[\u4E00-\u9FA5]+/,OTHER:/^[^\u4E00-\u9FA5]+$/},d=function(e,a,r){var i=t('[data-qti-id="'+a+'"]'),d=i.find(".qp-hwarea");if(!(document.webkitIsFullScreen||d.length<=0)){var h={scrollState:e.scrollState,inputArea:[]},c=t(document.body),p=c.scrollTop(),u=c.scrollLeft(),g=8,w=3;d.each(function(){var a=t(this),i=parseInt(a.attr("data-index")),s=a.closest(".qp-model").attr("data-model-id"),o=a.offset(),d=r[s].value[i],c={id:s+"|"+i,left:o.left-u,top:o.top-p,width:a.width(),height:a.height(),type:"OTHER",show:!0};for(var f in l)if(l[f].test(d)){c.type=f;break}"START"===h.scrollState?c.show=!1:((o.left<e.scrollArea.left-u||o.left>e.scrollArea.left+e.scrollArea.width-u)&&(c.show=!1),(o.top<e.scrollArea.top-p-g||o.top+c.height>e.scrollArea.top+e.scrollArea.height-p+w)&&(c.show=!1)),c.height=c.height+2,h.inputArea.push(c),n&&(t('[data-m="'+c.id+'"]').length>0?t('[data-m="'+c.id+'"]').css({left:c.left+30+"px",top:c.top+"px",display:c.show?"block":"none"}):t(document.body).append('<div data-m="'+c.id+'" style=" opacity: 0.5; background: black; position: fixed;z-index: 10000;left: '+(c.left+20)+"px;top:"+c.top+"px;width:"+c.width+"px;height:"+c.height+"px; display:"+(c.show?"block":"none")+'"></div>'))}),s.debug(h),o.initHWPanel(h)}};(function(){var e=t(".com_keyboard");return function(){return e.length<=0&&(e=t(".com_keyboard")),{top:e.length<=0?0:e.offset().top,visible:!(e.length<=0)&&!e.is(":hidden")}}})();r.createPlayer=function(e){var n=r._createPlayer(e);return n._homework={},n.setHomeWorkHWArea=function(e){var n=this;this._homework.area=e;var a=this.getAssessmentModel().correctAnswer;if(d(this._homework.area,this._homework.renderid,a),!this._homework.called){var r=t('[data-qti-id="'+this._homework.renderid+'"]').find(".qp-player");r.resize(function(){s.debug("area resize--------------------"),n._homework.area&&(n._homework.area.scrollState="INIT",d(n._homework.area,n._homework.renderid,a))}),this._homework.called=!0,o.showHWPanel(!0)}},n.renderHomeWorkHWAnswer=function(e){"string"==typeof e&&(e=JSON.parse(e));var n=/(.+?)\|(\d)*/i,a=this.getAnswer(),r="",i=0;for(var o in e){var l=n.exec(o);l&&3===l.length?(r=l[1],i=parseInt(l[2])):(r=o,i=0),a[r]?e[o].append?a[r].value[i]=(a[r].value.length>0?a[r].value[i]:"")+e[o].value:a[r].value[i]=e[o].value:s.error("id:"+r+"不存在")}this.setAnswer(a);var d=t('[data-qti-id="'+this._homework.renderid+'"]'),h=this._assessmentTest._assessmentItem._modelItem;for(var o in h){var c=h[o];c.renderAnswer&&c.renderAnswer(d.find('[data-model-id="'+o+'"]'),this._option)}},n.setHomeWorkHWVisible=function(e){o.showHWPanel(e)},n.mediaOnFullScreenChange=function(e){this._mediaOnFullScreenChange(function(t){o.showHWPanel(!t),e&&e(t)})},n.destroy=function(){this._destroy(),o.destroyHWPanel()},n.render=function(e,n,a){var r=t.type(e),s=null;"string"===r?s=t("#"+e):"object"===r&&(s=e instanceof jQuery?e:t(e)),this._homework.renderid=i.getRandom(),s.attr("data-qti-id",this._homework.renderid),this._homework.called=!1,this._render(e,n,a)},n.mediaOnFullScreenChange(function(e){s.debug("mediaOnFullScreenChange:"+e)}),n}}}(window,jQuery),function(e,t){var n=e.QtiPlayer,a=(n.getUtils(),{_name:"textEntryInteraction",getName:function(){return this._name},create:function(e){var t=e.getModel();e.getName=function(){return"填空题"},e.hasNum=function(){return!1},e.hasHint=function(){return!1},e.createTitleHtml=function(){return""},e.createAnswerHtml=function(e){var n=this,a="";t.expectedLength>0&&(a=' maxlength="'+t.expectedLength+'" ');var r=t.modelId,i=r.substring(r.lastIndexOf("-")+1),s='<span class="qp-model-content qp-blank-filling">';if(e.showCorrectAnswer){var o=n.getCorrectAnswer(),l="";o.length>0&&(l=o[0]);var d="qp-textentry";l.trim().length>0?(d+=" qp-textentry-html",l.match(/<latex( class="math-tex")?>[\s\S]*?<\/latex>/g)&&(d+=" qp-latex")):(d+=" qp-textentry-html-empty",l="&nbsp;"),e.showSubSequence&&(l='<i class="qp-response-num">'+i+"</i>"+l),s+='<span data-index="0" data-num="'+i+'" class="'+d+'">'+l}else if(s+='<span data-index="0" data-num="'+i+'" class="qp-textentry qp-hwarea"> ',e.hideAnswerArea);else if(e.showStatisAnswer)s+='<span  class="qp-textentry-text-statis">'+i+"</span>";else{var h="";t.keyboard;e.showSubSequence&&(s+='<i class="qp-response-num">'+i+"</i>"),s+='<input step="0.000000001" style="text-align: left;" class="qp-text-input qp-textentry-input" '+a+'placeholder="'+h+'" type="text"/>'}return s+="</span></span>"},e.render=function(e,n){var a=this,r=e.find(".qp-text-input");if(e.find(".qp-textentry").bind("qpTap",function(){var e=a.getCorrectAnswer();a.triggerOptionClick(0,e[0])}),!(r.length<=0)){var i=r.hasClass("qp-digital-container");if(n.showAnswerArea&&t.width){var s=18*t.width;s=s<60?60:s,r.css("width",s+"px")}i&&DigitalInput.InputManager.getInstance().register(r.get(0),function(){var e=DigitalInput.InputManager.getInstance().getText4Dom(r.get(0)),t=[];t.push(e.toString()),a.setAnswer(t)}),(n.showAnswer||n.showCheckedAnswer)&&a.renderAnswer(e,n),n.showLock&&(i?DigitalInput.InputManager.getInstance().setDisabled4DOM(r.get(0),!0):r.attr("disabled","disabled"));var o=e.find(".qp-response-num");i&&n.showSubSequence&&DigitalInput.InputManager.getInstance().setFocusCallback4DOM(r.get(0),function(){o.hide()},function(){var e=DigitalInput.InputManager.getInstance().getText4Dom(r.get(0));e.length>0?o.hide():o.show()})}},e.eventHandle=function(e,t){var n=this,a=e.find("input"),r=e.find(".qp-response-num"),i=a.hasClass("qp-digital-container");if(!i){var s=null,o="",l=function(e){var t=[];t.push(e),n.setAnswer(t)};i||r.bind("qpTap",function(){a.trigger("focus")}),a.bind("focus",function(){r.hide(),s=setInterval(function(){var e=a.val().trim();e!==o&&(o=e,l(e))},500)}),a.bind("blur",function(){clearInterval(s),s=null;var e=a.val().trim();a.val(e),o=e,l(e),e.length>0?r.hide():r.show()})}},e.renderAnswer=function(e,t){var n=this,a=e.find(".qp-text-input"),r=a.hasClass("qp-digital-container");if(t.showAnswerArea||t.showAnswer||t.showCheckedAnswer){var i=n.getAnswer();if(i.length>0){r?DigitalInput.InputManager.getInstance().setText4DOM(i[0],a.get(0)):a.val(i[0]);var s=n.getCorrectAnswer();if(t.showCheckedAnswer&&s.length>0){var o=n.checkTextAnswer(s[0],i[0])?"qp-answer-right":"qp-answer-wrong";a.addClass(o)}i[0].length>0&&e.find(".qp-response-num").hide()}}}}});n.registerModelHandler(a)}(window,jQuery),function(e,t){var n=e.QtiPlayer,a=n.getUtils(),r={_name:"textEntryMultipleInteraction",getName:function(){return this._name},create:function(e){var n=e.getModel();n.textEntry=[];for(var r,i,s,o=[],l=/<textEntry[\s\S]*?\/>/g,d=/keyboard="([\s\S]*?)"/,h=/width="(\d+)"/,c=n.prompt.match(l),p=/expectedLength="(\d+)"/,u=0;u<c.length;u++)r=a.getIntValue(c[u],p),i=a.getValue(c[u],d),s=a.getIntValue(c[u],h),i||(i="text"),n.textEntry.push({expectedLength:r,keyboard:i,width:s}),o.push("");var g=function(e,t,n){var a=e.getAnswer();0===a.length&&(a=o),a[t]=n,e.setAnswer(a)};e.getName=function(){return"填空题"},e.createTitleHtml=function(){return""},e.createAnswerHtml=function(e){var t=this,a=n.textEntry,r=n.prompt,i=0;r=r.replace(l,function(n){var r=i+1,s=a[i],o="";s.expectedLength>0&&(o=' maxlength="'+s.expectedLength+'" ');var l="";if(e.showCorrectAnswer){var d=t.getCorrectAnswer(),h="";d.length>0&&(h=d[i]);var c="qp-textentry";h.trim().length>0?(c+=" qp-textentry-html",h.match(/<latex( class="math-tex")?>[\s\S]*?<\/latex>/g)&&(c+=" qp-latex")):(c+=" qp-textentry-html-empty",h="&nbsp;"),e.showSubSequence&&(h='<i class="qp-response-num">'+r+"</i>"+h),l='<span data-index="'+i+'" class="'+c+'" >'+h+"</span>"}else{if(l='<span data-index="'+i+'" class="qp-textentry qp-hwarea">',e.hideAnswerArea);else if(e.showStatisAnswer)l+='<span  class="qp-textentry-text-statis">'+r+"</span>";else{var p="";e.showSubSequence&&(l+='<i class="qp-response-num">'+r+"</i>"),l+='<input style="text-align: left;" step="0.000000001" class="qp-textentry-input qp-text-input" '+o+'placeholder="'+p+'" data-index="'+i+'"" type="text"/>'}l+="</span>"}return i++,l});var s='<div class="qp-model-content qp-textentry-multiple qp-blank-filling">'+r+"</div>";return s},e.render=function(e,a){var r=this,i=e.find(".qp-text-input");i.each(function(){var i=t(this),s=i.data("index");if(a.showAnswerArea&&n.textEntry[s].width){var o=18*n.textEntry[s].width;o=o<60?60:o,i.css("width",o+"px")}i.hasClass("qp-digital-container")?(DigitalInput.InputManager.getInstance().register(i.get(0),function(){var e=DigitalInput.InputManager.getInstance().getText4Dom(i.get(0)),t=i.data("index");g(r,t,e.toString())}),a.showLock&&DigitalInput.InputManager.getInstance().setDisabled4DOM(i.get(0),!0),a.showSubSequence&&DigitalInput.InputManager.getInstance().setFocusCallback4DOM(i.get(0),function(){e.find('[data-index="'+s+'"] .qp-response-num').hide()},function(){var t=DigitalInput.InputManager.getInstance().getText4Dom(i.get(0));t.length>0?e.find('[data-index="'+s+'"] .qp-response-num').hide():e.find('[data-index="'+s+'"] .qp-response-num').show()})):a.showLock&&i.attr("disabled","disabled")}),(a.showAnswer||a.showCheckedAnswer)&&r.renderAnswer(e,a),e.find(".qp-textentry").bind("qpTap",function(){var e=t(this),n=e.data("index"),a=r.getCorrectAnswer();r.triggerOptionClick(n,a[n])})},e.eventHandle=function(e,n){var a=this,r=e.find(".qp-text-input"),i={};r.each(function(){var n=t(this),a=n.data("index");i[a]={timer:null,lastValue:""};var r=n.hasClass("qp-digital-container");r||e.find('[data-index="'+a+'"] .qp-response-num').bind("qpTap",function(){n.trigger("focus")})}),r.each(function(){var n=t(this);n.hasClass("qp-digital-container")||(n.bind("focus",function(){var n=t(this),r=n.data("index");e.find('[data-index="'+r+'"] .qp-response-num').hide();var s=i[r];s.timer=setInterval(function(){var e=n.val().trim();e!==s.lastValue&&(s.lastValue=e,g(a,r,e))},500)}),n.bind("blur",function(){var n=t(this),r=n.data("index"),s=e.find('[data-index="'+r+'"] .qp-response-num'),o=i[r];clearInterval(o.timer),o.timer=null;var l=n.val().trim();n.val(l),o.lastValue=l,g(a,r,l),l.length>0?s.hide():s.show()}))})},e.renderAnswer=function(e,n){var a=this,r=e.find(".qp-text-input");if(n.showAnswerArea||n.showAnswer||n.showCheckedAnswer){var i=a.getAnswer(),s=a.getCorrectAnswer();i.length>0&&i.length===r.length&&r.each(function(){var r=t(this),o=r.data("index");if(r.hasClass("qp-digital-container")?DigitalInput.InputManager.getInstance().setText4DOM(i[o],r.get(0)):r.val(i[o]),n.showCheckedAnswer){var l=a.checkTextAnswer(s[o],i[o])?"qp-answer-right":"qp-answer-wrong";r.addClass(l)}i[o].length>0&&e.find('[data-index="'+o+'"] .qp-response-num').hide()})}}}};n.registerModelHandler(r)}(window,jQuery);