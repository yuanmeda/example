define("player.playersetting",["require","exports"],function(e,t){"use strict";var n;(function(t){var n="",r="",i=e.toUrl("").split("?");n="?v=2017040101",r="2017040101";var s=function(){function e(e,t,n,r,i,s,u){this.apiHost=e,this.staticHost=t,this.swfUrl=n,this.video=r,this.playerConfigs=i,this.playerEvents=s,this.playerPlugins=u,this.defaultconfig=new o(this),this.video=this.video||{autoBuffering:!0,autoPlay:!0,accessToken:""},this.accessToken=this.video.accessToken,this.swfUrl=this.swfUrl||this.staticHost+"/typescript/cloud/video/dest/latest/flowplayer/"}return e.prototype.getPlayerConfigs=function(e,t,n){var r=this.defaultconfig.getConfig(e,this.playerConfigs,n);return t&&(r.obj2.clip.autoPlay=typeof t["autoPlay"]=="boolean"?t.autoPlay:!0,r.obj2.clip.autoBuffering=typeof t["autoBuffering"]=="boolean"?t.autoBuffering:!0),r},e.prototype.getPlayerEvents=function(){return this.playerEvents?this.playerEvents:{}},e.prototype.getPlayerPlugins=function(){return this.playerPlugins?this.playerPlugins:[]},e}();t.PlayerSetting=s;var o=function(){function e(e){this.playersetting=e}return e.prototype.getConfig=function(e,t,r){var i={src:""},s={clip:{id:e&&e.Id?e.Id:0,url:e&&e.DefaultFile?e.DefaultFile.FileName[0]:e,autoPlay:!1,autoBuffering:!0,loading:t.loading===!1?!1:!0,captionUrl:e&&e.DefaultSubtitle&&e.DefaultSubtitle.Url,quality:e&&e.DefaultFile&&e.DefaultFile.Quality,frontCoverUrl:e&&e.FrontCoverUrl,screenshotInterval:e&&e.ScreenshotInterval,screenshotPath:e.ScreenshotPath,screenshotWidth:e&&e.ScreenshotWidth,screenshotHeight:e&&e.ScreenshotHeight},log:{qaLogUrl:"http://192.168.19.97:7001/index.php?_c=qa_log.raw_log.send",writeQaLog:!1,level:"debug",filter:[]},i18n:{noFlashPluginMessage:'<p>如果您无法播放视频，请确认您是否安装Flash</p><p><a href="http://get.adobe.com/cn/flashplayer/" target="_blank">点击下载</a>安装最新Flash Player播放器</p>',videoText:"视频",audioText:"音频",resourceStatusEncodingMessage:"抱歉，当前{{videoType}}未转码完成，请稍候再观看。",resourceStatusReadyMessage:"{{videoType}}：已就绪",resourceStatusExpiredMessage:"抱歉，当前{{videoType}}已下线，无法观看。",resourceStatusDeleteMessage:"抱歉，当前{{videoType}}已删除，无法观看。",resourceStatusDefaultMessage:"抱歉，{{videoType}}加载失败，错误码：",resourceLoadFailMessage:"抱歉，视频加载失败，错误码：",play:"播放",pause:"暂停",replay:"重播",volume:"音量",preference:"设置",fullscreen:"全屏",exitFullscreen:"退出全屏幕",coveredTheEntireScreen:"满屏",ad:"广告",second:"秒",sure:"确定",cancel:"取消",language:"语言",subtitles:"字幕",quality:"画质",auto:"自动",notAvailable:"不可选",noUseed:"不使用",ultimateHD:"超清",hd:"高清",sd:"标清",smooth:"流畅",rapidly:"极速",rightAnswerTitle:"恭喜你答对了",examinationQuestions:"检测题",continuePlay:"继续播放",reAnswer:"重新作答",question:"题",total:"共",hasAnswered:"已作答",failAnswerTitle:"很遗憾你答错了，请继续作答",fastreverse:"后退15秒",scale:"画面比例",chinese:"中文",english:"英文",japanese:"日文"},plugins:{flashls:{url:this.playersetting.swfUrl+"flowplayer.flashls-3.2.10.swf"+n,hls_lowbufferlength:10},lighttpd:{url:this.playersetting.swfUrl+"flowplayer.pseudostreaming-3.2.13.swf"+n,id:e&&e.Id?e.Id:0,code:r&&r.code?r.code:"",playType:r.type.toString(),apiHost:e&&e.ApiHost?e.ApiHost:"",accessToken:e&&e.accessToken?e.accessToken:"",hosts:e&&e.Hosts?e.Hosts:[],files:e&&e.Files?e.Files:[],defaultFile:e.DefaultFile},controls:{url:this.playersetting.swfUrl+"flowplayer.controls-3.2.15.swf"+n,margins:[9,10,9,20],height:40,opacity:1,sliderBorder:0,ratio:!0,quality:!0,fastreverse:!1,backgroundGradient:[0],backgroundColor:"#1E1E1E",bufferColor:"#797979",progressColor:"#EE750A",volumeColor:"#EE750A",timeColor:"#b5b5b5",timeFontSize:14,durationColor:"#737373",dragDirection:"both",dragTime:0,autoHide:{fullscreenOnly:!0,hideDelay:2e3,hideProgressBar:!0},onClick:function(e){var t=e.split("_");window.circle(parseInt(t[1])/1e3)}},toppanel:{url:this.playersetting.swfUrl+"flowplayer.toppanel-3.2.8.swf"+n,top:0,height:30,borderRadius:0,border:0,backgroundColor:"#1E1E1E",opacity:.95,backgroundGradient:[0],left:0,autoHide:{fullscreenOnly:!0,hideDelay:2e3},scaleTextColor:"#ffffff",fontColor:"#ee750a"},setpanel:{url:this.playersetting.swfUrl+"flowplayer.setpanel-3.2.8.swf"+n,top:"50%",left:"50%",width:400,height:250,borderRadius:0,border:0,backgroundColor:"#1E1E1E",opacity:.9,backgroundGradient:[0],files:e&&e.Files?e.Files:[],currentFile:e&&e.DefaultFile?e.DefaultFile:{},subTitle:e&&e.SubTitle?e.SubTitle:[],currentSubtitle:e&&e.DefaultSubtitle?e.DefaultSubtitle:{},closeButton:!0,itemTextColor:"#ffffff",selectItemBackgroundColor:"#ee750a",sureButtonBackgroundColor:"#ee750a",sureButtonFontColor:"#ffffff",cancelButtonBackgroundColor:"#ffffff",cancelButtonFontColor:"#000000"},captionsContent:{url:this.playersetting.swfUrl+"flowplayer.content-3.2.9.swf"+n,bottom:52,height:75,zIndex:1,backgroundColor:"transparent",backgroundGradient:"none",border:0,textDecoration:"glow",opacity:1,style:{body:{fontSize:16,fontFamily:"simhei,黑体",textAlign:"center",color:"#ffffff"},p:{leading:2}}},lastPositionContent:{url:this.playersetting.swfUrl+"flowplayer.content-3.2.9.swf"+n,bottom:50,left:0,zIndex:2,border:0,borderRadius:0,textDecoration:"outline",backgroundGradient:"none",height:40,backgroundColor:"transparent",style:{body:{fontSize:16,fontFamily:"simhei,黑体",textAlign:"left",color:"#ffffff",textShadow:"1px 1px 1px #a00,-1px -1px 1px #a00"}}},captions:{url:this.playersetting.swfUrl+"flowplayer.captions-3.2.9.swf"+n,captionTarget:"captionsContent"},poster:{url:this.playersetting.swfUrl+"flowplayer.poster-1.0.0.swf"+n,start:{hideTimer:!1,closeButton:!0,enable:!0,items:[]},pause:{hideTimer:!0,closeButton:!0,enable:!0,items:[]},end:{hideTimer:!0,closeButton:!0,enable:!0,items:[]}}},logo:{url:"http://flash.flowplayer.org/media/img/player/acme.png",fullscreenOnly:!1,opacity:0},contextMenu:[{"华渔未来教育视频播放器 v1.0.6(core-3.2.17)":function(){}},{"网络检测":function(){window.open("http://s21.tianyuimg.com/huayutools/")}},{"下载诊断工具":function(){window.open("")}},{"下载诊断工具":function(){window.open("http://f11.e.99.com/tools/video/HuayuVideoCheck.exe")}},{"网络诊断分析":function(){var e=this.getClip().completeUrl;window.open("hyvideo://url="+encodeURIComponent(e))}}],canvas:{background:"#000000",backgroundGradient:[0]}};r.type=="url"?(s.plugins.setpanel=null,s.plugins.controls.ratio=!1,s.plugins.controls.quality=!1):(s.plugins.controls.ratio=!0,s.plugins.controls.quality=!0);if(e&&typeof e.SubTitle=="undefined"||e.SubTitle.length==0)s.plugins.captionsContent=null,s.plugins.captions=null;this.playersetting.staticHost.indexOf("huayu.nd")==-1?(s=$.extend(s,{key:"#$8369a13897007a895dd"}),i=$.extend(i,{src:this.playersetting.swfUrl+"flowplayer.commercial-3.2.16.swf"+n,wmode:"opaque"})):i=$.extend(i,{src:this.playersetting.swfUrl+"flowplayer-3.2.16.swf"+n,wmode:"opaque"});if(typeof e=="string"&&e.indexOf(".mp3")<0)s=$.extend(!0,s,{clip:{url:e,provider:"lighttpd",autoPlay:!1,autoBuffering:!0},plugins:{tybitrateselect:null}});else if(typeof e=="string"&&e.indexOf(".mp3")>=0){var o=this.playersetting.swfUrl+"audio.jpg";s=$.extend(!0,s,{clip:{coverImage:{url:o,scaling:"orig",provider:"audio"}},plugins:{audio:{url:this.playersetting.swfUrl+"flowplayer.audio-3.2.10.swf"+n},tybitrateselect:null,scale:null,lighttpd:null,toppanel:null}})}else if(e.VideoType==0||e.VideoType==2||typeof e.VideoType=="undefined")s=$.extend(!0,s,{clip:{provider:e.DefaultFile.Type==6?"flashls":"lighttpd",urlResolvers:null}});else if(e.VideoType==1){var o=e.FrontCoverUrl&&(e.FrontCoverUrl.toLowerCase().indexOf(".jpg")>=0||e.FrontCoverUrl.toLowerCase().indexOf(".png")>=0)?e.FrontCoverUrl:this.playersetting.swfUrl+"audio.jpg";s=$.extend(!0,s,{clip:{coverImage:{url:o,scaling:"orig",provider:"audio"}},plugins:{audio:{url:this.playersetting.swfUrl+"flowplayer.audio-3.2.10.swf"+n},tybitrateselect:null,scale:null,lighttpd:null,toppanel:null}})}if(typeof t["plugins"]!="undefined"&&t["plugins"]!=null){for(var u in t.plugins){if(!t.plugins[u].url||t.plugins[u].url.indexOf("?")>0)continue;t.plugins[u].url.indexOf("http://")>-1?t.plugins[u].url=t.plugins[u].url+n:t.plugins[u].url=this.playersetting.swfUrl+t.plugins[u].url+n}s=$.extend(!0,s,t);if(s.plugins.poster.start&&s.plugins.poster.start.items){var a=s.plugins.poster.start.items,f=[];for(var l=0,c=a.length;l<a.length;l++)a[l].type=="video"&&typeof a[l].duration=="number"&&a[l].duration>0&&f.push(a[l]);s.plugins.poster.start.items=f,s.plugins.poster.start.hideTimer=!1}s.plugins.poster.pause&&s.plugins.poster.pause.items.length>1&&(s.plugins.poster.pause.items=s.plugins.poster.pause.items.slice(0,1),s.plugins.poster.pause.closeButton=!0),s.plugins.poster.end&&s.plugins.poster.end.items.length>1&&(s.plugins.poster.end.items=s.plugins.poster.end.items.slice(0,1),s.plugins.poster.end.closeButton=!0)}if(typeof t["plugins"]=="undefined"||t["plugins"]==null||!t.plugins.poster)s.plugins.poster=null;return r.type=="url"&&(s.plugins.setpanel=null),e.Drawable||(s.plugins.controls.dragDirection="backward",s.plugins.controls.dragTime=e.DrawablePos),{obj1:i,obj2:s}},e}()})(n=t.Video||(t.Video={}))}),define("eventdispatcher",["require","exports"],function(e,t){(function(e){var t=function(){function e(e){this.type=e}return e}();e.Event=t;var n=function(){function e(){this._listeners=[]}return e.prototype.hasEventListener=function(e,t,n){var r=!1;for(var i=0;i<this._listeners.length;i++)this._listeners[i].type===e&&this._listeners[i].listener===t&&this._listeners[i].scope==n&&(r=!0);return r},e.prototype.addEventListener=function(e,t){var n=e.indexOf("."),r,i;n>-1?(r=e.substr(0,n),i=e.substr(n)):(r=e,i="");if(this.hasEventListener(r,t,i))return;this._listeners.push({type:r,listener:t,scope:i})},e.prototype.removeEventListener=function(e,t){var n=e.indexOf("."),r,i;n>-1?(r=e.substr(0,n),i=e.substr(n)):(r=e,i="");for(var s=0;s<this._listeners.length;s++)t?this._listeners[s].type===r&&this._listeners[s].listener===t&&this._listeners[s].scope==i&&this._listeners.splice(s,1):this._listeners[s].type===r&&this._listeners[s].scope==i&&this._listeners.splice(s,1)},e.prototype.dispatchEvent=function(e){var t=e.type.indexOf(".");if(t>-1){var n=e.type.substr(0,t),r=e.type.substr(t);for(var i=0;i<this._listeners.length;i++)this._listeners[i].type===e.type&&this._listeners[i].scope==r&&this._listeners[i].listener.call(this,e)}else for(var i=0;i<this._listeners.length;i++)this._listeners[i].type===e.type&&this._listeners[i].listener.call(this,e)},e}();e.EventDispatcher=n})(t.Common||(t.Common={}));var n=t.Common});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.plugin",["require","exports","eventdispatcher"],function(e,t,n){(function(e){var t=function(e){function t(){e.call(this),this.addEventListener("onLoad",$.proxy(this.onLoad,this))}return __extends(t,e),t.prototype.onLoad=function(e){this.player=e.player},t}(n.Common.EventDispatcher);e.PluginBase=t})(t.Video||(t.Video={}));var r=t.Video});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.playerevent",["require","exports","eventdispatcher"],function(e,t,n){(function(e){var t=function(e){function t(t,n){e.call(this,t),this.type=t,this.callback=n}return __extends(t,e),t}(n.Common.Event);e.PlayerEvent=t})(t.Video||(t.Video={}));var r=t.Video});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.cuepointevent",["require","exports","eventdispatcher"],function(e,t,n){(function(e){var t=function(e){function t(t,n){e.call(this,t),this.type=t,this.obj=n}return __extends(t,e),t}(n.Common.Event);e.CuepointEvent=t})(t.Video||(t.Video={}));var r=t.Video});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.clip",["require","exports","eventdispatcher","player.cuepointevent"],function(e,t,n,r){(function(e){var t=function(e){function t(t){e.call(this),this.innerClip=t}return __extends(t,e),t.prototype.addCuepoint=function(e){var t=this;this.innerClip.onCuepoint(e,function(e,n){t.dispatchEvent(new r.Video.CuepointEvent("onCuepoint",n))})},t}(n.Common.EventDispatcher);e.Clip=t})(t.Video||(t.Video={}));var i=t.Video});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.clipevent",["require","exports","eventdispatcher"],function(e,t,n){(function(e){var t=function(e){function t(t,n){e.call(this,t),this.type=t,this.clip=n}return __extends(t,e),t}(n.Common.Event);e.ClipEvent=t})(t.Video||(t.Video={}));var r=t.Video}),define("player.flashdetect",["require","exports"],function(e,t){"use strict";var n;(function(e){var t=function(){function e(e,t){this.element=e,this.setting=t,this.i18n=t.playerConfigs.i18n,this.stylePrefix="flashdetect-",this.hasFlash=!0,this.supportVideo=!!document.createElement("video").canPlayType,this.detect()}return e.prototype.detect=function(){var e=swfobject.getFlashPlayerVersion(),t=window.navigator.userAgent,n="",r=/iPad/i.test(t),i=/iPhone/i.test(t),s=t.match(/Android\s?(\d+.\d+(.\d+)?)/i);s&&s.length>2&&(n=s[1]),e.major>=10&&n<"4.0.3"&&!r&&!i?this.hasFlash=!0:(this.hasFlash=!1,this.show())},e.prototype.show=function(e){this.appendStyle(),this.showError(e)},e.prototype.appendStyle=function(){var e=this.stylePrefix+this.element;if($("#"+e).length>0)return;var t="#"+this.element,n='<style type="text/css" id="'+e+'">'+t+" { width: 100%; height: 100%; background-color: #000; overflow: hidden; }"+t+" .player-warn { width: 425px; height: 100px; background: url("+this.setting.staticHost+"nae/images/warn.png) no-repeat 188px 0; margin: 125px auto 0; padding-top: 75px; }"+t+' .player-warn p { height: 30px; font: 18px/30px "MicroSoft YaHei"; text-align: center; color: #B5B5B5; }'+t+" .player-warn p a { color: #EE750A; text-decoration: none; }"+"</style>";$("head").append(n)},e.prototype.showError=function(e){this.hasFlash||(e=e||this.setting.playerConfigs.i18n.noFlashPluginMessage,e='<div class="player-warn">'+e+"</div>",$("#"+this.element).html(e))},e}();e.FlashHelper=t})(n=t.Video||(t.Video={}))}),define("player.playerException",["require","exports"],function(e,t){"use strict";var n;(function(e){var t=function(){function e(e){this.player=e,this.stylePrefix="playerWarnStyle-",this._player=e}return e.prototype.detect=function(e){var t="";if(e.Code==0){if(e.Data==null)e.Data={},e.Data.VideoType=0,e.Data.ResourceStatus=n.Noting;else if(e.Data.Files.length>0&&(e.Data.ResourceStatus==n.Ready||e.Data.ResourceStatus==n.Release||typeof e.Data.ResourceStatus=="undefined"))return!0;t='<div class="player-warn"><p>'+this.getStatusDescription(e.Data)+"</p></div>"}else t='<div class="player-warn"><p>'+this._player.originalConfig.configs.i18n.resourceLoadFailMessage+e.Code+"</p></div>";return this.showError(t),!1},e.prototype.detectUrl=function(e){e=e.toLowerCase();if(e.indexOf(".mp3")>-1||e.indexOf(".f4v")>-1||e.indexOf(".mp4")>-1)return!0;var t='<div class="player-warn"><p>'+this._player.originalConfig.configs.i18n.resourceLoadFailMessage+"9</p></div>";return this.showError(t),!1},e.prototype.queryFail=function(){var e='<div class="player-warn"><p>'+this._player.originalConfig.configs.i18n.resourceLoadFailMessage+"404</p></div>";return this.showError(e),!1},e.prototype.appendStyle=function(){var e=this.stylePrefix+this.player.originalElement;if($("#"+e).length>0)return;var t=$("#"+this.player.originalElement).css("position");t=="static"||t==""?t="position:relative; ":t=" ";var n="";n=n+'<style type="text/css" id="'+e+'">',n=n+" #"+this.player.originalElement+" {"+t+" background-color: #000; overflow: hidden; }",n=n+" #"+this.player.originalElement+" .player-warn { width: 380px; height: 100px; background: url("+this.player.setting.staticHost+"nae/images/warn.png) no-repeat center top; margin:-80px 0 0 -190px; padding-top: 60px;position: absolute; top: 50%;left: 50%;}",n=n+" #"+this.player.originalElement+' .player-warn p { height: 30px; font: 18px/30px "MicroSoft YaHei"; text-align: center; color: #B5B5B5; }',n+="</style>",$("head").append(n)},e.prototype.showError=function(e){this.appendStyle(),$("#"+this.player.originalElement).html(e)},e.prototype.stringFormat=function(e,t,n){var r=new RegExp("({{"+t+"}})","g");return e.replace(r,n)},e.prototype.getStatusDescription=function(e){var t=e.VideoType==1?this._player.originalConfig.configs.i18n.audioText:this._player.originalConfig.configs.i18n.videoText;switch(e.ResourceStatus){case n.Encoding:case n.Sync:case n.Create:t=this.stringFormat(this._player.originalConfig.configs.i18n.resourceStatusEncodingMessage,"videoType",t);break;case n.Ready:t=this.stringFormat(this._player.originalConfig.configs.i18n.resourceStatusReadyMessage,"videoType",t);break;case n.Disabled:case n.Expired:t=this.stringFormat(this._player.originalConfig.configs.i18n.resourceStatusExpiredMessage,"videoType",t);break;case n.Delete:t=this.stringFormat(this._player.originalConfig.configs.i18n.resourceStatusDeleteMessage,"videoType",t);break;default:t=this.stringFormat(this._player.originalConfig.configs.i18n.resourceStatusDefaultMessage,"videoType",t)+e.ResourceStatus}return t},e}();e.PlayerException=t;var n;(function(e){e[e.Create=0]="Create",e[e.Ready=1]="Ready",e[e.Disabled=2]="Disabled",e[e.Expired=3]="Expired",e[e.Encoding=4]="Encoding",e[e.Sync=5]="Sync",e[e.Delete=7]="Delete",e[e.Release=8]="Release",e[e.Noting=9]="Noting"})(n||(n={}))})(n=t.Video||(t.Video={}))});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.pluginevent",["require","exports","eventdispatcher"],function(e,t,n){(function(e){var t=function(e){function t(t,n){e.call(this,t),this.type=t,this.player=n}return __extends(t,e),t}(n.Common.Event);e.PluginEvent=t})(t.Video||(t.Video={}));var r=t.Video}),define("player.questionplugin.judge",["require","exports"],function(e,t){var n='<div class="ln-judge" data-bind="css:{\'ln-judge-editable\':editable}" >    <ul data-bind="foreach:options">        <li  data-bind="css:{\'ln-judge-checked\':answered,\'ln-judge-hover\':hovered,\'ln-judget-standarded\':standarded}">            <i data-bind="css:{\'ln-judge-hover-i\':hovered}"></i><em></em>            <label data-bind="text: content"></label>        </li>    </ul></div>                ';(function(e){var t=function(){function e(){this.init()}return e.prototype.init=function(){$.widget("learning.judgeVideo",{options:{id:0,sub:0,options:["对","错"],answer:{Answer:"",Result:-1},standard:""},_init:function(){var e=this;this.element.html(n);var t=this.options,r=$.extend({},t,{options:Enumerable.from(t.options).select(function(e,n){var r=t.options[n];return{content:r,answered:t.answer.Answer.indexOf(r)>-1,standarded:t.standard.indexOf(r)>-1,hovered:!1}}).toArray()});e._vm=ko.mapping.fromJS(r),e._vm.pushAnswer=$.proxy(this._pushAnswer,this),this._inner=$(".ln-judge",this.element),this._trigger("inited",null,this._ui()),ko.applyBindings(this._vm,e._inner[0]),$("li",e._inner).hover($.proxy(this._onOptionHover,this)).click($.proxy(this._onOptionClick,this))},_pushAnswer:function(e){var t=Enumerable.from(this._vm.options()).firstOrDefault(null,"$.content()=='"+e+"'");t!=null&&(t.answered()||(Enumerable.from(this._vm.options()).forEach("$.answered(false)"),t.answered(!0),this._triggerChanged()))},_triggerChanged:function(){this._vm.answer.Answer(Enumerable.from(this._vm.options()).where("$.answered()").select("$.content()").toArray().join("")),this._trigger("changed",null,this._ui())},_onOptionHover:function(e){if(!this._vm.editable())return;ko.dataFor(e.currentTarget).hovered(e.type=="mouseenter")},_onOptionClick:function(e){if(!this._vm.editable())return;var t=ko.contextFor(e.currentTarget);t.$parent.pushAnswer(t.$data.content())},_ui:function(){return{viewModel:this._vm}},viewModel:function(){return this._vm}})},e}();e.judge=t})(t.Learning||(t.Learning={}));var r=t.Learning}),define("player.questionplugin.option",["require","exports"],function(e,t){var n="<div class=\"ln-options\" data-bind=\"foreach:options, css:{'ln-options-mutil':multiSelect(),'ln-options-single':!multiSelect(), 'ln-options-editable':editable}\">    <dl data-bind=\"attr:{'data-item':$data},css:{'ln-option-hover': hovered,'ln-option-answered':answered,'ln-option-standarded':standarded }\">        <dt data-bind=\"css:{'ln-option-hover-dt':hovered}\"><i></i><em data-bind=\"attr:{title:standarded?'此选项为参考答案':''}\"></em>            <label data-bind=\"text: label() + '.&nbsp;'\"></label>        </dt>        <dd data-bind=\"html:content\"></dd>    </dl></div>                ";(function(e){var t=function(){function e(){this.init()}return e.prototype.init=function(){$.widget("learning.questionOptionVideo",{options:{id:0,sub:0,options:[],multiSelect:!0,editable:!0,answer:{Answer:"",Result:-1},standard:"",shortcut:!0,ispapermode:!1},_init:function(){var e=this;this.element.html(n);var t=this.options,r=$.extend({},t,{options:Enumerable.from(t.options).select(function(e,n){var r=String.fromCharCode(n+65);return{label:r,content:e,answered:t.answer.Answer.indexOf(r)>-1,standarded:t.standard.indexOf(r)>-1,hovered:!1}}).toArray()});e._vm=ko.mapping.fromJS(r),e._vm.pushAnswer=$.proxy(this._pushAnswer,this),this._inner=$(".ln-options",this.element),this._trigger("inited",null,this._ui()),ko.applyBindings(e._vm,e._inner[0]),$("dl",e._inner).hover($.proxy(this._onOptionHover,this)).click($.proxy(this._onOptionClick,this)),this._keyUpHandler=$.proxy(this._onKeyUp,this),this._vm.ispapermode()||$(document).keyup(e._keyUpHandler),this.element.bind("remove."+e.widgetName,function(){$(document).unbind("keyup",e._keyUpHandler)})},layout:function(){var e=this;e._inner.removeClass("ln-span1 ln-span2 ln-span4");var t=this.element.closest(".ln-main-body:hidden");t.show();if(this.options.options.join("").indexOf("<img")<0){var n=e._inner.find("dd"),r=e._inner.width()-50,i=0;r=r<0?0:r;for(var s=0;s<n.length;s++){var o=$(n[s]),u=o.width()+65;if(u>r/2){i=r;break}i=Math.max(i,u)}i<r/4?e._inner.addClass("ln-span4"):i<r/2?e._inner.addClass("ln-span2"):e._inner.addClass("ln-span1")}else e._inner.addClass("ln-span1");t.hide()},_onKeyUp:function(e){if(!this._vm.editable()||!this._vm.shortcut())return;e.keyCode>=65&&e.keyCode<=65+this._vm.options().length&&$(".ln-feedback").css("display")=="none"&&this._pushAnswer(String.fromCharCode(e.keyCode))},_pushAnswer:function(e){var t=Enumerable.from(this._vm.options()).firstOrDefault(null,"$.label()=='"+e+"'");t!=null&&(this._vm.multiSelect()?(t.answered(!t.answered()),this._triggerChanged()):t.answered()||(Enumerable.from(this._vm.options()).forEach("$.answered(false)"),t.answered(!0),this._triggerChanged()))},_triggerChanged:function(){this._vm.answer.Answer(Enumerable.from(this._vm.options()).where("$.answered()").select("$.label()").toArray().join("")),this._trigger("changed",null,this._ui())},_onOptionHover:function(e){if(!this._vm.editable())return;ko.dataFor(e.currentTarget).hovered(e.type=="mouseenter")},_onOptionClick:function(e){if(!this._vm.editable())return;var t=ko.contextFor(e.currentTarget);t.$parent.pushAnswer(t.$data.label())},_ui:function(){return{viewModel:this._vm}},viewModel:function(){return this._vm}})},e}();e.Option=t})(t.Learning||(t.Learning={}));var r=t.Learning}),define("player.questionplugin.scroll",["require","exports"],function(e,t){(function(e){var t=function(){function e(){this.init()}return e.prototype.init=function(){$.widget("learning.scrollC",{options:{step:10},_hover:!1,_create:function(){var e=this;this.element.addClass("ln-scroll"),$('<div class="ln-scroll-bar"><div class="ln-scroll-handler" /></div>').prependTo(this.element),this._scroll=this.element.find(".ln-scroll-bar"),this._scrollHander=this.element.find(".ln-scroll-handler"),this._targetElement=$(this.options.targetElement),e._scroll.height(this.element.height()),e._targetElement.addClass("ln-scroll-content"),$("body").mousewheel($.proxy(this._onMousewheel,this)).resize($.proxy(this._onResize,this)),e._scrollHander.draggable({containment:"parent",drag:$.proxy(this._onDrag,this)}),this._targetHeight=e._targetElement.height(),window.setInterval($.proxy(this._onDetectSize,this),100),this.reset()},value:function(e){var t=this;if(typeof e=="undefined"||e==null)return t._scrollHander.position().top;e<0&&(e=0),e=Math.min(Math.max(0,e),t._scroll.height()-t._scrollHander.height());var n=-e*t._targetElement.height()/t._scroll.height();t._scrollHander.css("top",e),this._trigger("scrolling",null,{value:e}),t._targetElement.css("top",n)},normal:function(){var e=this,t=Math.min(Math.max(0,1),e._scroll.height()-e._scrollHander.height());return t*e._targetElement.height()/e._scroll.height()},reset:function(){var e=this;e._scroll.height(this.element.height()),e._targetElement.width(this.element.width());var t=e._targetElement.height(),n=e._scroll.height(),r=t>n,i=e._scroll.position().top+n-(e._targetElement.position().top+t);i>0&&e._targetElement.css("top",Math.min(0,e._targetElement.position().top+i)),e._scroll.toggle(r),e._scrollHander.height(n*n/t)},_onDetectSize:function(){var e=this,t=e._targetElement.height();t!=e._targetHeight&&this.reset(),e._scrollHander.css("left",0)},_showed:function(){var e=this;return e._targetElement.height()>e._scroll.height()},_onMousewheel:function(e,t,n,r){this._showed()&&this.value(this.value(null)-r*this.options.step)},_onDrag:function(e,t){this.value(t.position.top)},_onResize:function(e){var t=this;t._targetElement.height()},_onScrollHover:function(e){var t=this;this._hover=e.type=="mouseenter",this._showed()&&(this._hover?t._scroll.stop(!0,!0).fadeIn(500):t._scroll.stop(!0,!0).fadeOut(500))}})},e}();e.Scroll=t})(t.Learning||(t.Learning={}));var n=t.Learning}),define("player.questionplugin.question",["require","exports","player.questionplugin.judge","player.questionplugin.option","player.questionplugin.scroll"],function(e,t,n,r,i){var s='<div class="ln-work">    <div class="ln-question">        <div class="ln-body" data-bind="visible:question.QuestionType()==50">            <label data-bind="text: num() + \'.\'"></label>            <em data-bind="text:\'（\' + question.QuestionTypeName() + \'）\'"></em>            <div data-bind="html:question.ComplexBody" class="ln-body-content"></div>        </div>        <div data-bind="foreach:question.SubItems">            <div class="ln-body">                <label data-bind="text: $root.SubNum($index())"></label>                <em data-bind="text:\'（\' + QuestionTypeName() + \'）\'"></em>                <div data-bind="html:Body" class="ln-body-content"></div>            </div>            <div class="ln-input"></div>            <div class="ln-answer" data-bind="visible:$root.showAnswer,css:{\'ln-answercorrect\':$root.qResult(),\'ln-answererror\':!$root.qResult()}">                <dl><dt class="answer"></dt><dd class="answer" data-bind="html:$root.qResult()==true?\'恭喜你答对了！\':\'很遗憾你答错了，请继续作答\',css:{\'ln-xl\':$root.qResult()==true,\'ln-kl\':$root.qResult()==false}"></dd></dl>                <dl data-bind="visible:$root.ShowExplanation($index())"><dt>题目详解:</dt><dd data-bind="html:$root.StandardExplanation($index())"></dd></dl>            </div>        </div>        <div class="ln-answer" data-bind="visible:$root.showAnswer() && question.ComplexExplanation().length>0">            <dl>                <dt>套题详解:</dt><dd data-bind="html:question.ComplexExplanation"></dd>            </dl>        </div>    </div></div>',o='<div class="ln-status">    <span data-bind="text:$root.statusTitle">疑似错题</span>    <div class="ln-status-tip">        <i></i>        <div data-bind="text:$root.statusDesc" class="ln-status-title">本题为疑似错题，建议跳过作答：</div>        <div data-bind="text:$root.question.FeedbackRemark, visible: $root.showFeedbackRemark"></div>        <ul data-bind="foreach:$root.feedbacks,visible: $root.showFeedback">            <li><span class="ln-status-label" data-bind="text: Title"></span><span class="ln-status-count" data-bind="text: \'反馈: \' + Count()"><i class="ln-status-icon"></i></span></li>        </ul>    </div></div>';(function(e){var t=function(){function e(){new n.Learning.judge,new r.Learning.Option,new i.Learning.Scroll,this.init()}return e.prototype.init=function(){$.widget("learning.questionVideo",{options:{feedbacks:[],feedbackLoaded:!1,editable:!0,showAnswer:!0,ispapermode:!1},_init:function(){var e=this;this.element.html(s);var t=this.options,n=t.question,r=this,i=n.QuestionType==50?$(".ln-body:eq(0)",this.element):$(".ln-body:eq(1)",this.element);n.Status!=0&&n.Status!=4&&i.prepend(o);var r=this;r._inner=$(".ln-work",this.element);var u=ko.mapping.fromJS(t);u.statusTitle=ko.computed(function(){var e=this.question;return["","疑似错题","争议题","鉴定题","作废题"][e.Status()]},u),u.statusDesc=ko.computed(function(){var e=this.question;return["","本题为疑似错题，建议跳过作答","本题为争议题，建议跳过作答","","本题为作废题，建议跳过作答"][e.Status()]},u),u.showFeedback=ko.computed(function(){var e=this,t=this.question;return t.Status()==1&&e.feedbacks().length>0},u),u.showFeedbackRemark=ko.computed(function(){var e=this.question,t=e.Status();return(t==2||t==3)&&e.FeedbackRemark()!=null&&e.FeedbackRemark().length>0},u),u.StandardCostime=ko.computed(function(){return this.result.CostSeconds()!=0?this.result.CostSeconds()+"秒":""},u),u.catalogs=ko.computed(function(){var e=this.question;return typeof e.Catalogs=="undefined"?"<无>":Enumerable.from(e.Catalogs()).select("$.Title()").toJoinedString(" &gt; ")},u),u.qResult=ko.computed(function(){return Enumerable.from(this.result.Answers()).all("$.Result()==1")},u),this._vm=u,u.editable.subscribe(function(e){for(var t=0;t<n.SubItems.length;t++){var r=n.SubItems[t].viewModel;r&&r.shortcut&&r.shortcut(e&&n.QuestionType!=50)}},this),u.SubNum=function(e){var t=this.question,n=this;return t.QuestionType()!=50?n.num()+".":e+1+")."},u.MineAnswer=function(e){var t=this.result.Answers()[e].Answer();return t.length>0?t:"<未作答>"},u.StandardAnswer=function(e){var t=this.question;return t.SubItems()[e].Answer()},u.StandardScore=function(e){var t=this.question,n=typeof t.SubItems()[e].Score=="function"?t.SubItems()[e].Score():0;if(n==0)return"";var r=typeof this.result.Answers()[e].Score=="function"?this.result.Answers()[e].Score():0;return r+"(总分: "+n+")"},u.ShowExplanation=function(e){var n=this.question.SubItems()[e].Explanation();return n!=null&&n.length>0&&!t.editable},u.StandardExplanation=function(e){var t=this.question,n=t.SubItems()[e].Explanation();return n!=null&&n.length>0?n:"<暂无>"},u.MineAnswerResult=function(e){return this.result.Answers()[e].Result()==1},this._trigger("inited",null,this._ui()),ko.applyBindings(u,this._inner[0]);var a=n.QuestionType==50,f=$(".ln-input",this._inner);for(var l=0;l<n.SubItems.length;l++){var c=n.SubItems[l];switch(c.QuestionType){case 10:case 15:case 18:var h={Answer:"",Result:-1,Score:0};t.result!=null&&l<t.result.Answers.length&&(h=t.result.Answers[l]),$(f[l]).questionOptionVideo({id:n.Id,sub:l,options:c.Options,multiSelect:c.QuestionType!=10,answer:h,changed:$.proxy(this._onAnswerChanged,this),inited:function(e,t){c.viewModel=t.viewModel},shortcut:u.editable()&&!a,editable:u.editable(),standard:u.editable()?"":c.Answer,ispapermode:u.ispapermode()});break;case 20:case 25:var h={Answer:"",Result:1,Score:0};t.result!=null&&l<t.result.Answers.length&&(h=t.result.Answers[l]),$(f[l]).subjective({id:n.Id,sub:l,answer:h,showAnswer:t.showAnswer,scoreable:typeof t.isSetScoreView!="undefined"?!0:!1,ischapter:typeof t.ischapter!="undefined"&&t.ischapter==1?!0:!1,subQuestionscore:c.Score?c.Score:1,changed:$.proxy(this._onAnswerChanged,this),inited:function(e,t){c.viewModel=t.viewModel}});break;case 30:var h={Answer:"",Result:-1,Score:0};t.result!=null&&l<t.result.Answers.length&&(h=t.result.Answers[l]),$(f[l]).judgeVideo({id:n.Id,sub:l,answer:h,editable:u.editable(),standard:u.editable()?"":c.Answer,changed:$.proxy(this._onAnswerChanged,this),inited:function(e,t){c.viewModel=t.viewModel}})}}$(".ln-body-content",this._inner).each(function(e,t){var n=t.childNodes;(n.length==0||n[0].tagName!="P")&&$(t).prev().css("margin-right","0em")}),u.result=ko.computed(function(){return r.getResult()}),u.done=ko.computed(function(){return typeof t.isSetScoreView!="undefined"&&t.isSetScoreView==1?Enumerable.from(this.result().Answers).any("$.Score>0"):Enumerable.from(this.result().Answers).any("$.Answer.length>0")},u),$(".ln-question-wrapper",this._inner).scrollC({targetElement:$(".ln-question",this._inner)}),Enumerable.from(u.result().Answers).all("$.Result==1")?$(".ln-answer-only",this._inner).show():setTimeout(function(){$(".ln-answererror",e._inner).fadeOut(1e3)},1e3),$(".ln-question span",this._inner).each(function(e,t){var n=$(t),r=n.css("background-color");(r=="rgb(255, 255, 255)"||r=="#ffffff")&&n.css("background-color","")})},getResult:function(){var e={Answers:[],Result:-1},t=this.options.question,n=$(".ln-input",this._inner);for(var r=0;r<t.SubItems.length;r++){var i=t.SubItems[r],s=ko.mapping.toJS(i.viewModel.answer);e.Answers.push(s)}return e},layout:function(){var e=this,t=Enumerable.from(e.options.question.SubItems).any("$.QuestionType<=18");t&&$(".ln-input",this.element).questionOptionVideo("layout")},_onAnswerChanged:function(e,t){this._trigger("changed",null,this._ui())},_ui:function(){var e=this;return{viewModel:e._vm}}})},e}();e.Question=t})(t.Learning||(t.Learning={}));var u=t.Learning});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};define("player.questionplugin",["require","exports","player.plugin","player.questionplugin.question"],function(e,t,n,r){"use strict";var i;(function(e){var t=function(e){function t(t,n){e.call(this),this.dotTriggerInfo=[],this.currentSeekTime=0,this.currentIndexForDot=-1,this.currentkey="",this.timeoutId=0,this.pausetimeoutId=0,this.disable=!1,this.maxPlayPosition=0,this._config={element:"",sid:"",cellsUrl:"",submit:null,results:null,apiHost:"",accessToken:""},this._config.apiHost=n.setting.apiHost,this._config.accessToken=n.setting.accessToken,this._config.element=$("#"+n.element),this._config=$.extend(this._config,t),this.questionPlayer=new i(this),new r.Learning.Question,window.circle=$.proxy(this.show,this)}return __extends(t,e),t.prototype.config=function(){return this._config},t.prototype.getConfig=function(){return this._config},t.prototype.onLoad=function(t){e.prototype.onLoad.call(this,t),this.player.removeEventListener("onClipLoad.QuestionPlugin"),this.player.removeEventListener("onSeek.QuestionPlugin"),this.player.removeEventListener("onResume.QuestionPlugin"),this.player.addEventListener("onClipLoad.QuestionPlugin",$.proxy(this.clipLoad,this)),this.player.addEventListener("onSeek.QuestionPlugin",$.proxy(this.seek,this)),this.player.addEventListener("onResume.QuestionPlugin",$.proxy(this.seek,this))},t.prototype.getcells=function(){var e=this;if(this._config.cellsUrl=="")return;this._config.mooc?$.ajax({url:this._config.cellsUrl,dataType:"jsonp",type:"Get",jsonp:"jsoncallback",cache:!1,success:function(t){e._config.results=Enumerable.from(t.data).select(function(e){return{Id:e.questionId,Result:{CostSeconds:e.costSeconds,Answers:Enumerable.from(e.answers).select(function(e){return{Answer:e.answer,Result:e.answerResult}}).toArray(),Result:Enumerable.from(e.answers).all("$.answerResult==1")}}}).toArray()},error:function(){}}):$.ajax({url:this._config.cellsUrl,dataType:"jsonp",type:"Get",jsonp:"jsoncallback",data:{videoId:this.player.key},cache:!1,success:function(t){e._config.results=t.Cells,e._config.sid=t.Sid},error:function(){}})},t.prototype.checkIsActive=function(){return this.disable},t.prototype.clipLoad=function(e){if(this.currentkey==this.player.key||this.currentkey!=""){this.disable=!1;return}this.currentkey=this.player.key,this.disable=!0;if(this.player.timeQuestions&&this.player.timeQuestions.length>0){this.getcells(),e.clip.addEventListener("onCuepoint",$.proxy(this.cuepoint,this));var t=[];Enumerable.from(this.player.timeQuestions).select(function(e){for(var n=0;n<e.QuestionIds.length;n++)t.push(e.QuestionIds[n])}).toArray(),this.questionPlayer.setIds(t)}},t.prototype.seek=function(){var e=this;if(!this.checkIsActive())return;this.player.timeQuestions&&this.player.timeQuestions.length>0&&(this.player.isPaused()||window.setTimeout(function(){var t=e.player.getTime();e.checkunanswer(Math.round(t))},50))},t.prototype.checkunanswer=function(e){for(var t=0;t<this.player.timeQuestions.length;t++){var n=this.player.timeQuestions[t];if(this.currentSeekTime==e)return;if(e>=n.time&&n.time!=0&&!this.questionPlayer.getResults2(n.QuestionIds)){this.currentSeekTime=n.time,this.player.seek(Math.round(n.time)),this.jump(n.time,n.QuestionIds);break}}},t.prototype.cuepoint=function(e){if(!this.checkIsActive())return;if(e.obj.type=="question"||e.obj.type=="any"){var t=e.obj.time/1e3,n=e.obj.QuestionIds;if(this.dotTriggerInfo[t])return;this.jump(t,n)}},t.prototype.show=function(e){var t=this;if(!this.checkIsActive())return;Enumerable.from(this.player.timeQuestions).forEach(function(n,r){if(e==n.time&&t.questionPlayer.getResults(n.QuestionIds)){t.jump(n.time,n.QuestionIds);return}})},t.prototype.jump=function(e,t){var n=this;if(!this.checkIsActive())return;clearTimeout(this.timeoutId),clearTimeout(this.pausetimeoutId),this.timeoutId=setTimeout(function(){n.dotTriggerInfo[e]=n.player.getTime(),n.currentIndexForDot=n.getDotIndex(e),n.player.isFullscreen()&&n.player.toggleFullscreen();var r=n.questionPlayer.jump(t);if(!r)return;n.pausetimeoutId=setTimeout(function(){n.player.isPaused()||(typeof n.player.getPlugin("poster")!="undefined"&&n.player.getPlugin("poster").skipPoster(),n.player.pause())},50)},100)},t.prototype.getDotIndex=function(e){for(var t=0;t<this.player.timeQuestions.length;t++)if(this.player.timeQuestions[t].time==e)return t},t}(n.Video.PluginBase);e.QuestionPlugin=t;var i=function(){function e(e){this.plugin=e,this.element=null,this.isAnswering=!1,this.cells=null,this.viewModel={},this.numFromCurrentIds=1,this.tipTimeOut=0,this.questionStatus={},this.questionTypeName={10:"单选题",15:"多选题",18:"不定项选择题",20:"填空题",25:"主观题",30:"判断题",40:"连线题",50:"套题"};var t="chaptervideo_"+(new Date).getTime();e.getConfig().element.prev(".chaptervideo").remove(),e.getConfig().element.before('<div class="chaptervideo" id="'+t+'" style = "display: none;" >'+'<div class="ln-result-tip"><div style="display: none;"></div></div><div class="ln-close" style="display: none;"><a href="javascript:void(0);">×</a></div><div class="ln-container" style="display:none;">'+'<div class="ln-main">'+'<div class="ln-main-body"></div>'+"</div>"+'<div class="chapter-foot">'+'<a href="javascript:void(0);" class="chapter-btn-commit ln-submit" style = "display: none;"></a>'+'<a href="javascript:void(0);" class="chapter-btn-next ln-next" style = "display: none;"></a>'+'<a href="javascript:void(0);" class="chapter-btn-resume ln-resume" style = "display: none;"></a>'+"</div>"+"</div>"+'<div class="ln-confirm" style="display:none;">'+"<h3>检测题</h3>"+"<p>共 <em></em> 题，<span>已做答 </span></p>"+"<div>"+'<a href="javascript:void(0);" class="ln-confirm-btn j-reanswer"> 重新作答 </a>'+'<a href="javascript:void(0);" class="ln-confirm-btn j-resume1"> 继续播放 </a>'+"</div>"+"</div>"+"</div>"),this.element=$("#"+t),this.regiestEvents()}return e.prototype.regiestEvents=function(){var e=this;$(".j-resume1",e.element).on("click",function(){e.resume()}),$(".j-reanswer",e.element).on("click",function(){e.renswer(e.currentIds)}),$(".ln-resume",e.element).on("click",function(){$(this).hasClass("disable")||e.resume()}),$(".ln-next",e.element).on("click",function(){$(this).hasClass("disable")||e.next()}),$(".ln-submit",e.element).on("click",function(){$(this).hasClass("disable")||e._onSubmit()}),$(".ln-close",e.element).on("click",function(){e.getResults(e.currentIds)||(e.plugin.dotTriggerInfo[e.plugin.currentSeekTime]=0),e.element.hide()})},e.prototype.setIds=function(e){this.qids=e},e.prototype.jump=function(e){return this.currentIds=e,$(".j-resume1",this.element).focus().blur(),this.getResults2(this.currentIds)?!1:(this.element.show(),this.transfer(e[0],this.getNum(e[0],this.plugin.currentIndexForDot)),this.showAnswer(),!0)},e.prototype.getResults2=function(e){var t=this.plugin.player.timeQuestions;return Enumerable.from(t).any(function(t){if(t.QuestionIds.join()==e.join()&&t.QuestionAnswerStatus==1)return!0})},e.prototype.transfer=function(e,t,n){var r=this;this.cells==null?this.load({qids:this.qids,accessToken:this.plugin.getConfig().accessToken},function(i){var i=r.toquestionModel(i);r.cells=i,r.mergeCells(),n&&typeof n=="function"&&n(),r.render(e,t)}):(n&&typeof n=="function"&&n(),this.render(e,t))},e.prototype.toquestionModel=function(e){var t=this;return Enumerable.from(e).select(function(e){return{Id:e.QuestionId,Question:{Id:e.QuestionId,IsSubjective:e.IsSubjective,QuestionType:parseInt(e.QuestionType),ComplexBody:e.ComplexBody,CompletionSeconds:e.CompletionSeconds,Status:0,QuestionAnswerStatus:e.QuestionAnswerStatus,ComplexExplanation:e.ComplexExplanation,QuestionTypeName:t.questionTypeName[parseInt(e.QuestionType)],SubItems:Enumerable.from(e.QuestionSubItems).select(function(n){return{Body:n.Body,Options:n.Options,QuestionType:parseInt(n.QuestionType),Answer:n.Answer,Explanation:n.Explanation,QuestionTypeName:t.questionTypeName[parseInt(e.QuestionType)]}}).toArray()}}}).toArray()},e.prototype.render=function(e,t){var n=this,r=150,i=this.get(e),s=i.submit==1?1:0,o=s==1||s==2,u=this.getResult(e);$(".ln-main-body",n.element).questionVideo({num:t,question:i.Question,result:i.Result,changed:$.proxy(n._onAnswerChanged,n),inited:function(e,t){n.viewModel.question=t.viewModel},showAnswer:o,editable:!u,ischapter:!0}),this.initui(o,u,e),window.setTimeout(function(){n.isAnswering||($(".ln-main-body",n.element).show(),n.isAnswering=!0)},200),$(".ln-main-body",n.element).show(),$(".ln-close",n.element).show()},e.prototype.initui=function(e,t,n){var r=this.viewModel.question,i=this.numFromCurrentIds=this.getNumFromCurrentIds(n);t&&this.currentIds.length>1&&i!=this.currentIds.length&&$(".ln-next",this.element).removeClass("disable").show(),!t&&this.currentIds.length>1&&$(".ln-next",this.element).addClass("disable").show(),(this.currentIds.length<=1||i==this.currentIds.length||r.question.QuestionType()==15&&!t)&&$(".ln-next",this.element).hide(),i==this.currentIds.length&&t&&$(".ln-resume",this.element).removeClass("disable").show(),!t&&(r.question.QuestionType()==10||r.question.QuestionType()==30)&&i==this.currentIds.length&&$(".ln-resume",this.element).addClass("disable").show(),(!t&&r.question.QuestionType()!=10&&r.question.QuestionType()!=30||this.currentIds.length>1&&i!=this.currentIds.length)&&$(".ln-resume",this.element).hide(),r.question.QuestionType()==10||r.question.QuestionType()==30||t?$(".ln-submit",this.element).hide():$(".ln-submit",this.element).show().addClass("disable")},e.prototype.getNumFromCurrentIds=function(e){var t=0;for(var n=0;n<this.currentIds.length;n++){t++;if(this.currentIds[n]==e)return t}},e.prototype.getNum=function(e,t){var n=this.plugin.player.timeQuestions,r=0,i=0,s=typeof t=="number"&&t>=0?Math.min(n.length,t+1):n.length;for(var o=0;o<s;o++)for(var u=0;u<n[o].QuestionIds.length;u++)r++,n[o].QuestionIds[u]==e&&(i=r);return i},e.prototype.get=function(e){return Enumerable.from(this.cells).where(function(t){return t.Id==e}).firstOrDefault([])},e.prototype.mergeCells=function(){var e=this;this.cells=Enumerable.from(this.cells).select(function(t){var n=t.Question,r=n.SubItems.length,i=Enumerable.from(e.plugin.getConfig().results).where(function(e){if(e.Id==t.Id)return e.submit=!0,!0}).firstOrDefault(null);if(i==null){i={Result:{CostSeconds:0,Answers:[],Result:0}};for(var s=0;s<r;s++)i.Result.Answers.length<=s&&i.Result.Answers.push({Answer:"",Result:0})}return t=$.extend({},i,t),t}).toArray()},e.prototype.getResult=function(e){var t=this.get(e);if(typeof t.Result=="undefined"){var n=Enumerable.from(this.plugin.getConfig().results).where(function(t){return t.Id==e}).firstOrDefault(null);return n?n.Result.Result==1:!1}return t.Result.Result==1},e.prototype.setResult=function(e){var t=Enumerable.from(this.cells).where(function(t){return t.Id==e}).firstOrDefault(null);t&&(t.Result&&(t.Result.Result=0,t.Result.Answers=[]),t.submit=!1)},e.prototype.getResults=function(e){var t=this;return Enumerable.from(e).all(function(e){return t.getResult(e)==1})},e.prototype.setResults=function(e){for(var t=0,n=e.length;t<n;t++)this.setResult(e[t])},e.prototype._onAnswerChanged=function(){var e=this.viewModel.question;if(e.question.QuestionType()==10||e.question.QuestionType()==30){this._onSubmit();return}Enumerable.from(e.result().Answers).any("$.Answer.length>0")?$(".ln-submit").removeClass("disable"):$(".ln-submit").addClass("disable")},e.prototype._onSubmit=function(){this._updateAnswers(!0)},e.prototype._updateAnswers=function(e){var t=this.viewModel.question;if(typeof t=="undefined"||t==null)return;var n=this.get(t.question.Id()),r=n.Question,i=$.extend(!0,{CostSeconds:0},n.Result,t.result());i.CostSeconds+=1,n.Result=i,n.submit=e||n.submit;if(e){var s=!0;for(var o=0;o<r.SubItems.length;o++){var u=r.SubItems[o],a=n.Result.Answers[o],f=a.Result==1;if(u.QuestionType==10||u.QuestionType==15||u.QuestionType==18||u.QuestionType==30)f=n.Result.Answers[o].Answer==u.Answer,a.Result=f?1:2;s&=f}n.Result.Result=s?1:2}this.update(n),this.render(t.question.Id(),t.num()),$(".ln-result-tip div").stop(!1,!0).show(),s?$(".ln-result-tip div").html("恭喜你答对了！"):$(".ln-result-tip div").html("很遗憾你答错了，请继续作答"),$(".ln-result-tip").show(),clearTimeout(this.tipTimeOut),this.tipTimeOut=setTimeout(function(){$(".ln-result-tip div").fadeOut(1e3,function(){$(".ln-result-tip").hide()})},1e3)},e.prototype.update=function(e){var t=[];t.push({Id:e.Id,Result:{Answers:e.Result.Answers,CostSeconds:e.Result.CostSeconds}});var n=this.plugin.getConfig();if(n.submit)n.submit.call(this,{sid:n.sid,results:t,userUnitId:0,version:2});else{var r=Enumerable.from(t[0].Result.Answers).select(function(e){return{answer:e.Answer}}).toArray();this.updateQuestionIdsStatus(t),$.ajax({url:this.plugin.getConfig().apiHost+"/"+this.plugin.player.videoInfo.Id+"/words/"+this.plugin.player.videoInfo.LinkWordId+"/question_answers",type:"POST",data:JSON.stringify([{question_id:t[0].Id,cost_seconds:t[0].Result.CostSeconds,sub_answers:r}]),cache:!1})}},e.prototype.updateQuestionIdsStatus=function(e){var t=e[0].Id,n=this.plugin.player.timeQuestions;this.questionStatus[t]=1;for(var r=0;r<n.length;r++){var i=n[r].QuestionIds,s=!0;for(var o=0;o<i.length;o++)if(this.questionStatus[i[o]]!=1){s=!1;break}s&&(n[r].QuestionAnswerStatus=1)}},e.prototype.load=function(e,t){$.ajax({url:this.plugin.getConfig().apiHost+"/"+this.plugin.player.videoInfo.Id+"/words/"+this.plugin.player.videoInfo.LinkWordId+"/questions",dataType:"json",enableToggleCase:!0,responseCase:"pascal",cache:!1,success:t,error:function(){}})},e.prototype.resume=function(){var e=this;this.plugin.player.resume(),window.setTimeout(function(){e.element.hide(),e.isAnswering=!1,e.plugin.player.isPaused()&&e.plugin.player.resume()},150)},e.prototype.next=function(){var e=this.viewModel.question;this.render(this.currentIds[this.numFromCurrentIds],e.num()+1)},e.prototype.showConfirm=function(e){$(".ln-close",this.element).hide(),$(".ln-confirm p em",this.element).text(e),$(".ln-container",this.element).hide(),$(".ln-confirm",this.element).show()},e.prototype.showAnswer=function(){$(".ln-confirm",this.element).hide(),$(".ln-container",this.element).show()},e.prototype.renswer=function(e){var t=this;this.transfer(e[0],this.getNum(e[0],this.plugin.currentIndexForDot),function(){t.setResults(e)}),this.showAnswer()},e}()})(i=t.Video||(t.Video={}))});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.positionplugin",["require","exports","player.plugin","player"],function(e,t,n,r){(function(e){var t=function(e){function t(t){e.call(this),this._isfirstresume=!0,this._config={autoPosition:!0,intervalTime:2e4,beginTime:0,callback:null},this._config=$.extend(this._config,t)}return __extends(t,e),t.prototype.config=function(){return this._config},t.prototype.getConfig=function(){return this._config},t.prototype.onLoad=function(t){console&&console.log("position plugin is loaded"),e.prototype.onLoad.call(this,t),this.player.addEventListener("onResume",$.proxy(this.resume,this))},t.prototype.resume=function(){this._isfirstresume&&(this._isfirstresume=!1,console&&console.log("position plugin is started"),this.position(),this.interval())},t.prototype.position=function(){var e=0;this._config.autoPosition&&(e=parseInt($.cookie(""+this.player.key))),this._config.beginTime>0&&(e=this._config.beginTime),e>0&&this.player.seek(Math.round(e)),console&&console.log("position seek time:"+Math.round(e))},t.prototype.interval=function(){var e=this;window.setInterval(function(){var t=e.player.getState();if(t==r.Video.Player.STATE["playing"]){var n=Math.round(e.player.getTime());e._config.autoPosition&&$.cookie(""+e.player.key,n),e._config.callback&&e._config.callback.call&&e._config.callback.call(e,n)}},this._config.intervalTime)},t}(n.Video.PluginBase);e.PositionPlugin=t})(t.Video||(t.Video={}));var i=t.Video}),define("document.frame",["require","exports","module"],function(e,t){(function(e){e.widget("document.frame",{options:{documentType:0,main:null,element:""},_init:function(){var t;this.options.documentType==="threescreen"?t='<div class="document-frame doc-player">                                <div class="ths-main">                                </div>                                <div class="doc-bar"></div>                            </div>':t='<div class="document-frame doc-player">                            <div class="doc-main">                                <div class="document-thumal"></div>                                <div class="document-content" style="height: 100%"></div>                                <div class="document-message" style="height: 100%"></div>                            </div>                            <div class="doc-bar"></div>                        </div>';var n=this,r=this.element.css("position");(!r||r=="static")&&this.element.css("position","relative"),this.element.html(t);var i=this.options;this._vm=ko.mapping.fromJS(i),this._vm.height=e(this.options.element).height(),this._vm.width=e(this.options.element).width(),this._inner=e(".document-frame",this.element),this.$docmain=this.options.documentType==="threescreen"?e(".ths-main",this._inner):e(".doc-main",this._inner),ko.applyBindings(this._vm,this._inner[0]),e(window).resize(e.proxy(this.onresize,this)),this.onresize(),e(".document-thumal,.doc-bar,.doc-main,.document-frame",this.element).attr("unselectable","on").css({"-moz-user-select":"none","-ms-user-select":"none","-webkit-user-select":"none"}),e(window).resize(function(){n.element.data("isFullscreen")&&n._resetPlayer(!0)})},onresize:function(){this._resetPlayer()},resize:function(){this.onresize()},_resetPlayer:function(t){var n=this.element.width()-6,r=0,i=0;r=t?e(window).height():this.element.height(),i=parseInt(e(this.element).css("paddingTop"),10),i=isNaN(i)?0:i,i+=parseInt(e(this.element).css("paddingBottom"),10),i+=isNaN(i)?0:i,this.$docmain.height(r-40-i)},fullscreen:function(){this.element.data("isFullscreen",!0);var t=this,n=e(".document-frame",this.element);this.prevCssArray=[],t.prevCssArray.push(this.element.css("zIndex")),this.element.css("zIndex","99999"),t.prevCssArray.push(this.element[0].style.width),this.element.css("width","auto"),t.prevCssArray.push(this.element[0].style.height),this.element.css("height","auto"),t.prevCssArray.push(n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")),n.css("borderWidth","0"),n.parents().each(function(){t.prevCssArray.push(e(this).css("position")),e(this).css("position","static")});var r=e("body");t.prevCssArray.push(r.css("marginTop"),r.css("marginRight"),r.css("marginBottom"),r.css("marginLeft"),r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")),r.css({margin:0,padding:0}),this._resetPlayer(!0)},exitfullscreen:function(){this.element.data("isFullscreen",!1);var t=this,n=e(".document-frame",this.element);this.element.css("zIndex",t.prevCssArray.shift()),this.element.css("width",t.prevCssArray.shift()),this.element.css("height",t.prevCssArray.shift()),n.css({borderTopWidth:t.prevCssArray.shift(),borderRightWidth:t.prevCssArray.shift(),borderBottomWidth:t.prevCssArray.shift(),borderLeftWidth:t.prevCssArray.shift()}),n.parents().each(function(){e(this).css("position",t.prevCssArray.shift())});var r=e("body");e("body").css({marginTop:t.prevCssArray.shift(),marginRight:t.prevCssArray.shift(),marginBottom:t.prevCssArray.shift(),marginLeft:t.prevCssArray.shift(),paddingTop:t.prevCssArray.shift(),paddingRight:t.prevCssArray.shift(),paddingBottom:t.prevCssArray.shift(),paddingLeft:t.prevCssArray.shift()}),this.prevCssArray=[],this._resetPlayer(!1)}})})(jQuery)}),define("document.bar",["require","exports","module"],function(e,t){(function(e){e.widget("document.bar",{options:{documentType:0,showThumbnail:!1,thumbnailLength:[],selectMode:1,fileType:0,readTime:"",readTitle:"",showMode:1,currentPage:1,pageCount:0,pageSize:1,step:0,zoomTimes:0,zoom:1,scaling:1.2,isfullscreen:!1,isShowFullScreen:!0,isShowDocSide:!1,topElement:"",percents:[]},_init:function(){var t='            <div class="doc-toolbar">        <span class="left j-removeTextNodes" data-bind="visible: !isOnlyFullScreen()">            <a href="javascript:void(0)" class="i-doc-side" data-bind="attr: { title: i18n.bar.thumbanail },  visible: width()>=200 && isShowDocSide, css:{\'active\':showThumbnail()}"></a>            <i class="icon-split" data-bind="visible: width()>=200"></i>            <a href="javascript:void(0)"  style="display:none;" data-bind="css:{\'i-doc-drag\':selectMode()==1,\'i-doc-choice\':selectMode()==0}, attr:{ title:selectMode() == 1 ? i18n.bar.drag : i18n.bar.choiceWord }, text:selectMode() == 1? i18n.bar.dragMode : i18n.bar.zonedWrodMode ,visible:fileType()==1&&width()>=550, attr: { title: i18n.bar.drag }"></a>            <i class="icon-split" style="display:none;" data-bind="visible:fileType()==1&&width()>=550"></i>            <span class="doc-time" style="display:none;" data-bind="visible:readTime().length>0&&width()>=420">                <span data-bind="html:readTime()"></span>                <span class="doc-time-tip" data-bind="visible:readTitle().length>0">					<em data-bind="html:readTitle()"></em>					<i class="caret"></i>				</span>            </span>            <i class="icon-split" style="display:none;" data-bind="visible:readTime().length>0&&width()>=420"></i>        </span>    <span class="center" data-bind="visible: !isOnlyFullScreen()">         <span class="doc-bubble-tip" style="display: none">					<em data-bind="text: i18n.bar.returnTopPage"></em>					<i class="caret"></i>				</span>        <span style="display: none;" data-bind="visible:width()>250,css:{\'j-removeTextNodes-vertical\':showMode()==1,\'j-removeTextNodes-horizontal\':showMode()==0 }" class="j-removeTextNodes">             <i class="icon-split" data-bind="visible:width()>=450"></i>             <a href="javascript:void(0)" data-bind="visible:width()>=450, text:showMode()==1? i18n.bar.prevPage + \'↑\' : i18n.bar.prevPage + \'←\',attr:{title:showMode()==1? i18n.bar.prevScreen:i18n.bar.prevPage},css:{\'i-doc-up\':showMode()==1,\'i-doc-prve\':showMode()==0}"></a>             <i class="icon-split" data-bind="visible:width()>=450"></i>             <span data-bind="visible:width()>=450" class="pageindex">                 <input data-bind="css:{\'text-vertical\':showMode()==1,\'text-horizontal\':showMode()==0},value:currentPage" onkeyup="this.value=this.value.replace(/[^0-9]/g,\'\')"  type="text"><span>/</span><span data-bind="text:pageCount"></span>             </span>             <i class="icon-split" data-bind="visible:width()>=450"></i>             <a href="javascript:void(0)" data-bind="visible:width()>=450, text:showMode()==1? i18n.bar.nextPage + \'↓\': i18n.bar.nextPage + \'→\',attr:{title:showMode()==1? i18n.bar.nextScreen: i18n.bar.nextPage},css:{\'i-doc-down\':showMode()==1,\'i-doc-next\':showMode()==0}"></a>             <i class="icon-split" data-bind="visible:width()>=450"></i>        </span>    </span>    <span class="right j-removeTextNodes">            <i class="icon-split" data-bind="visible:width()>=845 && !isOnlyFullScreen()"></i>            <a href="javascript:void(0)" class="i-doc-zoomin" data-bind="visible:width()>=845 && !isOnlyFullScreen(), attr:{title: i18n.bar.narrow}, text:i18n.bar.narrow"></a>            <i class="icon-split" data-bind="visible:width()>=845 && !isOnlyFullScreen()"></i>            <div style="display: inline;">            <input class="editable-input" data-bind="visible:width()>=845 && !isOnlyFullScreen()">            <select class="editable-select" data-bind="visible:width()>=845 && !isOnlyFullScreen()">                <option class="editable-option" value="33">33%</option>                <option class="editable-option" value="50">50%</option>                <option class="editable-option" value="67">67%</option>                <option class="editable-option" value="75">75%</option>                <option class="editable-option" value="90">90%</option>                <option class="editable-option" value="100">100%</option>                <option class="editable-option" value="110">110%</option>                <option class="editable-option" value="125">125%</option>                <option class="editable-option" value="150">150%</option>                <option class="editable-option" value="175">175%</option>                <option class="editable-option" value="200">200%</option>            </select>            </div>            <i class="icon-split" data-bind="visible:width()>=845 && !isOnlyFullScreen()"></i>            <a href="javascript:void(0)" class="i-doc-zoomout" data-bind="visible:width()>=845 && !isOnlyFullScreen(), attr: { title:i18n.bar.enlarge }, text: i18n.bar.enlarge"></a>            <i class="icon-split" data-bind="visible:width()>=200"></i>            <a href="javascript:void(0)"  class="j-togglefullscreen"  data-bind="visible:width()>=200 && isShowFullScreen,css:{\'i-doc-fullscreen\':isfullscreen()==false,\'i-doc-exitfullscreen\':isfullscreen()==true},text:isfullscreen()==false? i18n.bar.fullscreen:i18n.bar.exitfullscreen,attr:{title:isfullscreen()==false? i18n.bar.fullscreen:i18n.bar.exitfullscreen}"></a>    </span></div>                     ';this.element.html(t);var n=this.options;n.width=e(n.topElement).width()-6,this._vm=ko.mapping.fromJS(n),this._vm.isOnlyFullScreen=ko.observable(this._vm.documentType()==="threescreen"),this._inner=e(".doc-toolbar",this.element),ko.applyBindings(this._vm,this._inner[0]),this._vm.currentPage()>=2&&(e(".doc-bubble-tip",this._inner).show(),setTimeout(function(){e(".doc-bubble-tip",this._inner).hide()},2e3)),this._vm.percents(this._vm.percents().sort(function(e,t){return e>t?1:-1})),e(".doc-bubble-tip",this._inner).click(e.proxy(this._jumpToFirstPage,this)),e(".i-doc-"+(this._vm.selectMode()==0?"choice":"drag"),this._inner).click(e.proxy(this._changeMode,this)),e(".i-doc-side",this._inner).click(e.proxy(this._toggleThumbnail,this)),e(".i-doc-up",this._inner).click(e.proxy(this._prev,this)),e(".i-doc-down",this._inner).click(e.proxy(this._next,this)),e(".i-doc-prve",this._inner).click(e.proxy(this._prev,this)),e(".i-doc-next",this._inner).click(e.proxy(this._next,this)),e(".i-doc-zoomin",this._inner).click(e.proxy(this._zoomOut,this)),e(".i-doc-zoomout",this._inner).click(e.proxy(this._zoomIn,this)),e(".j-togglefullscreen",this._inner).off("click",e.proxy(this._toggleFullscreen,this)).on("click",e.proxy(this._toggleFullscreen,this)),e(".text-"+(this._vm.showMode()==0?"horizontal":"vertical"),this._inner).keydown(e.proxy(this._keydown,this)),e(".text-"+(this._vm.showMode()==0?"horizontal":"vertical"),this._inner).keypress(e.proxy(this._keypress,this)),e(window).resize(e.proxy(this.onresize,this)),e(".j-removeTextNodes",this._inner).contents().each(function(){this.nodeType===3&&e(this).remove()}),e(".pageindex input").on("input",e.proxy(this._oninput,this)).on("propertychange",e.proxy(this._oninput,this)),e(".editable-select",this.element).on("change",e.proxy(this._onselectchange,this)).keydown(e.proxy(this._onselectkeydown,this)),e(".editable-input",this.element).keydown(e.proxy(this._onPercentChange,this)).keypress(e.proxy(this._onPercentPress,this)).on("input",e.proxy(this._onpercentinput,this)).on("propertychange",e.proxy(this._onpercentinput,this))},_onselectkeydown:function(e){e.stopPropagation()},_onpercentinput:function(t){var n=this._vm.percents()[0];e(t.target).off("propertychange").off("input"),t.type=="propertychange"?t.target.value=t.target.value.replace(/[^0-9]/g,"")+"%":t.target.value=t.target.value.replace(/[^0-9]/g,""),e(t.target).on("input",e.proxy(this._onpercentinput,this)).on("propertychange",e.proxy(this._onpercentinput,this))},_oninput:function(t){e(t.target).off("propertychange").off("input"),t.target.value=t.target.value.replace(/[^0-9]/g,""),parseInt(t.target.value)>this._vm.pageCount()&&(t.target.value=this._vm.pageCount()),e(t.target).on("input",e.proxy(this._oninput,this)).on("propertychange",e.proxy(this._oninput,this))},_keypress:function(e){var t="",n=e.target.value,r=null;if(window.getSelection)if(document.activeElement&&document.activeElement.tagName.toLowerCase()=="input")t=n.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd);else{var i=window.getSelection();t=i.toString()}else if(document.selection.createRange){var s=document.selection.createRange();t=s.text}var o=e.which;if(o>=48&&o<=57||o==8||o==0){if(t!=""&&parseInt(t)>=this._vm.pageCount()){e.target.value="";return}var u=String.fromCharCode(o);if(t==""){var a=parseInt(n+u);e.target.selectionStart==0&&(a=parseInt(u+n)),e.target.selectionStart<=e.target.value.length&&(a=parseInt(n.substring(0,e.target.selectionStart)+u+n.substring(e.target.selectionStart,n.length))),(a<1||a>this._vm.pageCount())&&e.preventDefault()}else if(e.target.selectionStart!==undefined){var f=n.substring(0,e.target.selectionStart)+u+n.substring(e.target.selectionEnd,n.length);(parseInt(f)<1||parseInt(f)>this._vm.pageCount())&&e.preventDefault()}}else e.preventDefault()},_keydown:function(e){if(e.keyCode==13){var t=parseInt(e.target.value);if(isNaN(t))return;if(this._vm.config&&this._vm.config.skippablePos&&t>this._vm.config.skippablePos()+1)return;this._vm.currentPage(t),this._trigger("numchange",null,{currentPage:t})}},onresize:function(){this._vm.width(e(this.element).width())},resize:function(){this.onresize()},changeStep:function(e){this._vm.step(e)},showTime:function(t){this._vm.readTime(t.readTime),this._vm.readTitle(t.readTitle),typeof t.timeOut!="undefined"&&(t.timeOut=3e3),t.readTitle!=""&&(e(".doc-time-tip",this.element).fadeIn(),setTimeout(function(){e(".doc-time-tip",this.element).fadeOut()},t.timeOut))},_changeMode:function(){this._changeSelectMode(this._vm.selectMode()==1?0:1)},_changeSelectMode:function(e){var t=this._vm.selectMode;if(e==t)return;this._vm.selectMode(e),this._trigger("changeSelectMode",null,{mode:e})},_jumpToFirstPage:function(){e(".doc-bubble-tip",this._inner).hide(),this._vm.currentPage(1),this._trigger("numchange",null,{currentPage:1})},toggleSelectMode:function(){this._changeMode()},changeCurrentPage:function(e){this._vm.currentPage(e)},_prev:function(){this._trigger("prev")},_next:function(){this._trigger("next")},_toggleThumbnail:function(){if(this._vm.step()!=2)return;this._vm.showThumbnail(!this._vm.showThumbnail()),this._trigger("thumbnailclick")},toggleThumbnail:function(){if(this._vm.step()!=2)return;this._vm.showThumbnail()&&this._vm.showThumbnail(!this._vm.showThumbnail())},_onselectchange:function(){var t=e(".editable-select",this.element).val();e(".editable-input",this.element).val(t+"%"),this._vm.zoom(parseInt(t)/100),this._trigger("changeZoom",null,this._vm.zoom()),e(".editable-select",this.element).blur()},_zoomOut:function(e){if(this._vm.step()!=2)return;var t=this._getAppropriatePercent(!1);this._vm.zoom(t),this._trigger("zoomOut",null,this._vm.zoom())},_zoomIn:function(e){if(this._vm.step()!=2)return;var t=this._getAppropriatePercent(!0);this._vm.zoom(t),this._trigger("zoomIn",null,this._vm.zoom())},_onPercentPress:function(e){var t="",n=e.target.value,r=null;if(window.getSelection)if(document.activeElement&&document.activeElement.tagName.toLowerCase()=="input")t=n.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd);else{var i=window.getSelection();t=i.toString()}else if(document.selection.createRange){var s=document.selection.createRange();t=s.text}var o=e.which;if(o>=48&&o<=57||o==37||o==8||o==0){var u=String.fromCharCode(o);if(t==""){var a=parseInt(n+u);e.target.selectionStart==0&&(a=parseInt(u+n)),e.target.selectionStart<=e.target.value.length&&(a=parseInt(n.substring(0,e.target.selectionStart)+u+n.substring(e.target.selectionStart,n.length))),a<1&&e.preventDefault()}else if(e.target.selectionStart!==undefined){var f=n.substring(0,e.target.selectionStart)+u+n.substring(e.target.selectionEnd,n.length);parseInt(f)<1&&e.preventDefault()}}else e.preventDefault()},_onPercentChange:function(e){if(e.keyCode==13){var t=parseInt(e.target.value);this._canZoom(t/100)?(this._vm.zoom(parseInt(e.target.value)/100),this._trigger("changeZoom",null,this._vm.zoom()),e.target.value=e.target.value.replace(/%/g,"")+"%"):(t=this._vm.zoom(),e.target.value=parseInt(t*100)+"%"),this._setselectval(t)}},_setselectval:function(t){e(".editable-select")[0].selectedIndex=-1;for(var n=0;n<this._vm.percents().length;n++){var r=this._vm.percents()[n];r==t&&e(".editable-select").val(r)}},initZoom:function(t){var n=parseInt(t*100);this._vm.zoom(n/100),e(".editable-input",this.element).val(n+"%"),this._setselectval(n)},_canZoom:function(e){var t=.01;return e>=t?!0:!1},_getAppropriatePercent:function(e){var t=this._vm.zoom();for(var n=0;n<this._vm.percents().length;n++){var r=this._vm.percents()[n]/100;if(e&&r>this._vm.zoom()){t=r;break}!e&&r<this._vm.zoom()&&(t=r)}return t},_toggleFullscreen:function(){if(this._vm.step()!=2)return;this._vm.isfullscreen()?this.exitfullscreen():this.fullscreen()},fullscreen:function(){if(this._vm.step()!=2)return;this._vm.isfullscreen(!0),this._trigger("fullscreen",null,this._ui())},exitfullscreen:function(){if(this._vm.step()!=2)return;this._vm.isfullscreen(!1),this._trigger("exitfullscreen",null,this._ui())},_ui:function(){return{viewModel:this._vm}},viewModel:function(){return this._vm}})})(jQuery)}),define("document.message",["require","exports","module"],function(e,t){(function(e){e.widget("document.message",{options:{step:0,message:"抱歉，出了点小问题！"},_init:function(){var t='<div class="doc-msg-bg" style="display: block;" data-bind="visible:step()!=2">   <div class="doc-msg-box">      <div class="doc-msg" data-bind="visible:step()==1" style="display: none">          <i class="i-doc-warning"></i>           <p>'+this.option().i18n.message.failTitle1+'<a href="javascript:location.reload();">'+this.option().i18n.message.failTitle2+"</a>"+this.option().i18n.message.failTitle3+'<br/><span data-bind="html:i18n.message.message()"></span><br/></p>'+"          </div>"+'          <div class="doc-msg" data-bind="visible:step()==0">'+'               <i class="i-doc-loading"></i>'+"              <p>    "+this.option().i18n.message.loadingTitle+"    </p>"+"           </div>"+"       </div>"+"   </div>"+"</div>";this.element.html(t);var n=this.options;this._vm=ko.mapping.fromJS(n),this._inner=e(".doc-msg-bg",this.element),ko.applyBindings(this._vm,this._inner[0])},show:function(e){typeof e.step!="undefined"&&this._vm.step(e.step),typeof e.message!="undefined"&&this._vm.message(e.message)}})})(jQuery)}),define("document.content",["require","exports","module"],function(e,t){(function(e){e.widget("document.content",{options:{showMode:0,selectMode:1,showprev:!1,shownext:!1,prevValid:!1,nextValid:!0,step:0,zoomTimes:5,currentPage:1,zoom:1,scaling:1.2,lazyload:400,spacing:20,screenChangeOffsetHeight:50,fileType:1,pageCount:0,pageWidth:0,pageHeight:0,topElement:"",percents:[],existingPageCount:0},_init:function(){var t='<div class="doc-right"  data-bind="visible:step()==2"><span class="button-unselectable page-top" data-bind="visible:showMode()==1&&showprev()&&prevValid()" style="display: none"><a href="javascript:void(0)">'+this.options.i18n.content.top+"</a></span>"+'<span class="button-unselectable page-bottom" data-bind="visible:showMode()==1&&shownext()&&nextValid()" style="display: none"><a href="javascript:void(0)">'+this.options.i18n.content.bottom+"</a></span>"+'<span class="button-unselectable page-left" data-bind="visible:showMode()==0&&showprev()&&prevValid()" style="display: none"><a href="javascript:void(0)">'+this.options.i18n.content.left+"</a></span>"+'<span class="button-unselectable page-right" data-bind="visible:showMode()==0&&shownext()&&nextValid()" style="display: none"><a href="javascript:void(0)">'+this.options.i18n.content.right+"</a></span>"+'<div class="doc-content" style="background-color: #eee;">'+'<div id="html-content-wrap">'+'<div id="html-content" class="control-content" style="position:relative;-o-transform:left top;-ms-transform-origin:left top;-webkit-transform-origin:left top;-moz-transform-origin:left top;">'+"</div>"+"</div>"+"</div>"+"</div>";this.cacheArray=[],this.isMouseDown=!1,this.isLeftIn=!1,this.mouseX=0,this.mouseY=0,this.timeoutId=-1,this.ltIE9=!1,this.element.html(t),this.isInner=!0;var n=this.options;this._vm=ko.mapping.fromJS(n),this._inner=e(".doc-right",this.element),ko.applyBindings(this._vm,this._inner[0]),this._vm.selectMode.subscribe(function(e){e==0?this.element.find("#html-content-wrap").removeAttr("unselectable").css({"-moz-user-select":"text","-ms-user-select":"text","-webkit-user-select":"text"}):this.element.find("#html-content-wrap").attr("unselectable","on").css({"-moz-user-select":"none","-ms-user-select":"none","-webkit-user-select":"none"})},this),this._vm.selectMode.valueHasMutated(),this.$wrap=e("#html-content-wrap"),this.$docmain=e(this.element).closest(".doc-main"),this.$controlcontent=e(".control-content",this._inner),this.$doccontent=e(".doc-content",this._inner),this.$docleft=e(".doc-left",this._inner),this.$docplayer=e(this.element).closest(".doc-player"),this.currentZoom=0,this.width=this._vm.pageWidth(),this.height=this._vm.pageHeight(),this.count=this._vm.pageCount(),this.lastPagePadding=100,e.browser.msie&&parseInt(e.browser.version)<9&&(this.ltIE9=!0);if(this._vm.showMode()==0)this.$doccontent.append('<div class="doc-msg-box"><div class="doc-msg"><i class="i-doc-loading"></i><p>    '+this.options.i18n.content.loading+"    </p></div></div>"),this.$controlcontent.append('<div class="main-content" style="position: relative; overflow:hidden; background-color: white; height:'+this._vm.pageHeight()+"px; width:"+this._vm.pageWidth()+'px;"><div class="doc-msg-bg" style="display: block;" ></div></div>');else{var r="",i=0;for(var s=0;s<this._vm.pageCount();s++){var o=s>this._vm.existingPageCount()-1?"":'<div class="doc-msg-bg" style="display: block;" ><div class="doc-msg-box"><div class="doc-msg"><i class="i-doc-loading"></i><p>    '+this.options.i18n.content.loading+"    </p></div></div></div>";s==0?r+='<div id="main-content-'+(s+1)+'" class="main-content" style="position:relative;overflow:hidden; background-color: white; margin-bottom: '+this._vm.spacing()+("px; margin-top:"+this._vm.spacing())+"px; height:"+this._vm.pageHeight()+"px; width:"+this._vm.pageWidth()+'px;">'+o+"</div>":(i=s==this._vm.pageCount()-1?this._vm.pageHeight()+this.lastPagePadding:this._vm.pageHeight(),r+='<div id="main-content-'+(s+1)+'" class="main-content" style="position:relative;overflow:hidden; background-color: white; margin-bottom: '+this._vm.spacing()+"px; height:"+i+"px; width:"+this._vm.pageWidth()+'px;">'+o+"</div>")}this.$controlcontent.append(r)}this._mouseEventReg(),this._calculateInitZoom(),this.$docmain.mousemove(e.proxy(this._docmousemove,this)).mouseleave(e.proxy(this._docmouseout,this)),this.$docleft.mouseenter(e.proxy(this._leftmouseenter,this)).mouseleave(e.proxy(this._leftmouseleave,this)),this.$doccontent.scroll(e.proxy(this._onscroll,this)).click(e.proxy(this._onclick,this)),this.$doccontent.mousewheel(e.proxy(this._mouseWheel,this)),this._updateZoom(!1),this.go(this._vm.currentPage(),!1),this._vm.currentPage()<2&&this._onscroll(null),e(window).resize(e.proxy(this.onresize,this)),e(".page-top > a",this._inner).click(e.proxy(this._prevClick,this)),e(".page-bottom > a",this._inner).click(e.proxy(this._nextClick,this)),e(".page-left > a",this._inner).click(e.proxy(this._prevClick,this)),e(".page-right > a",this._inner).click(e.proxy(this._nextClick,this))},_mouseWheel:function(e){this.isInner=!0},_onscrollEvent:function(e){this._onscroll(e)},toggleSelectMode:function(){this._vm.selectMode(this._vm.selectMode()==1?0:1)},changeSelectMode:function(e){var t=this._vm.selectMode();if(e==t)return;this._vm.selectMode(e),this._mouseEventReg()},_prevClick:function(){if(this._vm.step()!=2)return;var e=this._vm.currentPage(),t=this._vm.showMode();if(e<=1&&t==0)return;e>1&&this._vm.currentPage(--e),t==0?this._switchHorizontal():this._prev()},prev:function(){this._prevClick()},_nextClick:function(){if(this._vm.step()!=2)return;var e=this._vm.currentPage(),t=this._vm.pageCount(),n=this._vm.showMode(),r=this._vm.pageWidth();if(e>=t&&n==0)return;e<t&&this._vm.currentPage(++e),n==0?this._switchHorizontal():this._next()},next:function(){this._nextClick()},_switchHorizontal:function(){var t=this,n=e(".main-content",this._inner),r=this._vm.fileType();n.empty().css("background","transparent"),t.$doccontent.find(".doc-msg-box").hide();if(r!=2)var i='<div class="doc-msg-bg" style="display: block;" >   <div class="doc-msg-box">          <div class="doc-msg">               <i class="i-doc-loading"></i>              <p>    加载中...    </p>           </div>       </div></div>';if(this.ltIE9){var s=t.cacheArray[t._vm.currentPage()];typeof s=="undefined"&&(r!=2?n.html(i):t.$doccontent.find(".doc-msg-box").show()),s&&n.html(s.dom).css("background","#EFEFEF"),typeof s!="undefined"&&(r==2||!t._vm.pageWidth())&&t.resetZoomForImageGroup(s.imgInfo),this._fixIe(this._vm.currentPage()),this._setIndex()}else e.when(this._effectOut(null)).done(function(){var s=t.cacheArray[t._vm.currentPage()];typeof s=="undefined"&&(r!=2?n.html(i):t.$doccontent.find(".doc-msg-box").show()),s&&n.html(s.dom).css("background","#EFEFEF"),typeof s!="undefined"&&(r==2||!t._vm.pageWidth())&&t.resetZoomForImageGroup(s.imgInfo),t._fixIe(t._vm.currentPage()),t._effectIn(e.proxy(t._setIndex,t))});t._trigger("numchange",null,{currentPage:this._vm.currentPage()}),t.timeoutId!=-1&&window.clearTimeout(t.timeoutId),t.timeoutId=window.setTimeout(function(){t._trigger("detect",null,{currentPage:t._vm.currentPage()})},t._vm.lazyload());var o=this._vm.currentPage(),u=this._vm.pageCount();o>1?this._vm.prevValid(!0):this._vm.prevValid(!1),o>=u?this._vm.nextValid(!1):this._vm.nextValid(!0)},getCurrentPage:function(){return this._vm.step()!=2?1:this._vm.currentPage()},_getAppropriatePercent:function(e){var t=this._vm.zoom();for(var n=0;n<this._vm.percents().length;n++){var r=this._vm.percents()[n]/100;if(e&&r>this._vm.zoom()){t=r;break}!e&&r<this._vm.zoom()&&(t=r)}return t},changeZoom:function(e){this._canZoom(e)&&(this._vm.zoom(e),this._updateZoom(!1),this.go(this._vm.currentPage()))},_canZoom:function(e){var t=.01;return e>=t?!0:!1},zoomIn:function(){if(this._vm.step()!=2)return;var e=this._getAppropriatePercent(!0);e>this._vm.zoom()&&(this._vm.zoom(e),this._updateZoom(!1),this.go(this._vm.currentPage()),this._trigger("initZoom",null,this._vm.zoom()))},zoomOut:function(){if(this._vm.step()!=2)return;var e=this._getAppropriatePercent(!1);e<this._vm.zoom()&&(this._vm.zoom(e),this._updateZoom(!1),this.go(this._vm.currentPage()),this._trigger("initZoom",null,this._vm.zoom()))},_updateZoom:function(t){typeof t=="undefined"&&(t=!0);var n=this._vm.zoom(),r=this.$controlcontent,i=this.$docmain.width(),s=this.$doccontent.height(),o=this._vm.spacing(),u=this.$controlcontent.parent();this.ltIE9?r.css("zoom",n):r.css({"-webkit-transform":"scale("+n+")","-moz-transform":"scale("+n+")","-ms-transform":"scale("+n+")","-o-transform":"scale("+n+")"}),n<=1&&r.css({width:this.width*n,height:this.height*n}),this.width*n<i?(this.width?parseInt(e.browser.version)==8?r.css("margin-left",(i-this.width*n)/2/n+"px"):r.css("margin-left",(i-this.width*n)/2+"px"):r.css("marginLeft",20),u.width("auto")):(r.css("margin-left",0),u.width(this.width*n));if(this._vm.showMode()==0){this.height*n<s?r.css("margin-top",(s-this.height*n)/2+"px"):r.css("margin-top","0px");var a=Math.max(this.height*n,s);u.height(a)}else{var a=Math.max((this.height+o)*(this.count-1)*n+(this.height+o+this.lastPagePadding)*n,s);u.height(a)}(this._vm.fileType()!==1&&!this._vm.pageWidth()||!this.textShow())&&u.css("overflow","hidden"),t&&this._onscroll(null)},onresize:function(){this.resetZoom()},resize:function(){this.onresize()},resetZoom:function(){this._calculateInitZoom(),this._vm.zoom(this._vm.zoom()*Math.pow(this._vm.scaling(),this.currentZoom)),this._updateZoom(!1),this.go(this._vm.currentPage())},resetZoomForImageGroup:function(t){e(".main-content",this._inner).css({width:t.width,height:t.height}),this.width=t.width,this.height=t.height,this.resetZoom()},_onscroll:function(t){var n=this;if(this._vm.showMode()==0)return;var r=0,i=this.$doccontent.height();t?r=t.target.scrollTop:r=this.$doccontent.scrollTop();var s=this.height,o=this._vm.zoom(),u=this._vm.spacing(),a=r?Math.round((r+i)/((s+u)*o))||1:1;a<=this._vm.pageCount()&&this._vm.currentPage(a),r>0?this._vm.prevValid(!0):this._vm.prevValid(!1),t&&(r+i>=e(t.target)[0].scrollHeight?this._vm.nextValid(!1):this._vm.nextValid(!0)),this.isInner&&n._trigger("numchange",null,{currentPage:this._vm.currentPage()}),this.isInner=!0,this.timeoutId!=-1&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(function(){n._trigger("detect",null,{currentPage:a})},this._vm.lazyload())},go:function(e,t,n){if(typeof t=="undefined"||t==null)t=!0;typeof n=="undefined"||n==null?this.isInner=!0:this.isInner=n;var r=this._vm.pageCount(),i=this._vm.currentPage(),s=this._vm.showMode();if(i==e&&s==0&&t)return;e<1&&(e=1),e>r&&(e=r),this._vm.currentPage(e),s==0?this._switchHorizontal():this._goToPage()},textShow:function(e){if(!this._vm.pageWidth()){var t="auto";return this.$wrap.width(t).height(t),this.$controlcontent.height(t).width(t).find(".main-content").height(t).width(t),!0}return!1},show:function(t,n,r){var i=this._vm.pageCount();if(t<1||t>i)return;this._vm.showMode()==0||!this._vm.pageWidth()?t==this._vm.currentPage()&&(e(".main-content",this._inner).html(n),this.$doccontent.find(".doc-msg-box").hide(),typeof r!="undefined"&&this.resetZoomForImageGroup(r)):(e("#main-content-"+t,this._inner).html(n),(this._vm.fileType()==2||this._vm.fileType()==0)&&t==i&&e("#main-content-"+t,this._inner).find("img").css("height",this._vm.pageHeight()+"px")),this.cacheArray[t]={dom:n,imgInfo:r},this._fixIe(t),this._setIndex()},_mouseEventReg:function(){var t=this.$controlcontent;t.mousedown(e.proxy(this._onmousedown,this)),t.mouseup(e.proxy(this._onmouseup,this)),t.mousemove(e.proxy(this._onmousemove,this)),this._vm.fileType()==0?t.css("cursor",this._getCursor(1)):this._vm.selectMode()==1?(e(".overlay").css("z-index","1"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),t.css("cursor",this._getCursor(1))):(e(".overlay").css("z-index","0"),t.off("mousedown mouseup mousemove"),t.css("cursor",this._getCursor(0)))},_getVisible:function(e,t,n,r,i,s){return i>=e&&i<=e+n&&s>=t&&s<=t+r},_getCursor:function(t){var n=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,r=typeof window.InstallTrigger!="undefined",i=!!window.chrome&&!n;return r?t==0?"":t==1?"-moz-grab":"-moz-grabbing":i&&e.browser.version>537.1?t==0?"":t==1?"-webkit-grab":"-webkit-grabbing":t==0?"":t==1?"pointer":"move"},_docmousemove:function(t){if(this.isLeftIn)return;var n=t.clientX,r=t.clientY,i=e(window).scrollTop(),s=e(window).scrollLeft();if(this._vm.showMode()==0){var o=this.$docmain.offset().left-s,u=this.$docmain.offset().top+this.$docmain.height()/2-90-i;this._vm.showprev(this._getVisible(o,u,70,180,n,r)),this._vm.shownext(this._getVisible(o+this.$docmain.width()-80,u,80,180,n,r))}else{var o=this.$docmain.offset().left+this.$docmain.width()/2-90-s,u=this.$docmain.offset().top-i;this._vm.showprev(this._getVisible(o,u,180,70,n,r)),this._vm.shownext(this._getVisible(o,u+this.$docmain.height()-70,180,70,n,r))}},getScreenPageCount:function(){return Math.floor(this.height/(this._vm.pageHeight()*this._vm.zoom())||1)},_docmouseout:function(e){this.isMouseDown=!1,this._vm.shownext(!1),this._vm.showprev(!1)},_onmousedown:function(e){this.$controlcontent.css("cursor",this._getCursor(2)),this.mouseX=e.screenX,this.mouseY=e.screenY,this.isMouseDown=!0},_onmouseup:function(e){this.$controlcontent.css("cursor",this._getCursor(1)),this.isMouseDown=!1},_onmousemove:function(e){if(!this.isMouseDown)return;this.$doccontent.scrollLeft(this.$doccontent.scrollLeft()+this.mouseX-e.screenX),this.$doccontent.scrollTop(this.$doccontent.scrollTop()+this.mouseY-e.screenY),this.mouseX=e.screenX,this.mouseY=e.screenY},_leftmouseenter:function(e){this.isLeftIn=!0},_leftmouseleave:function(e){this.isLeftIn=!1},_onkeydown:function(e){e.keyCode==39&&this.next(),e.keyCode==37&&this.prev()},_onclick:function(e){this._trigger("hideThumbnail",null,null)},_calculateInitZoom:function(){var e=this.$docmain.width()-1,t=this.$docmain.height(),n=this.width,r=this.height;if(e<=0)return;if(this._vm.showMode()==1)n<=e?this._vm.zoom(1):this._vm.zoom(e/n);else{var i=this._vm.fileType()==2?n<e?1:2:this._xiangxian(e,n,t,r);switch(i){case 1:this._vm.zoom(1);break;case 2:this._vm.zoom(e/n);break;case 3:var s=e/n,o=t/r;this._vm.zoom(s<=o?s:o);break;case 4:this._vm.zoom(t/r)}}this._trigger("initZoom",null,this._vm.zoom())},_xiangxian:function(e,t,n,r){return e-t>=0&&n-r>=0?1:e-t>=0&&n-r<0?4:e-t<0&&n-r>=0?2:e-t<0&&n-r<0?3:1},_setIndex:function(){this._vm.selectMode()==1?e(".overlay").css("z-index","1"):e(".overlay").css("z-index","0")},_effectOut:function(e){return this.$controlcontent.fadeOut(100,e)},_effectIn:function(e){return this.$controlcontent.fadeIn(100,e)},_fixIe:function(t){if(this._vm.fileType()==0)return;if(this.ltIE9){var n=e("#jpedal"+t,this._inner).find(".t").length+1;for(var r=1;r<n;r++){var i="t"+r.toString(36)+"_"+t;e("#"+i).css("fontSize",parseInt(e("#"+i).css("fontSize").replace("px",""))/4+"px")}}},_next:function(){this._verticalScroll(1)},_prev:function(){this._verticalScroll(-1)},_verticalScroll:function(e){var t=this.$doccontent.scrollTop(),n=0,r="1000";e>=0?n=t+e*(this.$docmain.height()-this._vm.screenChangeOffsetHeight()*this._vm.zoom()):n=t-Math.abs(e)*(this.$docmain.height()-this._vm.screenChangeOffsetHeight()*this._vm.zoom()),this.$doccontent.stop().animate({scrollTop:n},r,"swing")},_goToPage:function(){var t=this.$doccontent.scrollTop(),n=(this.height+this._vm.spacing())*this._vm.zoom()*(this._vm.currentPage()-1)+10;e(".doc-content",this._inner).length&&this.$doccontent.scrollTop(n)},_ui:function(){return{viewModel:this._vm}},viewModel:function(){return this._vm}})})(jQuery)}),define("document.thumbnail",["require","exports","module"],function(e,t){(function(e){e.widget("document.thumbnail",{options:{showThumbnail:!1,thumbnailArray:[],currentPage:1,showMode:0,pageWidth:0,pageHeight:0,pageCount:0,existingPageCount:0,animateDelay:400},_staticHost:function(){var e="",t=document.getElementsByTagName("script");for(var n=0,r=t?t.length:0;n<r;n++){var i=t[n].src,i=i||i.toLowerCase();if(i&&i.indexOf("typescript")>-1){var s=i.match(/(https?:\/\/.+?\/)\/{0,}(\w+?\/)?/i);if(s){i.indexOf("release")>-1&&s.length>2?e=s[1]+s[2]:e=s[1];break}}}return e},_init:function(){var t=this,n=t.options,r=[],i=n.showMode==0,s=0,o=n.pageCount,u=this._staticHost()+"/typescript/cloud/document/v1/images/mapbg.jpg",a='<div class="doc-msg-bg" style="display: block;">   <div class="doc-msg-box">      <div class="doc-msg">          <i class="i-doc-warning"></i>           <p>'+this.option().i18n.thumbanail.noThumbanail+"</p>";"          </div>       </div>   </div></div>",r.push('<div class="'+(i?"doc-bottom":"doc-left")+'" style="display: '+(o>0?"block":"block")+';">'),r.push('   <div class="minimap" class="'+(i?"clearfix":"")+'">');if(o>0&&n.thumbnailArray.length>0)for(;s<o;s++){var f='       <img src="'+u+'" style="min-width:1px;"  data-original="'+n.thumbnailArray[s]+'" />';s>=n.thumbnailArray.length&&(f=""),r.push('<div class="minimap-item '+(s>=n.thumbnailArray.length&&s>n.existingPageCount-1?"doc-protected":"")+" minimap-item-"+(s+1==n.currentPage?s+1+" active":s+1+"")+'">'),r.push("   <em>"+(s+1)+"</em>"),r.push('   <div class="minimap-item-bg" data-index="'+(s+1)+'" >'),r.push(f),r.push("</div></div>")}else r.push(a);r.push("</div></div>"),this.element.html(r.join("")),e(".doc-bottom").css({bottom:"-170px"}),e(".doc-left").css({left:"-210px"});var l;n.showMode==0?(l=e(".minimap"),o>0&&n.thumbnailArray.length>0?l.width(n.pageCount*155+10):(l.addClass("minimap-vertical"),e(".i-doc-warning").addClass("i-doc-warning-vertical"),e(".doc-msg").addClass("doc-msg-vertical"))):l=e(".doc-left .minimap"),this.first=!1,this.width=0,this.height=0,n.showThumbnail?this.show():this.hide(),e(".minimap").scroll(e.proxy(this._scroll,this)),e(".minimap-item-bg").click(e.proxy(this.goToPage,this)),e(window).resize(e.proxy(this._resize,this)),e(window).resize(),n.showMode==0?this.viewRight=Math.floor(this.width/155):this.viewBottom=Math.floor(this.height/137)},goToPage:function(t){var n=e(t.currentTarget).data("index");this._active(n),this._trigger("go",null,{currentPage:parseInt(n,0)})},getViewMaxPage:function(){var t,n=this.options.currentPage();this.options.showMode==0?this.width=e(".minimap").scrollLeft():this.height=e(".doc-bottom").scrollTop()},toggle:function(){this.options.showThumbnail?this.hide():this.show()},_lazyload:function(){if(!this.first){function t(t,n,r){e(this).closest(".minimap-item").css("backgroundImage","none")}var n;this.options.showMode==0?n=e(".doc-bottom"):n=e(".minimap"),e(".minimap-item-bg > img").lazyload({threshold:0,forceLoad:!0,effect:"fadeIn",container:n,appear:t}),this.options.showThumbnail&&e(".minimap").scroll(),this.first=!0}},show:function(){this.options.showThumbnail=!0,this.options.showMode==0?e(".doc-bottom").stop().animate({bottom:"0px"},this.options.animateDelay,e.proxy(this._lazyload,this)):e(".doc-left").stop().animate({left:"0px"},this.options.animateDelay,e.proxy(this._lazyload,this))},hide:function(){this.options.showThumbnail=!1,this.options.showMode==0?e(".doc-bottom").stop().animate({bottom:"-170px"},this.options.animateDelay):e(".doc-left").stop().animate({left:"-210px"},this.options.animateDelay)},getThumbPageCount:function(){return this.options.showMode==0?Math.floor(e(".doc-bottom").width()/155):Math.floor(this.height/137)},_resize:function(){this.options.showMode==0?this.width=e(".minimap").width():this.height=e(".minimap").height(),this.thumbGo(this.options.currentPage)},_scroll:function(){if(this.options.showMode==1){var t=Math.floor(this.height/137);this.viewBottom=e(".minimap").scrollTop()/137+t}},thumbGo:function(t){if(t<1||t>this.options.pageCount)return;var n=this.options.currentPage,r=this.getThumbPageCount();this.options.showMode==0?(t>this.viewRight&&(e(".doc-bottom",this.element).scrollLeft(e(".doc-bottom",this.element).scrollLeft()+(t-this.viewRight)*155),this.viewRight=t),t<this.viewRight-r+1&&(e(".doc-bottom",this.element).scrollLeft((t-1)*155),this.viewRight=t+r-1)):(t>this.viewBottom&&(e(".minimap",this.element).scrollTop(e(".minimap",this.element).scrollTop()+(t-this.viewBottom)*137),this.viewBottom=t),t<this.viewBottom-r+1&&(e(".minimap",this.element).scrollTop((t-1)*137),this.viewBottom=t+r-1)),e(".minimap-item").removeClass("active"),e(".minimap-item-"+t).addClass("active"),this.options.currentPage=t},_active:function(t){e(".minimap-item").removeClass("active"),e(".minimap-item-"+t).addClass("active")}})})(jQuery)}),define("document.threescreen",["require","exports","module"],function(e,t){(function(e){e.widget("document.threescreen",{options:{path:"threescreen/index.html",host:"",fullPath:""},_init:function(){this.options.fullPath===""&&(this.options.fullPath=this.options.host+this.options.path);var t='<iframe class="i-ths" style="width: 100%; height: 100%; z-index: 10000;" frameborder="no" border="0" marginwidth="0" marginheight="0" data-bind="attr: { src: fullPath }"></iframe>';this._vm=ko.mapping.fromJS(this.options),this.element.html(t),this._inner=e(".i-ths",this.element),ko.applyBindings(this._vm,this._inner[0])}})})(jQuery)}),function(e){require(["document.frame","document.bar","document.message","document.content","document.thumbnail","document.threescreen"])}(jQuery),define("document.initmode",function(){}),define("urlloader",["require","exports"],function(e,t){var n=null;(function(e){var t=function(){function e(){}return e.Singleton=function(){return n||(n=new r({})),n},e}();e.FlashLoader=t;var r=function(){function e(t){this.setting=t,this._moviElement=null,this._eventQueue=[],this._defs=[],this._readyDeferred=$.Deferred(),this._inited=!1,this._supportCross=!1,t.htmlId=t.htmlId||"swfproxy";var n=document.createElement("span");n.style.width="0",n.style.height="0",n.style.overflow="hidden",n.style.position="absolute",document.body.appendChild(n);var r=document.createElement("span");r.id=t.htmlId,n.appendChild(r),e.instances[this.setting.htmlId]=this,this._init()}return e.prototype.ready=function(){return this._readyDeferred.promise()},e.prototype.get=function(e,t){var n=this,r=$.Deferred();return this._defs.push(r),this._eventQueue.push(t),this._supportCross?$.ajax({url:e,type:"GET",headers:{"X-Gaea-Authorization":undefined,Authorization:undefined,Accept:undefined,"Content-Type":undefined,"Accept-Language":undefined},success:function(t){n._queueEvent("success",[t,e])},error:function(t){n._queueEvent("error",["error",e])}}):(this._moviElement||(this._moviElement=swfobject.getObjectById(this.setting.htmlId)),this._moviElement.getConnect(e)),r.promise()},e.prototype._init=function(){"withCredentials"in new XMLHttpRequest?this._supportCross=!0:!1;var e={menu:"false",scale:"noScale",allowfullscreen:"true",allowscriptaccess:"always"};swfobject.embedSWF("http://s11.e.99.com/auxo/addins/swfproxy/v1.0.0/swfproxy.swf",this.setting.htmlId,"0","0","9.0.0","expressInstall.swf",{movieName:this.setting.htmlId},e)},e.prototype._queueEvent=function(e,t){var n=this;t==undefined?t=[]:t.constructor!==Array&&(t=[t]),setTimeout(function(){n.executeNext(e,t)},0)},e.prototype.executeNext=function(e,t){var n=this._eventQueue.shift();n&&(n.apply(this,t),this._defs.shift().resolve())},e.prototype.loadComplete=function(){this._moviElement=swfobject.getObjectById(this.setting.htmlId),this._readyDeferred.resolve()},e.prototype.connectComplete=function(e,t){this._queueEvent("success",[e,t])},e.prototype.connectError=function(e){this._queueEvent("error",["error",e])},e.instances={},e}();e.SWFProxy=r,window.SWFProxy=r})(t.Document||(t.Document={}));var r=t.Document}),define("document.enum",["require","exports"],function(e,t){"use strict";var n;(function(e){(function(e){e[e.CUR_DEFAULT=0]="CUR_DEFAULT",e[e.CUR_GRAB=1]="CUR_GRAB",e[e.CUR_GRABBING=2]="CUR_GRABBING"})(e.CursorType||(e.CursorType={}));var t=e.CursorType;(function(e){e[e.select=0]="select",e[e.move=1]="move"})(e.SelectMode||(e.SelectMode={}));var n=e.SelectMode;(function(e){e[e.image=0]="image",e[e.html=1]="html",e[e.imagegroup=2]="imagegroup",e[e.unknown=9]="unknown"})(e.PlayFormat||(e.PlayFormat={}));var r=e.PlayFormat;(function(e){e[e.horizontal=0]="horizontal",e[e.vertical=1]="vertical"})(e.ShowType||(e.ShowType={}));var i=e.ShowType;(function(e){e[e.loading=0]="loading",e[e.error=1]="error",e[e.playing=2]="playing"})(e.Step||(e.Step={}));var s=e.Step;(function(e){e[e.document=0]="document",e[e.threescreen=1]="threescreen",e[e.imagegroup=2]="imagegroup"})(e.DocumentType||(e.DocumentType={}));var o=e.DocumentType})(n=t.Document||(t.Document={}))}),define("document.store",["require","exports","urlloader","document.enum"],function(e,t,n,r){"use strict";var i;(function(e){var t=function(){function e(e){this.dataCache={},this.data=null,this._firstLoad=!1,this.loader=n.Document.FlashLoader.Singleton(),this._hasFlash=!0,this.data=$.extend(!0,{CurrentPage:1,ScreenPageCount:3,Step:r.Document.Step.loading},e),this.detect()}return e.prototype.checkMissing=function(e){return typeof this.dataCache[e]=="undefined"||typeof this.dataCache[e].data=="undefined"?!0:!1},e.prototype.detect=function(){var e=swfobject.getFlashPlayerVersion(),t=window.navigator.userAgent,n="",r=/iPad/i.test(t),i=/iPhone/i.test(t),s=t.match(/Android\s?(\d+.\d+(.\d+)?)/i);s&&s.length>2&&(n=s[1]),e.major>=10&&n<"4.0.3"&&!r&&!i?this._hasFlash=!0:this._hasFlash=!1},e.prototype.load=function(e){var t=this;!this.data.IgnoreFlash&&this._hasFlash==1?this.loader.ready().done(function(){t.detector(e)}):this.detector(e)},e.prototype.changeScreenPageCount=function(e){this.data.ScreenPageCount=e+3},e.prototype.detector=function(e){this.request(e)},e.prototype.request=function(e){var t=this;e>1&&(e-=1);var n=this.data.Hosts,s=this.data.PageCount,u=[],a=this.data.Files,f=this.data.ShowType,l=e+this.data.ScreenPageCount>this.data.Files.length?this.data.Files.length:e+this.data.ScreenPageCount,c=$.Deferred();!this._firstLoad&&l==0&&(this.dataLoadedHandler(1,""),this._firstLoad=!0),u.push(c.promise());for(var h=e;h<=l;h++){if(!!this.dataCache[h])continue;this.dataCache[h]={};switch(r.Document.PlayFormat[this.data.PlayFormat+""]){case r.Document.PlayFormat.imagegroup:case r.Document.PlayFormat.image:(function(n){u.push(t.imgloader(a[n-1],function(s){var o=i+' <img src="'+a[n-1]+'" style="width:100%;height:100%;"/>';r.Document.PlayFormat[t.data.PlayFormat+""]==r.Document.PlayFormat.imagegroup||!this.data.PageWidth?t.dataLoadedHandler(n,o,s):t.dataLoadedHandler(n,o),n==e&&c.resolve()},function(){t.dataLoadedErrorHandler(n),t.dataCache[n]=null,n==e&&c.resolve()}))})(h);break;default:u.push(this.loader.get(a[h-1],function(n,r){var i=t.getIndexOf(a,r)+1;if(n=="error")t.dataLoadedErrorHandler(i),t.dataCache[i]=null,i==e&&c.resolve();else{n=t.replace(n,i);var s=n.match(o);if(!s){t.dataLoadedHandler(i,n);return}s=s[2],t.imgloader(s,function(){t.dataLoadedHandler(i,n),i==e&&c.resolve()},function(){t.dataLoadedErrorHandler(i),t.dataCache[i]=null,i==e&&c.resolve()})}}))}}$.when.apply(undefined,u).done($.proxy(this.done,this)).fail($.proxy(this.fail,this))},e.prototype.imgloader=function(e,t,n){var r=this,i=$.Deferred(),s=new Image;return e?(s.onload=function(){t&&t.call(r,{width:s.width,height:s.height,src:s.src}),i.resolve()},s.onerror=function(){n&&n.call(r),i.resolve()},s.src=e,i):(i.resolve(),i)},e.prototype.getIndexOf=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]==t)break;return n},e.prototype.done=function(){},e.prototype.fail=function(){},e.prototype.replace=function(e,t){var n=this.data.Hosts;if(window.resourceType==101||window.resourceType==102||window.resourceType==103){if(this.data.Files&&this.data.Files.length>0){var r=this.data.Files[0].split("/");--r.length;var i=r.join("/");return e.replace(/href="/ig,'href="'+i+"/").replace(/url\("/ig,'url("'+i+"/").replace(/src="/ig,'src="'+i+"/")}return e}return e.replace(/href="/ig,'href="'+n[t%n.length]+"html/").replace(/url\("/ig,'url("'+n[t%n.length]+"html/").replace(/src="/ig,'src="'+n[t%n.length]+"html/")},e}();e.Store=t;var i="",s=/\/(\d+).html/i,o=/<img(?= )[^>]* src=(['"])(.*?)\1[^>]*>/i;$.browser.msie&&parseInt($.browser.version)?i='<div class="overlay" style="width:100%; height:100%; position:absolute; z-index:1; background: url(about:blank); opacity: 0;filter:alpha(opacity=0);"></div>':i='<div class="overlay" style="width:100%; height:100%; position:absolute; z-index:1; opacity: 0;filter:alpha(opacity=0);"></div>'})(i=t.Document||(t.Document={}))});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};define("document.main",["require","exports","eventdispatcher"],function(e,t,n){"use strict";var r;(function(e){var t=function(e){function t(t){e.call(this),this.element=t,this.store=null,this.__init()}return __extends(t,e),t.prototype.__init=function(){$("head").append("<style>.t {line-height: normal;font-size: 0px;position: absolute;-webkit-transform-origin: top left;-moz-transform-origin: top left;                    -o-transform-origin: top left;-ms-transform-origin: top left;-webkit-transform: scale(0.25);-moz-transform: scale(0.25);                    -o-transform: scale(0.25);-ms-transform: scale(0.25);z-index: 1;white-space: nowrap;overflow: visible;}</style>"),$.browser.msie&&parseInt($.browser.version)==7&&$("head").append("<style>.doc-player .overlay { background-image:url(about:blank);</style>")},t.prototype.init=function(e){console.log("请实现 init 方法！")},t.prototype.go=function(e){console.log("请实现 go 方法！")},t.prototype.toggleThumbnail=function(){console.log("请实现 toggleThumbnail 方法！")},t.prototype.toggleSelectMode=function(){console.log("请实现 toggleSelectMode 方法！")},t.prototype.zoomIn=function(){console.log("请实现 zoomIn 方法！")},t.prototype.zoomOut=function(){console.log("请实现 zoomOut 方法！")},t.prototype.fullscreen=function(){console.log("请实现 fullscreen 方法！")},t.prototype.exitfullscreen=function(){console.log("请实现 exitfullscreen 方法！")},t.prototype.next=function(){console.log("请实现 next 方法！")},t.prototype.prev=function(){console.log("请实现 prev 方法！")},t.prototype.onresize=function(){console.log("请实现 onresize 方法！")},t.prototype.error=function(e){console.log("请实现 error 方法！")},t}(n.Common.EventDispatcher);e.Main=t})(r=t.Document||(t.Document={}))});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};define("document.extend.main",["require","exports","document.main","document.store","document.enum","eventdispatcher"],function(e,t,n,r,i,s){"use strict";var o;(function(e){var t=function(e){function t(t,n){e.call(this,t),this.element=t,this.config=n,this._firstloaded=!0,this._currentNum=0,this._lastPageNumber=0,this._barConfig={},this.i18nConfig={main:{reload:"点击重载"},thumbanail:{noThumbanail:"该文档暂无缩略图"},message:{message:"抱歉，出了点小问题！",loadingTitle:"    加载中...    ",failTitle1:"文档加载失败，请",failTitle2:"刷新",failTitle3:"页面重新加载"},content:{top:"上",bottom:"下",left:"左",right:"右",loading:"加载中..."},bar:{thumbanail:"缩略图",drag:"拖拽",choiceWord:"选词",dragMode:"拖拽模式",zonedWrodMode:"划词模式",returnTopPage:"上次看到这里，点击回首页",prevPage:"上一页",nextPage:"下一页",prevScreen:"上一屏",nextScreen:"下一屏",narrow:"缩小",enlarge:"放大",fullscreen:"全屏",exitfullscreen:"退出全屏"}};if(!n.Document)return;n.i18n&&(this.i18nConfig=$.extend(this.i18nConfig,n.i18n)),n.Document.Id?this.start({Id:n.Document.Id,Type:"id"}):n.Document.DocumentCode&&this.start({DocumentCode:n.Document.DocumentCode,Type:"code"})}return __extends(t,e),t.prototype.init=function(e){this._init({Data:e,Code:0})},t.prototype.play=function(e){var t=$.Deferred();return this._firstloaded=!0,this.start({Id:e,Type:"id"},t),t.promise()},t.prototype.start=function(e,t){var n=this;this.get(e).done(function(e){n.config.dataFilter&&(e=n.config.dataFilter(e)),t.resolve(e.Data),n._init(e)})},t.prototype._init=function(e){this._firstloaded=!0,this._lastPageNumber=0,this._currentNum=0,e.Data&&e.Data.DocumentType?($(this.element).frame({documentType:i.Document.DocumentType[e.Data.DocumentType]}),e.Data.DocumentType!=1&&($(".document-message",this.element).message({i18n:this.i18nConfig}),$(".doc-bar",this.element).bar({i18n:this.i18nConfig}))):($(this.element).frame({}),$(".document-message",this.element).message({i18n:this.i18nConfig}),$(".doc-bar",this.element).bar({i18n:this.i18nConfig})),this.checkvalid(e)&&(this.store=new r.Document.Store($.extend(!0,this.transform(e.Data),this.config)),this.store.dataLoadedHandler=$.proxy(this.dataLoadedHandler,this),this.store.dataLoadedErrorHandler=$.proxy(this.dataLoadedErrorHandler,this),this.regiest())},t.prototype.regiest=function(){var e=this.store.data;e.DocumentType==1?($(".ths-main",this.element).threescreen({host:e.Hosts[0]}),$(".doc-bar",this.element).bar({step:i.Document.Step.playing,topElement:this.element,documentType:i.Document.DocumentType[e.DocumentType],fullscreen:$.proxy(this._fullscreen,this),isShowFullScreen:typeof e.isShowFullScreen!="undefined"?e.isShowFullScreen:!0,isShowDocSide:typeof e.isShowDocSide!="undefined"?e.isShowDocSide:!0,exitfullscreen:$.proxy(this._exitfullscreen,this),i18n:this.i18nConfig})):($(".document-thumal",this.element).thumbnail({showMode:i.Document.ShowType[e.ShowType],pageWidth:e.PageWidth,pageHeight:e.PageHeight,thumbnailArray:e.Thumbnail,pageCount:e.PageCount,existingPageCount:e.Files.length,go:$.proxy(this._thumbnailGo,this),i18n:this.i18nConfig}),$(".doc-bar",this.element).bar({percents:[33,50,67,75,90,100,110,125,150,175,200],thumbnailLength:e.Thumbnail.length,pageCount:e.PageCount,topElement:this.element,documentType:i.Document.DocumentType[e.DocumentType],showMode:i.Document.ShowType[e.ShowType],fileType:i.Document.PlayFormat[e.PlayFormat],changeSelectMode:$.proxy(this.changeSelectMode,this),zoomOut:$.proxy(this.zoomOut,this),zoomIn:$.proxy(this.zoomIn,this),changeZoom:$.proxy(this.changeZoom,this),numchange:$.proxy(this.numchange,this),prev:$.proxy(this._prev,this),next:$.proxy(this._next,this),thumbnailclick:$.proxy(this._thumbnailclick,this),fullscreen:$.proxy(this._fullscreen,this),isShowFullScreen:typeof e.isShowFullScreen!="undefined"?e.isShowFullScreen:!0,isShowDocSide:typeof e.isShowDocSide!="undefined"?e.isShowDocSide:!0,exitfullscreen:$.proxy(this._exitfullscreen,this),i18n:this.i18nConfig,config:this._barConfig}),$(".document-content",this.element).content({percents:[33,50,67,75,90,100,110,125,150,175,200],currentPage:e.CurrentPage,step:i.Document.Step.playing,showMode:i.Document.ShowType[e.ShowType],fileType:i.Document.PlayFormat[e.PlayFormat],pageCount:e.PageCount,existingPageCount:e.Files.length,pageWidth:e.PageWidth,pageHeight:e.PageHeight,detect:$.proxy(this.detect,this),initZoom:$.proxy(this.initZoom,this),numchange:$.proxy(this.numchange2,this),hideThumbnail:$.proxy(this.hideThumbnail,this),topElement:this.element,i18n:this.i18nConfig})),this.store.data.Step=i.Document.Step.playing,$(this.element).attr("tabindex","0").css("outline","0").off("keydown").on("keydown",$.proxy(this._keydown,this))},t.prototype.setBarConfig=function(e){this._barConfig=e},t.prototype._keydown=function(e){if(e.keyCode==39||e.keyCode==40||e.keyCode==34)$(".document-content",this.element).content("next"),$(this.element).focus(),e.preventDefault();if(e.keyCode==37||e.keyCode==38||e.keyCode==33)$(".document-content",this.element).content("prev"),$(this.element).focus(),e.preventDefault();e.keyCode==36&&$(".document-content",this.element).content("go",1),e.keyCode==35&&$(".document-content",this.element).content("go",Number.MAX_VALUE),e.keyCode==27&&$(".doc-bar",this.element).bar("exitfullscreen")},t.prototype._fullscreen=function(){$(this.element).frame("fullscreen"),this.dispatchEvent(new s.Common.Event("onFullScreen")),this.resize()},t.prototype._exitfullscreen=function(){$(this.element).frame("exitfullscreen"),this.dispatchEvent(new s.Common.Event("onExitFullScreen")),this.resize()},t.prototype.detect=function(e,t){this.store.changeScreenPageCount(parseInt($(".document-content",this.element).content("getScreenPageCount")+"",0)),this.render(t.currentPage)},t.prototype.numchange2=function(e,t){$(".doc-bar",this.element).bar("changeCurrentPage",t.currentPage),$(".document-thumal",this.element).thumbnail("thumbGo",t.currentPage),this._lastPageNumber!=t.currentPage&&(this._lastPageNumber=t.currentPage,this.dispatchEvent(new s.Common.Event("onNumChange")))},t.prototype.hideThumbnail=function(e,t){$(".document-thumal",this.element).thumbnail("hide"),$(".doc-bar",this.element).bar("toggleThumbnail")},t.prototype.render=function(e){this._currentNum=e,this.store.load(e)},t.prototype.change=function(e,t){if(e<0)return;$(".document-content",this.element).content("show",e,t)},t.prototype.dataLoadedHandler=function(e,t,n){this._firstloaded&&this._currentNum==e&&(this._firstloaded=!1,$(".document-message",this.element).message("show",{step:i.Document.Step.playing}),$(".doc-bar",this.element).bar("changeStep",i.Document.Step.playing),this.dispatchEvent(new s.Common.Event("onLoad"))),$(".document-content",this.element).content("show",e,t,n)},t.prototype.dataLoadedErrorHandler=function(e){var t=$('<div style="font-size: 30px; position: absolute;left: 50%; margin-left: -60px;top:48%;"><a href="javascript:void(0);">'+this.i18nConfig.main.reload+"</a></div>");t.click($.proxy(this._loadAgain,this,e)),$(".document-message",this.element).message("show",{step:i.Document.Step.playing}),$(".document-content",this.element).content("show",e,t),$(".doc-bar",this.element).bar("changeStep",i.Document.Step.playing)},t.prototype._loadAgain=function(e){this.render(e)},t.prototype.numchange=function(e,t){this.render(t.currentPage),$(".document-content",this.element).content("go",t.currentPage,null,!1),$(".document-thumal",this.element).thumbnail("thumbGo",t.currentPage),this._lastPageNumber!=t.currentPage&&(this._lastPageNumber=t.currentPage,this.dispatchEvent(new s.Common.Event("onNumChange")))},t.prototype._thumbnailGo=function(e,t){$(".document-content",this.element).content("go",t.currentPage,null,!1),$(".doc-bar",this.element).bar("changeCurrentPage",t.currentPage),this._lastPageNumber!=t.currentPage&&(this._lastPageNumber=t.currentPage,this.dispatchEvent(new s.Common.Event("onNumChange")))},t.prototype._thumbnailclick=function(){$(".document-thumal",this.element).thumbnail("toggle")},t.prototype._prev=function(){$(".document-content",this.element).content("prev"),this.dispatchEvent(new s.Common.Event("onPrev"))},t.prototype._next=function(){$(".document-content",this.element).content("next"),this.dispatchEvent(new s.Common.Event("onNext"))},t.prototype.checkStatus=function(){return this.store!=null&&this.store.data.Step==i.Document.Step.playing?!0:!1},t.prototype.go=function(e){this.checkStatus()&&$(".document-content",this.element).content("go",e)},t.prototype.resize=function(){this.checkStatus()&&($(".document-content",this.element).content("resize"),$(".doc-bar",this.element).bar("resize"))},t.prototype.getCurrentPage=function(){return this.checkStatus()?$(".document-content",this.element).content("getCurrentPage"):1},t.prototype.getStatus=function(){return this.store!=null?this.store.data.Step:i.Document.Step.loading},t.prototype.toggleThumbnail=function(){console.log("请实现 toggleThumbnail 方法！")},t.prototype.changeSelectMode=function(e,t){this.checkStatus()&&$(".document-content",this.element).content("changeSelectMode",t.mode)},t.prototype.toggleSelectMode=function(){this.checkStatus()&&($(".doc-bar",this.element).bar("toggleSelectMode"),$(".document-content",this.element).content("toggleSelectMode"))},t.prototype.changeZoom=function(e,t){this.checkStatus()&&$(".document-content",this.element).content("changeZoom",t)},t.prototype.initZoom=function(e,t){$(".doc-bar",this.element).bar("initZoom",t)},t.prototype.zoomIn=function(){this.checkStatus()&&$(".document-content",this.element).content("zoomIn")},t.prototype.zoomOut=function(){this.checkStatus()&&$(".document-content",this.element).content("zoomOut")},t.prototype.fullscreen=function(){this.checkStatus()&&$(".doc-bar",this.element).bar("fullscreen")},t.prototype.exitfullscreen=function(){this.checkStatus()&&$(".doc-bar",this.element).bar("exitfullscreen")},t.prototype.next=function(){this.checkStatus()&&$(".document-content",this.element).content("next")},t.prototype.prev=function(){this.checkStatus()&&$(".document-content",this.element).content("prev")},t.prototype.error=function(e){$(".document-message",this.element).message("show",{step:1,message:e})},t.prototype.showTime=function(e,t,n){this.checkStatus()&&$(".doc-bar",this.element).bar("showTime",{readTime:e,readTitle:t,timeOut:n})},t.prototype.get=function(e){var t;return e.Type=="id"?t={documentId:e.Id,access_token:this.config.Document.AccessToken}:e.Type=="code"&&(t={documentCode:e.DocumentCode}),typeof this.config.Document.types!="undefined"&&(t.types=this.config.Document.types),$.ajax({url:this.config.Host+"/"+e.Id,dataType:"json",enableToggleCase:!0,responseCase:"pascal",cache:!1})},t.prototype.transform=function(e){!e.PageWidth&&e.PlayFormat!="html"&&(e.ShowType="horizontal");var t=[],n=[],r=0,i=e.Hosts,s=i.length,o=e.Files,u=o.length,a=e.PlayFormat,f=e.PageCount;for(;r<u;r++){if(o[r].Type=="thumbnail")for(var l=0;l<o[r].FileNames.length;l++)n.push(i[l%s]+""+o[r].Path+"/"+o[r].FileNames[l]);if(o[r].Type==a)for(var c=0;c<o[r].FileNames.length;c++)switch(a){case"html":t.push(i[c%s]+""+o[r].Path+"/"+o[r].FileNames[c]);break;case"imagegroup":case"image":t.push(i[c%s]+""+o[r].Path+"/"+o[r].FileNames[c])}}return e.Files=t,e.Thumbnail=n,e},t.prototype.checkvalid=function(e){return e.Code!=0?(this.error("错误原因："+this.getStatusDescription(o.Noting)),!1):e.Data==null?(this.error("错误原因："+this.getStatusDescription(o.Noting)),!1):e.Data.ResourceStatus==o.Ready?!0:(this.error("错误原因："+this.getStatusDescription(e.Data.ResourceStatus)),!1)},t.prototype.getStatusDescription=function(e){var t="";switch(e){case o.Encoding:case o.Sync:case o.Create:t="文档未就绪";break;case o.Ready:t="文档已就绪";break;case o.Disabled:case o.Expired:t="文档已下线";break;case o.Delete:t="文档已删除";break;case o.Noting:t="无此数据"}return t},t}(n.Document.Main);e.ExtendMain=t;var o;(function(e){e[e.Create=0]="Create",e[e.Ready=1]="Ready",e[e.Disabled=2]="Disabled",e[e.Expired=3]="Expired",e[e.Encoding=4]="Encoding",e[e.Sync=5]="Sync",e[e.Delete=7]="Delete",e[e.Release=8]="Release",e[e.Noting=9]="Noting"})(o||(o={}))})(o=t.Document||(t.Document={}))});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.documentplugin",["require","exports","player.plugin","document.extend.main","document.enum"],function(e,t,n,r,i){(function(e){var t=function(e){function t(t,n){e.call(this),this._config={element:"",apiHost:"",accessToken:""},this._documentPlayer=null,this._queue=[],this._currentPage=1,this._key=0,this.first=!0,this._config.apiHost=n.setting.apiHost,this._config.accessToken=n.setting.accessToken,this._config=$.extend(!0,this._config,t),$("#syncvideo").click($.proxy(this.syncVideo,this))}return __extends(t,e),t.prototype.config=function(){return this._config},t.prototype.onLoad=function(t){e.prototype.onLoad.call(this,t),this._key=this.player.key,this.first=!0;if(!this.first)return;this._documentPlayer=new r.Document.ExtendMain(this._config.element,{Document:{AccessToken:this._config.accessToken},Host:this._config.apiHost,isShowFullScreen:this._config.isShowFullScreen}),this.player.type=="id"?this._documentPlayer.play(this.player.videoInfo==null?0:this.player.videoInfo.LinkDocumentId):this.player.type=="code"&&this._documentPlayer.init(this.player.documentInfo),this._currentPage=this._documentPlayer.getCurrentPage(),this.first=!1,this.player.addEventListener("onClipLoad",$.proxy(this.clipLoad,this)),this.player.addEventListener("onStart",$.proxy(this.onStart,this)),this.player.addEventListener("onSeek",$.proxy(this.onSeek,this)),this.player.addEventListener("onFinish",$.proxy(this.onFinish,this))},t.prototype.resize=function(){this._documentPlayer.resize()},t.prototype.clipLoad=function(e){e.clip.addEventListener("onCuepoint",$.proxy(this.cuepoint,this))},t.prototype.onSeek=function(){var e=this;window.setTimeout(function(){var t=parseInt(""+e.player.getTime(),10)*1e3,n=e.player.timeDocuments,r=n?n.length:0;if(r==0)return;for(var i=0;i<r;i++)if(t<n[i].time)break;if(i==0||r==0)return;e._queue=n[i-1].PageNumber;if(e._currentPage!=e._documentPlayer.getCurrentPage())return;var s=i==0?1:n[i-1].PageNumber;e._currentPage=s,e.go(s)},200)},t.prototype.onFinish=function(){this.first=!0},t.prototype.onStart=function(){if(!this.first)return;this.first=!1,this._queue=1,this._currentPage=1,this._currentPage!=this._documentPlayer.getCurrentPage()&&this.go(this._queue)},t.prototype.cuepoint=function(e){if(e.obj.type=="document"||e.obj.type=="any"){this._queue=e.obj.PageNumber;if(this._currentPage!=this._documentPlayer.getCurrentPage()||this._documentPlayer.getStatus()!=i.Document.Step.playing)return;this._currentPage=e.obj.PageNumber,this.go(e.obj.PageNumber)}},t.prototype.syncVideo=function(){this._currentPage=this._queue,this.go(this._queue)},t.prototype.isSync=function(){return this._documentPlayer==null||this.player.timeDocuments==null||this.player.timeDocuments.length==0||this._documentPlayer.getStatus()!=i.Document.Step.playing?!0:this._currentPage==this._documentPlayer.getCurrentPage()},t.prototype.go=function(e){this._documentPlayer.getStatus()==i.Document.Step.playing&&this._documentPlayer.go(e)},t}(n.Video.PluginBase);e.DocumentPlugin=t})(t.Video||(t.Video={}));var s=t.Video});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.cuepointplugin",["require","exports","player.plugin"],function(e,t,n){(function(e){var t=function(e){function t(t){e.call(this),this._config={times:[{time:10}],callback:function(e){}},this._config=$.extend(!0,this._config,t)}return __extends(t,e),t.prototype.onLoad=function(t){e.prototype.onLoad.call(this,t),this.player.addEventListener("onClipLoad",$.proxy(this.clipLoad,this))},t.prototype.clipLoad=function(e){e.clip.addEventListener("onCuepoint",$.proxy(this.cuepoint,this)),e.clip.addCuepoint(this._config.times)},t.prototype.cuepoint=function(e){this._config.callback(e)},t}(n.Video.PluginBase);e.CuepointPlugin=t})(t.Video||(t.Video={}));var r=t.Video});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("player.innercuepointplugin",["require","exports","player.plugin"],function(e,t,n){(function(e){var t=function(e){function t(t){e.call(this),this._config={times:[{time:0}]},this.currentkey="",this._config=$.extend(!0,this._config,t)}return __extends(t,e),t.prototype.onLoad=function(t){e.prototype.onLoad.call(this,t),this.player.addEventListener("onClipLoad",$.proxy(this.clipLoad,this))},t.prototype.clipLoad=function(e){if(this.currentkey==this.player.key||this.currentkey!="")return;this.currentkey=this.player.key;var t=this.uniq();e.clip.addCuepoint(t)},t.prototype.uniq=function(){var e=this.player.times.sort(function(e,t){return e.time-t.time}),t=e.length,n=[];for(var r=0;r<t;){var i=r+1;if(i<t)if(e[r].time==e[i].time){var s=$.extend(!0,e[r],e[i]);s.isShow=!0,s.type="any",n.push(s),r+=2}else n.push(e[r]),r++;else n.push(e[r]),r++}return n},t}(n.Video.PluginBase);e.InnerCuepointPlugin=t})(t.Video||(t.Video={}));var r=t.Video}),define("player.pluginfactory",["require","exports","player.pluginevent","player.questionplugin","player.positionplugin","player.documentplugin","player.cuepointplugin","player.innercuepointplugin"],function(e,t,n,r,i,s,o,u){(function(e){var t=function(){function e(){this._plugins={}}return e.prototype.init=function(e,t){for(var a in t){switch(a){case"question":this._plugins[a]=new r.Video.QuestionPlugin(t[a],e);break;case"position":this._plugins[a]=new i.Video.PositionPlugin(t[a],e);break;case"document":this._plugins[a]=new s.Video.DocumentPlugin(t[a],e);break;case"cuepoint":this._plugins[a]=new o.Video.CuepointPlugin(t[a],e);break;case"innerCuepoint":this._plugins[a]=new u.Video.InnerCuepointPlugin(t[a],e);break;default:this._plugins[a]=t[a]}typeof this._plugins[a].dispatchEvent=="function"&&this._plugins[a].dispatchEvent(new n.Video.PluginEvent("onLoad",e))}},e.prototype.get=function(e){return this._plugins[e]||null},e}();e.PluginFactory=t})(t.Video||(t.Video={}));var a=t.Video}),define("screen2base",["require","exports"],function(e,t){(function(e){var t=function(){function e(e){this.config={selector:".s2",minLeftWidth:260,minRightWidth:300,threshold:560},this.wrap=null,this.left=null,this.right=null,this.splite=null,this.resizeTick=0,this.leftDomId="",this.rightDomId="",this.s2DomId="",$.extend(this.config,e);var t=(new Date).getTime();this.leftDomId="player"+t,this.rightDomId="documentPlayer"+t,this.s2DomId="s2Player"+t,$(this.config.selector).empty().append('<div id="'+this.s2DomId+'" class="s2">'+'   <div id="'+this.leftDomId+'" class="s2-left" style = "background-color: #000;" ></div>'+'   <div class="s2-right">'+'       <div class="s2-split"></div>'+'       <div id="'+this.rightDomId+'" class="docplayer"></div>'+"   </div>"+"</div>"),this.wrap=$("#"+this.s2DomId,this.config.selector).css({minWidth:this.config.minLeftWidth+this.config.minRightWidth}),this.left=$(".s2-left",this.config.selector),this.right=$(".s2-right",this.config.selector),this.splite=$(".s2-split",this.config.selector),this._init()}return e.prototype._init=function(){var e=this;this.splite.mousedown(function(t){e._startDrag(t.pageX)}).mouseup(function(){e._stopDrag()}),$(window).resize(function(){clearTimeout(e.resizeTick),e.resizeTick=setTimeout(function(){var t="step",n=e.left.width(),r=e.right.width();e.splite.data("isAvg")?t="avg":Math.abs(e.splite.data("prevWidht")-e.wrap.width())>200&&(Math.abs(n-r)<6?(t="avg",e.splite.data("isAvg",1)):t="keep"),e._onResize(t)},0)})},e.prototype._disableSelect=function(){window.getSelection?(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges(),$(this.wrap).css({"-moz-user-select":"none","-ms-user-select":"none","-webkit-user-select":"none"})):document.selection&&($(this.wrap).attr("unselectable","on"),document.selection.empty())},e.prototype._enableSelet=function(){window.getSelection?(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges(),$(this.wrap).css({"-moz-user-select":"inherit","-ms-user-select":"inherit","-webkit-user-select":"inherit"})):document.selection&&($(this.wrap).removeAttr("unselectable"),document.selection.empty())},e.prototype._startDrag=function(e){var t=this;this._disableSelect();var n=Math.max(this.config.minRightWidth,this.config.minLeftWidth);this.splite.css({padding:"0 "+n+"px",marginLeft:"-"+n+"px","z-index":100}).data({isAvg:0,pageX:e}),this.wrap.mousemove(function(e){t._dragging(e.pageX)}).bind("mouseleave mouseup",function(){t._stopDrag()})},e.prototype._dragging=function(e){this._disableSelect();var t=this.splite.data("pageX"),n=t-e;if(Math.abs(n)>5){var r=this.left.width()-n,i=this.right.width()+n;r<this.config.minLeftWidth&&(r=this.config.minLeftWidth,i=this.wrap.width()-r),i<this.config.minRightWidth&&(i=this.config.minRightWidth,r=this.wrap.width()-i),this.splite.data("pageX",e),this.left.width(r),this.right.width(i)}},e.prototype._stopDrag=function(){this.wrap.unbind("mousemove mouseleave mouseup"),this.splite.css({padding:0,marginLeft:0}),this._enableSelet(),this.fixDrag()},e.prototype._onResize=function(e){var t=this,n=this.splite.width(),r=this.wrap.width(),i=this.left.width(),s=this.right.width();r<this.config.threshold&&(r=this.config.threshold);switch(e){case"avg":var o=r/2;i=Math.max(o,this.config.minLeftWidth),s=Math.max(o,this.config.minRightWidth),this.left.width(i),this.right.width(s);break;case"keep":var u=parseInt(this.splite.data("prevWidht"),10);i=this.left.width()/u*r,s=this.right.width()/u*r,i<this.config.minLeftWidth?(i=this.config.minLeftWidth,s=r-this.config.minLeftWidth):s<this.config.minRightWidth&&(i=r-this.config.minRightWidth,s=this.config.minRightWidth),this.left.width(i),this.right.width(s);break;case"step":var u=parseInt(this.splite.data("prevWidht"),10);r>u?(u<this.config.minRightWidth+this.config.minLeftWidth&&this.wrap.data("fromMin",1),this.wrap.data("fromMin")&&s<this.config.threshold?r>this.config.minRightWidth+this.config.minLeftWidth&&(s=r-i):(this.wrap.data("fromMin",0),i>s?(i=Math.max(i,this.config.minLeftWidth),s=r-i,s=Math.max(s,this.config.minRightWidth)):(s=Math.max(s,this.config.minRightWidth),i=r-s,i=Math.max(i,this.config.minLeftWidth)))):r>this.config.threshold*2?i>s?(s=Math.max(s,this.config.minRightWidth),i=r-s,i=Math.max(i,this.config.minLeftWidth)):(i=Math.max(i,this.config.minLeftWidth),s=r-i,s=Math.max(s,this.config.minRightWidth)):i>this.config.minLeftWidth?(s=Math.max(s,this.config.minRightWidth),i=r-s,i=Math.max(i,this.config.minLeftWidth)):(i=Math.max(i,this.config.minLeftWidth),s=r-i,s=Math.max(s,this.config.minRightWidth)),this.left.width(i),this.right.width(s)}this.splite.data("prevWidht",r),this.fixDrag(i,s),this.resize()},e.prototype.getConfig=function(){return this.config||{}},e.prototype.fixDrag=function(e,t){typeof e=="undefined"&&(e=this.left.width()),typeof t=="undefined"&&(t=this.right.width())},e.prototype.resize=function(){},e}();e.Sreen2Base=t})(t.Multiscreen||(t.Multiscreen={}));var n=t.Multiscreen});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("screen2videodoc",["require","exports","./screen2base"],function(e,t,n){(function(e){var t=function(e){function t(t){var n=this;e.call(this,t),this.setting=t,this.options=null,this.fixDragTick=0,this.videoPlayer=null,this.docPlayer=null,this.options=e.prototype.getConfig.call(this),this.wrap.append('<div class="s2-sync" style="display:none;" id="syncvideo">   <label>回到老师正在讲的页面</label><i></i></div>'),this.options.videoPlayer&&this.options.videoPlayer.onStart(function(){!n.options.docPlayer&&(n.options.docPlayer=n.options.videoPlayer.getCustomPlugin("document"))}),setInterval(function(){n.options.docPlayer&&n.toggleSync(n.options.docPlayer.isSync())},500),$(".s2 .s2-right .docplayer").height("100%")}return __extends(t,e),t.prototype._startDrag=function(t){this.left.find("object").width(this.left.width()),e.prototype._startDrag.call(this,t)},t.prototype._stopDrag=function(){e.prototype._stopDrag.call(this),this.left.find("object").width(this.left.width()),this.resize()},t.prototype.fixDrag=function(e,t){var n=this;typeof e=="undefined"&&(e=this.left.width()),typeof t=="undefined"&&(t=this.right.width()),clearTimeout(this.fixDragTick),this.fixDragTick=setTimeout(function(){n.left.width(e-1),setTimeout(function(){e+t!=n.wrap.width()&&(e=n.wrap.width()-t,e=Math.max(e,n.options.minLeftWidth)),n.left.width(e)},30)},20)},t.prototype.toggleSync=function(e){e?this.wrap.find(".s2-sync").hide():this.wrap.find(".s2-sync").show()},t.prototype.resize=function(){this.left.find("object").width(this.left.width()),this.options.docPlayer&&this.options.docPlayer.resize()},t}(n.Multiscreen.Sreen2Base);e.S2videodoc=t})(t.Multiscreen||(t.Multiscreen={}));var r=t.Multiscreen});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};define("player",["require","exports","eventdispatcher","player.playerevent","player.clip","player.clipevent","player.playersetting","player.flashdetect","player.playerException","player.pluginfactory","screen2videodoc"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c;(function(e){var t=function(e){function t(n,r){n===void 0&&(n="player"),r===void 0&&(r=null),e.call(this),this.element=n,this.originalConfig=r,this.key="",this.innerPlayer=null,this.videoInfo=null,this.videoBaseInfo=null,this.timeDocuments=null,this.documentInfo=null,this.timeQuestions=null,this.times=[],this.results=null,this.isPlayerLoaded=!1,this.isNewPlayClip=!0,this.flashHelp=null,this.playerException=new a.Video.PlayerException(this),this.pluginfactory=new f.Video.PluginFactory,this.currentClip=null,this.type=null,this.setting=null,this.originalElement=null,this.audiofirst=!0,this.s2videodoc=null,this.seekTick=0,this.enableHtml5=!1,this.html5Help={isLoaded:!0,state:t.STATE.buffering},this.sthOption=null,this.tryServerRequestNum=0,this.originalElement=n,this.enableHtml5=r.enableHtml5,this.setting=new o.Video.PlayerSetting(r.apiHost,r.staticHost,r.swfHost,r.video,r.configs,r.events,r.plugins),this.flashHelp=new u.Video.FlashHelper(this.element,this.setting);if(!this.flashHelp.hasFlash&&!this.enableHtml5)return;this.registerPlayerEvents(),r.video&&(r.video.id>0&&typeof r.video.accessToken=="string"&&r.video.accessToken||typeof r.video.code=="string"&&r.video.code||typeof r.video.url=="string"&&r.video.url)&&this.play(r.video,r.video.quality)}return __extends(t,e),t.prototype.registerPlayerEvents=function(){var e=this.setting.getPlayerEvents();for(var t in e)this.addEventListener(t,e[t])},t.prototype.registerPlayerPlugins=function(){var e=this.setting.getPlayerPlugins();this.times.length>0&&(e.innerCuepoint={times:this.times}),this.pluginfactory.init(this,e)},t.prototype.initHtml5Player=function(e){var t=this;this.overwriteInnplayerFunctionApi();if(e.type=="url")this.innerPlayer=this.html5TryPlay([e.url]);else{var n=[];n.push(this.getVideo(e)),$.when.apply({},n).done(function(){if(t.videoInfo==null)return;n.push(t.getUrlByQuality(t.videoInfo,e)),$.when.apply({},n).done(function(){if(t.videoInfo==null)return;var e=t.videoInfo.VideoType==0||t.videoInfo.VideoType==2?"video":"audio";t.innerPlayer=t.html5TryPlay(t.videoInfo.DefaultFile.FileName,t.videoInfo.FrontCoverUrl,e)})})}},t.prototype.html5TryPlay=function(e,t,n){var i=this;n===void 0&&(n="video");var i=this,s=n=="audio"?"audio/mpeg":"video/mp4",o="",u=e.length,a=2,f=!0;$(".j-huayuHtml5Player",$("#"+this.element)).remove();var l={"class":"j-huayuHtml5Player",controls:"controls",style:"height:100%;width:100%;",autoplay:this.setting.video.autoPlay};t&&(l.poster=t),$("#"+this.element).append($("<"+n+">",l)),this.video=$(".j-huayuHtml5Player",$("#"+this.element)),this.video.on("play",function(e){i.video[0].isPlayToEnded&&(i.video[0].isPlayToEnded=!1,i.dispatchEvent(new r.Video.PlayerEvent("onResume"))),i.dispatchEvent(new r.Video.PlayerEvent("onStart"))}),this.video.on("seeking",function(e){i.dispatchEvent(new r.Video.PlayerEvent("onBeforeSeek"))}),this.video.on("seeked",function(e){i.dispatchEvent(new r.Video.PlayerEvent("onSeek"))}),this.video.on("pause",function(e){i.dispatchEvent(new r.Video.PlayerEvent("onPause"))}),this.video.on("ended",function(e){i.video[0].isPlayToEnded=!0,i.dispatchEvent(new r.Video.PlayerEvent("onFinish"))}),this.html5Help.isLoaded=!0,this.dispatchEvent(new r.Video.PlayerEvent("onLoad"));var c="";for(var h=0,p=e.length;h<p;h++){var o='<source src="'+e[h]+'" type="'+s+'"/>';for(var d=a;d>0;d--)c+=o}return this.video.append(c),this.video[0]},t.prototype.overwriteInnplayerFunctionApi=function(){$.extend(this,{resize:function(){},close:function(){},getControls:function(){},getCommonClip:function(){},getIndex:function(){},getParent:function(){},getPlay:function(){},getPlaylist:function(){},getPlugin:function(e){},getCustomPlugin:function(e){},getScreen:function(){},getState:function(){return this.html5Help.state},getStatus:function(){return{bufferEnd:0,bufferStart:0,muted:this.innerPlayer.muted,state:this.html5Help.state,time:this.innerPlayer.currentTime,volume:Math.floor(this.innerPlayer.volume*100)}},getTime:function(){return this.innerPlayer==null?0:this.innerPlayer.currentTime},getVersion:function(){},getVolume:function(){return this.innerPlayer==null?0:Math.floor(this.innerPlayer.volume*100)},getCurrentQuality:function(){return 0},hide:function(){return this.video.hide()},id:function(){return this.video.attr("id")},isFullscreen:function(){},isHidden:function(){return this.video.is(":visible")},isLoaded:function(){return this.html5Help.isLoaded},isPaused:function(){return this.innerPlayer.paused},isPlaying:function(){return this.html5Help.state==3},pause:function(){return this.innerPlayer.pause()},resume:function(){this.innerPlayer.currentTime=0,this.innerPlayer.play()},getClip:function(){return{}},seek:function(e){var t=this;clearTimeout(this.seekTick),this.seekTick=setTimeout(function(e){return function(){if(t.innerPlayer==null)return;var n=t.innerPlayer.duration;e<=n-1&&(t.innerPlayer.currentTime=e)}}(e),200)},setVolume:function(e){return e<0&&(e=0),e>100&&(e=100),this.innerPlayer.volume=e/100},show:function(){return this.video.show()},stop:function(){this.innerPlayer.currentTime=0,this.innerPlayer.pause()},toggle:function(){return this.video.toggle()},toggleFullscreen:function(){}})},t.prototype.initFlashPlayer=function(e){var t=this;if(e.type=="url")this.s2videodoc=null,this.playerException.detectUrl(e.url)&&this.initPlayerConfig(e.url,this.setting.video,e);else{var n=[];n.push(this.getVideo(e)),$.when.apply({},n).done(function(){if(t.videoInfo==null)return;n.push(t.getUrlByQuality(t.videoInfo,e)),$.when.apply({},n).done(function(){var r=t.setting.getPlayerPlugins();if(t.videoInfo==null)return;t.videoInfo.LinkDocumentId&&t.videoInfo.LinkDocumentId!="00000000-0000-0000-0000-000000000000"&&r.document&&n.push(t.getVideoDocument(e)),t.videoInfo.LinkWordId&&t.videoInfo.LinkWordId!="00000000-0000-0000-0000-000000000000"&&r.question&&n.push(t.getVideoQuestion(e)),n.length>=3?$.when.apply({},n).done(function(){t.s2(r),t.initPlayerConfig(t.videoInfo,t.setting.video,e),$("#fixObjectStyle").remove(),$("#"+t.element).after("<style id='fixObjectStyle'>#"+t.element+" Object,#"+t.element+" object{display:block;}</style>")}):(t.s2(r),t.initPlayerConfig(t.videoInfo,t.setting.video,e),$("#fixObjectStyle").remove(),$("#"+t.element).after("<style id='fixObjectStyle'>#"+t.element+" Object,#"+t.element+" object{display:block;}</style>"))})})}},t.prototype.initPlayerConfig=function(e,t,n){var r=this.setting.getPlayerConfigs(e,t,n);r.obj2.plugins.captionsContent&&(r.obj2.plugins.captionsContent.style.body.fontSize=$("#"+this.element).width()/40),this.initPlayerEvent(r.obj1,r.obj2)},t.prototype.initPlayerEvent=function(e,t){var n=this;$f(this.element,e,t).onLoad(function(){n.isPlayerLoaded=!0,n.registerPlayerPlugins(),n.dispatchEvent(new r.Video.PlayerEvent("onLoad"));var e=n.pluginfactory.get("document");e!=null&&(e.first=!0)}).onFullscreen(function(){n.dispatchEvent(new r.Video.PlayerEvent("onFullscreen"))}).onMouseOver(function(){n.dispatchEvent(new r.Video.PlayerEvent("onMouseOver"))}).onMouseOut(function(){n.dispatchEvent(new r.Video.PlayerEvent("onMouseOut"))}).onFullscreenExit(function(){n.dispatchEvent(new r.Video.PlayerEvent("onFullscreenExit"))}).onStart(function(e){(n.videoInfo||n.type=="url")&&n.audiofirst==1&&(n.audiofirst=!1,n.currentClip=new i.Video.Clip(e),n.dispatchEvent(new s.Video.ClipEvent("onClipLoad",n.currentClip)),n.dispatchEvent(new r.Video.PlayerEvent("onStart")),n._onStart())}).onBeforeSeek(function(){n.dispatchEvent(new r.Video.PlayerEvent("onBeforeSeek"))}).onSeek(function(){n.dispatchEvent(new r.Video.PlayerEvent("onSeek"))}).onPause(function(){n.dispatchEvent(new r.Video.PlayerEvent("onPause"))}).onResume(function(){n.dispatchEvent(new r.Video.PlayerEvent("onResume"))}).onFinish(function(){n.dispatchEvent(new r.Video.PlayerEvent("onFinish"))}),this.innerPlayer=$f(this.element)},t.prototype._onStart=function(){function i(){n.show(),window.setTimeout(function(){try{n.hide()}catch(e){}},t.time)}var e=this,t=this.pluginfactory.get("lastPositionContent"),n=this.innerPlayer.getPlugin("lastPositionContent"),r=0;t&&(n.hide(),n.append(t.html),r=setInterval(function(){if(e.isLoaded()){var t=e.getPlugin("poster");t?t.startPosterIsComplete()&&(i(),clearInterval(r)):(i(),clearInterval(r))}},100))},t.prototype.replay=function(){this.innerPlayer&&this.innerPlayer.play()},t.prototype.play=function(e,t){t===void 0&&(t=2),this.__defer=$.Deferred();if(!this.flashHelp.hasFlash&&!this.enableHtml5)return;return this.element=this.originalElement+"Wrap",$("#"+this.originalElement).html('<div id="'+this.element+'" style="height:100%;width:100%;">'),this.flashHelp.hasFlash&&$("#"+this.element).prev(".chaptervideo").remove(),this.innerplay(e,t),this.__defer.promise()},t.prototype.innerplay=function(e,t){t===void 0&&(t=2),this.key=e;var n=null;this.audiofirst=!0,this.setting.video=this.setting.video||{},typeof e=="string"&&e!=""?e.indexOf("http")>-1?(n={url:e,type:"url"},$.extend(this.setting.video,{id:null,code:null,url:null}),this.setting.video.url=e):(n={code:e,type:"code"},$.extend(this.setting.video,{id:null,code:null,url:null}),this.setting.video.code=e):typeof e=="number"&&e!=0?(n={videoId:e,type:"id"},$.extend(this.setting.video,{id:null,code:null,url:null}),this.setting.video.id=e):typeof e=="object"&&(typeof e.id=="number"&&e.id>0?(n={videoId:e.id,type:"id"},this.key=e.id):typeof e.code=="string"&&e.code!=""?(n={code:e.code,type:"code"},this.key=e.code):typeof e.url=="string"&&e.url!=""&&(n={url:e.url,type:"url"},this.key=e.id),$.extend(this.setting.video,{id:null,code:null,url:null}),$.extend(this.setting.video,e)),this.setting.video.quality=t>=0&&t<=4?t:2,this.setting.video.autoPlay=typeof e["autoPlay"]=="boolean"?e.autoPlay:!!this.setting.video.autoPlay,this.setting.video.autoBuffering=typeof e["autoBuffering"]=="boolean"?e.autoBuffering:!!this.setting.video.autoBuffering;if(n==null)return;this.times=[],this.timeDocuments=null,this.timeQuestions=null,this.type=n.type,!this.flashHelp.hasFlash&&this.enableHtml5&&this.flashHelp.supportVideo?this.initHtml5Player(n):this.flashHelp.hasFlash?(this.enableHtml5=!1,this.initFlashPlayer(n)):this.flashHelp.show()},t.prototype.s2=function(e){e.document&&this.videoInfo.LinkDocumentId&&this.videoInfo.LinkDocumentId!="00000000-0000-0000-0000-000000000000"?(this.s2videodoc=new l.Multiscreen.S2videodoc({selector:"#"+this.element,videoPlayer:this}),e.document.element="#"+this.s2videodoc.rightDomId,this.element=this.s2videodoc.leftDomId):this.s2videodoc=null},t.prototype.getVideo=function(e){var t=this,n={};return e.type=="id"?n={videoId:e.videoId,accessToken:this.setting.accessToken}:e.type=="code"&&(n={videoCode:e.code}),$.ajax({url:this.setting.apiHost+"/"+e.code,timeout:2e4,dataType:"json",enableToggleCase:!0,responseCase:"pascal",cache:!1,success:function(e){t.setting.playerConfigs.dataFilter&&(e=t.setting.playerConfigs.dataFilter(e)),t.__defer.resolve(e),t.playerException.detect(e)?(t.videoInfo=t.formatVideoBaseInfo(e.Data),t.videoInfo.ApiHost=t.setting.apiHost):t.videoInfo=null},complete:function(e,n){n=="timeout"&&t.playerException.queryFail()},error:function(e,t,n){return}})},t.prototype.getUrlByQuality=function(e,t){var n=this,r=e.DefaultFile,i={quality:r.Quality,audioIndex:r.AudioIndex,types:r.Type};return t.type==="code"?i.videoCode=t.code:t.type==="id"&&(i.videoId=t.videoId,i.accessToken=this.setting.accessToken),$.ajax({url:this.setting.apiHost+"/"+t.code+"/urls",dataType:"json",enableToggleCase:!0,responseCase:"pascal",data:i,cache:!1,success:function(e){n.setting.playerConfigs.dataFilter&&(e=n.setting.playerConfigs.dataFilter(e)),r.FileName=e.Data[0].Urls,n.videoInfo.DefaultFile=r,n.videoInfo.accessToken=n.setting.accessToken}})},t.prototype.getVideoQuestion=function(e){var t=this,n={videoId:e.videoId,accessToken:this.setting.accessToken};return $.ajax({url:this.setting.apiHost+"/"+e.code+"/video_exercises",dataType:"json",enableToggleCase:!0,responseCase:"pascal",cache:!1,success:function(e){t.timeQuestions=Enumerable.from(e.Relations).where(function(e){return e.IsSubjective==0&&e.Position>0}).select(function(e){return{time:e.Position,QuestionIds:e.QuestionIds,IsSubjective:e.IsSubjective,QuestionAnswerStatus:e.QuestionAnswerStatus,type:"question",isShow:!0}}).toArray().sort(function(e,t){return e.time-t.time}),t.times=t.times.concat(Enumerable.from(t.timeQuestions).select(function(e){return{time:e.time*1e3,QuestionIds:e.QuestionIds,IsSubjective:e.IsSubjective,type:"question",isShow:!0}}).toArray())}})},t.prototype.getVideoDocument=function(e){var t=this,n={},r="";return e.type=="id"?r=this.setting.playerConfigs.docVideoHost:e.type=="code"&&(r=this.setting.playerConfigs.docVideoHost),$.ajax({url:r,dataType:"json",enableToggleCase:!0,responseCase:"pascal",cache:!1,success:function(e){t.setting.playerConfigs.dataFilter&&(e=t.setting.playerConfigs.dataFilter(e)),e.Code==0&&e.Data!=null?(t.documentInfo=e.Data,t.timeDocuments=Enumerable.from(e.Data.Relations).select(function(e){return{time:e.Duration*1e3,PageNumber:e.PageNumber,type:"document",isShow:!1}}).toArray().sort(function(e,t){return e.time-t.time}),t.times=t.times.concat(t.timeDocuments)):window.console&&console.log("getVideoDocument："+e.Message)}})},t.prototype.formatVideoBaseInfo=function(e){var t=this.enableHtml5?"mp4":"f4v",n={Id:e.Uuid,Type:e.Type,Title:e.Title,VideoType:e.VideoType,DefaultAudioIndex:e.DefaultAudioIndex,ResourceStatus:e.ResourceStatus,Duration:e.Duration,Drawable:e.Drawable,DrawablePos:e.DrawablePos,LinkDocumentId:e.LinkDocumentId,LinkWordId:e.LinkWordId,ScreenshotInterval:e.ScreenshotInterval,ScreenshotPath:e.ScreenshotPath,ScreenshotWidth:e.ScreenshotWidth,ScreenshotHeight:e.ScreenshotHeight,Urls:e.Urls,FrontCoverUrl:e.FrontCoverUrl,SubTitle:Enumerable.from(e.Subtitles||[]).select(function(e){return{Title:encodeURIComponent(e.Title),IsDefault:e.IsDefault,Url:e.Url}}).toArray(),Files:Enumerable.from(e.Files).where(function(n){if(typeof e.VideoType=="undefined")return!0;if(e.VideoType!=0&&e.VideoType!=2)return n.Type==3;if(t=="mp4")return n.Type!=1;if(t=="f4v")return n.Type!=2}).select(function(e){return{Quality:e.Quality,Type:e.Type,AudioIndex:e.AudioIndex,AudioTitle:e.AudioTitle,AudioLanguage:e.AudioLanguage}}).toArray().sort(function(e,t){var n=t.Quality-e.Quality,r=t.AudioIndex-e.AudioIndex;return n==0?r:n})};n.DefaultSubtitle=Enumerable.from(n.SubTitle).where(function(e){return e.IsDefault}).toArray()[0],n.DefaultFiles=Enumerable.from(n.Files).where(function(t){return t.AudioIndex==e.DefaultAudioIndex}).toArray();var r=this.setting.video.quality;return n.DefaultFile=function(){var e=n.DefaultFiles;for(var t=0;t<e.length;t++)if(e[t].Quality<=r)return e[t];for(var t=e.length-1;t>=0;t--)if(e[t].Quality>=r)return e[t]}(),n.DefaultFile&&n.Type&&n.Type!=2&&(n.DefaultFile.Type=3),n.DefaultFile&&n.DefaultFile.Type==3&&(window.resourceType!=101&&window.resourceType!=102&&window.resourceType!=103&&(n.DefaultFile.Type=3),n.VideoType=1),n},t.prototype.resize=function(){this.s2videodoc!=null&&this.s2videodoc._onResize("keep")},t.prototype.close=function(){this.innerPlayer.close(),$("#"+this.originalElement).html("")},t.prototype.getControls=function(){return this.innerPlayer.getControls()},t.prototype.getCommonClip=function(){return this.innerPlayer.getCommonClip()},t.prototype.getIndex=function(){return this.innerPlayer.getIndex()},t.prototype.getParent=function(){return this.innerPlayer.getParent()},t.prototype.getPlay=function(){return this.innerPlayer.getPlay()},t.prototype.getPlaylist=function(){return this.innerPlayer.getPlaylist()},t.prototype.getPlugin=function(e){return this.innerPlayer.getPlugin(e)},t.prototype.getCustomPlugin=function(e){return this.pluginfactory.get(e)},t.prototype.getScreen=function(){return this.innerPlayer.getScreen()},t.prototype.getState=function(){return this.innerPlayer.getState()},t.prototype.getStatus=function(){return this.innerPlayer.getStatus()},t.prototype.getTime=function(){return this.innerPlayer==null?0:this.innerPlayer.getTime()},t.prototype.getVersion=function(){return this.innerPlayer.getVersion()},t.prototype.getVolume=function(){return this.innerPlayer.getVolume()},t.prototype.getCurrentQuality=function(){var e=this.getClip();return e==null||e.innerClip==null?0:e.innerClip.quality||0},t.prototype.hide=function(){return this.innerPlayer.hide()},t.prototype.id=function(){return this.innerPlayer.id()},t.prototype.isFullscreen=function(){return this.innerPlayer.isFullscreen()},t.prototype.isHidden=function(){return this.innerPlayer.isHidden()},t.prototype.isLoaded=function(){return this.innerPlayer.isLoaded()},t.prototype.isPaused=function(){return this.innerPlayer.isPaused()},t.prototype.isPlaying=function(){return this.innerPlayer.isPlaying()},t.prototype.pause=function(){return this.innerPlayer.pause()},t.prototype.resume=function(){return this.innerPlayer.resume()},t.prototype.getClip=function(){return this.currentClip},t.prototype.seek=function(e){var t=this;clearTimeout(this.seekTick),this.seekTick=setTimeout(function(e){return function(){if(t.currentClip==null)return;var n=t.currentClip.innerClip.duration;e<=n-1&&t.innerPlayer.seek(e)}}(e),200)},t.prototype.setVolume=function(e){return this.innerPlayer.setVolume(e)},t.prototype.show=function(){return this.innerPlayer.show()},t.prototype.stop=function(){return this.innerPlayer.stop()},t.prototype.toggle=function(){return this.innerPlayer.toggle()},t.prototype.toggleFullscreen=function(){return this.innerPlayer.toggleFullscreen()},t.prototype.onMouseOver=function(e){return this.addEventListener("onMouseOver",e),this},t.prototype.onMouseOut=function(e){return this.addEventListener("onMouseOut",e),this},t.prototype.onProgressBarClick=function(e){return this.addEventListener("onProgressBarClick",e),this},t.prototype.onFullscreen=function(e){return this.addEventListener("onFullscreen",e),this},t.prototype.onFullscreenExit=function(e){return this.addEventListener("onFullscreenExit",e),this},t.prototype.onStart=function(e){return this.addEventListener("onStart",e),this},t.prototype.onBeforeSeek=function(e){return this.addEventListener("onBeforeSeek",e),this},t.prototype.onSeek=function(e){return this.addEventListener("onSeek",e),this},t.prototype.onBegin=function(e){return this.addEventListener("onBegin",e),this},t.prototype.onPause=function(e){return this.addEventListener("onPause",e),this},t.prototype.onResume=function(e){return this.addEventListener("onResume",e),this},t.prototype.onFinish=function(e){return this.addEventListener("onFinish",e),this},t.prototype.onCuepoint=function(e,t){},t.STATE={loaded:0,unstarted:1,buffering:2,playing:3,paused:4,ended:5},t}(n.Common.EventDispatcher);e.Player=t})(c=t.Video||(t.Video={}))});