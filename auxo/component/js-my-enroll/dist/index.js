!function(t){"use strict";function n(n){var e={init:!1,processStatus:0,defaultImage:"",search:{page_no:-1,page_size:10},data:{items:[],total:0}};this.model=t.mapping.fromJS(e),this.model.search.status=t.pureComputed(function(){return[[0,2,5],[1,3,4]][this.model.processStatus()]||[]},this),this.defaultOptions={projectCode:"onetest",defaultImage:"",hosts:{enrollGateway:"http://elearning-enroll-gateway.dev.web.nd",enrollApi:"http://elearning-enroll-api.dev.web.nd",payGateway:""}},this.options=$.extend({},this.defaultOptions,n.options),this.model.defaultImage(this.options.defaultImage),this.init()}t="default"in t?t["default"]:t;var e=i18nHelper.getKeyValue,a=t.utils;n.prototype.store={query:function(t,n){return $.ajax({url:t+"/v1/user/enrollment_infos",data:n,dataType:"json",cache:!1})}},n.prototype.init=function(){this.getDataList()},n.prototype.fixImage=function(t,n){n.target.src=this.options.defaultImage},n.prototype.getDataList=function(n){var e=this.model.search.page_no;this.ajaxRequest&&(this.ajaxRequest.abort(),e(e()-1)),n&&e(-1);var r=this,i=t.mapping.toJS(this.model.search),o=this.model.data;e(++i.page_no),this.ajaxRequest=this.store.query(this.options.hosts.enrollGateway,this._getParamString(i)),this.ajaxRequest.done(function(t){t&&(a.arrayForEach(t.items,function(t){t.button=r.formatButton(t)}),o.items(n?t.items:o.items().concat(t.items)),o.total(t.total)),r.model.init(!0)}).always(function(){r.ajaxRequest=null})},n.prototype.switchTab=function(t){this.model.processStatus(t),this.getDataList(!0)},n.prototype.showMore=function(){this.getDataList()},n.prototype.formatTime=function(t,n){var e="";return t&&(n?(e=t&&t.split("."),e=e[0].replace("T"," ")):(e=t&&t.split("T"),e=e[0])),e||""},n.prototype.formatButton=function(t){return{0:{btnText:"myEnroll.verifying",btnClass:"btn btn-disabled",btnHref:"javascript:;",btnFunc:null},1:{btnText:"myEnroll.fail",btnClass:"btn btn-disabled",btnHref:"javascript:;",btnFunc:null},2:{btnText:"myEnroll.pay",btnClass:"btn btn-primary",btnHref:"javascript:;",btnFunc:$.proxy(this.alertMessage,this,e("myEnroll.notSupportPay"))},3:{btnText:"myEnroll.cancel",btnClass:"btn btn-disabled",btnHref:"javascript:;",btnFunc:null},4:{btnText:"myEnroll.success",btnClass:"btn btn-disabled",btnHref:"javascript:;",btnFunc:null},5:{btnText:"myEnroll.enroll",btnClass:"btn btn-primary",btnHref:"javascript:;",btnFunc:$.proxy(this.hrefEnroll,this,t)}}[t.status]},n.prototype.hrefEnroll=function(t){var n=this.options,e=n.hosts.enrollGateway+"/"+n.projectCode+"/enroll/enroll?unit_id="+t.unit_id+"&__return_url="+encodeURIComponent(location.href);location.href=e+"&__mac="+Nova.getMacToB64(e)},n.prototype.alertMessage=function(t){$.fn.udialog?$.fn.udialog.alert(t):window.alert(t)},n.prototype.triggerButton=function(t){return t.button.btnFunc&&$.isFunction(t.button.btnFunc)&&t.button.btnFunc(),!0},n.prototype.hrefTo=function(t,n){var e=this.options,a=e.hosts.enrollGateway+"/"+e.projectCode+"/enroll/user_enroll_form?unit_id="+n.unit_id+"&__return_url="+encodeURIComponent(location.href);switch(t){case"form":location.href=a+"&__mac="+Nova.getMacToB64(a)}},n.prototype._getParamString=function(t){var n="";for(var e in t)if(t.hasOwnProperty(e)){var a=t[e],r="";if($.isArray(a))for(var i=a.length,o=0;o<i;o++)""!==(r=$.trim(a[o]))&&(n+=e+"="+r+"&");else""!==(r=$.trim(a))&&(n+=e+"="+r+"&")}return n?n.substring(0,n.length-1):n},t.components.register("x-my-enroll",{viewModel:n,template:'<div class="x-my-enroll" id="x-my-enroll">\r\n    <div class="tab-nav">\r\n        <ul>\r\n            <li class="active" data-bind="css:{\'active\':model.processStatus() == 0},click:switchTab.bind($data,0)">\r\n                <!--ko translate:{key:\'myEnroll.processing\'}-->\r\n                <!--/ko-->\r\n            </li>\r\n            <li data-bind="css:{\'active\':model.processStatus() == 1},click:switchTab.bind($data,1)">\r\n                <!--ko translate:{key:\'myEnroll.finish\'}-->\r\n                <!--/ko-->\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class="panel-body clearfix">\r\n        <div class="enroll-list" style="display: none;" data-bind="visible:model.data.items().length && model.init(),foreach:model.data.items">\r\n            <div class="enroll-item">\r\n                <div class="inline">\r\n                    <img data-bind="attr:{\'src\':cover_url? cover_url+\'!m300x200.jpg\': $parent.model.defaultImage ,\'alt\':title },event:{\'error\':$parent.fixImage.bind($parent)}">\r\n                </div>\r\n                <div class="inline">\r\n                    <div class="title" data-bind="text:title"></div>\r\n                    <div class="info">\r\n                        <span class="label"><i class="me-icon-time"></i>&nbsp;&nbsp;<!--ko translate:{key:\'myEnroll.activityTime\'}--><!--/ko--></span>\r\n                        <!--ko translate:{ \'key\':enroll.enroll_time_limit_type?\'myEnroll.fromTo\':\'myEnroll.noLimit\',properties:{\'startTime\':$parent.formatTime(enroll.enroll_start_time),\'endTime\':$parent.formatTime(enroll.enroll_end_time)}}-->\r\n                        <!--/ko-->\r\n                    </div>\r\n                    <div class="info">\r\n                        <span class="label"><i class="me-icon-clock"></i>&nbsp;&nbsp;<!--ko translate:{key:\'myEnroll.enrollTime\'}--><!--/ko--></span>\r\n                        <!--ko text:$parent.formatTime(enroll.create_time,true)-->\r\n                        <!--/ko-->\r\n                    </div>\r\n                </div>\r\n                <div class="item-right">\r\n                    <div class="money-panel" data-bind="text:display_amount||\'\'"></div>\r\n                    <a href="javascript:;" data-bind="attr:{\'href\': button.btnHref,\'class\':button.btnClass },click:$parent.triggerButton.bind($parent)">\r\n                        <!--ko translate:{ \'key\': button.btnText }-->\r\n                        <!--/ko-->\r\n                    </a>\r\n                    <div class="control-panel" style="display:none;" data-bind="visible:user_enroll_form && enroll.enroll_form_type">\r\n                        <a href="javascript:;" class="btn-triangle"></a>\r\n                        <div class="control-list">\r\n                            <a class="control-item" href="javascript:;" data-bind="click:$parent.hrefTo.bind($parent,\'form\')">\r\n                                <!--ko translate:{key:\'myEnroll.myEnrollInfo\'}-->\r\n                                <!--/ko-->\r\n                            </a>\r\n                        </div>\r\n                    </div>\r\n                    <div class="time-panel" data-bind="visible:pay_order"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="more-panel" data-bind="visible:model.data.items().length < model.data.total()">\r\n            <a class="more-btn" href="javascript:;" data-bind="click:showMore">\r\n                <!--ko translate:{key:\'myEnroll.showMore\'}-->\r\n                <!--/ko-->\r\n            </a>\r\n        </div>\r\n        <div class="no-content" style="display: none;" data-bind="visible: !model.data.items().length && model.init()">\r\n            <div class="book-icon">\r\n                <i class="me-icon-study"></i>\r\n            </div>\r\n            <div class="text-panel">\r\n                <!--ko translate:{key:\'myEnroll.noEnroll\'}-->\r\n                <!--/ko-->\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'})}(ko);
