!function(e,t){"use strict";function n(n){this.model={course_name:n.course_name,user_name:n.user_name,api_url:n.api_url,gateway:n.gateway,course_id:n.course_id,user_id:n.user_id,is_login:!!n.is_login,content:e.observableArray(JSON.parse(n.content||"[]")),search:{target_id:e.observable("course:"+n.course_id),keyword:e.observable(""),order_by:e.observable(1),page:e.observable(0),size:20},data:{items:e.observableArray([]),total:e.observable(0)},note_type:e.observable(0),search_all_result:e.observable(0),is_hide_statusbar:e.observable(!1),mynote_count:e.observable(0),init:e.observable(!1)},this.init();var a=this;a.show_editor=e.observable(!1),a.on_del_command=function(e){t.fn.udialog.confirm(window.i18nHelper.getKeyValue("courseNote.del_confirm_msg"),[{"class":"ui-btn-confirm",text:window.i18nHelper.getKeyValue("courseNote.confirm"),click:function(){var n=this;a.store.deleteNote(a.model.api_url,e).then(function(){var i=o(a.model.data.items,e);a.model.data.items.splice(i,1),t(n).udialog("hide")})}},{"class":"ui-btn-primary",text:window.i18nHelper.getKeyValue("courseNote.cancel"),click:function(){t(this).udialog("hide")}}],{title:window.i18nHelper.getKeyValue("courseNote.tip_title")})},a.on_edit_command=function(e){a.editor_params.note=e,a.show_editor(!0)},a.editor_params={note:null,options:{apiHost:a.model.api_url,courseUrl:window.courseUrl,onCancelCommand:function(){a.show_editor(!1)},onSubmitSuccess:function(e){var t=o(a.model.data.items,e.id);a.model.data.items.splice(t,1,e),a.show_editor(!1)}}}}function o(e,t){for(var n=0,o=e.length;n<o;n++)if(e[n].id==t)return n}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t;n.prototype.store={getAllNote:function(e,n){return t.ajax({url:e+"/v1/notes",data:n,dataType:"json",cache:!1})},getMyNote:function(e,n){return t.ajax({url:e+"/v1/my_notes",data:n,dataType:"json",cache:!1})},deleteNote:function(e,n){return t.ajax({url:e+"/v1/notes/"+n,type:"DELETE",dataType:"json",cache:!1})}},n.prototype.init=function(){this.getList()},n.prototype.getList=function(){if(!this.model.is_login&&!this.model.note_type())return this.model.init(!0),this.model.data.items([]),void this.model.data.total(0);var n=e.mapping.toJS(this.model.search),o=this,a=this.model.data;this.model.init(!1),a.total(0),this.model.note_type()?(n.keyword=t.trim(n.keyword),this.store.getAllNote(this.model.gateway,n).done(function(e){a.items(e.items||[]),a.total(e.count||0),o.model.is_hide_statusbar(o.model.search_all_result()&&!a.total()),o._page(a.total(),n.page,n.size),o.model.init(!0)})):(n.keyword=undefined,n.order_by=undefined,this.store.getMyNote(this.model.gateway,n).done(function(e){a.items(e.items||[]),a.total(e.count||0),~n.target_id.indexOf("course")&&o.model.mynote_count(a.total()),o._page(a.total(),n.page,n.size),o.model.init(!0)}))},n.prototype.search=function(e,n){if(this.model.search.page(0),this.model.search_all_result(0),this.model.is_hide_statusbar(!1),"string"==typeof n)switch(n){case"note_type":t(".dlist").find(".active").removeClass("active"),this.model.search.keyword(""),this.model.search.order_by(1),this.model.search.target_id("course:"+this.model.course_id),this.model.note_type(e);break;case"search.order_by":this.model.search.order_by(e)}else this.model.search_all_result(1);this.getList()},n.prototype.switchCourse=function(){this.model.search.page(0),this.model.search.target_id("course:"+this.model.course_id),this.getList()},n.prototype.switchChapter=function(e,n){this.model.search.page(0),this.model.search.target_id("chapter:"+e.id),this.getList(),t(".dlist").find(".active").removeClass("active"),t(n.target).addClass("active")},n.prototype.toggleList=function(e,n){t(n.target).toggleClass("n-icon-minus"),t(n.target).parent().toggleClass("open")},n.prototype.focus=function(e,n){t(n.target).siblings(".txt").focus()},n.prototype._page=function(e,n,o){var a=this.model.search,i=this;t("#js_note_pagination").pagination(e,{items_per_page:o,num_display_entries:5,current_page:n,is_show_total:!1,is_show_input:!0,pageClass:"pagination-box",prev_text:"common.addins.pagination.prev",next_text:"common.addins.pagination.next",callback:function(e){e!=n&&(a.page(e),i.getList())}})},e.components.register("x-course-detail-note",{viewModel:n,template:'<div class="x-course-detail-note n-mod-note" id="x-course-detail-note">\r\n    <div class="note-wrap">\r\n        <div class="note-content">\r\n            <div class="n-ui-tab">\r\n                <a href="javascript:;" class="btn-tab"\r\n                   data-bind="click: $component.search.bind($component,0,\'note_type\'), translate: {key: \'courseNote.mine\'}, css:{\'on\': !model.note_type()}">我的笔记</a>\r\n                <a href="javascript:;" class="btn-tab"\r\n                   data-bind="click: $component.search.bind($component,1,\'note_type\'), translate: {key: \'courseNote.all\'}, css:{\'on\': model.note_type()}">全部笔记</a>\r\n            </div>\r\n            <div class="note-head" data-bind="visible: !model.note_type()&&model.data.items().length || model.note_type()">\r\n                \x3c!--我的笔记--\x3e\r\n                <p class="head-tip" data-bind="visible: !model.note_type(), translate:{key:\'courseNote.tips\',properties: {user_name: model.user_name, count: model.data.total}}"></p>\r\n                \x3c!--全部笔记 搜索前，或搜索后有内容--\x3e\r\n                <form class="n-ui-search fr" data-bind="visible: model.note_type, event:{submit: search}">\r\n                    <span class="tip" data-bind="visible: model.init()&&model.is_hide_statusbar()&&!model.data.items().length,translate:{key: \'courseNote.noResult\'}"></span>\r\n                    <input class="txt" type="text" maxlength="100" data-bind="textInput: model.search.keyword" />\r\n                    <a href="javascript:;" class="btn-search" data-bind="click: search"></a>\r\n                    <label class="placeholder" data-bind="click: focus, visible: !model.search.keyword().length, translate:{key: \'courseNote.placeholder\'}"></label>\r\n                </form>\r\n                <div class="n-ui-tab-filter" data-bind="visible: model.note_type()&&!model.is_hide_statusbar()">\r\n                    <a href="javascript:;" class="btn-tab" data-bind="click: $component.search.bind($component, 1, \'search.order_by\'), translate: {key: \'courseNote.hot\'}, css: {\'on\': model.search.order_by}">最热</a>\r\n                    <a href="javascript:;" class="btn-tab" data-bind="click: $component.search.bind($component, 0, \'search.order_by\'), translate: {key: \'courseNote.new\'}, css: {\'on\': !model.search.order_by()}">最新</a>\r\n                    <span class="total" data-bind="translate:{key: \'courseNote.total\', properties:{total: model.data.total} }"></span>\r\n                </div>\r\n                \x3c!--全部笔记 搜索后无内容--\x3e\r\n                <a href="javascript:;" class="btn-back" data-bind="click: search.bind($component,1,\'note_type\'),visible: model.init()&&model.is_hide_statusbar()&&!model.data.items().length,translate:{key: \'courseNote.back\'}" style="display: none;">返回全部</a>\r\n            </div>\r\n            \x3c!-- 列表 --\x3e\r\n            <div data-bind="foreach: model.data.items, visible: model.data.items().length && model.init()">\r\n                <div data-bind="component:{\r\n                name: \'x-note-item-a\',\r\n                params:{\r\n                  note: $data,\r\n                  options: {\r\n                    apiHost: $component.model.api_url,\r\n                    userId: $component.model.user_id,\r\n                    isLogin: $component.model.is_login,\r\n                    onDelCommand: $component.on_del_command,\r\n                    onEditCommand: $component.on_edit_command,\r\n                    showExcerpt: $component.model.note_type(),\r\n                    showBlowing: $component.model.note_type()\r\n                }}}"></div>\r\n            </div>\r\n            \x3c!-- 列表为空 --\x3e\r\n            <div class="note-empty" data-bind="visible: (!model.data.items().length && model.init())">\r\n                <i class="note-empty-icon"></i>\r\n                <p class="note-empty-tips" data-bind="visible: model.note_type() || model.mynote_count(), translate:{key: \'courseNote.noNote\'}">暂无任何笔记</p>\r\n                <p class="note-empty-tips" data-bind="visible: !model.note_type() && !model.mynote_count() && model.is_login, translate:{key: \'courseNote.noMineNote\',properties: {user_name: model.user_name}}">HI~鲜阳飞同学，你在此目录下还未记录笔记，</p>\r\n                <p class="note-empty-tips" data-bind="visible: !model.note_type() && !model.mynote_count() && model.is_login, translate:{key: \'courseNote.noMineNoteTip\'}">在课程学习过程中可以把有用的知识记录下来喔。</p>\r\n                <p class="note-empty-tips" data-bind="visible: !model.note_type() && !model.is_login, translate:{key: \'courseNote.noLigin\'}">您还没有登录</p>\r\n            </div>\r\n            <div class="note-empty" data-bind="visible: !model.init()">\r\n                <p class="note-empty-tips" data-bind="translate:{key:\'courseNote.loading\'}">数据加载中...</p>\r\n            </div>\r\n            <div id="js_note_pagination" data-bind="visible: model.data.items().length&&model.init" class="cf pagination-box"></div>\r\n        </div>\r\n        <div class="note-side">\r\n            <div class="n-ui-tab-menu">\r\n                <a href="javascript:;" class="btn-tab" data-bind="translate: {key: \'courseNote.content\'}">课程目录</a>\r\n                \x3c!--<a href="###" class="btn-tab">知识索引</a>--\x3e\r\n            </div>\r\n            <div class="n-ui-menu">\r\n                \x3c!-- 课程目录 --\x3e\r\n                <dl class="dlist" data-bind="visible: model.content().length">\r\n                    <dt data-bind="text: model.course_name, attr: {title: model.course_name},click:switchCourse.bind($component)" style="cursor:pointer;"></dt>\r\n                    \x3c!-- ko foreach: {data: model.content ,as: \'content\'} --\x3e\r\n                    <dd data-bind="css:{\'open\': !$index()}">\r\n                        <em class="iconfont-learn n-icon-add" data-bind="click: $component.toggleList.bind($component),css: $index()>0 ? \'n-icon-add\': \'n-icon-minus\'"></em>\r\n                        <span class="d-item"\r\n                              data-bind="text: content.title, attr:{title: content.title}, click: $component.switchChapter.bind($component)"></span>\r\n                        \x3c!-- ko if: content.children.length--\x3e\r\n                        <ul class="list" data-bind="foreach: {data: content.children, as: \'section\'}">\r\n                            <li class="sub-item" data-bind="text: section.title, attr:{title: section.title}, click: $component.switchChapter.bind($component)"></li>\r\n                        </ul>\r\n                        \x3c!-- /ko --\x3e\r\n                    </dd>\r\n                    \x3c!-- /ko --\x3e\r\n                </dl>\r\n                \x3c!-- 课程目录为空 --\x3e\r\n                <p class="no-menu" data-bind="visible: !model.content().length,translate:{key: \'courseNote.noContent\'}">暂无课程目录</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!--ko if:show_editor()--\x3e\r\n\x3c!--ko component:{name:"x-note-editor",params:editor_params}--\x3e\x3c!--/ko--\x3e\r\n\x3c!--/ko--\x3e'})}(ko,$);
