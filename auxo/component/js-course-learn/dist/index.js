!function(e){"use strict";function t(e){var t=$.extend(!0,{Detail:null,Message:null,Code:0},{Data:e});return t.Data.ResourceStatus=1,t}function n(e){var t=$.extend(!0,{Detail:null,Message:null,Code:0},{Data:e});return t.Data.ResourceStatus=1,t}function a(t){var n=this;this.model={question:null,filter:{page_no:0,page_size:5},answers:{items:[],total:0},state:{showAnswerArea:!1,showMoreContent:!1},content:""},this.model=e.mapping.fromJS(this.model);var a=$.extend(!0,{},t.question);a.answer_count=e.observable(a.answer_count),this.model.question(a),this.display_user=t.question.display_user,this.options=t.options,this.optionsForAnswer={urls:t.options.urls,actions:{"delete":$.proxy(this.getAnswer,this)},state:{showAcceptIcon:!1,showAcceptBtn:!1}},this.options.showAcceptIcon=!1,this.options.showAcceptBtn=!1,this.userId=t.userId,this.actions=this.options.actions||{detail:void 0,"delete":void 0},this.urls=this.options.urls||{api:"",gateway:""},this.store={getQuestion:function(e){return $.ajax({url:n.urls.gateway+"/v1/questions/"+e,dataType:"json",cache:!1})},deleteQuestion:function(e){return $.ajax({url:n.urls.gateway+"/v1/questions/"+e,dataType:"json",type:"DELETE"})},createAnswer:function(e){return $.ajax({url:n.urls.gateway+"/v1/answers",data:JSON.stringify(e),dataType:"json",type:"POST"})},getAnswer:function(e){return $.ajax({url:n.urls.gateway+"/v1/answers/search",data:e,dataType:"json",cache:!1})}},this.init()}function i(t){var n=this;this.model={question:null,answer:null,filter:{page_no:0,page_size:5},answers:{items:[],total:0},state:{showAnswerArea:!1,showAcceptIcon:!1!==t.options.showAcceptIcon,showAcceptBtn:!1!==t.options.showAcceptBtn},content:""},this.model=e.mapping.fromJS(this.model),this.model.question(t.question),this.model.answer(t.answer),this.display_user=t.answer.display_user,this.options=t.options,this.userId=t.userId,this.actions=this.options.actions||{accept:void 0,"delete":void 0},this.urls=this.options.urls||{api:"",gateway:""},this.store={acceptAnswer:function(e,t){return $.ajax({url:n.urls.api+"/v1/answers/"+e+"/actions/accept/"+t,dataType:"json",type:"PUT"})}},this.init()}function s(t){var n=this;this.maxlength=400,this.config=t.config,this.model={biz_param:t.data.biz_param,noteContent:e.observable(""),isOpen:e.observable(!0),videoCurrentTime:t.data.videoCurrentTime,docInfo:t.data.docInfo,refreshNotes:t.data.refreshNotes,editNoteInfo:t.data.editNoteInfo,excerpt_note_id:t.data.excerpt_note_id,report_count:e.observable(0),note_id:t.data.note_id},this.wordCount=e.computed(function(){return this.model.noteContent()?this.model.noteContent().length:0},this),this.model.noteContent.subscribe(function(e){e?($(".n-ui-btn-main").show(),$(".n-ui-btn-disable").hide()):($(".n-ui-btn-main").hide(),$(".n-ui-btn-disable").show());var t=this.maxlength;this.model.noteContent(e&&e.length>t?e.substr(0,t):e)},this),this.model.editNoteInfo.subscribe(function(e){var t="string"==typeof e.biz_data?JSON.parse(e.biz_data):e.biz_data;e.biz_data=t,this.model.note_id(e.id),this.model.noteContent(e.content),this.model.videoCurrentTime(e.biz_data&&e.biz_data.location&&e.biz_data.location.location?e.biz_data.location.location:""),this.model.docInfo(e.biz_data&&e.biz_data.location&&e.biz_data.location.location?e.biz_data.location.location:""),this.model.biz_param.resource_type(e.biz_data&&e.biz_data.resource_type?e.biz_data.resource_type:""),this.model.isOpen(e.is_open),this.model.excerpt_note_id(e.excerpt_note_id),this.model.report_count(e.report_count),this.model.biz_param.resource_id(e.biz_data&&e.biz_data.resource_id?e.biz_data.resource_id:""),this.model.report_count(e.report_count?e.report_count:0),$(".add-note-input").removeClass("hide")},this),this.store={createNote:function(e){return $.ajax({url:n.config.urls.noteServiceUrl+"/v1/notes",dataType:"json",type:"post",contentType:"application/json;charset=utf-8",data:JSON.stringify(e)})},updateNote:function(e,t){return $.ajax({url:n.config.urls.noteServiceUrl+"/v1/notes/"+t,dataType:"json",type:"put",contentType:"application/json;charset=utf-8",data:JSON.stringify(e)})}}}function o(e){var t;switch(e){case 0:case"101":t="video";break;case 1:case"102":t="document";break;case"2":case"103":t="question";break;case"3":case"104":t="url";break;case"4":case"105":t="vr";break;case"5":t="live";break;case"6":t="panorama"}return t}e=e&&"default"in e?e["default"]:e;var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=function(){function t(n){var a=this;r(this,t),this.model={initialData:e.observable(null).subscribeTo("INITIAL_DATA",this.initWithData,this),cata_type:e.observable("").publishOn("CATA_TYPE"),rightTab:e.observable("3"),breadcrumb:e.observableArray().subscribeTo("BREADCRUMB"),course:e.observable(null).publishOn("COURSE"),ready:e.observable(null).publishOn("COMPONENT_READY"),resize:e.observable(null).publishOn("PLAYER_RESIZE"),state:{hideLeft:e.observable(!1).subscribeTo("HIDELEFT"),hideRight:e.observable(!1).subscribeTo("HIDERIGHT")}},this.config=n.config,this.store={get:function(){return $.ajax({url:a.config.selfUrl+"/v1/business_courses/"+a.config.courseId,dataType:"json",cache:!1})}},this.init();var i=$(".cplay__wrap");this.config.supportTransition=function(e){var t=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var n in t)if(e.style[t[n]]!==undefined)return!0;return!1}(i[0]),this.config.supportTransition&&i.on("transitionend webkitTransitionEnd msTransitionEnd otransitionend oTransitionEnd",function(){a.model.resize({})}),EventDispatcher.addEventListener("onExamExit",function(e){"main"===e.data.context&&this.goToDetail()}.bind(this))}return t.prototype.init=function(){var e=this;this.store.get().done(function(t){e.model.course(t),e.config.contextId=(t.context_id?t.context_id+".":"")+"businesscourse_2:"+e.config.courseId,e.model.ready({key:"main",value:!0})})},t.prototype.initWithData=function(e){this.model.cata_type(e.cata_type||"0")},t.prototype.switchLeftSide=function(e){this.model.cata_type(e)},t.prototype.switchRightSide=function(e){this.model.rightTab(e)},t.prototype.toggleLeft=function(){var e=this,t=this.model.state.hideLeft;if(this.config.supportTransition)t(!t());else{var n=$(".cplay__side-l"),a=$(".cplay__wrap");$.when(n.animate({left:t()?"0":"-286px"},{duration:500,queue:!1}),a.animate({"padding-left":t()?"286px":"0"},{duration:500,queue:!1})).then(function(){t(!t()),e.model.resize({})})}},t.prototype.toggleRight=function(){var e=this,t=this.model.state.hideRight;if(this.config.supportTransition)t(!t());else{var n=$(".cplay__side-r"),a=$(".cplay__wrap");$.when(n.animate({right:t()?"0":"-360px"},{duration:500,queue:!1}),a.animate({"padding-right":t()?"360px":"0"},{duration:500,queue:!1})).then(function(){t(!t()),e.model.resize({})})}},t.prototype.returnDetail=function(){if(window.isAnswering){var e={type:"onLinkClick",data:{context:"main",info:""}};EventDispatcher.dispatchEvent(e)}else this.goToDetail()},t.prototype.goToDetail=function(){location.href=this.config.selfUrl+"/"+this.config.projectCode+"/course/"+this.config.courseId},t}();e.components.register("x-course-learn",{viewModel:l,template:'<div class="cplay__header" data-bind="if:model.course()">\r\n    <a class="cplay__btn-back" href="javascript:;" data-bind="click:returnDetail.bind($component)">\r\n        <i class="xcl-icon-left"></i>\r\n        <span data-bind="translate:{\'key\':\'courseLearn.main.returnDetail\'}">返回课程主页</span>\r\n    </a>\r\n    <h1 class="cplay__header-title" data-bind="text:model.course().title"></h1>\r\n</div>\r\n\r\n\x3c!--\r\n    左侧收起时，加类名 close-left\r\n    右侧收起时，加类名 close-right\r\n--\x3e\r\n<div class="cplay__wrap" data-bind="css:{\'close-left\':model.state.hideLeft,\'close-right\':model.state.hideRight}">\r\n    <div class="cplay__side-l">\r\n        <div class="cplay__tab--menu">\r\n            \x3c!-- 靠右用pos-right， 靠左用pos-left (圆角的区别) --\x3e\r\n            <div class="cplay__btn-side pos-left">\r\n                <a href="javascript:;" class="menu-tab"\r\n                   data-bind="css:{\'state-on\':model.cata_type()==\'0\'},click:switchLeftSide.bind($component,\'0\')">\r\n                    <span class="menu-tab-txt" data-bind="translate:{\'key\':\'courseLearn.main.chapter\'}">章节</span>\r\n                </a>\r\n                <a href="javascript:;" class="menu-tab"\r\n                   data-bind="css:{\'state-on\':model.cata_type()==\'1\'},click:switchLeftSide.bind($component,\'1\')">\r\n                    <span class="menu-tab-txt" data-bind="translate:{\'key\':\'courseLearn.main.knowledge\'}">知识点</span>\r\n                </a>\r\n                <a class="menu-btn" href="javascript:;" data-bind="click:toggleLeft">\r\n                    <i class="xcl-icon-left"\r\n                       data-bind="css:{\'xcl-icon-left\':!model.state.hideLeft(),\'xcl-icon-right\':model.state.hideLeft}"></i>\r\n                </a>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 课程目录 --\x3e\r\n        <div class="cplay__chapter_box">\r\n            <div class="cplay__chapter">\r\n                <div data-bind="component:{\'name\':\'x-course-learn-catalog\',\'params\':{\'config\':$root.config}},visible:model.cata_type()==\'0\'"></div>\r\n                <div data-bind="component:{\'name\':\'x-course-learn-knowledge\',\'params\':{\'config\':$root.config}},visible:model.cata_type()==\'1\'"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="cplay__content">\r\n        <div class="cplay__content--title" data-bind="foreach:model.breadcrumb">\r\n            <i class="xcl-icon-right" data-bind="visible:$index()>0"></i>\r\n            \x3c!-- 有后续子集，才会出现 --\x3e\r\n            <span class="title-txt" data-bind="html:$data"></span>\r\n        </div>\r\n        \x3c!-- 资源tab --\x3e\r\n        <div data-bind="component:{\'name\':\'x-course-learn-resource\',\'params\':{\'config\':$root.config}}"></div>\r\n        \x3c!-- 资源播放区 --\x3e\r\n        <div data-bind="component:{\'name\':\'x-course-learn-player\',\'params\':{\'config\':$root.config}}"></div>\r\n    </div>\r\n\r\n    \x3c!-- 主内容右侧 --\x3e\r\n    <div class="cplay__side-r">\r\n        <div class="cplay__other--wrap">\r\n            \x3c!-- <div data-bind="component:{\'name\':\'x-course-learn-question\',\'params\':{\'config\':$root.config}},if:model.rightTab()==\'1\'"></div>--\x3e\r\n            \x3c!-- <div data-bind="component:{\'name\':\'x-course-learn-attachment\',\'params\':{\'config\':$root.config}},if:model.rightTab()==\'2\'"></div>--\x3e\r\n            <div data-bind="component:{\'name\':\'x-course-learn-note\',\'params\':{\'config\':$root.config}}"></div>\r\n        </div>\r\n        \x3c!-- 按钮 --\x3e\r\n        <div class="cplay__tab--other">\r\n            \x3c!--<div class="cplay__btn-side pos-right">\r\n                <a href="javascript:;" class="menu-tab"\r\n                   data-bind="click:switchRightSide.bind($component,\'1\'),css:{\'state-on\':model.rightTab()==\'1\'}">\r\n                    <i class="icon-tab xcl-icon-ask"></i>\r\n                </a>\r\n            </div>\r\n            <div class="cplay__btn-side pos-right">\r\n                <a href="javascript:;" class="menu-tab"\r\n                   data-bind="click:switchRightSide.bind($component,\'2\'),css:{\'state-on\':model.rightTab()==\'2\'}">\r\n                    <i class="icon-tab xcl-icon-attachment"></i>\r\n                </a>\r\n            </div>--\x3e\r\n            <div class="cplay__btn-side pos-right">\r\n                <a href="javascript:;" class="menu-tab"\r\n                   data-bind="click:switchRightSide.bind($component,\'3\'),css:{\'state-on\':model.rightTab()==\'3\'}">\r\n                    <i class="icon-tab xcl-icon-note"></i>\r\n                </a>\r\n                <a class="menu-btn" href="javascript:;" data-bind="click:toggleRight">\r\n                    <i class="xcl-icon-right"\r\n                       data-bind="css:{\'xcl-icon-left\':model.state.hideRight,\'xcl-icon-right\':!model.state.hideRight()}"></i>\r\n                </a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\x3c!--ko if:courseStatusCode != 10--\x3e\r\n<div class="cplay__buy-tip" data-bind="translate: { key: \'courseLearn.player.buyTip\' }"></div>\r\n\x3c!--/ko--\x3e'});var d=e.utils,c=function(){function t(n){var a=this;r(this,t),this.model={initialData:e.observable(null).subscribeTo("INITIAL_DATA",this.initWithData,this),catalog:e.observable(null),course:e.observable(null).subscribeTo("COURSE"),cata_id:e.observable("").publishOn("CATA_ID"),lesson_id:e.observable(""),breadcrumb:e.observableArray().publishOn("BREADCRUMB"),contextId:e.observable("").publishOn("CONTEXT_ID"),resourceFilter:e.observable(null).publishOn("RESOURCE_FILTER").subscribeTo("RESOURCE_FILTER",this.resourceFilterModify,this),route:e.observable("").publishOn("ROUTE"),ready:e.observable(null).publishOn("COMPONENT_READY")},this.config=n.config,this.store={get:function(){return $.ajax({url:a.config.selfUrl+"/v1/business_courses/"+a.config.courseId+"/catalogs",dataType:"json",cache:!1})}},this.init()}return t.prototype.init=function(){var e=this;$("body").append('<script id="catalog-lesson-item" type="text/html">\r\n    <li class="sub-item" data-bind="click:$component.getResources.bind($component)">\r\n        <span class="item-txt" data-bind="css:{\'active\': $data.id == $component.model.lesson_id()}">\r\n            <em data-bind="html:name"></em>\r\n        </span>\r\n    </li>\r\n<\/script>\r\n<script id="catalog-tree-item" type="text/html">\r\n    <li class="sub-item" data-bind="attr:{\'title\':name},css:{\'open\':isOpen}">\r\n        <a class="icon-toggle" href="javascript:;"\r\n           data-bind="click:$component.toggleTree.bind($component),visible:children.length || lessons.length > 1">\r\n            <i class="xcl-icon-right" data-bind="css:{\'xcl-icon-down\':isOpen,\'xcl-icon-right\':!isOpen()}"></i>\r\n        </a>\r\n        <span class="item-txt" data-bind="click:$component.getResourcesByCatalog.bind($component),css:{\'active\':lessons.length == 1 && lessons[0].id == $component.model.lesson_id()}">\r\n            <em data-bind="html:name"></em>\r\n        </span>\r\n        <ul class="list level-2">\r\n            \x3c!--ko foreach:children--\x3e\r\n                \x3c!--ko template: { \'name\': \'catalog-tree-item\', \'data\': $data }--\x3e\x3c!--/ko--\x3e\r\n            \x3c!--/ko--\x3e\r\n            \x3c!--ko if:lessons.length > 1--\x3e\r\n                \x3c!--ko foreach:lessons--\x3e\r\n                    \x3c!--ko template: { \'name\': \'catalog-lesson-item\', \'data\': $data }--\x3e\x3c!--/ko--\x3e\r\n                \x3c!--/ko--\x3e\r\n            \x3c!--/ko--\x3e\r\n        </ul>\r\n    </li>\r\n<\/script>'),this.store.get().done(function(t){e.model.catalog(e.formatCatalog(t)),e.model.ready({key:"catalog",value:!0})}),EventDispatcher.addEventListener("onExamExit",function(e){"catalog"===e.data.context&&this.changeResources(e.data.info)}.bind(this))},t.prototype.initWithData=function(e){if(e&&"0"==e.cata_type){var t=e.cata_id,n=this.routes;if(n&&n.length){if(t)for(var a=0;a<n.length;a++)for(var i=n[a],s=i[i.length-1].lessons,o=0;o<s.length;o++){var r=s[o];if(r&&r.id==t){this.getResources(r);for(var l=0;l<i.length;l++)i[l].isOpen(!0);return}}var d=n[0],c=d[d.length-1].lessons[0];this.getResources(c);for(var u=0;u<d.length;u++)d[u].isOpen(!0)}else this.model.route("#/")}},t.prototype.formatCatalog=function(t){function n(t){if(t.isOpen=e.observable(!1),a.push(t),t.children)for(var s=0;s<t.children.length;s++)t.children[s]=n(t.children[s]);return t.lessons.length&&i.push(a.concat()),a.length=a.length-1,t}var a=[],i=[];return t=n(t),this.routes=function(e){for(var t={},n=[],a=0;a<e.length;a++){var i=e[a],s=i[i.length-1];t[s.id]||(t[s.id]=i,n.push(i))}return n}(i),t},t.prototype.toggleTree=function(e){e.isOpen(!e.isOpen())},t.prototype.getResourcesByCatalog=function(e){e.lessons&&1==e.lessons.length?this.getResources(e.lessons[0]):this.toggleTree(e)},t.prototype.getResources=function(e){if(window.isAnswering){var t={type:"onLinkClick",data:{context:"catalog",info:e}};EventDispatcher.dispatchEvent(t)}else this.changeResources(e)},t.prototype.changeResources=function(e){this.model.cata_id(e.id),this.model.lesson_id(e.id),this.model.contextId(this.config.contextId+".lesson:"+e.id),this.model.resourceFilter({lesson_id:e.id}),this.formatBreadcrumb(e)},t.prototype.formatBreadcrumb=function(e){for(var t=[],n=this.routes,a=e.id,i=0;i<n.length;i++){for(var s=n[i],o=s[s.length-1].lessons,r=null,l=0;l<o.length;l++){var c=o[l];if(c.id==a){t.push(c.name),r=s;break}}if(r){(t=d.arrayMap(s,function(e){return e.name}).concat(t)).shift();break}}this.model.breadcrumb(t)},t.prototype.resourceFilterModify=function(e){e.knowledge_id&&this.model.lesson_id("")},t}();e.components.register("x-course-learn-catalog",{viewModel:c,template:'<div class="dlist">\r\n    <div class="cata-header" data-bind="text:model.course()&&model.course().title,attr:{\'title\':model.course()&&model.course().title}"></div>\r\n    \x3c!--ko foreach: model.catalog() && model.catalog().children--\x3e\r\n    <div class="cata-list" data-bind="css:{\'open\':isOpen}">\r\n        <a class="icon-toggle" href="javascript:;"\r\n           data-bind="click:$component.toggleTree.bind($component),visible:children.length || lessons.length > 1">\r\n            <i class="xcl-icon-right" data-bind="css:{\'xcl-icon-down\':isOpen,\'xcl-icon-right\':!isOpen()}"></i>\r\n        </a>\r\n        <span class="d-item"\r\n              data-bind="html:name,attr:{\'title\':name},click:$component.getResourcesByCatalog.bind($component),css:{\'active\':lessons.length == 1 && lessons[0].id == $component.model.lesson_id()}"></span>\r\n        <ul class="list level-2">\r\n            \x3c!--ko foreach:children--\x3e\r\n                \x3c!--ko template: { \'name\': \'catalog-tree-item\', \'data\': $data }--\x3e\x3c!--/ko--\x3e\r\n            \x3c!--/ko--\x3e\r\n            \x3c!--ko if:lessons.length>1--\x3e\r\n                \x3c!--ko foreach:lessons--\x3e\r\n                    \x3c!--ko template: { \'name\': \'catalog-lesson-item\', \'data\': $data }--\x3e\x3c!--/ko--\x3e\r\n                \x3c!--/ko--\x3e\r\n            \x3c!--/ko--\x3e\r\n        </ul>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n</div>\r\n<div class="course__no-menu" data-bind="translate:{\'key\':\'courseLearn.catalog.notFound\'},visible:model.ready() && !model.catalog().children.length">\r\n    没有找到目录\r\n</div>'});var u=function(){function t(n){var a=this;r(this,t),this.model={initialData:e.observable(null).subscribeTo("INITIAL_DATA",this.initWithData,this),knowledge:e.observableArray(),selectKnowledge:e.observable(null),cata_id:e.observable("").publishOn("CATA_ID"),knowledge_id:e.observable(""),breadcrumb:e.observableArray().publishOn("BREADCRUMB"),contextId:e.observable("").publishOn("CONTEXT_ID"),resourceFilter:e.observable(null).publishOn("RESOURCE_FILTER").subscribeTo("RESOURCE_FILTER",this.resourceFilterModify,this),route:e.observable("").publishOn("ROUTE"),ready:e.observable(null).publishOn("COMPONENT_READY")},this.config=n.config,this.store={get:function(){return $.ajax({url:a.config.selfUrl+"/v1/business_courses/"+a.config.courseId+"/knowledges",dataType:"json",cache:!1})}},this.init()}return t.prototype.init=function(){var e=this;$("body").append('<script id="knowledge-tree-item" type="text/html">\r\n    <li class="sub-item" data-bind="attr:{\'title\':name},css:{\'open\':isOpen}">\r\n        <a class="icon-toggle" href="javascript:;"\r\n           data-bind="click:$component.toggleTree.bind($component),visible:children.length">\r\n            <i class="xcl-icon-right" data-bind="css:{\'xcl-icon-down\':isOpen,\'xcl-icon-right\':!isOpen()}"></i>\r\n        </a>\r\n        <span class="item-txt"\r\n              data-bind="click:$component.getResources.bind($component),css:{\'active\':id == $component.model.knowledge_id()}">\r\n            <em data-bind="html:title"></em>\r\n        </span>\r\n        <ul class="list level-2">\r\n            \x3c!--ko foreach:children--\x3e\r\n            \x3c!--ko template: { \'name\': \'knowledge-tree-item\', \'data\': $data }--\x3e\x3c!--/ko--\x3e\r\n            \x3c!--/ko--\x3e\r\n        </ul>\r\n    </li>\r\n<\/script>'),this.store.get().done(function(t){e.model.knowledge(e.formatKnowledge(t)),e.model.ready({key:"knowledge",value:!0})}),EventDispatcher.addEventListener("onExamExit",function(e){"knowledge"===e.data.context&&this.changeResources(e.data.info)}.bind(this))},t.prototype.initWithData=function(e){if(e&&"1"==e.cata_type){var t=e.cata_id,n=this.knowledgeMap,a=n.idMap,i=n.knowledgeIdMap,s=this.model.knowledge();if(s&&s.length){if(t){var o=a[t];o&&(!function r(e){e.isOpen(!0);var t=i[e.parent_knowledge_id];if(t)for(var n=0;n<t.length;n++)if(t[n].lesson_id==o.lesson_id){r(t[n]);break}}(o),this.getResources(o))}}else this.model.route("#/"),this.model.ready({key:"knowledge",value:!0,call:"refresh"})}},t.prototype.formatKnowledge=function(t){function n(e,t,n,a){for(var i=0;i<t.length;i++)if(e[a]==t[i][n])return t[i];return null}for(var a={},i={},s={},o=[],r=0;r<t.length;r++)a[t[r].id]=t[r],i[t[r].knowledge_id]=i[t[r].knowledge_id]||[],i[t[r].knowledge_id].push(t[r]),s[t[r].lesson_id]=s[t[r].lesson_id]||[],s[t[r].lesson_id].push(t[r]);s=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({lesson_id:n,knowledge:e[n]});return t}(s);for(var l=0;l<s.length;l++)o=o.concat(function(t,a,i){for(var s=[],o={},r=void 0,l=void 0,d=0,c=t.length;d<c;d++)o[(r=t[d])[a]]=r,o[r[a]].children=[],o[r[a]].isOpen=e.observable(!1);for(var u in o)o.hasOwnProperty(u)&&(n(l=o[u],t,a,i)?o[l[i]].children.push(l):s.push(l));return s}(s[l].knowledge,"knowledge_id","parent_knowledge_id"));return this.knowledgeMap={idMap:a,knowledgeIdMap:i,lessonIdMap:s},o},t.prototype.toggleTree=function(e){e.isOpen(!e.isOpen())},t.prototype.getResources=function(e){if(window.isAnswering){var t={type:"onLinkClick",data:{context:"knowledge",info:e}};EventDispatcher.dispatchEvent(t)}else this.changeResources(e)},t.prototype.changeResources=function(e){this.model.knowledge_id(e.id),this.model.cata_id(e.id),this.model.selectKnowledge(e),this.model.contextId(this.config.contextId+".lesson:"+e.lesson_id),this.model.resourceFilter({lesson_id:e.lesson_id,knowledge_id:e.knowledge_id}),this.formatBreadcrumb(e)},t.prototype.formatBreadcrumb=function(e){function t(e){n.unshift(e.title);var a=o[e.parent_knowledge_id];if(a)for(var i=0;i<a.length;i++)if(a[i].lesson_id==r.lesson_id){t(a[i]);break}}var n=[],a=e.id,i=this.knowledgeMap,s=i.idMap,o=i.knowledgeIdMap,r=s[a];r&&t(r),this.model.breadcrumb(n)},t.prototype.resourceFilterModify=function(e){e.knowledge_id||this.model.knowledge_id("")},t}();e.components.register("x-course-learn-knowledge",{viewModel:u,template:'<div class="dlist">\r\n    \x3c!--ko foreach:model.knowledge--\x3e\r\n    <div class="cata-list" data-bind="css:{\'open\':isOpen}">\r\n        <a class="icon-toggle" href="javascript:;"\r\n           data-bind="click:$component.toggleTree.bind($component),visible:children.length">\r\n            <i class="xcl-icon-right" data-bind="css:{\'xcl-icon-down\':isOpen,\'xcl-icon-right\':!isOpen()}"></i>\r\n        </a>\r\n        <span class="d-item"\r\n              data-bind="html:title,attr:{\'title\':name},click:$component.getResources.bind($component),css:{\'active\':id == $component.model.knowledge_id()}"></span>\r\n        <ul class="list level-2">\r\n            \x3c!--ko foreach:children--\x3e\r\n                \x3c!--ko template: { \'name\': \'knowledge-tree-item\', \'data\': $data }--\x3e\x3c!--/ko--\x3e\r\n            \x3c!--/ko--\x3e\r\n        </ul>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n</div>\r\n<div class="course__no-menu" data-bind="translate:{\'key\':\'courseLearn.knowledge.notFound\'},visible:model.ready() && !model.knowledge().length">\r\n    没有找到知识点\r\n</div>'});var p=i18nHelper.getKeyValue,v=function(){function t(n){var a=this;r(this,t),this.model={initialData:e.observable(null).subscribeTo("INITIAL_DATA"),resourceFilter:e.observable("").subscribeTo("RESOURCE_FILTER",this.resourceFilterModify,this),resources:e.observableArray(),resource:e.observable("").publishOn("RESOURCE"),ready:e.observable(null).publishOn("COMPONENT_READY"),resourceStatus:e.observable(0).subscribeTo("RESOURCE_STATUS"),ICON_CLASS_MAP:{0:"icon-res-empty",1:"icon-res-half",2:"icon-res-finish"}},this.config=n.config,this.store={get:function(e,t){return $.ajax({url:a.config.selfUrl+"/v1/business_courses/"+a.config.courseId+"/lessons/"+e+"/resources",data:t,dataType:"json",cache:!1})}},this.STATUS_CLASS_MAP={0:"xcl-icon-video",1:"xcl-icon-document",10:"xcl-icon-exam"},this.model.ready({key:"resource",value:!0}),EventDispatcher.addEventListener("onExamExit",function(e){"resource"===e.data.context&&this.changeResource(e.data.info)}.bind(this))}return t.prototype.resourceFilterModify=function(e){var t=this;this.store.get(e.lesson_id,e.knowledge_id&&{knowledge_id:e.knowledge_id}).done(function(e){for(var n=0;n<e.length;n++)e[n].iconClass=t.STATUS_CLASS_MAP[e[n].type],e[n].displayData=t.formatDisplayData(e[n]);t.model.resources(e);var a=t.model.initialData();if(e.length){var i=null;if(a){var s=a.resource_id;if(s)for(var o=0;o<e.length;o++)if(e[o].id==s){i=e[o],t.selectResource(e[o]),t.scrollToResource(o);break}t.model.initialData(null)}i||(t.selectResource(e[0]),t.scrollToResource(0))}else t.selectResource(null)})},t.prototype.formatDisplayData=function(e){switch(e.type){case 0:return this.formatDuration(e.resource_data.duration);case 1:return e.resource_data.page_count+" "+p("courseLearn.resource.page");case 10:return""}},t.prototype.formatDuration=function(e){if(!e&&0!==e)return e;var t=~~(e/60/60),n=~~((e-60*t*60)/60),a=~~(e-60*t*60-60*n);return(t>0?(t<10?"0"+t:t)+":":"")+(n<10?"0"+n:n)+":"+(a<10?"0"+a:a)},t.prototype.startScroll=function(e){var t=this,n=$(".cplay__resource--scroller"),a=(n.scrollLeft(),"left"==e?-10:10);window.clearInterval(this.scroller),this.scroller=setInterval(function(){t.scrolling=!0,n.scrollLeft(n.scrollLeft()+a)},10),n.scrollLeft(n.scrollLeft())},t.prototype.endScroll=function(){this.scrolling=!1,window.clearInterval(this.scroller)},t.prototype.scrollToResource=function(e){$(".cplay__resource--scroller").scrollLeft(220*e)},t.prototype.selectResource=function(e){if(window.isAnswering){var t={type:"onLinkClick",data:{context:"resource",info:e}};EventDispatcher.dispatchEvent(t)}else this.changeResource(e)},t.prototype.changeResource=function(e){e&&this.model.resourceStatus(e.status),this.model.resource(e)},t}();e.components.register("x-course-learn-resource",{viewModel:v,template:'<div class="cplay__content--resource" data-bind="visible:model.resources().length">\r\n    <a href="javascript:;" class="cplay__switch-btn btn-left"\r\n       data-bind="event:{\'mousedown\':$component.startScroll.bind($root,\'left\'),\'mouseup\':$component.endScroll.bind($root)}">\r\n        <i class="xcl-icon-triangle-left"></i>\r\n    </a>\r\n    <a href="javascript:;" class="cplay__switch-btn btn-right"\r\n       data-bind="event:{\'mousedown\':$component.startScroll.bind($root,\'right\'),\'mouseup\':$component.endScroll.bind($root)}">\r\n        <i class="xcl-icon-triangle-right"></i>\r\n    </a>\r\n    <div class="cplay__resource--scroller">\r\n        <ul class="cplay__resource--list clearfix"\r\n            data-bind="foreach:model.resources,style:{\'width\':model.resources().length*220 +\'px\'}">\r\n            <li class="cplay__resource--item"\r\n                data-bind="css:{\'state-on\':$data==$component.model.resource()},click:$component.selectResource.bind($component)">\r\n                <p class="cplay__resource--name">\r\n                    <i class="icon-sprite" data-bind="css:$component.model.ICON_CLASS_MAP[$data==$component.model.resource() ? $component.model.resourceStatus() : status]"></i>\r\n                    <span class="name-text" data-bind="text:name"></span>\r\n                </p>\r\n                <p class="cplay__resource--other">\r\n                    <i data-bind="css:iconClass"></i>\r\n                    <span class="other-txt" data-bind="text:displayData"></span>\r\n                    \x3c!--ko if:extra_data && extra_data.exp_config && extra_data.exp_config.exp_type == 1 && courseStatusCode != 10--\x3e\r\n                    <span class="exp-tip" data-bind="translate: { key: \'courseLearn.player.freeTrial\' }"></span>\r\n                    \x3c!--/ko--\x3e\r\n                </p>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>'});var m=function(){function n(a){var i=this;r(this,n);var s=a.data,o=s.contextId,l=s.resource,d=s.initialData;this.resource=l,this.initialData=d,this.contextId=o,this.config=a.config,this.model={RESOURCE_TYPE:{VIDEO:0,DOC:1,EVALUATE:10}},this.setting={apiHost:this.config.selfUrl+"/v1/business_courses/"+this.config.courseId+"/videos",docHost:this.config.selfUrl+"/v1/business_courses/"+this.config.courseId+"/documents",staticHost:this.config.urls.staticUrl+"auxo",swfHost:this.config.urls.staticUrl+"auxo/addins/flowplayer/v1.0.0/",video:{accessToken:"",autoPlay:!0},configs:{clip:{loading:"true"===window.logoLoading},log:{},i18n:i18n.videos,plugins:{controls:{dragDirection:"both",dragTime:0}},dataFilter:t},events:{},plugins:{document:{},question:{},lastPositionContent:{html:"",time:0}}},this.store={getActivity:function(){return $.ajax({url:i.config.selfUrl+"/v1/business_courses/"+i.config.courseId+"/resources/"+i.resource.id+"/activities",dataType:"json",data:{resource_type:i.model.RESOURCE_TYPE.VIDEO},cache:!1})},createSession:function(e){return $.ajax({url:i.config.urls.learningProgressServiceUrl+"/v1/session/videos?context_id="+i.contextId+"&video_id="+i.resource.id,type:"post",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify(e)})},updateSession:function(e,t,n){return $.ajax({url:i.config.urls.learningProgressServiceUrl+"/v1/sessions/"+e+"/videos?mac_body="+t,type:"post",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify(n)})}},this.resourceData={beginPos:0,beginTime:0},this.playerData=e.observable(null).subscribeTo("GET_PLAYER_DATA",this.dispatchPlayerData,this).publishOn("PLAYER_DATA"),this.resize=e.observable(null).subscribeTo("PLAYER_RESIZE",this.resize,this),this.reportQueue=[],this.init()}return n.prototype.dispatchPlayerData=function(){this.playerData({resource:this.resource,currentPos:~~this.player.getTime()})},n.prototype.resize=function(){this.player&&this.player.resize()},n.prototype.init=function(){var e=this;if($(".exp-container").hide(),!this.isExp()&&10!=courseStatusCode)return $(".exp-container").show(),void $(".play-container").hide();userId?$.when(this.initPlayer(),this.initSession()).then(function(t,n){e.sessionId=n}):this.initPlayer()},n.prototype.initPlayer=function(){var e=this,t=$.Deferred(),n=this.config.player[0],a=n.instance||new n.plugin.Video.Player("playerVideo",this.setting);return n.instance=a,this.player=a,this.registerEvent(),this.player.setting.playerConfigs.quatityHost=this.config.selfUrl+"/v1/business_courses/"+this.config.courseId+"/videos/"+this.resource.id+"/urls",this.player.play(this.resource.id).done(function(n){e.player.removeEventListener("onLoad"),e.player.addEventListener("onLoad",function(){e.onLoad(),t.resolve(n)}),e.reportConfig={videoReportInterval:n.Data.VideoReportInterval,VideoReportStatus:n.Data.VideoReportStatus},e.resourceData.beginPos=(e.initialData&&e.initialData.pos?+e.initialData.pos:n.Data.CurrentPos)||0}),t.promise()},n.prototype.registerEvent=function(){var e=this;this.player.removeEventListener("onStart"),this.player.removeEventListener("onSeek"),this.player.removeEventListener("onPause"),this.player.removeEventListener("onResume"),this.player.removeEventListener("onBeforeSeek"),this.player.removeEventListener("onFinish"),this.player.removeEventListener("onFullscreen"),this.player.removeEventListener("onFullscreenExit"),this.player.addEventListener("onStart",function(){e.onStart()}),this.player.addEventListener("onSeek",function(){e.onSeek()}),this.player.addEventListener("onPause",function(){e.onPause()}),this.player.addEventListener("onResume",function(){e.onResume()}),this.player.addEventListener("onBeforeSeek",function(){e.onBeforeSeek()}),this.player.addEventListener("onFinish",function(){e.onFinish()}),this.player.addEventListener("onFullscreen",function(){e.onFullscreen()}),this.player.addEventListener("onFullscreenExit",function(){e.onFullscreenExit()})},n.prototype.initSession=function(){var e=this,t=$.Deferred();return this.store.getActivity().done(function(n){n?t.resolve(n.current_session_id):e.store.createSession().done(function(e){t.resolve(e.id)})}),t.promise()},n.prototype.onLoad=function(){window.console&&console.log("onLoad")},n.prototype.onStart=function(){window.console&&console.log("onStart"),window.console&&console.log(this.resourceData.beginPos),this.stopExpInterval(),this.isExp()&&10!=courseStatusCode&&this.createExpInterval(),this.resourceData.beginTime=~~((new Date).getTime()/1e3),this.resourceData.beginPos&&this.player.seek(this.resourceData.beginPos),this.progress()},n.prototype.onSeek=function(){window.console&&console.log("onSeek")},n.prototype.onPause=function(){window.console&&console.log("onPause"),this.stopProgress()},n.prototype.onResume=function(){window.console&&console.log("onResume"),this.progress()},n.prototype.onBeforeSeek=function(){var e=this;window.console&&console.log("onBeforeSeek"),this.isSeeking||(this.isSeeking=!0,window.setTimeout(function(){e.progress(),e.isSeeking=!1},1500))},n.prototype.onFinish=function(){window.console&&console.log("onFinish"),this.stopProgress(),this.report(!0)},n.prototype.onFullscreen=function(){},n.prototype.onFullscreenExit=function(){},n.prototype.stopProgress=function(){this.progressTimer&&window.clearTimeout(this.progressTimer)},n.prototype.progress=function(){var e=this;this.stopProgress(),this.report().done(function(t){e.reportConfig.VideoReportStatus&&e.reportConfig.videoReportInterval&&(e.progressTimer=setTimeout(function(){e.progress()},1e3*e.reportConfig.videoReportInterval))})},n.prototype.addProgress=function(e){var t=e?this.resource.resource_data.duration:~~this.player.getTime();if(!isNaN(parseInt(t))){var n=~~((new Date).getTime()/1e3),a=this.resourceData.beginPos,i=t;if(a>i){var s=a;a=i,i=s}a===i&&(i=a+1),this.reportQueue.push({ps:a,pe:i,ts:this.resourceData.beginTime,te:n}),this.resourceData.beginTime=n,this.resourceData.beginPos=t}},n.prototype.isExp=function(){return this.resource.extra_data&&this.resource.extra_data.exp_config&&1==this.resource.extra_data.exp_config.exp_type},n.prototype.createExpInterval=function(){window.expIntervalId=window.setInterval($.proxy(function(){this.player.getTime()>=this.resource.extra_data.exp_config.exp_length&&($(".exp-container").show(),$(".player-container").hide(),this.player.pause(),this.stopExpInterval())},this),1e3)},n.prototype.stopExpInterval=function(){window.expIntervalId&&(clearInterval(window.expIntervalId),window.expIntervalId=null)},n.prototype.report=function(e){var t=this;if(!this.config.userId)return $.when(!1);if(this.addProgress(e),!this.reporting){if(!this.reporting&&this.reportQueue.length){var n=this.reportQueue.concat(),a=encodeURIComponent(this.runEncrypt(JSON.stringify(n)));return this.reporting=!0,this.store.updateSession(this.sessionId,a,n).done(function(){t.reportQueue=t.reportQueue.slice(n.length)}).fail(function(){t.player.pause(),t.Toast("不支持插件加速播放",3e3)}).always(function(){t.reporting=!1})}return $.when(!1)}},n.prototype.runEncrypt=function(e){var t=new jsSHA("SHA-256","TEXT");return t.setHMACKey(this.config.mac.mac_key,"TEXT"),t.update(e),t.getHMAC("B64")},n.prototype.Toast=function(e,t){t=isNaN(t)?3e3:t;var n=document.createElement("div");n.innerHTML=e,n.style.cssText="width: 10%;min-width: 100px;opacity: 0.7;height: 50px;color: rgb(255, 255, 255);line-height: 30px;text-align: center;border-radius: 5px;position: fixed;top: 82%;left: 35%;z-index: 999999;background: rgb(0, 0, 0);font-size: 18px;",document.body.appendChild(n),setTimeout(function(){n.style.webkitTransition="-webkit-transform 0.5s ease-in, opacity 0.5s ease-in",n.style.opacity="0",setTimeout(function(){document.body.removeChild(n)},500)},t)},n}();e.components.register("x-course-learn-player-video",{viewModel:m,template:'<div id="playerVideo" class="player-container"></div>'});var h=function(){function t(a){var i=this;r(this,t);var s=a.data,o=s.contextId,l=s.resource,d=s.initialData;this.resource=l,this.initialData=d,this.contextId=o,this.config=a.config,this.model={RESOURCE_TYPE:{VIDEO:0,DOC:1,EVALUATE:10}},this.setting={i18n:i18n.documents,dataFilter:n,Document:{AccessToken:""},Host:this.config.selfUrl+"/v1/business_courses/"+this.config.courseId+"/documents"},this.store={getActivity:function(){return $.ajax({url:i.config.selfUrl+"/v1/business_courses/"+i.config.courseId+"/resources/"+i.resource.id+"/activities",dataType:"json",data:{resource_type:i.model.RESOURCE_TYPE.DOC},cache:!1})},createSession:function(e){return $.ajax({url:i.config.urls.learningProgressServiceUrl+"/v1/session/documents?context_id="+i.contextId+"&document_id="+i.resource.id,type:"post",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify(e)})},updateSession:function(e,t,n){return $.ajax({url:i.config.urls.learningProgressServiceUrl+"/v1/sessions/"+e+"/documents?mac_body="+t,type:"post",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify(n)})}},this.resourceData={beginPos:0,beginTime:0,pageCount:0},this.playerData=e.observable(null).subscribeTo("GET_PLAYER_DATA",this.dispatchPlayerData,this).publishOn("PLAYER_DATA"),this.resize=e.observable(null).subscribeTo("PLAYER_RESIZE",this.resize,this),this.reportQueue=[],this.init()}return t.prototype.dispatchPlayerData=function(){this.playerData({resource:this.resource,currentPos:this.player.getCurrentPage()})},t.prototype.resize=function(){this.player&&this.player.resize()},t.prototype.init=function(){var e=this;if($(".exp-container").hide(),!this.isExp()&&10!=courseStatusCode)return $(".exp-container").show(),void $(".play-container").hide();userId?$.when(this.initPlayer(),this.initSession()).then(function(t,n){e.sessionId=n,e.progress()}):this.initPlayer()},t.prototype.initPlayer=function(){var e=this,t=$.Deferred(),n=this.config.player[1],a=n.instance||new n.plugin.Document.ExtendMain("#playerDocument",this.setting);return n.instance=a,this.player=a,this.player.play(this.resource.id).done(function(n){e.resourceData.beginPos=(e.initialData&&e.initialData.pos&&+e.initialData.pos<=n.PageCount?+e.initialData.pos:n.CurrentPos)||0,"undefined"!=typeof n.Skippable&&0==n.Skippable&&e.player.setBarConfig({skippablePos:n.SkippablePos}),e.player.removeEventListener("onLoad"),e.player.addEventListener("onLoad",function(){e.onLoad(),t.resolve(n),e.registerEvent()})}),t.promise()},t.prototype.registerEvent=function(){var e=this;this.player.removeEventListener("onNumChange"),this.player.removeEventListener("onNext"),this.player.addEventListener("onNumChange",function(){e.onNumChange()}),this.player.addEventListener("onNext",function(){e.onNext()})},t.prototype.onLoad=function(){window.console&&console.log("onLoad"),window.console&&console.log(this.resourceData.beginPos),this.resourceData.beginTime=~~((new Date).getTime()/1e3),this.resourceData.beginPos&&this.player.go(this.resourceData.beginPos)},t.prototype.onNext=function(){window.console&&console.log("onNext")},t.prototype.onNumChange=function(){if(window.console&&console.log("onNumChange"),this.isExp()&&10!=courseStatusCode&&this.player.getCurrentPage()>this.resource.extra_data.exp_config.exp_length)return $(".exp-container").show(),void $(".player-container").hide();this.report()},t.prototype.initSession=function(){var e=this,t=$.Deferred();return this.store.getActivity().done(function(n){n?t.resolve(n.current_session_id):e.store.createSession().done(function(e){t.resolve(e.id)})}),t.promise()},t.prototype.stopProgress=function(){this.progressTimer&&window.clearTimeout(this.progressTimer)},t.prototype.progress=function(){var e=this;this.stopProgress(),this.report().done(function(t){e.progressTimer=setTimeout(function(){e.progress()},1e4)})},t.prototype.addProgress=function(){var e=this.player.getCurrentPage();if(!isNaN(parseInt(e))){var t=~~((new Date).getTime()/1e3),n=this.resourceData.beginPos==e?this.resourceData.beginPos-1:this.resourceData.beginPos,a=e;if(n>a){var i=n;n=a,a=i}this.reportQueue.push({ps:n,pe:a,ts:this.resourceData.beginTime,te:t}),this.resourceData.beginTime=t,this.resourceData.beginPos=e}},t.prototype.isExp=function(){return this.resource.extra_data&&this.resource.extra_data.exp_config&&1==this.resource.extra_data.exp_config.exp_type},t.prototype.report=function(){var e=this;if(!this.config.userId)return $.when(!1);if(this.addProgress(),!this.reporting){if(!this.reporting&&this.reportQueue.length){var t=this.reportQueue.concat(),n=encodeURIComponent(this.runEncrypt(JSON.stringify(t)));return this.reporting=!0,this.store.updateSession(this.sessionId,n,t).done(function(){e.reportQueue=e.reportQueue.slice(t.length)}).always(function(){e.reporting=!1})}return $.when(!1)}},t.prototype.runEncrypt=function(e){var t=new jsSHA("SHA-256","TEXT");return t.setHMACKey(this.config.mac.mac_key,"TEXT"),t.update(e),t.getHMAC("B64")},t}();e.components.register("x-course-learn-player-doc",{viewModel:h,template:'<div id="playerDocument" class="player-container"></div>'});var b=function(){function t(n){var a=this;r(this,t);var i=n.data,s=i.resource,o=i.initialData;this.resource=s,this.initialData=o,this.model={RESOURCE_TYPE:{VIDEO:0,DOC:1,EVALUATE:10},RESOURCE_STATUS:{UNDO:0,DOING:1,DONE:2},resourceId:this.resource.id,lessonId:n.resourceFilter.lesson_id,knowledge_id:n.resourceFilter.knowledge_id,isStartBtnDisabled:e.observable(!1),isShowAnswer:e.observable(!1),isAnswerExp:e.observable(!1),evaluatingInfo:e.observable(null),activities:e.observable(null),popTimeZero:e.observable(!1),resourceStatus:e.observable(0).publishOn("RESOURCE_STATUS")},this.config=n.config,this.store={getEvaluatingInfo:function(){var e={};return a.model.lessonId&&(e.lesson_id=a.model.lessonId),a.model.knowledge_id&&(e.knowledge_id=a.model.knowledge_id),$.ajax({url:"/v1/business_courses/"+a.config.courseId+"/evaluates/"+a.resource.id,dataType:"json",data:e,cache:!1})},getActivities:function(){var e={resource_type:a.model.RESOURCE_TYPE.EVALUATE,need_extra_data:!0,lesson_id:a.model.lessonId};if(window.answerSubmitTime){var t=0,n=$.format.toBrowserTimeZone(Date.ajustTimeString(window.answerSubmitTime),"yyyy/MM/dd HH:mm:ss");(t=new Date(n).getTime())>0&&(e.timestamp=t),window.answerSubmitTime=""}return $.ajax({url:"/v1/business_courses/"+a.config.courseId+"/resources/"+a.resource.id+"/activities",dataType:"json",data:e,cache:!1})}},this.init()}return t.prototype.init=function(){var e=this;if($(".exp-container").hide(),10!=courseStatusCode)return $(".exp-container").show(),void $(".play-container").hide();this.store.getEvaluatingInfo().done(function(t){e.model.evaluatingInfo(t),userId&&e.store.getActivities().done(function(t){if(t)e.model.activities(t),!0===e.model.activities().extra_data.last_pass&&e.model.activities().extra_data.next_start_time&&e.model.activities().extra_data.system_current_time&&e.model.activities().extra_data.next_start_time>e.model.activities().extra_data.system_current_time&&e.model.isStartBtnDisabled(!0);else{var n={status:0};"MEMORY"===e.model.evaluatingInfo().rule_type&&(n.extra_data={pass_times:0,last_pass:!1}),e.model.activities(n)}e.model.resourceStatus(e.model.activities().status)})})},t.prototype.showAnswer=function(e){"QUICK"!==this.model.evaluatingInfo().rule_type||0!==this.model.evaluatingInfo().rule_value.duration?!0!==this.model.isStartBtnDisabled()&&(e&&this.model.isAnswerExp(!0),this.model.isShowAnswer(!0)):this.model.popTimeZero(!0)},t.prototype.hideTimeZeroPop=function(){this.model.popTimeZero(!1)},t.prototype.dateFormat=function(e){return $.format.toBrowserTimeZone(e,"yyyy/MM/dd HH:mm:ss")},t}();e.components.register("x-course-learn-player-evaluating",{viewModel:b,template:'\x3c!--ko if:model.evaluatingInfo() && model.activities() && model.isShowAnswer()===false--\x3e\r\n    <div class="n-evaluate result">\r\n    <div class="icon-flag"></div>\r\n    <h2 class="result-tit" data-bind="text:model.evaluatingInfo().title"></h2>\r\n    <div class="result-statu ing" data-bind="visible:model.activities().status===model.RESOURCE_STATUS.UNDO"></div>\r\n    <div class="result-statu success" data-bind="visible:model.activities().status===model.RESOURCE_STATUS.DONE, translate:{\'key\':\'courseLearn.evaluating.passed\'}">达标</div>\r\n    <div class="result-statu failed" data-bind="visible:model.activities().status===model.RESOURCE_STATUS.DOING, translate:{\'key\':\'courseLearn.evaluating.failed\'}">未达标</div>\r\n    \x3c!-- 记忆曲线模式 --\x3e\r\n    <div data-bind="if: model.evaluatingInfo().rule_type===\'MEMORY\'">\r\n        <div class="result-step-list">\r\n            \x3c!--ko if:model.activities().extra_data.last_pass !==undefined && model.activities().extra_data.last_pass!==null--\x3e\r\n            <span class="result-step" data-bind="css:{\'success\': model.activities().extra_data.pass_times>0, \'failed\':model.activities().extra_data.pass_times===0 && model.activities().extra_data.last_pass===false && model.activities().status===model.RESOURCE_STATUS.DOING, \'ing\': model.activities().extra_data.pass_times===0 && model.activities().status===model.RESOURCE_STATUS.UNDO}, translate:{\'key\':\'courseLearn.evaluating.firstEvaluating\'}">第一次评测</span>\r\n            <span class="result-step" data-bind="css:{\'success\': model.activities().extra_data.pass_times>1, \'failed\':model.activities().extra_data.pass_times===1 && model.activities().extra_data.last_pass===false, \'ing\': model.activities().extra_data.pass_times===1 && model.activities().extra_data.last_pass===true}, translate:{\'key\':\'courseLearn.evaluating.secondEvaluating\'}">第二次评测</span>\r\n            <span class="result-step" data-bind="css:{\'success\': model.activities().extra_data.pass_times>2, \'failed\':model.activities().extra_data.pass_times===2 && model.activities().extra_data.last_pass===false, \'ing\': model.activities().extra_data.pass_times===2 && model.activities().extra_data.last_pass===true}, translate:{\'key\':\'courseLearn.evaluating.thirdEvaluating\'}">第三次评测</span>\r\n            \x3c!--/ko--\x3e\r\n            \x3c!--ko if:model.activities().extra_data.last_pass ===undefined || model.activities().extra_data.last_pass===null--\x3e\r\n            <span class="result-step" data-bind="translate:{\'key\':\'courseLearn.evaluating.firstEvaluating\'}">第一次评测</span>\r\n            <span class="result-step" data-bind="translate:{\'key\':\'courseLearn.evaluating.secondEvaluating\'}">第二次评测</span>\r\n            <span class="result-step" data-bind="translate:{\'key\':\'courseLearn.evaluating.thirdEvaluating\'}">第三次评测</span>\r\n            \x3c!--/ko--\x3e\r\n        </div>\r\n        \x3c!-- 评测前 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.UNDO">\r\n            <ul class="result-info">\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.questionCount\'}--\x3e 评测题数\x3c!--/ko--\x3e(<span class="highlight" data-bind="text:model.evaluatingInfo().rule_value.question_count"></span>)</li>\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e(<span class="highlight">\x3c!-- ko translate:{key:\'courseLearn.evaluating.accuracy\'}--\x3e 正确率\x3c!--/ko--\x3e\x3c!--ko text:model.evaluatingInfo().rule_value.qualified_rate--\x3e\x3c!--/ko--\x3e%</span>)</li>\r\n                <li><span data-bind="translate:{\'key\':\'courseLearn.evaluating.evaluatingCount\'}">评测次数</span>(<span class="highlight">3</span>)</li>\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.quizTime\'}--\x3e 答题时间\x3c!--/ko--\x3e(<span class="highlight" data-bind="translate:{\'key\':\'courseLearn.evaluating.unlimited\'}">不限</span>)</li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn"  data-bind="click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.beginToAnswer\'}">开始作答</a>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 未达标 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.DOING">\r\n            \x3c!-- 上一次评测没有通过 --\x3e\r\n            \x3c!--ko if:model.activities().extra_data.last_pass !==undefined && model.activities().extra_data.last_pass!==null && model.activities().extra_data.last_pass===false--\x3e\r\n                <div class="result-btn-item">\r\n                    <a href="javascript:;" class="ui-btn" data-bind="click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.reEvaluating\'}">重新评测</a>\r\n                </div>\r\n            \x3c!--/ko--\x3e\r\n            \x3c!-- 上一次评测有通过 --\x3e\r\n            \x3c!--ko if:model.activities().extra_data.last_pass !==undefined && model.activities().extra_data.last_pass!==null && model.activities().extra_data.last_pass===true--\x3e\r\n                \x3c!-- 未到评测开放时间 --\x3e\r\n                <div data-bind="if: model.isStartBtnDisabled()===true">\r\n                    <ul class="result-info">\r\n                        <li><span data-bind="translate:{\'key\':\'courseLearn.evaluating.nextEvaluatingOpenTime\'}">下次评测开放时间</span>：<span class="highlight" data-bind="text:dateFormat(model.activities().extra_data.next_start_time)"></span></li>\r\n                    </ul>\r\n                </div>\r\n                <div class="result-btn-item">\r\n                    <a href="javascript:;" class="ui-btn" data-bind="css:{\'disabled\': model.isStartBtnDisabled()===true}, click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.beginToAnswer\'}">开始作答</a>\r\n                </div>\r\n            \x3c!--/ko--\x3e\r\n            \x3c!--ko if:model.activities().extra_data.last_pass ===undefined || model.activities().extra_data.last_pass===null--\x3e\r\n                <div class="result-btn-item">\r\n                    <a href="javascript:;" class="ui-btn" data-bind="css:{\'disabled\': model.isStartBtnDisabled()===true}, click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.beginToAnswer\'}">开始作答</a>\r\n                </div>\r\n            \x3c!--/ko--\x3e\r\n        </div>\r\n        \x3c!-- 已达标 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.DONE">\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn2" data-bind="click:showAnswer.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \x3c!-- 连续答题模式 --\x3e\r\n    <div data-bind="if: model.evaluatingInfo().rule_type===\'CONTINUOUS\'">\r\n        \x3c!-- 评测前 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.UNDO">\r\n            <ul class="result-info">\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e(<span class="highlight" data-bind="translate: { key: \'courseLearn.evaluating.continuousRightCount\', properties:{ \'continuousRightCount\': model.evaluatingInfo().rule_value.continuous_right_count }}"></span>)</li>\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.quizTime\'}--\x3e 答题时间\x3c!--/ko--\x3e(<span class="highlight" data-bind="translate:{\'key\':\'courseLearn.evaluating.unlimited\'}">不限</span>)</li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn" data-bind="click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.beginToAnswer\'}">开始作答</a>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 未达标 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.DOING">\r\n            <div class="result-step-list">\r\n                <span class="success result-step"><span class="highlight" data-bind="translate: { key: \'courseLearn.evaluating.hightlightContinuousRightCount\', properties:{ \'continuousRightCount\': model.activities().extra_data.continuous_right_count || 0 }}"></span></span>\r\n            </div>\r\n            <ul class="result-info">\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e：<span data-bind="translate: { key: \'courseLearn.evaluating.continuousRightCount\', properties:{ \'continuousRightCount\': model.evaluatingInfo().rule_value.continuous_right_count }}"></span></li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn2" data-bind="click:showAnswer.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</a>\r\n                <a href="javascript:;" class="ui-btn" data-bind="click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.reEvaluating\'}">重新评测</a>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 已达标 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.DONE">\r\n            <div class="result-step-list">\r\n                <span class="success result-step"><span class="highlight" data-bind="translate: { key: \'courseLearn.evaluating.hightlightContinuousRightCount\', properties:{ \'continuousRightCount\': model.activities().extra_data.continuous_right_count || 0 }}"></span></span>\r\n            </div>\r\n            <ul class="result-info">\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e：<span data-bind="translate: { key: \'courseLearn.evaluating.continuousRightCount\', properties:{ \'continuousRightCount\': model.evaluatingInfo().rule_value.continuous_right_count }}"></span></li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn2" data-bind="click:showAnswer.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \x3c!-- 快速答题模式 --\x3e\r\n    <div data-bind="if: model.evaluatingInfo().rule_type===\'QUICK\'">\r\n        \x3c!-- 评测前 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.UNDO">\r\n            <ul class="result-info">\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.questionCount\'}--\x3e 评测题数\x3c!--/ko--\x3e(<span class="highlight" data-bind="text:model.evaluatingInfo().rule_value.question_count"></span>)</li>\r\n                <li>\r\n                    \x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e(<span class="highlight" data-bind="if: model.evaluatingInfo().rule_value.qualified_rate"><span data-bind="translate:{\'key\':\'courseLearn.evaluating.accuracy\'}">正确率</span><span data-bind="text:model.evaluatingInfo().rule_value.qualified_rate"></span>%</span><span class="highlight" data-bind="if: model.evaluatingInfo().rule_value.right_count"><span data-bind="translate: { key: \'courseLearn.evaluating.rightCount\', properties:{ \'rightCount\': model.evaluatingInfo().rule_value.right_count }}"></span></span><span class="highlight" data-bind="if: model.evaluatingInfo().rule_value.qualified_score"><span data-bind="text:model.evaluatingInfo().rule_value.qualified_score"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>)\r\n                </li>\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.quizTime\'}--\x3e 答题时间\x3c!--/ko--\x3e(<span class="highlight" data-bind="text:model.evaluatingInfo().rule_value.duration"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.minutes\'}">分钟</span>)</li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn" data-bind="click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.beginToAnswer\'}">开始作答</a>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 未达标 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.DOING">\r\n            <div class="result-step-list">\r\n                <ul class="scole-item">\r\n                    <li>\r\n                        <p class="value"><span data-bind="text:model.activities().extra_data.right_count || 0"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.questions\'}">题</span></p>\r\n                        <p class="label" data-bind="translate:{\'key\':\'courseLearn.evaluating.answerCorrect\'}">答对</p>\r\n                    </li>\r\n                    <li>\r\n                        <p class="value"><span data-bind="text:model.activities().extra_data.score || 0"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></p>\r\n                        <p class="label" data-bind="translate:{\'key\':\'courseLearn.evaluating.getScore\'}">得分</p>\r\n                    </li>\r\n                    <li>\r\n                        <p class="value"><span data-bind="text:model.activities().extra_data.accuracy || 0"></span>%</p>\r\n                        <p class="label"><span data-bind="translate:{\'key\':\'courseLearn.evaluating.accuracy\'}">正确率</span></p>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <ul class="result-info">\r\n                <li>\r\n                    \x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e:\r\n                    <span data-bind="if: model.evaluatingInfo().rule_value.qualified_rate"><span data-bind="translate:{\'key\':\'courseLearn.evaluating.accuracy\'}">正确率</span><span data-bind="text:model.evaluatingInfo().rule_value.qualified_rate"></span>%</span>\r\n                    <span data-bind="if: model.evaluatingInfo().rule_value.right_count"><span data-bind="translate:{\'key\':\'courseLearn.evaluating.answerCorrect\'}">答对</span><span data-bind="text:model.evaluatingInfo().rule_value.right_count"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.questions\'}">题</span></span>\r\n                    <span data-bind="if: model.evaluatingInfo().rule_value.qualified_score"><span data-bind="text:model.evaluatingInfo().rule_value.qualified_score"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>\r\n                </li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn2" data-bind="click:showAnswer.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</a>\r\n                <a href="javascript:;" class="ui-btn" data-bind="click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.reEvaluating\'}">重新评测</a>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 已达标 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.DONE">\r\n            <div class="result-step-list">\r\n                <ul class="scole-item">\r\n                    <li>\r\n                        <p class="value"><span data-bind="text:model.activities().extra_data.right_count || 0"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.questions\'}">题</span></p>\r\n                        <p class="label" data-bind="translate:{\'key\':\'courseLearn.evaluating.answerCorrect\'}">答对</p>\r\n                    </li>\r\n                    <li>\r\n                        <p class="value"><span data-bind="text:model.activities().extra_data.score || 0"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></p>\r\n                        <p class="label" data-bind="translate:{\'key\':\'courseLearn.evaluating.getScore\'}">得分</p>\r\n                    </li>\r\n                    <li>\r\n                        <p class="value"><span data-bind="text:model.activities().extra_data.accuracy || 0"></span>%</p>\r\n                        <p class="label"><span data-bind="translate:{\'key\':\'courseLearn.evaluating.accuracy\'}">正确率</span></p>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <ul class="result-info">\r\n                <li>\r\n                    \x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e:\r\n                    <span data-bind="if: model.evaluatingInfo().rule_value.qualified_rate"><span data-bind="translate:{\'key\':\'courseLearn.evaluating.accuracy\'}">正确率</span><span data-bind="text:model.evaluatingInfo().rule_value.qualified_rate"></span>%</span>\r\n                    <span data-bind="if: model.evaluatingInfo().rule_value.right_count"><span data-bind="translate:{\'key\':\'courseLearn.evaluating.answerCorrect\'}">答对</span><span data-bind="text:model.evaluatingInfo().rule_value.right_count"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.questions\'}">题</span></span>\r\n                    <span data-bind="if: model.evaluatingInfo().rule_value.qualified_score"><span data-bind="text:model.evaluatingInfo().rule_value.qualified_score"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>\r\n                </li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn2" data-bind="click:showAnswer.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \x3c!-- 试卷模式 --\x3e\r\n    <div data-bind="if: model.evaluatingInfo().rule_type===\'TEST\'">\r\n        \x3c!-- 评测前 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.UNDO">\r\n            <ul class="result-info">\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.questionCount\'}--\x3e 评测题数\x3c!--/ko--\x3e(<span class="highlight" data-bind="text:model.evaluatingInfo().rule_value.question_count"></span>)</li>\r\n                <li>\r\n                    \x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e(<span class="highlight" data-bind="if: model.evaluatingInfo().rule_value.qualified_score"><span data-bind="text:model.evaluatingInfo().rule_value.qualified_score"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>)\r\n                </li>\r\n                <li>\x3c!-- ko translate:{key:\'courseLearn.evaluating.quizTime\'}--\x3e 答题时间\x3c!--/ko--\x3e(<span class="highlight" data-bind="text:model.evaluatingInfo().rule_value.duration"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.minutes\'}">分钟</span>)</li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn" data-bind="click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.beginToAnswer\'}">开始作答</a>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 未达标 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.DOING">\r\n            <div class="result-step-list">\r\n                <span class="result-scole"><span class="num failed" data-bind="text:model.activities().extra_data.score || 0"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>\r\n            </div>\r\n            <ul class="result-info">\r\n                <li>\r\n                    \x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e:\r\n                    <span data-bind="if: model.evaluatingInfo().rule_value.qualified_score"><span data-bind="text:model.evaluatingInfo().rule_value.qualified_score"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>\r\n                </li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn2" data-bind="click:showAnswer.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</a>\r\n                <a href="javascript:;" class="ui-btn" data-bind="click:showAnswer.bind($component, false), translate:{\'key\':\'courseLearn.evaluating.reEvaluating\'}">重新评测</a>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 已达标 --\x3e\r\n        <div data-bind="if: model.activities().status===model.RESOURCE_STATUS.DONE">\r\n            <div class="result-step-list">\r\n                <span class="result-scole"><span class="num success" data-bind="text:model.activities().extra_data.score || 0"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>\r\n            </div>\r\n            <ul class="result-info">\r\n                <li>\r\n                    \x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e:\r\n                    <span data-bind="if: model.evaluatingInfo().rule_value.qualified_score"><span data-bind="text:model.evaluatingInfo().rule_value.qualified_score"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>\r\n                </li>\r\n            </ul>\r\n            <div class="result-btn-item">\r\n                <a href="javascript:;" class="ui-btn2" data-bind="click:showAnswer.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!--/ko--\x3e\r\n\x3c!--ko if:model.isShowAnswer()===true--\x3e\r\n    \x3c!--ko component:{\'name\':\'x-course-learn-player-answer\',\'params\':{ \'config\':$root.config,\'data\':{evaluatingInfo: model.evaluatingInfo(),activities: model.activities(),isAnswerExp: model.isAnswerExp(),resourceId: model.resourceId,lessonId: model.lessonId}}}--\x3e\r\n    \x3c!--/ko--\x3e\r\n\x3c!--/ko--\x3e\r\n\x3c!--ko if:model.popTimeZero()===true--\x3e\r\n<div class="ui-pop">\r\n    <div class="mask"></div>\r\n    <div class="model">\r\n        <div class="model-hd" data-bind="translate:{\'key\':\'courseLearn.common.hint\'}">提示</div>\r\n        <div class="model-bd">\r\n            <div class="tip-warn" data-bind="translate:{\'key\':\'courseLearn.evaluating.timeZeroWarning\'}">评测时间不可以设置为0分钟</div>\r\n        </div>\r\n        <div class="model-ft">\r\n            <a href="javascript:;" class="ui-btn" data-bind="click:hideTimeZeroPop.bind($component), translate:{\'key\':\'courseLearn.evaluating.confirm\'}">确定</a>\r\n        </div>\r\n        <a href="javascript:;" class="btn-close" data-bind="click:hideTimeZeroPop.bind($component)"></a>\r\n    </div>\r\n</div>\r\n\x3c!--/ko--\x3e\r\n'});var g=function(){function t(n){var a=this;r(this,t);var i=n.data.activities;this.model={RESOURCE_TYPE:{VIDEO:0,DOC:1,EVALUATE:10},ANSWER_TYPE:{MEMORY:"standard",CONTINUOUS:"singlecommit",QUICK:"autonext"},evaluatingInfo:n.data.evaluatingInfo,isAnswerExp:e.observable(n.data.isAnswerExp),resourceId:n.data.resourceId,lessonId:n.data.lessonId,currentSessionId:e.observable(i.current_session_id),sessionId:e.observable(null),conRightCount:e.observable(0),quickStatObj:e.observable(null),timer:e.observable(""),popOutAnswer:e.observable(!1),popTimeEnd:e.observable(!1),popErrorEnd:e.observable(!1),popFailed:e.observable(!1),state:{hideLeft:e.observable(!1).publishOn("HIDELEFT"),hideRight:e.observable(!1).publishOn("HIDERIGHT")},isBackToState:e.observable(!0),exitEventData:e.observable(null)},this.config=n.config,this.store={getUserExamSessions:function(e){return $.ajax({url:window.eLearningExamApiDomain+"/v1/user_exam_sessions?exam_id="+e,type:"POST",dataType:"json",cache:!1})},getActivities:function(){var e={resource_type:a.model.RESOURCE_TYPE.EVALUATE,need_extra_data:!0,lesson_id:a.model.lessonId};if(window.answerSubmitTime){var t=0;(t=new Date(window.answerSubmitTime).getTime())>0&&(e.timestamp=t),window.answerSubmitTime=""}return $.ajax({url:"/v1/business_courses/"+a.config.courseId+"/resources/"+a.model.resourceId+"/activities",dataType:"json",data:e,cache:!1})}},this.init(),EventDispatcher.addEventListener("onLinkClick",function(e){this.model.exitEventData(e.data),this.showExitPop()}.bind(this))}return t.prototype.init=function(){var e=this;this.answer=new window.Answer({serviceHosts:{examApi:window.eLearningExamApiDomain,resourceGateway:window.resourceServiceDomain,answerGateway:window.eLearningAnswerApiDomain,markApi:window.eLearningMarkApiDomain},returnUrl:"",staticUrl:"",language:"",macKey:TokenUtils.getMacKey(),userId:TokenUtils.getUserId(),element:"#exercise",sessionId:"",displayOptions:{hideToolbar:!0,hideNavigator:!("QUICK"===this.model.evaluatingInfo.rule_type||"CONTINUOUS"===this.model.evaluatingInfo.rule_type&&!0===e.model.isAnswerExp())},MarkDataStrategy:{RealTimeSync:!0},eventCallBack:{onAnswerSaved:function(){"QUICK"===e.model.evaluatingInfo.rule_type&&e.model.quickStatObj(e.getQuestionStatistic())},onRenderComplete:function(t){$.studying.loading.hide(),"QUICK"===e.model.evaluatingInfo.rule_type&&e.model.quickStatObj(e.getQuestionStatistic()),!0!==e.model.isAnswerExp()&&"CONTINUOUS"===e.model.evaluatingInfo.rule_type&&(1===t.answerStatus?(e.answer.next(),e.model.conRightCount(e.model.conRightCount()+1)):2===t.answerStatus&&(e.model.isBackToState(!1),e.model.conRightCount(0),e.onAnswerEnd(!1),e.model.popFailed(!0)))},onTimerElapsed:function(t){e.model.timer(t.text),window.isAnswering&&"00:00:00"===t.text&&e.model.popTimeEnd(!0)},afterSubmitCallBack:function(t){window.isAnswering=!1,t&&t.submitTime&&(window.answerSubmitTime=t.latestAnswerTime||t.submitTime),!1===e.model.popTimeEnd()&&!0===e.model.isBackToState()&&e.backToStatePage(),!1===e.model.isBackToState()&&e.model.isBackToState(!0)}}},this.onAnswerInited.bind(this))},t.prototype.onAnswerInited=function(){$.studying.loading.show(),this.model.isAnswerExp()?this.answer.start(this.model.currentSessionId(),this.model.ANSWER_TYPE[this.model.evaluatingInfo.rule_type]):(window.isAnswering=!0,this.model.state.hideLeft(!0),this.model.state.hideRight(!0),this.store.getUserExamSessions(this.model.evaluatingInfo.exam_id).done($.proxy(function(e){this.model.sessionId(e.id),this.answer.start(e.id,this.model.ANSWER_TYPE[this.model.evaluatingInfo.rule_type]),$("#exercise").show()},this)).error(function(){$.studying.loading.hide(),this.model.popErrorEnd(!0)}.bind(this)))},t.prototype.onAnswerPrev=function(){this.answer.prev()},t.prototype.onAnswerNext=function(){this.answer.next()},t.prototype.onAnswerEnd=function(e){this.answer.end(e)},t.prototype.showAnswerExp=function(){var e=this;this.hideFailedPop(),userId&&($.studying.loading.show(),this.store.getActivities().done(function(t){t&&e.model.currentSessionId(t.current_session_id),setTimeout(function(){this.model.isAnswerExp(!0),this.init(),$.studying.loading.hide()}.bind(e),2e3)}))},t.prototype.reAnswer=function(){this.hideFailedPop(),$.studying.loading.show(),setTimeout(function(){this.onAnswerInited(),$.studying.loading.hide()}.bind(this),3e3)},t.prototype.popAnswerEnd=function(){this.hidePop(),$.studying.loading.show(),this.answer.bussiness&&this.onAnswerEnd(!1),setTimeout(function(){$.studying.loading.hide();var e={type:"onExamExit",data:this.model.exitEventData()};EventDispatcher.dispatchEvent(e),this.model.state.hideLeft(!1),this.model.state.hideRight(!1)}.bind(this),2e3)},t.prototype.showExitPop=function(){this.model.popOutAnswer(!0)},t.prototype.hidePop=function(){this.model.popOutAnswer(!1)},t.prototype.hideTimeEndPop=function(){this.model.popTimeEnd(!1),this.backToStatePage()},t.prototype.hideErrorEndPop=function(){this.model.popErrorEnd(!1),window.isAnswering=!1,$.studying.loading.show(),window.location.reload()},t.prototype.hideFailedPop=function(){this.model.popFailed(!1)},t.prototype.backToStatePage=function(){this.model.isAnswerExp()||$.studying.loading.show(),setTimeout(function(){this.model.isAnswerExp()||$.studying.loading.hide(),$("ul.cplay__resource--list").find(".state-on").trigger("click"),this.model.state.hideLeft(!1),this.model.state.hideRight(!1)}.bind(this),this.model.isAnswerExp()?0:2e3)},t.prototype.getQuestionStatistic=function(){return this.answer.getQuestionStatistic()},t}();e.components.register("x-course-learn-player-answer",{viewModel:g,template:'\x3c!-- 答题界面 --\x3e\r\n\x3c!-- 记忆曲线模式 --\x3e\r\n\x3c!--ko if:model.evaluatingInfo.rule_type===\'MEMORY\'--\x3e\r\n<div class="n-evaluate answer">\r\n    \x3c!--ko if:model.isAnswerExp()===false--\x3e\r\n    <div class="answer-head">\r\n        <span class="test-num">\x3c!-- ko translate:{key:\'courseLearn.evaluating.questionCount\'}--\x3e 评测题数\x3c!--/ko--\x3e（<span class="highlight" data-bind="text:model.evaluatingInfo.rule_value.question_count"></span>）</span>\r\n        <span class="pass-require">\x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e（<span class="highlight">\x3c!-- ko translate:{key:\'courseLearn.evaluating.accuracy\'}--\x3e 正确率\x3c!--/ko--\x3e\x3c!--ko text:model.evaluatingInfo.rule_value.qualified_rate--\x3e\x3c!--/ko--\x3e%</span>）</span>\r\n        <span class="answer-time">\x3c!-- ko translate:{key:\'courseLearn.evaluating.quizTime\'}--\x3e 答题时间\x3c!--/ko--\x3e（<span class="highlight" data-bind="translate:{\'key\':\'courseLearn.evaluating.unlimited\'}">不限</span>）</span>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n    \x3c!--ko if:model.isAnswerExp()===true--\x3e\r\n    <div class="answer-head">\r\n        <span data-bind="translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</span>\r\n        <a href="javascript:;" class="btn-close" data-bind="click: backToStatePage.bind($component)"></a>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n    <div class="answer-body" id="exercise"></div>\r\n    \x3c!--ko if:model.isAnswerExp()===false--\x3e\r\n    <div class="answer-foot">\r\n        <div class="fr">\r\n            <a href="javascript:;" class="ui-btn small" data-bind="click:onAnswerEnd.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.submit\'}">提交</a>\r\n        </div>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n</div>\r\n\x3c!--/ko--\x3e\r\n\x3c!-- 连续答题模式 --\x3e\r\n\x3c!--ko if:model.evaluatingInfo.rule_type===\'CONTINUOUS\'--\x3e\r\n<div class="n-evaluate answer">\r\n    \x3c!--ko if:model.isAnswerExp()===false--\x3e\r\n    <div class="answer-head">\r\n        <span class="pass-require">\x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e（<span class="highlight" data-bind="translate: { key: \'courseLearn.evaluating.continuousRightCount\', properties:{ \'continuousRightCount\': model.evaluatingInfo.rule_value.continuous_right_count }}"></span>）</span>\r\n        <span class="answer-time">\x3c!-- ko translate:{key:\'courseLearn.evaluating.quizTime\'}--\x3e 答题时间\x3c!--/ko--\x3e（<span class="highlight" data-bind="translate:{\'key\':\'courseLearn.evaluating.unlimited\'}">不限</span>）</span>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n    \x3c!--ko if:model.isAnswerExp()===true--\x3e\r\n    <div class="answer-head">\r\n        <span data-bind="translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</span>\r\n        <a href="javascript:;" class="btn-close" data-bind="click: backToStatePage.bind($component)"></a>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n    <div class="answer-body" id="exercise"></div>\r\n    \x3c!--ko if:model.isAnswerExp()===false--\x3e\r\n    <div class="answer-foot">\r\n        <div class="fr">\r\n            <a href="javascript:;" class="ui-btn small" data-bind="click:onAnswerEnd.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.submit\'}">提交</a>\r\n        </div>\r\n        <span class="answer-data">\x3c!-- ko translate:{key:\'courseLearn.evaluating.alreadyContinuousRightCount\'}--\x3e 已连续答对题数\x3c!--/ko--\x3e：<span class="highlight" data-bind="text: model.conRightCount()"></span></span>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n</div>\r\n\x3c!--/ko--\x3e\r\n\x3c!-- 快速答题模式 --\x3e\r\n\x3c!--ko if:model.evaluatingInfo.rule_type===\'QUICK\'--\x3e\r\n<div class="n-evaluate answer">\r\n    \x3c!--ko if:model.isAnswerExp()===false--\x3e\r\n    <div class="answer-head">\r\n        <span class="test-num">\x3c!-- ko translate:{key:\'courseLearn.evaluating.questionCount\'}--\x3e 评测题数\x3c!--/ko--\x3e（<span class="highlight" data-bind="text:model.evaluatingInfo.rule_value.question_count"></span>）</span>\r\n        <span class="pass-require">\x3c!-- ko translate:{key:\'courseLearn.evaluating.eliRequires\'}--\x3e 合格要求\x3c!--/ko--\x3e (<span class="highlight" data-bind="if: model.evaluatingInfo.rule_value.qualified_rate"><span data-bind="translate:{\'key\':\'courseLearn.evaluating.accuracy\'}">正确率</span><span data-bind="text:model.evaluatingInfo.rule_value.qualified_rate"></span>%</span><span class="highlight" data-bind="if: model.evaluatingInfo.rule_value.right_count"><span data-bind="translate: { key: \'courseLearn.evaluating.rightCount\', properties:{ \'rightCount\': model.evaluatingInfo.rule_value.right_count }}"></span></span><span class="highlight" data-bind="if: model.evaluatingInfo.rule_value.qualified_score"><span data-bind="text:model.evaluatingInfo.rule_value.qualified_score"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.score\'}">分</span></span>) </span>\r\n        <span class="answer-time">\x3c!-- ko translate:{key:\'courseLearn.evaluating.quizTime\'}--\x3e 答题时间\x3c!--/ko--\x3e (<span class="highlight" data-bind="text:model.evaluatingInfo.rule_value.duration"></span><span data-bind="translate:{\'key\':\'courseLearn.evaluating.minutes\'}">分钟</span>) </span>\r\n        \x3c!--ko if:model.timer--\x3e\r\n        <div class="fr">\r\n            <span class="answer-time used" data-bind="text: model.timer"></span>\r\n        </div>\r\n        \x3c!--/ko--\x3e\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n    \x3c!--ko if:model.isAnswerExp()===true--\x3e\r\n    <div class="answer-head">\r\n        <span data-bind="translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</span>\r\n        <a href="javascript:;" class="btn-close" data-bind="click: backToStatePage.bind($component)"></a>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n    <div class="answer-body" id="exercise"></div>\r\n    \x3c!--ko if:model.isAnswerExp()===false--\x3e\r\n    <div class="answer-foot">\r\n        <div class="fr">\r\n            <a href="javascript:;" class="ui-btn small" data-bind="click:onAnswerEnd.bind($component, true), translate:{\'key\':\'courseLearn.evaluating.submit\'}">提交</a>\r\n            <a href="javascript:;" class="ui-btn small" data-bind="css:{\'disabled\': !model.quickStatObj()||model.quickStatObj().currentQuestionIndex===1}, click:onAnswerPrev.bind($component), translate:{\'key\':\'courseLearn.evaluating.prevQuestion\'}">上一题</a>\r\n            <a href="javascript:;" class="ui-btn small" data-bind="css:{\'disabled\': !model.quickStatObj()||model.quickStatObj().currentQuestionIndex===model.quickStatObj().total}, click:onAnswerNext.bind($component), translate:{\'key\':\'courseLearn.evaluating.nextQuestion\'}">下一题</a>\r\n        </div>\r\n        <span class="answer-data">\x3c!-- ko translate:{key:\'courseLearn.evaluating.answerStat\'}--\x3e 答题统计\x3c!--/ko--\x3e：<span class="highlight" data-bind="text: model.quickStatObj() && model.quickStatObj().done ? model.quickStatObj().done : 0"></span>/\x3c!--ko text:model.quickStatObj() && model.quickStatObj().total ? model.quickStatObj().total : model.evaluatingInfo.rule_value.question_count--\x3e\x3c!--/ko--\x3e</span>\r\n    </div>\r\n    \x3c!--/ko--\x3e\r\n</div>\r\n\x3c!--/ko--\x3e\r\n\x3c!-- 弹窗 --\x3e\r\n\x3c!--ko if:model.popOutAnswer()===true--\x3e\r\n<div class="ui-pop">\r\n    <div class="mask"></div>\r\n    <div class="model">\r\n        <div class="model-hd" data-bind="translate:{\'key\':\'courseLearn.common.hint\'}">提示</div>\r\n        <div class="model-bd">\r\n            <div class="tip-warn" data-bind="translate:{\'key\':\'courseLearn.evaluating.noAnswerWarning\'}">评测还未完成，离开后会自动交卷，确定退出吗？</div>\r\n        </div>\r\n        <div class="model-ft">\r\n            <a href="javascript:;" class="ui-btn2" data-bind="click:popAnswerEnd.bind($component), translate:{\'key\':\'courseLearn.evaluating.exit\'}">退出</a>\r\n            <a href="javascript:;" class="ui-btn" data-bind="click:hidePop.bind($component), translate:{\'key\':\'courseLearn.evaluating.continueAnswer\'}">继续答题</a>\r\n        </div>\r\n        <a href="javascript:;" class="btn-close" data-bind="click:hidePop.bind($component)"></a>\r\n    </div>\r\n</div>\r\n\x3c!--/ko--\x3e\r\n\x3c!--ko if:model.popTimeEnd()===true--\x3e\r\n<div class="ui-pop">\r\n    <div class="mask"></div>\r\n    <div class="model">\r\n        <div class="model-hd" data-bind="translate:{\'key\':\'courseLearn.common.hint\'}">提示</div>\r\n        <div class="model-bd">\r\n            <div class="tip-success" data-bind="translate:{\'key\':\'courseLearn.evaluating.timeEndWarning\'}">本次评测时间已到，不能继续答题</div>\r\n        </div>\r\n        <div class="model-ft">\r\n            <a href="javascript:;" class="ui-btn" data-bind="click:hideTimeEndPop.bind($component), translate:{\'key\':\'courseLearn.evaluating.confirm\'}">确定</a>\r\n        </div>\r\n        <a href="javascript:;" class="btn-close" data-bind="click:hideTimeEndPop.bind($component)"></a>\r\n    </div>\r\n</div>\r\n\x3c!--/ko--\x3e\r\n\x3c!--ko if:model.popFailed()===true--\x3e\r\n<div class="ui-pop">\r\n    <div class="mask"></div>\r\n    <div class="model">\r\n        <div class="model-hd" data-bind="translate:{\'key\':\'courseLearn.common.hint\'}">提示</div>\r\n        <div class="model-bd">\r\n            <div class="tip-warn" data-bind="translate:{\'key\':\'courseLearn.evaluating.failWarning\'}">本题答错啦！连续答题未达标~</div>\r\n            <p data-bind="translate:{\'key\':\'courseLearn.evaluating.tryAgain\'}">再试一次~</p>\r\n        </div>\r\n        <div class="model-ft">\r\n            <a href="javascript:;" class="ui-btn" data-bind="click:showAnswerExp.bind($component), translate:{\'key\':\'courseLearn.evaluating.aweAndExplanation\'}">答案解析</a>\r\n            <a href="javascript:;" class="ui-btn" data-bind="click:reAnswer.bind($component), translate:{\'key\':\'courseLearn.evaluating.reEvaluating\'}">重新评测</a>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!--/ko--\x3e\r\n\x3c!--ko if:model.popErrorEnd()===true--\x3e\r\n<div class="ui-pop">\r\n    <div class="mask"></div>\r\n    <div class="model">\r\n        <div class="model-hd" data-bind="translate:{\'key\':\'courseLearn.common.hint\'}">提示</div>\r\n        <div class="model-bd">\r\n            <div class="tip-warn" data-bind="translate:{\'key\':\'courseLearn.evaluating.ajaxErrorWarning\'}">进入作答出错，请退出重试~</div>\r\n        </div>\r\n        <div class="model-ft">\r\n            <a href="javascript:;" class="ui-btn" data-bind="click:hideErrorEndPop.bind($component), translate:{\'key\':\'courseLearn.evaluating.confirm\'}">确定</a>\r\n        </div>\r\n        <a href="javascript:;" class="btn-close" data-bind="click:hideErrorEndPop.bind($component)"></a>\r\n    </div>\r\n</div>\r\n\x3c!--/ko--\x3e'});var f=function(){function t(n){r(this,t),this.model={initialData:e.observable(null).subscribeTo("INITIAL_DATA"),cata_type:e.observable("0").subscribeTo("CATA_TYPE"),cata_id:e.observable("").subscribeTo("CATA_ID"),contextId:e.observable("").subscribeTo("CONTEXT_ID"),dataForPlayer:e.observable(null).subscribeTo("RESOURCE",this.resourceModify,this),route:e.observable("").publishOn("ROUTE"),ready:e.observable(null).publishOn("COMPONENT_READY"),resourceFilter:e.observable(null).subscribeTo("RESOURCE_FILTER"),course:e.observable(null).subscribeTo("COURSE")},this.config=n.config,this.model.ready({key:"player",value:!0})}return t.prototype.resourceModify=function(e){var t=this.model.contextId(),n=null;this.model.initialData()&&(n=this.model.initialData(),this.model.initialData(null)),e?(this.model.dataForPlayer({resource:e,contextId:t,initialData:n}),this.model.route("#/cata_type/"+this.model.cata_type()+"/cata_id/"+this.model.cata_id()+"/resource_id/"+e.id)):this.model.dataForPlayer(null)},t}();e.components.register("x-course-learn-player",{viewModel:f,template:"<div class=\"cplay__content--play\" data-bind=\"css:{'no-resource':!model.dataForPlayer()}\">\r\n    \x3c!--ko if:model.dataForPlayer--\x3e\r\n        \x3c!--ko if:model.dataForPlayer().resource.type==0--\x3e\r\n            \x3c!--ko component:{'name':'x-course-learn-player-video','params':{'config':$root.config,'data':model.dataForPlayer() }}--\x3e\r\n            \x3c!--/ko--\x3e\r\n        \x3c!--/ko--\x3e\r\n        \x3c!--ko if:model.dataForPlayer().resource.type==1--\x3e\r\n            \x3c!--ko component:{'name':'x-course-learn-player-doc','params':{'config':$root.config,'data':model.dataForPlayer() }}--\x3e\r\n            \x3c!--/ko--\x3e\r\n        \x3c!--/ko--\x3e\r\n        \x3c!--ko if:model.dataForPlayer().resource.type==10--\x3e\r\n            \x3c!--ko component:{'name':'x-course-learn-player-evaluating','params':{'config':$root.config,'data':model.dataForPlayer(),'resourceFilter':model.resourceFilter()}}--\x3e\r\n            \x3c!--/ko--\x3e\r\n        \x3c!--/ko--\x3e\r\n        <div class=\"exp-container\">\r\n            <p class=\"try-tip\" data-bind=\"translate: { key: 'courseLearn.player.expTip' }\"></p>\r\n            <p class=\"try-tip\" data-bind=\"text: model.course().title\"></p>\r\n        </div>\r\n    \x3c!--/ko--\x3e\r\n    \x3c!--ko ifnot:model.dataForPlayer--\x3e\r\n        <div class=\"no-content\">\r\n            <div class=\"icon-sprite icon-res-nocontent\"></div>\r\n            <div class=\"hint\" data-bind=\"translate:{'key':'courseLearn.player.noResource'}\">暂无课程资源</div>\r\n        </div>\r\n    \x3c!--/ko--\x3e\r\n</div>"});var x={alert:function(e){($.fn.udialog&&$.fn.udialog.alert||window.alert)(e,{title:i18nHelper.getKeyValue("courseDetailPk.hint"),buttons:[{text:i18nHelper.getKeyValue("courseDetailPk.confirm")}]})},confirm:function(e,t){($.fn.udialog&&$.fn.udialog.confirm||window.confirm)(e,[{text:i18nHelper.getKeyValue("courseDetailPk.confirm"),click:function(){t&&t(),$(this).udialog("hide")}},{text:i18nHelper.getKeyValue("courseDetailPk.cancel"),click:function(){$(this).udialog("hide")}}],{title:i18nHelper.getKeyValue("courseDetailPk.hint")})}},y=i18nHelper.getKeyValue;a.prototype.init=function(){this.dot()},a.prototype.formatTime=function(e){return e&&e.split(".")[0].replace("T"," ")},a.prototype.getQuestion=function(){var e=this;this.store.getQuestion(this.model.question().id).done(function(t){t.display_user=e.display_user,e.model.question(t),e.dot(),e.getAnswer()})},a.prototype.getAnswer=function(){var t=this,n=this.model.filter,a=e.toJS(this.model.filter),i=this.model.question;a.question_id=i().id,this.store.getAnswer(a).done(function(e){t.model.answers.items(e.items||[]),t.model.answers.total(e.total||0),i().answer_count(e.total||0),$("#pagination_"+t.model.question().id).pagination(e.total,{items_per_page:n.page_size(),num_display_entries:5,current_page:n.page_no(),is_show_total:!1,prev_text:"courseComponent.front.courseDetail.prev",next_text:"courseComponent.front.courseDetail.next",callback:function(e){e!=n.page_no()&&(n.page_no(e),t.getAnswer())}})})},a.prototype.searchAnswer=function(){this.model.filter.page_no(0),this.getAnswer()},a.prototype.toggleAnswerArea=function(){var e=this.model.state.showAnswerArea;e(!e()),e()&&this.searchAnswer()},a.prototype.questionDetail=function(){this.actions.detail&&this.actions.detail(this.model.question())},a.prototype.deleteQuestion=function(){var e=this;x.confirm(y("courseLearnQuestion.confirmDelete"),function(){e.store.deleteQuestion(e.model.question().id).done(function(t){e.actions["delete"]&&e.actions["delete"](e.model.question())})})},a.prototype.answer=function(){var e=this;if(this.model.content())if(this.model.content().length>2e3)x.alert(y("courseLearnQuestion.maxLength"));else{var t={question_id:this.model.question().id,title:"",content:this.model.content()};this.store.createAnswer(t).done(function(t){e.model.content(""),e.getAnswer()})}},a.prototype.toggleMoreContent=function(e){this.model.state.showMoreContent(e),e?$("#question_"+this.model.question().id+" .qa-item-cont").trigger("destroy"):$("#question_"+this.model.question().id+" .qa-item-cont").dotdotdot({height:42,after:".toggle"}).removeClass("expand")},a.prototype.dot=function(t,n){var a=this;e.tasks.schedule(function(){function e(e){e.dotdotdot({height:42,after:".toggle"}).removeClass("init").removeClass("expand");var t=e.find("i.icon.xclq-icon-down-arrow");"inline"===t.css("display")&&t.css("display","inline-block")}function t(e){e.addClass("init expand").trigger("destroy")}var n=$("#question_"+a.model.question().id+" .qa-item-cont");n.on("click",".xclq-icon-down-arrow",function(){t($(this).parents(".qa-item-cont"))}).on("click",".xclq-icon-up-arrow",function(){e($(this).parents(".qa-item-cont"))}),e(n)})},e.components.register("x-course-learn-question__question-item",{viewModel:a,template:'<div class="x-course-learn-question qa-item expand" data-bind="attr:{\'id\':\'question_\'+model.question().id}">\r\n    <div class="qa-record">\r\n        <div class="qa-item-avtor">\r\n            <img data-bind="attr:{\'src\':display_user.icon+\'&defaultImage=1\',\'alt\':display_user.display_name}">\r\n        </div>\r\n        <div class="qa-item-main">\r\n            <a class="qa-item-title" href="javascript:void(0);"\r\n               data-bind="text:model.question().title,click:questionDetail"></a>\r\n            <p class="qa-item-source"\r\n               data-bind="translate:{\'key\':\'courseLearnQuestion.from\',properties:{\'from\':model.question().target_name || \'\'}},visible:model.question().target_name"></p>\r\n            <div class="qa-item-cont init">\r\n                \x3c!--ko text:model.question().content--\x3e\x3c!--/ko--\x3e&emsp;\r\n                <span class="toggle">\r\n                    <i class="icon xclq-icon-down-arrow"></i>\r\n                    <i class="icon xclq-icon-up-arrow"></i>\r\n                </span>\r\n            </div>\r\n            <p class="qa-item-author">\x3c!--ko text:model.question().display_user.display_name--\x3e\x3c!--/ko--\x3e&emsp;\r\n                \x3c!--ko text:$component.formatTime(model.question().create_time)--\x3e\x3c!--/ko--\x3e</p>\r\n            <div class="qa-item-opts opts">\r\n                <div class="fl">\r\n                    <a href="javascript: void(0);" class="opt" data-bind="click:toggleAnswerArea">\r\n                        <i class="xclq-icon-reply"></i>\r\n                        <em data-bind="translate:{\'key\':model.state.showAnswerArea()?\'courseLearnQuestion.foldAnswerArea\':\'courseLearnQuestion.totalAnswer\',properties:{\'count\':model.question().answer_count}}"></em>\r\n                    </a>\r\n                </div>\r\n                <div class="fr" data-bind="visible:model.question().display_user.user_id == userId">\r\n                    <a href="javascript: void(0);" class="opt trash" data-bind="click:deleteQuestion">\r\n                        <i class="xclq-icon-delete"></i>\r\n                        \x3c!--ko translate:{\'key\':\'courseLearnQuestion.delete\'}--\x3e\x3c!--/ko--\x3e\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="qa-reply"\r\n         data-bind="visible:model.state.showAnswerArea() && (model.question().display_user.user_id != userId || model.answers.items().length)">\r\n        <div class="reply">\r\n            <div class="recovery"\r\n                 data-bind="visible:model.question().display_user.user_id != userId">\r\n                <textarea class="recovery-editor" maxlength="2000" data-bind="textInput:model.content"></textarea>\r\n                <div class="recovery-btns">\r\n                    <a href="javascript: void(0);" class="btn fr" data-bind="click:answer,css:{\'disabled\':!model.content().length}">\x3c!--ko translate:{\'key\':\'courseLearnQuestion.answer\'}--\x3e\x3c!--/ko--\x3e</a>\r\n                </div>\r\n            </div>\r\n            <ul class="reply-list" data-bind="foreach:model.answers.items">\r\n                <li>\r\n                    <div data-bind="component:{name:\'x-course-learn-answer\',params:{\'options\':$component.options,\'answer\':$data, \'userId\':$component.userId}}"></div>\r\n                </li>\r\n            </ul>\r\n            <div class="pagination" data-bind="attr:{\'id\':\'pagination_\'+model.question().id}"></div>\r\n        </div>\r\n    </div>\r\n</div>'});i.prototype.init=function(){},i.prototype.formatTime=function(e){return e&&e.split(".")[0].replace("T"," ")},i.prototype.accept=function(){var e=this;this.store.acceptAnswer(this.model.answer().id,!0).done(function(t){e.actions.accept&&e.actions.accept(e.model.answer())})},e.components.register("x-course-learn-question__answer-item",{viewModel:i,template:'<div class="x-course-learn-answer reply-item"\r\n     data-bind="css:{\'adopt\':model.answer().accepted || model.state.showAcceptIcon()}">\r\n    <div class="reply-header">\r\n        <div class="reply-avtor">\r\n            <img data-bind="attr:{\'src\':model.answer().display_user.icon+\'&defaultImage=1\',\'alt\':model.answer().display_user.display_name}">\r\n        </div>\r\n        <div class="reply-user">\r\n            <h4 data-bind="text:display_user.display_name"></h4>\r\n            <p class="reply-time" data-bind="text:$component.formatTime(model.answer().create_time)"></p>\r\n        </div>\r\n    </div>\r\n    <div class="reply-body" data-bind="text:model.answer().content"></div>\r\n    <div class="reply-opts opts">\r\n        <div class="fl">\r\n            \x3c!--<a href="javascript: void(0);" class="opt">\r\n                <i class="xclq-icon-reply"></i>\r\n                <em>11</em>\r\n                <span>个回复</span>\r\n            </a>\r\n            <a href="javascript: void(0);" class="opt">\r\n                <i class="xclq-icon-like"></i>\r\n                <em>17</em>\r\n            </a>--\x3e\r\n            <a href="javascript: void(0);" class="opt" data-bind="click:accept,visible:model.state.showAcceptBtn">\r\n                <i class="xclq-icon-accept active"></i>\r\n                <em data-bind="translate:{\'key\':\'courseLearnQuestion.accept\'}">采纳答案</em>\r\n            </a>\r\n        </div>\r\n    </div>\r\n</div>'});var _=function(){function t(n){var a=this;r(this,t),this.model={ready:e.observable(null).publishOn("COMPONENT_READY"),questions:{mine:{items:e.observableArray(),total:e.observable(0)},all:{items:e.observableArray(),total:e.observable(0)},search:{items:e.observableArray(),total:e.observable(0)}},filters:{mine:{type:2,page_no:0,page_size:10},all:{type:1,page_no:0,page_size:10},search:{page_no:0,page_size:10,content:e.observable("")},answer:{page_no:0,page_size:10}},keyword:e.observable(""),filter:{type:0,page_no:0,page_size:10,content:""},state:{page:e.observable("mine"),tab:e.observable(0)},store:{pageHistory:["mine"]}},this.config=n.config,this.store={getQuestions:function(e){return $.ajax({url:a.config.urls.assistGatewayUrl+"/v1/questions/search",data:e,cache:!1})},getAnswers:function(e){return $.ajax({url:a.config.urls.assistGatewayUrl+"/v1/answers/search",type:"GET",data:e,cache:!1})},createQuestion:function(e){return $.ajax({url:a.config.urls.assistGatewayUrl+"/v1/questions",type:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})},createAnswer:function(e){return $.ajax({url:a.config.urls.assistGatewayUrl+"/v1/answers",type:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})},getQuestion:function(e){return $.ajax({url:a.config.urls.assistGatewayUrl+"/v1/questions/"+e,dataType:"json",cache:!1})}},this.init()}return t.prototype.init=function(){var e=this;this.getQuestions().done(function(t){e.model.ready({key:"question",value:!0})})},t.prototype.initComputed=function(){var e=this;this.model.state.page.subscribe(function(t){e.model.store.pageHistory.push(t)})},t.prototype.getQuestions=function(){var t=this,n=e.mapping.toJS(this.model.filters[this.model.state.page()]);return this.store.getQuestions(n).done(function(e){t.model.questions[t.model.state.page()].items(e)})},t.prototype.go=function(e){this.model.state.page(e)},t.prototype.goBack=function(){var e=this.model.store.pageHistory;e.length=e.length-1,this.model.state.page(e[e.length-1])},t.prototype.ask=function(){this.go("edit")},t.prototype.searchQuestion=function(){this.model.filters.search.content()&&(this.go("search"),this.getQuestions())},t}();e.components.register("x-course-learn-question",{viewModel:_,template:'<div class="qa-block" style="position:absolute;">\r\n    <div class="qa">\r\n        <div class="qa-normal fix-types"\r\n             data-bind="visible: model.state.page()==\'mine\' || model.state.page()==\'all\' || model.state.page()==\'search\'">\r\n            <div class="qa-header" style="overflow:hidden">\r\n                <a href="javascript: void(0);" class="btn"\r\n                   data-bind="click: ask, translate:{ key: \'courseLearn.question.ask\'}">我要提问</a>\r\n                <div class="qa-search" style="display:none;">\r\n                    <input type="text" placeholder="请输入答疑关键字"\r\n                           data-bind="value: model.keyword, translate:{ key: \'courseLearn.question.keywordPlaceHolder\', target:[\'placeholder\']}">\r\n                    <a href="javascript: void(0);" class="qa-search-btn">\r\n                        <i class="icon question-icon-search"\r\n                           data-bind="click: searchQuestion"></i>\r\n                    </a>\r\n                </div>\r\n            </div>\r\n            <div class="qa-body" data-bind="style:{\'top\': model.state.page()==\'search\' ? \'0\' : \'70px\'}">\r\n                \x3c!--我的问题，全部问题展示--\x3e\r\n                <div class="qa-bily" data-bind="visible: model.state.page()!=\'search\'">\r\n                    <div class="question-tabs">\r\n                        <div class="tabs-container">\r\n                            <a href="javascript: void(0);" quizType="1" class="tab"\r\n                               data-bind="click: $component.go.bind($component, \'mine\'),css:{\'active\':model.state.page() == \'mine\'},translate:{ key: \'courseLearn.question.myQuestion\'}">我的问题</a>\r\n                            <a href="javascript: void(0);" quizType="2" class="tab"\r\n                               data-bind="click: $component.go.bind($component, \'all\'),css:{\'active\':model.state.page() == \'all\'},translate:{ key: \'courseLearn.question.allQuestion\'}">全部问题</a>\r\n                        </div>\r\n                    </div>\r\n                    <div class="qa-types">\r\n                        <p class="fr"\r\n                           data-bind="translate: { key: \'courseLearn.question.totalQuestion\', properties:{ \'total\': model.questions[model.state.page()].total() }}">\r\n                            \x3c!--全部问题时显示--\x3e\r\n                        <div class="fl">\r\n                            \x3c!--<a href="javascript: void(0);" class="qa-type active">最热</a>--\x3e\r\n                            <a href="javascript: void(0);" class="qa-type" style="background:#38adff;color:#fff;"\r\n                               data-bind="click: getQuestions, translate: { key: \'courseLearn.question.latest\' }">最新</a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \x3c!--搜索结果展示--\x3e\r\n                <div class="qa-bily" data-bind="visible: model.state.page()==\'search\'">\r\n                    <div class="bily-res">\r\n                        <div class="fr">\r\n                            <a href="javascript:;" class="btn btn-back"\r\n                               data-bind="click: goBack, translate:{ key: \'courseLearn.question.goBack\'}">返回</a>\r\n                        </div>\r\n                        <div class="fl">\r\n                            <p data-bind="translate: { key: \'courseLearn.question.findTotal\', properties:{ \'total\': model.questions[model.state.page()].total() }}"></p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                \x3c!--列表开始--\x3e\r\n                <div class="qa-list-scroll"\r\n                     data-bind="style: {\'top\': model.state.page()==\'search\' ? \'58px\' : \'130px\'}">\r\n                    <div class="qa-list-container">\r\n                        <div class="nodata" data-bind="visible: model.questions[model.state.page()].items().length">\r\n                            <i class="icon icon-nodata"></i>\r\n                            <p data-bind="translate:{ key: \'courseLearn.question.noQuestion\'}">暂无数据</p>\r\n                        </div>\r\n                        <ul class="qa-list" data-bind="foreach: model.questions[model.state.page()].items">\r\n                            <li>\r\n                                <div data-bind="component:{\'name\':\'x-course-learn-question__question-item\',\'params\':{\'config\':$root.config,options\':$root.model.question().viewModel.model.options,\'question\':$data,\'userId\':userId}}"></div>\r\n                            </li>\r\n                        </ul>\r\n                        <div class="qa-more">\r\n                            <a href="javascript: void(0);" class="qa-more" style="display: none;">点击加载更多回答</a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        \x3c!--编辑问题开始--\x3e\r\n        \x3c!-- ko if: model.state.page()==\'edit\' --\x3e\r\n        <div class="qa-issue" data-bind="visible:model.state.page()==\'edit\'">\r\n            <div class="issue-header">\r\n                <div class="qa-bily">\r\n                    <div class="bily-res">\r\n                        <div class="fr">\r\n                            <a href="javascript:;" class="btn btn-back"\r\n                               data-bind="click: goBack, translate:{ key: \'courseLearn.question.goBack\'}">返回</a>\r\n                        </div>\r\n                        <div class="fl">\r\n                            <p><strong data-bind="translate:{ key: \'courseLearn.question.editQuestion\'}">编辑问题</strong></p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="issue-body">\r\n                <div class="issue-main">\r\n                    <ul class="crumbs">\r\n                        <li><span>课程标题</span></li>\r\n                        <li><span data-bind="text: model.question().viewModel.model.courseResourceInfo"></span></li>\r\n                    </ul>\r\n                    <div class="question">\r\n                        <div class="question-input">\r\n                            <p><span data-bind="translate:{ key: \'learn.question\'}">问题：</span>\r\n                                \x3c!-- 非法+ invalid --\x3e\r\n                                <span class="question-input-size"\r\n                                      data-bind="text: model.question().viewModel.model.wordCount() + \'/50\'"></span>\r\n                            </p>\r\n                            <div class="control">\r\n                                <input type="text" class="control-input" placeholder="写下你的问题"\r\n                                       data-bind="textInput: model.question().viewModel.model.questionTitle, translate:{ key: \'learn.writeQuestionLabel\', target:[\'placeholder\']}"/>\r\n                            </div>\r\n                        </div>\r\n                        <div class="question-detail">\r\n                            <p data-bind="translate:{ key: \'learn.questionDetailOption\'}">问题详情（选填）：</p>\r\n                            <span style="float: right;font: 12px/normal \'microsoft yahei\';color: #ccc;"\r\n                                  data-bind="text: model.question().viewModel.model.wordCountDes() + \'/2000\'"></span>\r\n                            <div style="margin-top: 10px;">\r\n                                <textarea style="width: 99.8%;height:100px;overflow: auto;padding: 0;"\r\n                                          class="control control-input" placeholder="问题详细信息"\r\n                                          id="editQuestion" maxlength="2000"\r\n                                          data-bind="textInput: model.question().viewModel.model.questionContent, translate:{ key: \'learn.questionDetailInfo\', target:[\'placeholder\']}"></textarea>\r\n                            </div>\r\n                        </div>\r\n                        <div class="question-btn">\r\n                            \x3c!--ko if:model.question().viewModel.model.valid()--\x3e\r\n                            <a href="javascript: void(0);" class="btn"\r\n                               data-bind="click: model.question().viewModel.addQuestion, translate:{ key: \'learn.quiz\'}">马上提问</a>\r\n                            \x3c!--/ko--\x3e\r\n\r\n                            \x3c!--ko if:!model.question().viewModel.model.valid()--\x3e\r\n                            <a href="javascript: void(0);" class="btn"\r\n                               style="cursor:default;color:#000;background:#eee;"\r\n                               data-bind="translate:{ key: \'learn.quiz\'}">马上提问</a>\r\n                            \x3c!--/ko--\x3e\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!--编辑问题结束--\x3e\r\n\r\n        \x3c!--问题详情页面--\x3e\r\n        \x3c!-- ko if: model.state.page()==\'detail\' --\x3e\r\n        <div class="qa-detail" data-bind="visible: model.question().viewModel.model.isDetail">\r\n            <div class="detail-header">\r\n                <div class="qa-bily">\r\n                    <div class="bily-res">\r\n                        <div class="fr">\r\n                            <a href="javascript: void(0);" class="btn btn-back"\r\n                               data-bind="click: model.question().viewModel.backFromDetail, translate:{ key: \'learn.goback\'}">返回</a>\r\n                        </div>\r\n                        <div class="fl">\r\n                            <p data-bind="translate:{ key: \'learn.questionDetail\'}">问题详情</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="detail-body">\r\n                <div class="article">\r\n                    <p class="article-title"\r\n                       data-bind="text: model.question().viewModel.model.questionTitle"></p>\r\n                    <p class="article-source"><span\r\n                                data-bind="translate:{ key: \'learn.from\'}">来自：</span><span\r\n                                data-bind="text: model.question().viewModel.model.targetName"></span></p>\r\n                    <div class="article-content"\r\n                         data-bind="text: model.question().viewModel.model.questionDes">\r\n                        \x3c!--<img src="../images/img.png" alt="" width="100%" style="margin: 10px 0 0;">--\x3e\r\n                    </div>\r\n                    <p class="article-author"\r\n                       data-bind="model.question().viewModel.model.detailUserInfo"></p>\r\n                </div>\r\n                <div style="margin-top: 5px;background: #F2F2F2;width: 100%;padding: 10px 0 5px 10px;"\r\n                     data-bind="visible: model.question().viewModel.model.quizType() == \'2\'">\r\n                                <span style="margin-right: 20px;float: right;font: 12px/normal \'microsoft yahei\';color: #ccc;"\r\n                                      data-bind="text: model.question().viewModel.model.wordCountAnswer() + \'/2000\'"></span>\r\n                    <textarea\r\n                            style="display: block;width: 335px;height: 100px;border-radius: 3px;margin-bottom: 10px;border: 1px solid #ddd;"\r\n                            maxlength="2000"\r\n                            data-bind="textInput: model.question().viewModel.model.answerContent"></textarea>\r\n                    \x3c!--ko if:model.question().viewModel.model.answer_valid()--\x3e\r\n                    <a href="javascript: void(0);" class="btn" style="margin-left: 248px;padding: 0 15px;"\r\n                       data-bind="click: model.question().viewModel.answerQuestion, translate:{ key: \'learn.answers\'}">回答</a>\r\n                    \x3c!--/ko--\x3e\r\n\r\n                    \x3c!--ko if:!model.question().viewModel.model.answer_valid()--\x3e\r\n                    <a href="javascript: void(0);" class="btn"\r\n                       style="cursor:default;color:#000;background:#d0d0d0;margin-left: 248px;padding: 0 15px;"\r\n                       data-bind="translate:{ key: \'learn.answers\'}">回答</a>\r\n                    \x3c!--/ko--\x3e\r\n                </div>\r\n                <div class="block-title">\r\n                    <i class="icon icon-comt"></i>\r\n                    <em data-bind="text: model.question().viewModel.model.detailTotal"></em>\r\n                    <span data-bind="translate:{key:\'learn.answers\'}">个回答</span>\r\n                </div>\r\n                <div class="detail-list">\r\n                    <ul class="reply-list" data-bind="foreach: model.question().viewModel.model.detailList">\r\n                        <li>\r\n                            <div data-bind="component:{\'name\':\'x-course-learn-question__answer-item\',\'params\':{\'config\':$root.config,\'options\':$root.model.question().viewModel.model.options,\'answer\':$data, \'userId\':userId}}"></div>\r\n                        </li>\r\n                    </ul>\r\n                    <div class="qa-more">\r\n                        <a href="javascript: void(0);" class="qa-more" style="display: none;">点击加载更多回答</a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!--问题详情结束--\x3e\r\n    </div>\r\n</div>'});s.prototype={cancel:function(){$(".add-note-input").addClass("hide"),this.model.noteContent(""),this.model.isOpen(!0)},saveNote:function(){var e,t,n,a,i=this;if(this.model.noteContent()){switch(this.model.biz_param.resource_type()){case 0:case"101":e=this.formatVideoTime(this.model.videoCurrentTime()),t="video";break;case 1:case"102":e=+this.model.docInfo().split("/")[0],t="document";break;case"2":case"103":e=null,t="question";break;case"3":case"104":e=null,t="url";break;case"4":case"105":e=null,t="vr";break;case"5":e=null,t="live";break;case"6":e=null,t="panorama"}var s=JSON.stringify({course_id:this.model.biz_param.course_id(),resource_id:this.model.biz_param.resource_id(),resource_type:+this.model.biz_param.resource_type(),location:e});if(this.config.contextId)switch(this.config.contextId.split(":")[0]){case"auxo-specialty":case"auxo-train":n=this.config.contextId,a=this.config.contextId.split(":")[0];break;default:n="businesscourse_2:"+this.model.biz_param.course_id(),a="businesscourse_2"}else n=this.config.contextId,a="businesscourse_2";var o={content:this.model.noteContent(),target_id:t+":"+this.model.biz_param.resource_id(),target_name:this.model.biz_param.resource_title(),is_open:this.model.isOpen(),excerpt_note_id:"",biz_url:this.config.urls.businessCourseServiceUrl+"/v1/business_courses/biz_data",biz_param:s,context_id:n,custom_type:a,biz_view:"course2_biz_view"};this.model.note_id()?this.store.updateNote(o,this.model.note_id()).done(function(e){i.model.note_id(""),i.model.noteContent(""),i.model.refreshNotes(!0),i.model.isOpen(!0),$(".add-note-input").addClass("hide")}):this.store.createNote(o).done(function(e){i.model.noteContent(""),i.model.refreshNotes(!0),i.model.isOpen(!0),$(".add-note-input").addClass("hide")})}},formatVideoTime:function(e){var t=e.split(":");return 60*Number(t[0])+Number(t[1])}},e.components.register("x-course-learn-note__note-add",{viewModel:s,template:'<div id="x-course-learn-note" style="position: absolute;bottom: 0;left:0;background-color: #EDEDEF;width:360px;">\r\n    <div class="add-note-input hide">\r\n        <div class="note-icon-txt">\r\n            \x3c!-- ko if: model.biz_param.resource_type() == \'0\' || model.biz_param.resource_type() == \'101\' --\x3e\r\n            <a class="note-icon iconfont-learn n-icon-video"></a>\r\n            <span class="note-txt" data-bind="text: model.videoCurrentTime"></span>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: model.biz_param.resource_type() == \'1\' || model.biz_param.resource_type() == \'102\' --\x3e\r\n            <a class="note-icon iconfont-learn n-icon-chapter"></a>\r\n            <span class="note-txt"><span data-bind="text: model.docInfo"></span></span>\r\n            \x3c!-- /ko --\x3e\r\n        </div>\r\n        <div class="add-note-textarea">\r\n            <form action="">\r\n                <textarea placeholder="在此写下您的笔记..." name="writeDown" id="content" style="padding: 0;resize: none;"\r\n                          data-bind="textInput: model.noteContent, translate:{ key: \'note.placeholder\',target:[\'placeholder\']}"></textarea>\r\n            </form>\r\n            <div style="margin-left: 290px;"><span data-bind="text: wordCount">0</span>/400</div>\r\n        </div>\r\n        <div class="add-note-btns" style="margin-bottom: 10px;">\r\n            \x3c!-- ko if: !model.excerpt_note_id()  && model.report_count() < 3 --\x3e\r\n            <label for="tht" style="position: absolute;left: 0;top: 3px;">\r\n                <input id="tht" type="checkbox" style="margin-bottom: 2px;" data-bind="checked: model.isOpen">\r\n                \x3c!-- ko translate: {key: \'note.isOpen\'} --\x3e\r\n                公开笔记\r\n                \x3c!-- /ko --\x3e\r\n            </label>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: model.excerpt_note_id() && model.report_count() < 3 --\x3e\r\n            <div class="note-icon-txt">\r\n                <a class="note-icon  iconfont-learn n-icon-star"></a>\r\n                <span class="note-txt note-txt-light-gray" data-bind="translate:{key:\'note.fromExcerpt\'}">来自摘录</span>\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: model.report_count() >= 3 --\x3e\r\n            <div class="note-icon-txt">\r\n                <span class="note-txt note-txt-light-gray" data-bind="translate:{key:\'note.reported\'}">被举报</span>\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            <a href="javascript:;" class="n-ui-btn n-ui-btn-gray"\r\n               data-bind="click: cancel, translate: {key: \'note.cancel\'}">取消</a>\r\n            <a href="javascript:;" class="n-ui-btn n-ui-btn-main"\r\n               data-bind="click: saveNote, translate:{key:\'note.save\'}" style="display: none;">保存</a>\r\n            <a href="javascript:;" class="n-ui-btn n-ui-btn-disable" data-bind="translate:{key:\'note.save\'}">保存</a>\r\n        </div>\r\n    </div>\r\n</div>'});var k=i18nHelper.getKeyValue,w=e.utils,T=function(){function t(n){var a=this;r(this,t),this.offset=0,this.offsetAll=0,this.oneTime=!0,this.first=!0,this.config=n.config,this.opts3={userId:window.userId,apiHost:this.config.urls.noteServiceUrl,isLogin:!!window.userId,showExcerpt:!1,showBlowing:!1,showEdit:!0,showDel:!0,onEditCommand:function(e){a.model.createBuildNote.editNoteInfo(e)},onDelCommand:function(e){$(".u-ui-mask").show(),a.model.deleteId(e)}},this.opts4={userId:window.userId,apiHost:this.config.urls.noteServiceUrl,isLogin:!!window.userId,showExcerpt:!0,showBlowing:!0,showEdit:!1,showDel:!1},this.model={scrollTopMy:e.observable(null),scrollTopAll:e.observable(null),deleteId:e.observable(""),myNoteList:e.observableArray(),noQusMine:e.observable(!1),allNoteList:e.observableArray(),noQusAll:e.observable(!1),isLoading:e.observable(!1),noteType:e.observable(1),buttonText:k("courseLearn.note.add"),isShow:e.observable(!1),total:e.observable(0),allTotal:e.observable(0),createBuildNote:{biz_param:{course_id:e.observable(courseId),resource_id:e.observable(""),resource_type:e.observable(""),course_title:e.observable(""),resource_title:e.observable(""),location:e.observable("")},videoCurrentTime:e.observable(""),docInfo:e.observable(""),refreshNotes:e.observable(!1),editNoteInfo:e.observable(null),excerpt_note_id:e.observable(null),note_id:e.observable(null)},filterMy:{page:e.observable(0),size:e.observable(20)},filterAll:{order_by:e.observable(0),page:e.observable(0),size:e.observable(20)}},this.resource=e.observable(null).subscribeTo("RESOURCE",this.resourceModify,this),this.model.playerData=e.observable(null).subscribeTo("PLAYER_DATA",this.playerDataModify,this).publishOn("GET_PLAYER_DATA"),this.store={getMyNote:function(e){return e.target_id=o(a.resource().type)+":"+a.resource().id,e.course_id=a.config.courseId,$.ajax({url:a.config.urls.noteGatewayUrl+"/v2/my_notes",data:e,cache:!1})},getAllNote:function(e){return e.target_id=o(a.resource().type)+":"+a.resource().id,e.course_id=a.config.courseId,$.ajax({url:a.config.urls.noteGatewayUrl+"/v2/notes",data:e,cache:!1})},deleteNote:function(e){return $.ajax({url:a.config.urls.noteServiceUrl+"/v1/notes/"+e,type:"delete"})}},this.init()}return t.prototype.resourceModify=function(e){this.resource(e),e?this.getNotes():this.clearNotes()},t.prototype.clearNotes=function(){this.model.filterMy.page(0),this.model.filterMy.size(20),this.model.filterAll.page(0),this.model.filterAll.size(20),this.model.myNoteList([]),this.model.total(0),this.model.allNoteList([]),this.model.allTotal(0)},t.prototype.init=function(){var e=this;window.innerHeight<1e3&&$(".note-tab-cont").css("height","670px"),$(".note-tab-cont").on("scroll",function(){this.scrollTop+this.clientHeight==this.scrollHeight&&"1"==e.model.noteType()?(0==e.model.filterMy.page()&&e.model.filterMy.page(1),e.model.filterMy.page(e.model.filterMy.page()+1),e.model.filterMy.size(10),e.model.noQusMine()||e.getMyNotes(!0)):this.scrollTop+this.clientHeight==this.scrollHeight&&"2"==e.model.noteType()&&(0==e.model.filterAll.page()&&e.model.filterAll.page(1),e.model.filterAll.page(e.model.filterAll.page()+1),e.model.filterAll.size(10),e.model.noQusAll()||e.getAllNotes(!0))}),this.model.createBuildNote.refreshNotes.subscribe(function(t){t&&(setTimeout(function(){e.model.filterMy.page(0),e.model.filterMy.size(20),e.model.filterAll.page(0),e.model.filterAll.size(20),e.getNotes()},500),e.model.createBuildNote.refreshNotes(!1))})},t.prototype.switchTab=function(e){this.model.noteType()!=e&&(this.model.noteType(e),"1"==e?(this.model.isShow(!0),this.model.filterMy.page(0),this.model.filterMy.size(20),this.resource()&&this.getMyNotes()):(this.model.isShow(!1),this.model.filterAll.page(0),this.model.filterAll.size(20),this.resource()&&this.getAllNotes()))},t.prototype.getMyNotes=function(t){var n=this,a=e.mapping.toJS(this.model.filterMy);userId&&this.store.getMyNote(a).done(function(e){e&&e.items&&!t?(n.model.myNoteList(e.items),n.model.total(e.count)):(w.arrayForEach(e.items,function(e){n.model.myNoteList.push(e)}),e.items.length?$(".note-tab-cont").scrollTop(0):n.model.noQusMine(!0))})},t.prototype.getAllNotes=function(t){var n=this,a=e.mapping.toJS(this.model.filterAll);this.store.getAllNote(a).done(function(e){e&&e.items&&!t?(n.model.allNoteList(e.items),n.model.allTotal(e.count)):(w.arrayForEach(e.items,function(e){n.model.allNoteList.push(e)}),e.items.length?$(".note-tab-cont").scrollTop(0):n.model.noQusAll(!0))})},t.prototype.getNotes=function(){this.resource()&&(this.model.isShow(!0),this.model.filterMy.page(0),this.model.filterMy.size(20),this.resource()&&this.getMyNotes())},t.prototype.playerDataModify=function(e){if(e){switch(e.resource.type){case 0:this.model.createBuildNote.videoCurrentTime(this.formatTime(e.currentPos));break;case 1:this.model.createBuildNote.docInfo(e.currentPos+"/"+e.resource.resource_data.page_count)}this.model.createBuildNote.biz_param.resource_id(e.resource.id),this.model.createBuildNote.biz_param.resource_type(e.resource.type),this.model.createBuildNote.biz_param.resource_title(e.resource.name),this.model.createBuildNote.excerpt_note_id(null),this.model.createBuildNote.note_id(null),$("#tht").attr("checked",!0),$(".add-note-input").removeClass("hide")}},t.prototype.showEdit=function(){this.model.playerData({})},t.prototype.formatTime=function(e){var t="number"==typeof e?Math.floor(Number(e)):0,n=Math.floor(t/60),a=t%60;return n<10&&(n="0"+n),a<10&&(a="0"+a),n+":"+a},t.prototype.confirmDelete=function(){var e=this;this.store.deleteNote(this.model.deleteId()).done(function(t){$(".u-ui-mask").hide(),$.each(e.model.myNoteList(),function(t,n){if(n.id==e.model.deleteId())return e.model.myNoteList.splice(t,1),!1}),e.model.total(e.model.total()-1)})},t.prototype.deleteCancel=function(){$(".u-ui-mask").hide()},t}();e.components.register("x-course-learn-note",{viewModel:T,template:'<div class="mod-sidebar">\r\n    \x3c!--当a.add-note-btn为显示状态时，div.tab添加btn-status--\x3e\r\n    \x3c!--当div.add-note-input为显示状态时，div.tab添加input-status--\x3e\r\n    \x3c!--todo: 0424新增div.tab这一层--\x3e\r\n    <div class="tab btn-status">\r\n        <div class="n-ui-tab3">\r\n            <a href="javascript:;" class="btn-tab" noteType="1"\r\n               data-bind="click:switchTab.bind($component,\'1\'),translate:{key:\'courseLearn.note.mine\'},css:{\'on\':model.noteType()==\'1\'}"></a>\r\n            <a href="javascript:;" class="btn-tab" noteType="2"\r\n               data-bind="click:switchTab.bind($component,\'2\'),translate:{key:\'courseLearn.note.all\'},css:{\'on\':model.noteType()==\'2\'}"></a>\r\n        </div>\r\n\r\n        <div class="note-tab-cont" style="overflow: auto;position: absolute;bottom: 71px;top: 59px;right: 0;left: 0;">\r\n            \x3c!--隐藏 hide--\x3e\r\n            \x3c!-- ko if: model.isShow() && model.myNoteList().length --\x3e\r\n            <div class="note-tip">\r\n                <p class="n-ui-txt">\r\n                    <span data-bind="translate:{key:\'courseLearn.note.total\'}">共</span>\r\n                    <span class="n-ui-txt-main" data-bind="text: model.total"></span>\r\n                    <span data-bind="translate:{key:\'courseLearn.note.notes\'}">篇笔记</span>\r\n                </p>\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: !model.isShow() && model.allNoteList().length --\x3e\r\n            <div class="note-tip">\r\n                <p class="n-ui-txt">\r\n                    <span data-bind="translate:{key:\'courseLearn.note.total\'}">共</span>\r\n                    <span class="n-ui-txt-main" data-bind="text: model.allTotal"></span>\r\n                    <span data-bind="translate:{key:\'courseLearn.note.notes\'}">篇笔记</span>\r\n                </p>\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            <div class="note-list">\r\n                \x3c!--笔记列表为空开始--\x3e\r\n                \x3c!-- ko if: model.isShow() && !model.myNoteList().length --\x3e\r\n                <div class="note-empty">\r\n                    <i class="note-empty-icon"></i>\r\n                    <p class="note-empty-tips" data-bind="translate:{key:resource()?\'courseLearn.note.noNote\':\'courseLearn.note.noResource\'}">暂时没有笔记</p>\r\n                    <a class="note-empty-btn"\r\n                       data-bind="translate:{key:\'courseLearn.note.addNote\'}, click: showEdit,visible:resource">添加笔记</a>\r\n                </div>\r\n                \x3c!-- /ko --\x3e\r\n                \x3c!--全部笔记为空的条件--\x3e\r\n                \x3c!-- ko if: !model.isShow() && !model.allNoteList().length --\x3e\r\n                <div class="note-empty">\r\n                    <i class="note-empty-icon"></i>\r\n                    <p class="note-empty-tips" data-bind="translate:{key:resource()?\'courseLearn.note.noNote\':\'courseLearn.note.noResource\'}">暂时没有笔记</p>\r\n                    <a class="note-empty-btn"\r\n                       data-bind="translate:{key:\'courseLearn.note.addNote\'}, click: showEdit,visible:resource">添加笔记</a>\r\n                </div>\r\n                \x3c!-- /ko --\x3e\r\n\r\n                \x3c!--我的笔记列表开始--\x3e\r\n                \x3c!-- ko if: model.isShow() --\x3e\r\n                \x3c!-- ko foreach: model.myNoteList --\x3e\r\n                <div id="myNoteList"\r\n                     data-bind="component:{name: \'x-note-item-b\', params:{note:$data, options: $parent.opts3}}"></div>\r\n                \x3c!-- /ko --\x3e\r\n                \x3c!-- /ko --\x3e\r\n\r\n                \x3c!--全部笔记列表开始--\x3e\r\n                \x3c!-- ko if: !model.isShow() --\x3e\r\n                \x3c!-- ko foreach: model.allNoteList --\x3e\r\n                <div id="allNoteList"\r\n                     data-bind="component:{name: \'x-note-item-b\', params:{note:$data, options: $parent.opts4}}"></div>\r\n                \x3c!-- /ko --\x3e\r\n                \x3c!-- /ko --\x3e\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="u-ui-add-note" style="background-color: #fff;">\r\n        \x3c!--当a.add-note-btn为显示状态时，div.tab添加btn-status--\x3e\r\n        \x3c!--当div.add-note-input为显示状态时，div.tab添加input-status--\x3e\r\n        \x3c!--a.add-note-btn和div.dd-note-input的显示/隐藏状态，删除/添加hide--\x3e\r\n        <a class="add-note-btn note-icon-txt"\r\n           style="position: absolute;bottom: 15px;width: 320px;background-color: #fff;border: 1px solid #DEDEDF;"\r\n           data-bind="click: showEdit,visible:resource">\r\n            \x3c!--高亮状态为 on--\x3e\r\n            <i class="note-icon iconfont-learn n-icon-pen"></i>\r\n            <span class="note-txt" data-bind="translate:{key:\'courseLearn.note.addNote\'}">添加笔记</span>\r\n        </a>\r\n        \x3c!--组件在这里引用--\x3e\r\n        <div data-bind="component: { name: \'x-course-learn-note__note-add\', params: {\'config\':$root.config,data: model.createBuildNote} }"></div>\r\n    </div>\r\n    \x3c!--弹窗--\x3e\r\n    <div class="u-ui-mask" style="position: absolute;display: none;">\r\n        <div class="u-ui-pop" style="min-width: 340px;margin-left: -170px;">\r\n            <h3 class="pop-tit">\r\n                <span class="tit-left" data-bind="translate:{key:\'courseLearn.note.tips\'}">提示</span>\r\n                <span class="pop-close" data-bind="click: deleteCancel"></span>\r\n            </h3>\r\n            <div class="pop-content">\r\n                <p class="tip" data-bind="translate:{key:\'courseLearn.note.confirm\'}">确定删除此篇笔记吗？</p>\r\n            </div>\r\n            <div class="pop-footer">\r\n                <a href="javascript:;" class="u-ui-btn"\r\n                   data-bind="click: confirmDelete, translate: {key:\'courseLearn.note.sure\'}">确定</a>\r\n                \x3c!-- u-ui-btn加类on表示变为蓝色 --\x3e\r\n                <a href="javascript:;" class="u-ui-btn ml10"\r\n                   data-bind="click: deleteCancel, translate: {key:\'courseLearn.note.cancel\'}">取消</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \x3c!--弹窗--\x3e\r\n</div>'})}(ko);
