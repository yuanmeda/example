!function(e){"use strict";e="default"in e?e["default"]:e;var a=function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")},r=function(){function r(n){a(this,r),this.model={course:e.observable(n.course),pkId:e.observable(n.course.catalog[0].extra&&n.course.catalog[0].extra.pk_id)},this.options=n.options,this.projectCode=n.options.projectCode,this.urls=this.options.urls||{api:"",gateway:"","static":""}}return r.prototype.switchChapter=function(e){this.model.pkId(""),this.model.pkId(e.extra&&e.extra.pk_id)},r}();e.components.register("x-course-detail-pk-container",{viewModel:r,template:'<div class="x-course-detail-pk pk-entrance-main">\r\n    <div class="catelog-l">\r\n        <div class="note-side">\r\n            <div class="n-ui-tab-menu">\r\n                <a href="javascript:;" class="btn-tab" data-bind="translate: {key: \'courseDetailPk.catalog\'}">课程目录</a>\r\n                \x3c!--<a href="###" class="btn-tab">知识索引</a>--\x3e\r\n            </div>\r\n            <div class="n-ui-menu">\r\n                \x3c!-- 课程目录 --\x3e\r\n                <dl class="dlist" data-bind="visible: model.course().catalog.length">\r\n                    <dt data-bind="text: model.course_name, attr: {title: model.course_name},click:switchChapter.bind($component)"\r\n                        style="cursor:pointer;"></dt>\r\n                    \x3c!-- ko foreach: {data: model.course().catalog, as: \'catalog\'} --\x3e\r\n                    <dd data-bind="css:{\'open\': !$index()}">\r\n                        <div class="d-item"\r\n                             data-bind="attr:{title: catalog.title}, click: $component.switchChapter.bind($component)">\r\n                            <span data-bind="text: catalog.title"></span>\r\n                            <span class="tree-pk" data-bind="visible:extra && extra.pk_id"></span>\r\n                        </div>\r\n                    </dd>\r\n                    \x3c!-- /ko --\x3e\r\n                </dl>\r\n                \x3c!-- 课程目录为空 --\x3e\r\n                <p class="no-menu"\r\n                   data-bind="visible: !model.course().catalog.length,translate:{key: \'courseDetailPk.noCatalog\'}">\r\n                    暂无课程目录</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="relavant-r">\r\n        \x3c!--ko if:model.pkId--\x3e\r\n        <div data-bind="component: {\'name\': \'x-course-detail-pk-entrance\', params: {\'pkId\':model.pkId(),\'options\':options}}"></div>\r\n        \x3c!--/ko--\x3e\r\n        \x3c!--ko if:!model.pkId()--\x3e\r\n        <div class="no-pk-wrap">\r\n            <img data-bind="attr:{\'src\':urls.static + \'auxo/component/js-course-detail-pk/images/ico-nopk.png\'}">\r\n            <p data-bind="translate:{key: \'courseDetailPk.noCoursePk\'}">该节课程暂无PK赛，我们正在为您努力准备中！</p>\r\n        </div>\r\n        \x3c!--/ko--\x3e\r\n    </div>\r\n</div>'});var n=function(){function r(n){var t=this;a(this,r),this.model={pkId:e.observable(n.pkId),pk:e.observable(null),pkUser:e.observable(null)},this.options=n.options,this.projectCode=n.options.projectCode,this.urls=this.options.urls||{api:"",gateway:"","static":""},this.store={getPkDetail:function(){return $.ajax({url:t.urls.gateway+"/v2/pk_details/"+n.pkId,dataType:"json",cache:!1})},getPkUser:function(e){return $.ajax({url:t.urls.gateway+"/v1/pk_users",dataType:"json",data:e,cache:!1})}},this.init()}return r.prototype.init=function(){this.getPkDetail(),this.getPkUser()},r.prototype.getPkDetail=function(){var e=this;this.store.getPkDetail().done(function(a){e.model.pk(a)})},r.prototype.getPkUser=function(){var e=this;this.store.getPkUser({pk_id:this.model.pkId()}).done(function(a){e.model.pkUser(a)})},r.prototype.hrefToRecord=function(){var e=this.urls.gateway+"/"+this.projectCode+"/pk/"+this.model.pkId()+"/record",a=Nova.getMacToB64(e);window.open().location.href=e+(a?"?__mac="+a:"")},r.prototype.hrefTo=function(e){var a="";a=e||!this.model.pk().user_exam_session?this.urls.gateway+"/"+this.projectCode+"/pk/"+this.model.pkId()+"/answer":this.urls.gateway+"/"+this.projectCode+"/pk/"+this.model.pkId()+"/choose";var r=Nova.getMacToB64(a);window.open().location.href=a+(r?"?__mac="+r:"")},r.prototype.formatDuration=function(e){if(!e&&0!==e)return e;var a=~~(e/60/60),r=~~((e-60*a*60)/60),n=~~(e-60*a*60-60*r);return(a<10?"0"+a:a)+":"+(r<10?"0"+r:r)+":"+(n<10?"0"+n:n)},r}();e.components.register("x-course-detail-pk-entrance",{viewModel:n,template:'<div class="pk-entrance" data-bind="if:model.pk()&&model.pkUser()">\r\n    <h3 data-bind="text:model.pk().pk.name">走进生命科学PK赛</h3>\r\n    <div class="pk-situ-show">\r\n        <div class="pk-situ-list">\r\n            \x3c!--ko ifnot:model.pkUser().best_pk_answer --\x3e\r\n            <dl class="clearfix">\r\n                <dt data-bind="translate:{\'key\':\'courseDetailPk.bestScore\'}">最佳分数</dt>\r\n                <dd>\r\n                    <span class="line"></span>\r\n                </dd>\r\n            </dl>\r\n            <dl class="clearfix">\r\n                <dt data-bind="translate:{\'key\':\'courseDetailPk.bestCostTime\'}">最短用时</dt>\r\n                <dd>\r\n                    <span class="line"></span>\r\n                </dd>\r\n            </dl>\r\n            \x3c!--\r\n            <dl class="clearfix">\r\n                <dt data-bind="translate:{\'key\':\'courseDetailPk.pkRank\'}">PK排名</dt>\r\n                <dd>\r\n                    <span class="line"></span>\r\n                </dd>\r\n            </dl>\r\n            --\x3e\r\n            <dl class="clearfix">\r\n                <dt data-bind="translate:{\'key\':\'courseDetailPk.pkWinRate\'}">PK胜率</dt>\r\n                <dd>\r\n                    <span class="line"></span>\r\n                </dd>\r\n            </dl>\r\n            \x3c!--/ko--\x3e\r\n            \x3c!--ko if:model.pkUser().best_pk_answer --\x3e\r\n            <dl class="clearfix">\r\n                <dt data-bind="translate:{\'key\':\'courseDetailPk.bestScore\'}">最佳分数</dt>\r\n                <dd>\r\n                    <span class="relavant-value"\r\n                          data-bind="translate:{\'key\':\'courseDetailPk.scoreAndTotal\',\'properties\':{\'score\':model.pkUser().best_pk_answer.user_exam_session.score,\'totalScore\':model.pkUser().best_pk_answer.user_exam_session.paper.score}}">95 <em>(100满分)</em></span>\r\n                    <a class="brush-score" href="javascript:;"\r\n                       data-bind="click:$component.hrefTo.bind($component,true),translate:{\'key\':\'courseDetailPk.refreshScore\'}">刷成绩</a>\r\n                </dd>\r\n            </dl>\r\n            <dl class="clearfix">\r\n                <dt data-bind="translate:{\'key\':\'courseDetailPk.bestCostTime\'}">最短用时</dt>\r\n                <dd>\r\n                    <span class="relavant-value"\r\n                          data-bind="text:formatDuration(model.pkUser().best_pk_answer.user_exam_session.fix_cost_time)">00:00:50</span>\r\n                </dd>\r\n            </dl>\r\n            \x3c!--\r\n            <dl class="clearfix">\r\n                <dt data-bind="translate:{\'key\':\'courseDetailPk.pkRank\'}">PK排名</dt>\r\n                <dd>\r\n                    <span class="relavant-value"\r\n                          data-bind="translate:{\'key\':model.pkUser().user_rank?\'courseDetailPk.pkRankNumber\':\'courseDetailPk.noPkRankNumber\',\'properties\':{\'number\':model.pkUser().user_rank?model.pkUser().user_rank.rank:0}}">28名</span>\r\n                </dd>\r\n            </dl>\r\n            --\x3e\r\n            <dl class="clearfix">\r\n                <dt data-bind="translate:{\'key\':\'courseDetailPk.pkWinRate\'}">PK胜率</dt>\r\n                <dd>\r\n                    <span class="relavant-value" data-bind="text:Math.round(model.pkUser().win_rate)*100+\'%\'">48%</span>\r\n                </dd>\r\n            </dl>\r\n            \x3c!--/ko--\x3e\r\n            <div class="oprate-wrap">\r\n                <div class="pk-rule-wrap">\r\n                    <span class="rule xcdp-icon-rule" data-bind="translate:{\'key\':\'courseDetailPk.pkRule\'}">PK规则</span>\r\n                    <div class="rule-popup" data-bind="text:model.pk().rule_description,visible:model.pk().rule_description">\r\n                        <p>1、先在5分钟内完成10道题的闯关任务，分数越高获得更高的积分奖励（积分=分数*10）</p>\r\n                        <p>2、闯关成功后可以通过与其他人PK获得积分奖励，快来闯关吧</p>\r\n                    </div>\r\n                    <div class="rule-popup" data-bind="translate:{\'key\':\'courseDetailPk.noPkRankNumber\'},visible:!model.pk().rule_description">\r\n                    </div>\r\n                </div>\r\n                \x3c!--ko if:model.pk().user_exam_session --\x3e\r\n                \x3c!--\r\n                <a class="see-ranking xcdp-icon-rank" href="javascript:;"\r\n                   data-bind="translate:{\'key\':\'courseDetailPk.pkRankList\'}">PK排行</a>\r\n                   --\x3e\r\n                <a class="see-score xcdp-icon-score" href="javascript:;"\r\n                   data-bind="click:hrefToRecord,translate:{\'key\':\'courseDetailPk.pkRecord\'}">PK战绩</a>\r\n                \x3c!--/ko--\x3e\r\n            </div>\r\n        </div>\r\n        <div class="btm-wrap">\r\n            <a class="btn-border-blue" href="javascript:;"\r\n               data-bind="click:hrefTo.bind($component,null),translate:{\'key\':model.pk().user_exam_session?\'courseDetailPk.goPk\':\'courseDetailPk.goSingle\'}">闯关答题/发起挑战</a>\r\n        </div>\r\n    </div>\r\n</div>'})}(ko);
