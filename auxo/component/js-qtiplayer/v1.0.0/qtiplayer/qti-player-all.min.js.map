{"version":3,"sources":["qti-player-all.min.js"],"names":["window","document","$","require","define","defined","defineWaiting","callDeps","key","toLowerCase","df","args","i","deps","length","depName","ret","callback","apply","Array","Error","module","_logger","_event","_ajax","XDomainRequest","debug","_getUrl","url","errorCallback","that","this","request","open","onload","responseText","onprogress","ontimeout","error","ex","onerror","trigger","send","ajax","method","dataType","cache","done","xmlText","fail","_utils","convertTextToMultiple","assessmentItemModel","isTextEntry","prompt","firstModelId","modelMap","modelKey","model","modelType","replace","modelHtml","modelId","getValue","keyboard","style","width","expectedLength","multipleModel","questionType","correctAnswer","answer","value","push","identifier","cardinality","baseType","logger","_emptyFunc","_eventHandler","load","group","type","para","bind","exception","create","message","throwable","code","prototype","forEach","item","String","trim","clear","pop","pushArray","toPush","concat","arguments","len","indexOf","_xml","_this","_xmlinnerHTMLSTR","DOMParser","oSerializer","XMLSerializer","serializeToString","xml","myregexp","_xmlinnerHTML","match","noop","methods","_console","console","_level","setLevel","level","_log","e","msg","info","warn","QtiPlayer","jsonParser","xmlParser","_QtiPlayer","getLogger","getUtils","setLoggerLevel","loadSrc","option","Object","JSON","stringify","prefix","substring","parse","unifyTextEntry","text","loadOnError","_encodeLeftRegex","_decodeLeftRegex","_encodeRightRegex","_decodeRightRegex","_encodeAndRegex","_decodeAndRegex","_decodeBlankRegex","xmlEncode","xmlDecode","stringToBoolean","v","result","index","arr","getValues","r","values","getIntValue","parseInt","getBasePath","path","hashIndex","lastIndexOf","queryIndex","slashIndex","Math","min","template","tpl","attrs","templateRegExp","$0","$1","$2","undefined","getUuid","s","hexDigits","substr","floor","random","uuid","join","getPathSuffix","reUrl","dotIndex","addAnswer","response","base_type","corrects","feedbackParser","_subjectiveRegex","_subjectiveBaseAssetRegex","_subjectiveBaseAssetPosterRegex","_subjectiveBaseAssetSrcRegex","_subjectiveBaseAssetTypeRegex","_subjectiveBaseTextRegex","_widthRegex","_heightRegex","content","itemModel","test","assets","assetsResult","asset","poster","src","height","contentData","addFeedBack","feedback","showHide","show_hide","questionTypeToModelType","types","choice","multiplechoice","vote","judge","order","extendedtext","graphicgapmatch","textentry","textentrymultiple","drawing","handwrite","subjectivebase","inlinechoice","checkUseMath","texts","number","addTextEntryModel","textentrys","responses","j","addMultipleTextEntryModel","questionModel","filterMultTextentryInteraction","response_identifier","otherMsg","resModel","rubricBlock","_responseTextRegex","view","subjectiveBase","prompt_object","asset_titles","assetsTitle","assetTitle","object","paperType","papertype","title","filterTextentryInteraction","titleType","titletype","param","params","data","keys","name","valueType","gapImg","gap_imgs","obj","matchMax","associableHotspot","associable_hotspots","groups","groupsArray","choices","playerChoice","fixed","match_max","groupId","group_id","array","simpleMatchSet","addModel","layout","shuffle","maxChoices","max_choices","minChoices","min_choices","maxAssociations","minAssociations","simpleChoice","findByModelId","id","ids","useTextentry","addInlineModel","inlineChoice","children","jsonAdapter","convert","assessment","answerFeedback","hasMath","hintFeedback","feedbacks","sequence","playerFeedback","items","regex","responseidentifier","$3","playerItem","full_score","user_score","playerAnswer","_jsonConvert","_json","_refPathRegex","_refBaseRegex","_imgFilterRegex","_convert","parseJson","jsonText","refPath","basePath","mId","choiceInteraction","_choiceInteractionRegex","_choiceInteractionAttrRegex","_responseIdentifierRegex","_styleRegex","_shuffleRegex","_maxChoicesRegex","_minChoicesRegex","_promptRegex","_simpleChoiceRegex","_simpleChoiceValueRegex","_identifierRegex","_fixedRegex","_questionTypeRegex","_layoutRegex","modelXml","choiceInteractionAttr","simpleChoiceXml","simpleChoiceXmlArr","correctAnswerParser","_correctAnswerRegex","_cardinalityRegex","_baseTypeRegex","_answerRegex","_answerValueRegex","correctAnswerXml","correctAnswerXmlArr","drawingInteraction","_drawingInteractionRegex","_drawingInteractionAttrRegex","_titleTypeRegex","_paperTypeRegex","_titleRegex","_contentRegex","_assetRegex","_assetValueRegex","_assetTitleRegex","_assetTitleValueRegex","_emptyAssetRegex","_emptyAssetTitleRegex","_objectRegex","_dataRegex","_typeRegex","drawingInteractionAttr","assetXml","hasAsset","assetTitleXml","hasAssetTitle","objectXml","extendedTextInteraction","_extendedTextInteractionRegex","_extendedTextInteractionAttrRegex","extendedTextInteractionAttr","_feedbackRegex","_showHideRegex","_sequenceRegex","feedbackXml","feedbackXmlArr","gapMatchInteraction","_gapMatchInteractionRegex","_gapMatchInteractionAttrRegex","_gapTextRegex","_gapTextValueRegex","_matchMaxRegex","_tableContentRegex","gapMatchInteractionAttr","gapText","gapTextXmlArr","gapTextXml","gapTextObj","tableContent","tableMatchContent","graphicGapMatchInteraction","_graphicGapMatchInteractionRegex","_graphicGapMatchInteractionAttrRegex","_paramRegex","_nameRegex","_valueRegex","_valueTypeRegex","_gapImgRegex","_associableHotspotRegex","_shapeRegex","_coordsRegex","graphicGapMatchInteractionAttr","paramXmlArr","paramXml","gapImgXmlArr","gapImgXml","gapImgObj","associableHotspotXmlArr","associableHotspotXml","associableHotspotObj","shape","coords","inlineChoiceInteraction","_inlineChoiceInteractionRegex","_inlineChoiceInteractionAttrRegex","_inlineChoiceRegex","_inlineChoiceValueRegex","inlineChoiceInteractionAttr","inlineChoiceXmlArr","inlineChoiceXml","matchInteraction","_matchInteractionRegex","_matchInteractionAttrRegex","_maxAssociationsRegex","_minAssociationsRegex","_simpleMatchSetRegex","_simpleMatchSetValueRegex","_simpleAssociableChoiceRegex","_simpleAssociableChoiceValueRegex","matchInteractionAttr","simpleMatchSetXml","simpleAssociableChoiceXmlArr","simpleAssociableChoiceXml","simpleAssociableChoice","simpleMatchSetXmlArr","cIndex","orderInteraction","_orderInteractionRegex","_orderInteractionAttrRegex","orderInteractionAttr","_rubricBlockRegex","_idRegex","_viewRegex","rubricBlockMap","textEntryInteraction","_textEntryInteractionRegex","_expectedLengthRegex","_keyboardRegex","textEntryMultipleInteraction","_textEntryMultipleInteractionRegex","_textEntryMultipleInteractionAttrRegex","textEntryMultipleInteractionAttr","utils","_mathLeftDecodeRegex","_mathRightDecodeRegex","_mathRegex","_textEntryInteractionFilterRegex","_modelFeedbackFilterRegex","_textEntryFilterRegex","_paramFilterRegex","_associableHotspotFilterRegex","_objectFilterRegex","modelParser","_itemBodyRegex","_parserMap","parser","parseXml","filterXml","decodeAndRegex","_imageLoader","ModelItem","AssessmentItem","_media","_itemModel","_answer","_isComposite","_sequenceNumber","_stat","_modelItem","_score","_supportType","_fullScoreMap","_userScoreMap","_state","_titleExtras","_answerExtras","_mediaClass","_videoMinSize","_audioMinSize","_videoTagRegex","_audioTagRegex","_mediaSrcAttrRegex","_posterAttrRegex","_heightAttrRegex","_widthAttrRegex","_modelRegex","_modelIdRegex","_modelNumRegex","_modelHtmlRegex","_modelLatexRegex","_modelIsWYSIWYG","event","media","instance","extend","totalFullScore","totalUserScore","modelNum","state","modelItem","_model","getScore","setScore","score","getAnswer","getItemModel","setAnswer","newAnswer","modelAnswer","_checkAnswer","setStat","stat","newStat","setTitleExtras","extras","titleExtras","setExtrasAnswer","$view","extra","isAppended","extraHtml","appendView","appendToModelId","cleanModelId","cleanExtras","appendToExtras","setFullScore","retrieveData","fullScore","_calTotalScore","getFullScore","totalScore","setUserScore","userScore","getUserScore","parseFloat","getAnswerState","currentAnswer","responseVariable","completionStatus","duration","numAttempts","correctResponse","candidateResponse","each","setAnswerState","answerState","getState","_stateParser","responseVariableRegex","identifierRegex","baseTypeRegex","cardinalityRegex","stateRegex","candidateResponseRegex","valueRegex","setState","modelAnawer","responseVariableArray","_checkAnswerValue","correctValue","currentValue","valueArray","split","_checkTextAnswerValue","_checkModelAnswer","reset","modelResult","tempAnswer","currentResult","errorCount","temp","shift","isCorrect","isIncomplete","_getTitleExtras","_getCompositeTitleExtras","createHintHtml","hintHtml","tipTxt","getLangText","confirm","hintEventHandle","$hintEnter","find","$hintTipWrapper","$hintText","$hintCloseBtn","qpStopMouseWheel","dy","deltaY","currentTarget","scrollTop","closeHintTip","addClass","removeClass","tipHeight","css","tipWinHeight","windowHeight","isNaN","abs","$target","target","$tip","closest","_setExtrasTitleHtml","titleHtml","modelName","showQuestionName","suffix","createExtrasHtml","extrasOption","html","hintFeedbackContent","answerFeedbackContent","userAnswerHtml","correctAnswerHtml","getModel","getCorrectAnswer","ar","showUserAnswer","showCorrectAnswer","extrasUserAnswer","_option","extrasCorrectAnswer","checked","showHint","showAnalyse","_parseHtml","isSupport","init","numHtml","answerHtml","extrasHtml","showNum","hasNum","num","isElearningSkin","showTitleArea","hasTitle","createTitleHtml","getTitleExtras","getName","hideAnswerArea","isBlock","tag","createAnswerHtml","hasHint","centerHtml","modelHtmlArr","swfHost","Video","word","videoSrc","videoHeight","videoWidth","videoPoster","log","audioSrc","audioHeight","audioWidth","audioPoster","_parseCompositeHtml","HTML","compositeTitle","compositeBody","titleResult","exec","showCompositeSeparate","_compositeSeparateEventHandler","twoLineHeight","$title","$titleContent","$titleInside","$separateBar","$compositeBody","titleInsideHeight","lineHeight","fontSize","paddingTop","paddingBottom","separate","toggle","barHeight","viewHeight","hasClass","resize","on","render","setOption","qpPlayerLatexLoadingClass","MathJax","showNumClass","showScoreClass","showScore","isSimpleModel","qpModelName","isComposite","itemBodyHtml","parseImage","matjaxLoading","bodyClass","skin","platForm","showCompositeClass","showMedia","$this","attr","before","remove","$qpTextModule","$qpModel","className","getClassName","eventHandle","renderLock","showAnswer","renderAnswer","showCheckedAnswer","renderCheckedAnswer","renderCorrectAnswer","showStatisAnswer","renderStatisAnswer","setLock","lockMedia","Hub","Queue","_modelEach","lockArea","$modelView","setSequenceNumber","getSupportType","showUsrAndCorrectAnswer","isSupportThisInterface","showDefaultExtras","newOption","img","append","destroy","AssessmentTest","_assessmentItem","sequenceNumber","loadAssessmentItem","getAssessmentItem","Class","lang","classUtilsObject","base","MakeBase","Base","Type","BaseInteraction","member","Create","interactionId","Rd","getRandom","modalItem","modalModel","isDomExist","str","getAnswerRandom","start","randomSeed","isLock","showLock","arry","getShuffle","baseClass","prototype_","aPrototype","m","toString","toLocaleString","valueOf","aType","ExtrasOption","zh","mathjax_loading","drawing_source_material","drawing_stem","drawing_view_material","drawing_view_topics","drawing_continue_write","gapmath_title","inline_choice_choose","vote_sigleitem","vote_mutipleitem","vote_tip_pre","vote_tip_end","choice_screenshot_title","text_title","extras_user_answer","extras_correct_answer","analyse","single_choise","multiple_choise","blank_filling","connection","sort","question","voting","true_or_false","puzzle","complex","ja","ja_jp","en","es_ec","Option","screenshotLayout","showAnswerArea","showSubSequence","showStat","expectWidth","expectHeight","thumbnailEnable","graphicGapMatchImageLoaderEnable","pptshell","statis","wood","elearning","mediaPlayer","_$medias","play","pause","ended","timeupdate","seeked","volumeChange","fullScreenChange","renderImg","mediaHandler","$media","mediaType","tagName","mediaId","mediaTarget","eventTypes","eventType","currentTime","mediaOnStart","mediaOnPause","mediaOnEnded","mediaOnTimeupdate","mediaOnVolumeChange","mediaOnSeeked","_getMedia","mediaPlay","mediaPause","mediaPauseAll","mediaSkip","mediaVolumeChange","volume","diaplay","mediaOnFullScreenChange","lock","ELMediaPlayer","_players","fullScreen","fullScreenExit","_getKeyMedia","mediaUrl","config","video","autoPlay","player","Player","addEventListener","getMedia","replay","mediaOnFullScreen","mediaOnFullScreenExit","_fullChangeEvent","close","eMediaPlayer","_mediaImpl","onFullScreenChange","isFull","splice","onPlay","onPause","onEnd","onSeek","onVolumeChange","onTimeUpdate","seek","setVolume","eLearningMediaPlayer","Media","extendMedia","isComplete","NDMediaPlayer","removeAttr","mediaelementplayer","$img","lowVersionMediaPlayer","defaultMediaPlayer","ndMediaPlayer","Audio","slice","audio","defaultOption","renderUI","renderImmediately","renderMediaEle","modelHandlerFactory","_modelHandler","register","modelHandler","getModelHandler","_modelHandlerFactory","assessmentItem","getOption","triggerOptionClick","val","getStat","isChange","isEmpty","an","answerTemp","checkTextAnswer","renderReset","renderCorrectAnswerNoneGrayBg","area","getRectIntersectArea","rect1","rect2","l","t","b","getInteractRect","h","w","targetRects","rects","matchIndex","max","matchCount","rect","cm","pointToLine","x1","y1","x2","y2","x0","y0","a","c","space","lineSpace","p","sqrt","lineLength","userAgent","navigator","jQuery","browser","version","safari","opera","msie","mozilla","Android","BlackBerry","iOS","Windows","any","Mobile","IEVersion","engine","appName","appVersion","documentMode","compatMode","isIE11","isIE","_skin","_platform","checkOption","optionName","answerOptions","hasAnswerOption","hasTrueAnswerOption","theme","skinCls","dom","getParentElement","$el","nodeName","toLocaleLowerCase","parent","toCenter","screenHeight","innerHeight","body","clientHeight","documentElement","scrolltop","objTop","show","addListener","handler","attachEvent","allowNumKeyCodes","allowNumKeyDown","eventKeyCode","keyCode","shiftKey","input","srcElement","txtVal","setAttribute","ctrlKey","allowNumInput","keydown","getAttribute","inputResults","keyResult","ctrl","inputPreVal","getCursorPos","$dom","el","get","pos","selectionStart","focus","Sel","selection","createRange","SelLength","moveStart","getSelectedText","selText","getSelection","sel","activeElement","selRange","selectionEnd","range","inputNumberKeydown","$input","cursorPos","selectText","selectTextLength","inArray","metaKey","preventDefault","_lang","_checkOption","_platForm","svg","getPlatForm","Svg","Img","Area","Dom","Broswer","ImageLoader","_waitingQueue","_loadQueue","_loadingIconData","_imageLoaderPool","_emptyIconData","_errorIconData","_imageRegex","_srcRegex","_dataClassRegex","_dataWidthRegex","_dataHeightRegex","_lazyLoadRegex","_renderMediaImgRegex","_loadingImageStart","_imageIndex","_imageLoaderMaxNum","poolNum","Image","_getImageLoader","_returnImageLoader","imageLoader","resultHtml","imageInfo","lazyLoad","imageId","clazz","renderImgOption","_renderMediaImg","minHeight","minWidth","renderOption","renderMediaImg","parentNode","_loadImage","imageHandler","targetImageInfo","$image","imageWidth","imageHeight","targetWidth","targetHeight","newWidth","newHeight","wc","hc","loadingImageHandler","unshift","setTimeout","waitingQueueTemp","PreLoadingImg","resizeImage","imgElement","maxWidth","maxHeight","$imgElement","dataLoad","complete","oWidth","oHeight","maxW","maxH","minW","minH","scale","toFixed","playerEvent","change","image","click","latex","onEnded","optionClick","rendered","renderChanged","getRandomRange","n","getRandomArry","end","getRandomPri","randomEnd","rd","contain","Date","getMilliseconds","getRandomArray","seed","shuffleArray","answerRandom","resultArry","k","twConstants","DIALECT_SVG","DIALECT_VML","NS_SVG","NS_XLINK","getSVGDocument","alert","ownerDocument","getSVGRoot","doc","addLine","svgdoc","svgRoot","line","createElementNS","appendChild","addImgLine","iscorrect","showForeignObject","foreignObject","div","createElement","PlayerEvent","Exception","_assessmentTest","_uuid","assessmentTest","_render","_destroy","closeCustomKeyBoard","resetMedia","getModelType","getModelQuestionType","isMultipleModel","_setScore","answerOnChange","latexOnEnded","answerOnClick","getAssessmentModel","_getView","display","_mediaOnFullScreenChange","imageOnClick","showQuestion","identifiers","$model","hasIdentifier","hide","appendModelId","cleanExtrasAnswer","setHintVisible","visible","baseInteraction","createPlayer","_createPlayer","registerModelHandler","DigitalInput","InputManager","getInstance","closeKeyBoard","support","touch","mobile","vEventHandler","mouseDown","mouseUp","mouseWheel","getEventX","originalEvent","changedTouches","clientX","getEventY","clientY","bodys","getElementsByTagName","special","qpTap","setup","$that","vMouseDown","vMouseUp","_start","_startX","_startY","which","getTime","endX","endY","holdTime","dx","fix","triggerHandler","teardown","unbind","fn","qpMouseWheel","pageY","currentY","Plugin","Draggable","__bind","me","getScale","offWidth","offsetWidth","getBoundingClientRect","$container","options","moved","began","coordinate","off","getElements","resetElements","DEFAULTS","$elements","selector","elementOpts","count","eq","z-index","opacity","touches","bodyRect","_ref","containerOpts","fPosition","first","position","sPosition","spaceWidth","last","left","columns","rows","ceil","$placeHolder","outerHTML","visibility","after","top","origin","x","pageX","y","coor","maxIndex","maxArea","tarPos","eleWidth","eleHeight","overArea","tempPos","tempW","tempH","tempA","$tempEle","isAfter","dragged","draggabled","Constructor","disabled","Dragsort","draggingMoved","draggingEnded","draggingBegan","draggable","$ele","gutter","zIndex","placeHolderTemplate","_draggable","_update","update","dragsort","_name","_renderAnswer","$option","showChecked","_renderCorrectAnswerNoneGrayBg","option1","option2","_createCommonAnswerHtml","isJudgment","_createScreenshotAnswerHtml","tipText","optionId","$options","choiceText","_singleText","_tooManyOptions","imageRegex","imageSrcRegex","contentTextRegex","specifiedCharacterRegex","imageHtml","imageSrc","sigleitem","mutipleitem","optionHtml","tipPre","tipEnd","ulClass","liHtml","iconText","optionChecked","_canvasWidth","_canvasHeight","_canvasId","bg","cavsBoxClass","$canvas","$writingBar","answers","ctx","getContext","drawImage","lastX","lastY","isEraser","cxt","lineJoin","getMousePos","evt","point","targetTouches","clearLine","clearRect","drawPoint","beginPath","moveTo","lineTo","closePath","stroke","toDataURL","move","down","up","stopPropagation","blur","ev","oEvent","$clear","$write","$clearall","_modalName","_textEntryRegex","_stem","_sourceMaterial","_viewTopics","_viewMaterial","_continueWrite","nav","toolBar","titleContent","assetClass","assetNav","assetContentItem","selectClass","assetContent","editToolBar","inputIndex","editContentTitle","editContent","edit","bottomBar","$editCanvas","imgUrl","$navTitleItem","$navAssetItem","$contentItem","contentIndex","$assetNavItem","$assetContentItem","navIndex","$drawing","$viewTitleButton","$viewAssetButton","$wirteButton","$drawButton","$allClearButton","$clearButton","$backButton","$drawingEdit","editCanvas","lineWidth","dataUrl","inputState","inputAnswer","timer","lastValue","saveAllAnswer","allAnswer","saveInputAnswer","setInterval","newValue","clearInterval","drawLine","saveImageData","_$textarea","propertyName","__unbind","$textarea","interaction","GraphicGapMatchInteraction","createHtml","LocationType","Left","Right","LeftTop","RightTop","LeftBottom","RightBottom","Bottom","Middle","Top","TopToBottom","None","RESBOX_HEIGHT","TARGET_MARGIN_TOP","TARGET_BOX_WIDTH","RES_BORDER","TD_BORDER","TABLE_SPACING","RESBOX_MARGIN_RIGHT","resBoxRects","targetBoxsRects","absOffset","zindex","_self","$targetBoxs","$resBoxs","resizeCoor","cOffset","offset","initTargetRects","$box","initCoor","f","tid","intersectBind","moveBox","toTarget","stop","animate","initDrawEvent","targetIdentifier","targetCssText","absPoint","lastPoint","touchend","maxContainerWidth","$gapMathMain","$gapMathTable","changeRectColor","selected","downEvent","$targetNew","currentAbsOffset","getEventPoint","tOffset","cssText","resizeResBox","moveEvent","stopEvent","stopHandler","oldTargetId","getTargetRectId","targetRect","location","targetAreaRect","getTargetLocationRect","getResRectsByTid","backToParent","resRect","$res","resTop","$TargetContainer","rectTarget","layerX","layerY","bindEvent","cover","bindScroll","$lisbox","allWidth","boxWidth","scrolling","srollLeft","scrollLeft","$resBox","resHeight","resWidth","reslocationType","resRects","resId","locationRect","hasLocation","has","totalHeight","resizeTable","resizeBoxs","$targetBox","boxs","box","nboxs","nResRects","nbox","updateAnswer","answerArry","layoutTable","$main","$table","thHeight","th1Width","tdHeight","tdWidth","titleClass","$ths","$tds","columnCount","rowsCount","getTableHtml","getGapTextsHtml","setImageData","randomArry","pid","gaps","$gaps","TR","TD","SIDE_ITEM","QUS_BODY","_maxSvgWidth","_maxSvgHeight","_minSvgWidth","_minSvgHeight","_tdBorderWidth","_tableBorderWidth","_sideWidthPerHeight","gapUtil","winSize","winWidth","winHeight","clientWidth","qtiMaxSize","mathMaxSize","getOffsetInt","getTableData","cols","oneWidth","oneHeight","matrix","spot","vcoords","tbPos","row","col","getAreaSize","maxSvgWidth","maxSvgHeight","maxScale","relativeWidth","moRows","moCols","getRects","$rects","initFill","removeFill","tId","removeAllFill","addFill","isTouch","intersectRect","matchRect","$gapImgs","targetId","$parent","tBody","td","imgHtml","orientation","liOrientation","cls","lazyloader","tableBorderWidth","list","tbody","c-width","c-height","$side","platStatis","$wrap","$puzzleModule","$ul","__rects","newRects","lastActiveTarget","moveNum","supportTouch","_$target","clone","$li","_downTrigger","__event","choose","choiceArr","$select","EXTEND_WIDTH","LINE_WIDTH_PC","LINE_WIDTH_MOBIEL","_imgRegex","SORT_ITEM","PIC_TEXT","PIC","TEXT","ITEM_BODY","matchUtil","getFill","$item","fill","_removeFill","fillId","item1","item2","updateItemLineStyle","$boxs","_addFill","hasFill","canFill","getRect","res","right","getLinePos","tRect","isAnswerItemRight","correct","flag","isRes","_intersectedRect","inRect","intersected","intersectedRect","correctAnswers","$qpNumber","$svg","$qpItemContainer","resizeImg","getImage","images","getText","createItem","jscls","simpleAC","qpNums","$qpNum","numWidth","numHeight","initDataCoor","$lastTarget","$line","isTargetRect","getLinePoint","downRect","hoverLine","$lines","baseVal","pwidth","lastIsRes","boxId","lastBoxId","_startTime","_lastPoint","_startPos","_endPos","_absOffset","_holdTime","removeResize","$paixuList","getRandomSimpleChoice","same","firstChoice","itemHtml","appendTo","maxLangthAttr","showNormal","step","__digitalReset","qtiAutogrow","shadow","vertical","horizontal","postGrowCallback","ele","isDigital","getText4Dom","_$input","_timer","_lastValue","saveAnswer","setText4DOM","$checkedAnswer","$answer","checkedClass","__resizeCheckWidth","inputWidth","__unbindResize","setDisabled4DOM","textEntry","_initAnswer","keyboardRegex","widthRegex","textEntrys","expectedLengthRegex","__digitalResetCount","_thisState","thisAnswer","loopy","timeout_id","str_setTimeout","time_count","elems","elem","str_data","str_resize","str_resize_key","removeItem","removeData","clearTimeout","jq_resize","str_delay","str_throttle","getRandomId","add","handleObj","new_handler","old_handler","isFunction","getVerticalScrollbarWidth","debugx","debugy","debugcolor","flickering","verticalScrollbarWidth","filter","$e","$shadow","heightPadding","hasVerticalScrollBar","scrollHeight","background-color","max-width","padding","boxSizing","fontFamily","fontWeight","word-wrap","word-break","inner","outer","w1","w2","overflow","removeChild","call"],"mappings":"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","file":"qti-player-all.min.js","sourcesContent":["//version=1.0\r\n(function(window,document,$){\r\n/**\r\n * 简易模块化加载器\r\n * Created by ylf on 2016/7/5.\r\n */\r\n\r\n\r\nvar require, define;\r\n(function () {\r\n    var defined = {}, defineWaiting = {};\r\n\r\n    var callDeps = function (key) {\r\n        if (key) {\r\n            key = key.toLowerCase();\r\n        }\r\n        if (defineWaiting[key]) {\r\n            var df = defineWaiting[key];\r\n            delete defineWaiting[key];\r\n            var args = [];\r\n            for (var i = 0; i < df.deps.length; i++) {\r\n                var depName = df.deps[i];\r\n                args[i] = callDeps(depName);\r\n            }\r\n            var ret = df.callback.apply(df.callback, args);\r\n            defined[key] = ret;\r\n        }\r\n\r\n        return defined[key];\r\n    };\r\n\r\n    define = function (key, deps, callback) {\r\n        if (key) {\r\n            key = key.toLowerCase();\r\n        }\r\n        if (!(deps instanceof Array)) {\r\n            callback = deps;\r\n            deps = [];\r\n        }\r\n        if (defineWaiting[key]) {\r\n            throw  new Error('the key already has been  used');\r\n        }\r\n        defineWaiting[key] = {\r\n            'deps': deps,\r\n            'callback': callback,\r\n            'module': null\r\n        };\r\n    };\r\n\r\n    require = function (key) {\r\n        return callDeps(key);\r\n    };\r\n\r\n})();\r\n\n// qti model\r\ndefine('model/ajax', ['model/logger', 'model/event'], function (_logger, _event) {\r\n\r\n    var _ajax = {\r\n        _logger: _logger,\r\n        _event: _event\r\n    };\r\n\r\n    if (window.XDomainRequest) {\r\n        _logger.debug('_ajax:使用XDomainRequest加载数据');\r\n        //支持ie特有的支持xml跨与访问的方式\r\n        _ajax._getUrl = function (url, callback,errorCallback) {\r\n            var that = this;\r\n            var request = new XDomainRequest();\r\n            request.open('GET', url);\r\n            request.onload = function () {\r\n                callback(this.responseText);\r\n            };\r\n            request.onprogress = function () {\r\n\r\n            };\r\n            request.ontimeout = function () {\r\n                _logger.error('_ajax:XDomainRequest加载超时');\r\n                errorCallback && errorCallback(ex);\r\n            };\r\n            request.onerror = function () {\r\n                _logger.error('_ajax:XDomainRequest加载失败');\r\n                that._event.trigger('load', 'error', url);\r\n                errorCallback && errorCallback(ex);\r\n            };\r\n            request.send();\r\n        };\r\n    } else {\r\n        //默认使用jquery的xml访问\r\n        _logger.debug('_ajax:使用jquery ajax加载数据');\r\n        _ajax._getUrl = function (url, callback,errorCallback) {\r\n            var that = this;\r\n            $.ajax({\r\n                method: 'GET',\r\n                url: url,\r\n                dataType: 'text',\r\n                cache: false\r\n            }).done(function (xmlText) {\r\n                callback(xmlText);\r\n            }).fail(function () {\r\n                _logger.error('_ajax:jquery ajax加载失败');\r\n                that._event.trigger('load', 'error', url);\r\n                errorCallback && errorCallback(ex);\r\n            });\r\n        };\r\n    }\r\n\r\n    return _ajax;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/convertTextToMultiple', ['model/logger', 'model/utils'], function (_logger, _utils) {\r\n\r\n    var convertTextToMultiple = function (assessmentItemModel) {\r\n        var isTextEntry = true;\r\n        var prompt = '';\r\n        var firstModelId = '';\r\n        var modelMap = assessmentItemModel.modelMap;\r\n        //将选择题转换为复合题中的结构\r\n        for (var modelKey in modelMap) {\r\n            if (!firstModelId) {\r\n                firstModelId = modelKey;\r\n            }\r\n\r\n            var model = modelMap[modelKey];\r\n            if (model.modelType !== 'textEntryInteraction') {\r\n                isTextEntry = false;\r\n                break;\r\n            }\r\n        }\r\n        if (isTextEntry) {\r\n            prompt = assessmentItemModel.prompt.replace(/<(div|span) class=\"_qp-model\"[\\s\\S]*?><\\/(div|span)>/g, function (modelHtml) {\r\n                var modelId = _utils.getValue(modelHtml, /data-model-id=\"([\\s\\S]*?)\"/);\r\n                var model = modelMap[modelId];\r\n                return '<textEntry textentryid=\"\" keyboard=\"' + model.keyboard + '\"  style=\"' + model.style + '\" width=\"' + model.width + '\" expectedLength=\"' + model.expectedLength + '\" \\/>';\r\n            });\r\n\r\n            var multipleModel = {\r\n                modelId: firstModelId,\r\n                modelType: 'textEntryMultipleInteraction',\r\n                prompt: prompt,\r\n                questionType: '',\r\n                style: ''\r\n            };\r\n\r\n            var correctAnswer = [];\r\n            for (var key in assessmentItemModel.correctAnswer) {\r\n                var answer = assessmentItemModel.correctAnswer[key].value;\r\n                correctAnswer.push(answer[0]);\r\n            }\r\n            assessmentItemModel.correctAnswer = {};\r\n            assessmentItemModel.correctAnswer[firstModelId] = {\r\n                value: correctAnswer,\r\n                identifier: firstModelId,\r\n                cardinality: 'multiple',\r\n                baseType: 'pair'\r\n            };\r\n\r\n            assessmentItemModel.modelMap = {};\r\n            assessmentItemModel.modelMap[firstModelId] = multipleModel;\r\n            assessmentItemModel.prompt = '<div class=\"_qp-model\" data-model-id=\"' + firstModelId + '\" ></div>';\r\n        }\r\n    };\r\n    return convertTextToMultiple;\r\n});\r\n\n// qti model\r\ndefine('model/event', ['model/logger'], function (logger) {\r\n\r\n    //空方法\r\n    var _emptyFunc = function () {\r\n    };\r\n\r\n    //创建事件管理对象\r\n    var _event = {\r\n        _logger: logger,\r\n        _eventHandler: {\r\n            load: {\r\n                error: _emptyFunc\r\n            }\r\n        },\r\n        trigger: function (group, type, para) {\r\n            this._logger.debug('model trigger event:' + group + '-' + type);\r\n            this._eventHandler[group][type](para);\r\n        },\r\n        bind: function (group, type, callback) {\r\n            if (this._eventHandler[group] && this._eventHandler[group][type] && $.type(callback) === 'function') {\r\n                this._logger.debug('model bind event:' + group + '-' + type);\r\n                this._eventHandler[group][type] = callback;\r\n            }\r\n        }\r\n    };\r\n\r\n    return _event;\r\n\r\n});\r\n\ndefine('model/exception', ['model/logger', 'model/event'], function (_logger, _event) {\r\n\r\n\r\n    'use strict';\r\n\r\n    var exception = {\r\n        create: function (message, throwable, code) {\r\n            throwable.message = message + '： ' + throwable.message;\r\n            throwable.code = code || 0;\r\n            throwable.type = 'qtiplayerException';\r\n            return throwable;\r\n        }\r\n    };\r\n\r\n    return exception;\r\n});\n// qti model\r\n//define('model/ie8shim', function () {\r\n\r\n\r\n//兼容代码\r\nif (typeof Array.prototype.forEach === typeof  undefined) {\r\n    Array.prototype.forEach = function (callback) {\r\n        for (var i = 0; i < this.length; i++) {\r\n            var item = this[i];\r\n            callback.apply(this, [item, i, this]);\r\n        }\r\n    };\r\n}\r\nif (typeof String.prototype.trim === typeof  undefined) {\r\n    String.prototype.trim = function () {\r\n        return this.replace(/(^\\s*)|(\\s*$)/g, \"\");\r\n    };\r\n}\r\n\r\nif (typeof Array.prototype.clear === typeof  undefined) {\r\n//array 方法增强\r\n    Array.prototype.clear = function () {\r\n        while (this.length) {\r\n            this.pop();\r\n        }\r\n    };\r\n}\r\nif (typeof Array.prototype.pushArray === typeof  undefined) {\r\n    Array.prototype.pushArray = function () {\r\n        var toPush = this.concat.apply([], arguments);\r\n        for (var i = 0, len = toPush.length; i < len; ++i) {\r\n            this.push(toPush[i]);\r\n        }\r\n    };\r\n}\r\n\r\nif (typeof Array.prototype.indexOf === typeof  undefined) {\r\n    Array.prototype.indexOf = function (item) {\r\n        for (var i = 0; i < this.length; i++) {\r\n            if (this[i] == item) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n}\r\n\r\n\r\n//--扩展出jq的_xml方法，兼容IE浏览器无innerHTML的问题\r\n//获取JQ的XML对象中的内部的所有元素，类似innerHTML\r\n$.prototype._xml = function () {\r\n    if (this.length <= 0)\r\n        return null;\r\n    var _this = this[0];\r\n    var _xmlinnerHTMLSTR = '';\r\n    if (window.DOMParser) { // Standard\r\n        var oSerializer = new XMLSerializer();\r\n        _xmlinnerHTMLSTR = oSerializer.serializeToString(_this);\r\n    } else { // IE\r\n        _xmlinnerHTMLSTR = _this.xml;\r\n    }\r\n    var myregexp = /^\\s*<[\\s\\S]*?>([\\s\\S]*)<[\\s\\S]*?>\\s*$/;\r\n    var _xmlinnerHTML = _xmlinnerHTMLSTR.match(myregexp);\r\n    if (_xmlinnerHTML && _xmlinnerHTML.length >= 2)\r\n        return _xmlinnerHTML[1];\r\n};\r\n\r\n//});\n// qti model\r\ndefine('model/logger', function () {\r\n    var method;\r\n    var noop = function () {\r\n    };\r\n\r\n    var methods = [\r\n        'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',\r\n        'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',\r\n        'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',\r\n        'timeline', 'timelineEnd', 'timeStamp', 'trace', 'warn'\r\n    ];\r\n    var length = methods.length;\r\n    var _console = (window.console = window.console || {});\r\n    while (length--) {\r\n        method = methods[length];\r\n        // Only stub undefined methods.\r\n        if (!_console[method]) {\r\n            _console[method] = noop;\r\n        }\r\n    }\r\n\r\n    //logger\r\n    //----创建日志处理对象\r\n    //logger level值(debug:3, info:2, warn:1, error: 0, close: -1)\r\n    var _logger = {\r\n        _level: 0,\r\n        _console: _console,\r\n        setLevel: function (level) {\r\n            switch (level) {\r\n                case 'debug':\r\n                    this._level = 3;\r\n                    break;\r\n                case 'info':\r\n                    this._level = 2;\r\n                    break;\r\n                case 'warn':\r\n                    this._level = 1;\r\n                    break;\r\n                case 'error':\r\n                    this._level = 0;\r\n                    break;\r\n                default:\r\n                    this._level = -1;\r\n            }\r\n        },\r\n        _log: function (method, args) {\r\n            try {\r\n                this._console[method].apply(this._console, args);\r\n            } catch (e) {\r\n                var that = this;\r\n                this._log = function (method, args) {\r\n                    if (args.length <= 1) {\r\n                        that._console[method](args[0]);\r\n                    } else {\r\n                        that._console[method](args);\r\n                    }\r\n                };\r\n                this._log(method, args);\r\n            }\r\n        },\r\n        debug: function (msg) {\r\n            if (this._level >= 3) {\r\n                this._log('log', arguments);\r\n            }\r\n        },\r\n        info: function (msg) {\r\n            if (this._level >= 2) {\r\n                this._log('info', arguments);\r\n            }\r\n        },\r\n        warn: function (msg) {\r\n            if (this._level >= 1) {\r\n                this._log('warn', arguments);\r\n            }\r\n        },\r\n        error: function (msg) {\r\n            if (this._level >= 0) {\r\n                this._log('error', arguments);\r\n            }\r\n        }\r\n    };\r\n    return _logger;\r\n});\r\n\n//绑定全局变量\r\nif (!window.QtiPlayer) {\r\n    window.QtiPlayer = {};\r\n}\r\n// qti model\r\ndefine('model/qtiModel', ['model/logger', 'model/event', 'model/utils', 'model/ajax'], function (_logger, _event, _utils, _ajax) {\r\n\r\n    var jsonParser = require('model/json/jsonParser');\r\n    var xmlParser = require('model/xml/xmlParser');\r\n    var convertTextToMultiple = require('model/convertTextToMultiple');\r\n\r\n    var _QtiPlayer = window.QtiPlayer;\r\n\r\n\r\n    //全局api\r\n    _QtiPlayer.getLogger = function () {\r\n        return _logger;\r\n    };\r\n\r\n    _QtiPlayer.getUtils = function () {\r\n        return _utils;\r\n    };\r\n\r\n    _QtiPlayer.setLoggerLevel = function (level) {\r\n        return _logger.setLevel(level);\r\n    };\r\n\r\n    /**\r\n     * 全局API，load习题\r\n     * @param loadSrc 习题model的 url/json字符串/json对象\r\n     * @param option 配置信息json对象\r\n     * @param callback 加载数据成功的回调\r\n     */\r\n    _QtiPlayer.load = function (loadSrc, option, callback, errorCallback) {\r\n        try {\r\n            if (loadSrc && loadSrc instanceof Object) {// json对象转json字符串\r\n                loadSrc = JSON.stringify(loadSrc);\r\n            }\r\n\r\n            var prefix = loadSrc.substring(0, 1);\r\n            var assessmentItemModel;\r\n            if (prefix === '{' || prefix === '[') {// json字符串\r\n                assessmentItemModel = jsonParser.parse(loadSrc, option, null);\r\n\r\n                //将普通填空题转换为复合中的结构\r\n                if (option.unifyTextEntry === true) {\r\n                    convertTextToMultiple(assessmentItemModel);\r\n                }\r\n\r\n                if (callback) {\r\n                    callback(assessmentItemModel);\r\n                }\r\n            } else {// url字符串\r\n                _logger.debug('_ajax:加载' + loadSrc);\r\n                _ajax._getUrl(loadSrc, function (text) {\r\n                    try {\r\n                        text = $.trim(text);\r\n                        prefix = text.substring(0, 1);\r\n                        if (prefix === '{' || prefix === '[') {\r\n                            assessmentItemModel = jsonParser.parse(text, option, loadSrc);\r\n                        } else {\r\n                            assessmentItemModel = xmlParser.parse(text, option, loadSrc);\r\n                        }\r\n\r\n                        //将普通填空题转换为复合中的结构\r\n                        if (option.unifyTextEntry === true) {\r\n                            convertTextToMultiple(assessmentItemModel);\r\n                        }\r\n\r\n                        if (callback) {\r\n                            callback(assessmentItemModel);\r\n                        }\r\n                    } catch (ex) {\r\n                        _logger.error('load解析数据:',  ex);\r\n                        errorCallback && errorCallback(ex);\r\n                    }\r\n                }, function (ex) {\r\n                    _logger.error('load加载数据:',  ex);\r\n                    errorCallback && errorCallback(ex);\r\n                });\r\n            }\r\n        } catch (ex) {\r\n            _logger.error('load解析数据:',  ex);\r\n            errorCallback && errorCallback(ex);\r\n        }\r\n    };\r\n\r\n    _QtiPlayer.loadOnError = function (callback) {\r\n        _event.bind('load', 'error', callback);\r\n    };\r\n});\r\n\r\n//初始化qtiplayer-model\r\n//require('model/modelParser');\r\n\n// qti model\r\ndefine('model/utils', function () {\r\n    //工具类\r\n    var _utils = {\r\n        _encodeLeftRegex: /</g,\r\n        _decodeLeftRegex: /&lt;/g,\r\n        _encodeRightRegex: />/g,\r\n        _decodeRightRegex: /&gt;/g,\r\n        _encodeAndRegex: /&/g,\r\n        _decodeAndRegex: /&amp;/g,\r\n        _decodeBlankRegex: /&nbsp;/g,\r\n        xmlEncode: function (value) {\r\n            value = value.replace(this._encodeAndRegex, '&amp;');\r\n            value = value.replace(this._encodeLeftRegex, '&lt;');\r\n            value = value.replace(this._encodeRightRegex, '&gt;');\r\n            return value;\r\n        },\r\n        xmlDecode: function (value) {\r\n            value = value.replace(this._decodeBlankRegex, ' ');\r\n            value = value.replace(this._decodeLeftRegex, '<');\r\n            value = value.replace(this._decodeRightRegex, '>');\r\n            value = value.replace(this._decodeAndRegex, '&');\r\n            return value;\r\n        },\r\n        stringToBoolean: function (v) {\r\n            var result = false;\r\n            if (v && v === 'true') {\r\n                result = true;\r\n            }\r\n            return result;\r\n        },\r\n        getValue: function (xml, v, index) {\r\n            var result = '';\r\n            var arr = xml.match(v);\r\n            if (typeof  index === 'number' && arr && arr.length > index) {\r\n                result = arr[index]\r\n            } else if (arr && arr.length === 2) {\r\n                result = arr[1];\r\n            }\r\n            return result;\r\n        },\r\n        getValues: function (xml, r, v) {\r\n            var values = [];\r\n            var value;\r\n            var arr = xml.match(r);\r\n            if (arr) {\r\n                for (var i = 0; i < arr.length; i++) {\r\n                    value = this.getValue(arr[i], v);\r\n                    if (value) {\r\n                        values.push(value);\r\n                    }\r\n                }\r\n            }\r\n            return values;\r\n        },\r\n        getIntValue: function (xml, v) {\r\n            var result = 0;\r\n            var arr = xml.match(v);\r\n            if (arr && arr.length === 2) {\r\n                result = parseInt(arr[1]);\r\n            }\r\n            return result;\r\n        },\r\n        getBasePath: function (path) {\r\n            if (typeof path == typeof  undefined) {\r\n                throw new Error('path not defined');\r\n            }\r\n            var hashIndex = path.lastIndexOf('#');\r\n            if (hashIndex == -1) {\r\n                hashIndex = path.length;\r\n            }\r\n            var queryIndex = path.indexOf('?');\r\n            if (queryIndex == -1) {\r\n                queryIndex = path.length;\r\n            }\r\n            var slashIndex = path.lastIndexOf('/', Math.min(queryIndex, hashIndex));\r\n            return slashIndex >= 0 ? path.substring(0, slashIndex) : '';\r\n        },\r\n        template: function (tpl, attrs) {\r\n            var templateRegExp = /\\$\\{(.+?)(?:\\:(.+?))?\\}/g;\r\n            return tpl.replace(templateRegExp, function ($0, $1, $2) {\r\n                if (attrs[$1] !== undefined) {\r\n                    return attrs[$1];\r\n                }\r\n                return $0;\r\n            });\r\n        },\r\n        getUuid: function () {\r\n            var s = [];\r\n            var hexDigits = \"0123456789abcdef\";\r\n            for (var i = 0; i < 36; i++) {\r\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n            }\r\n            s[14] = \"4\";  // bits 12-15 of the time_hi_and_version field to 0010\r\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01\r\n            s[8] = s[13] = s[18] = s[23] = \"-\";\r\n\r\n            var uuid = s.join(\"\");\r\n            return uuid;\r\n        },\r\n        //获取地址后缀,入json,xml\r\n        getPathSuffix: function (path) {\r\n            path = path.toLowerCase();\r\n            var hashIndex = path.indexOf('#');\r\n            if (hashIndex == -1) {\r\n                hashIndex = path.length;\r\n            }\r\n            var queryIndex = path.indexOf('?');\r\n            if (queryIndex == -1) {\r\n                queryIndex = path.length;\r\n            }\r\n            var slashIndex = Math.min(queryIndex, hashIndex);\r\n            var reUrl = slashIndex >= 0 ? path.substring(0, slashIndex) : '';\r\n\r\n            var dotIndex = reUrl.indexOf('.');\r\n            return dotIndex >= 0 ? reUrl.substring(dotIndex + 1) : '';\r\n        }\r\n    };\r\n\r\n    return _utils;\r\n\r\n});\r\n\n//create by 王斌\r\ndefine('model/json/jsonConvert', ['model/utils', 'model/logger'], function (_utils, _logger) {\r\n\r\n    var addAnswer = function (response) {\r\n        var item = {\r\n            baseType: response.base_type,\r\n            cardinality: response.cardinality,\r\n            identifier: response.identifier,\r\n            value: response.corrects\r\n        };\r\n        return item;\r\n    };\r\n\r\n\r\n    var feedbackParser = {\r\n        _subjectiveRegex: /class=\"subjectivebase_text\"/i,\r\n        _subjectiveBaseAssetRegex: /<div[^<>]*?class=\"asset\"[^<>]*?><\\/div>/g,\r\n        _subjectiveBaseAssetPosterRegex: /data-poster=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetSrcRegex: /data-src=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetTypeRegex: /data-type=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseTextRegex: /<div class=\"subjectivebase_text\">([\\s\\S]*?)<\\/div>\\s*?<div class=\"subjectivebase_asset\"/,\r\n        _widthRegex: /width=\"([\\s\\S]+)\"/,\r\n        _heightRegex: /height=\"([\\s\\S]+)\"/,\r\n        parse: function (content, itemModel) {\r\n            //是否是主观题提示内容\r\n            if (this._subjectiveRegex.test(content)) {\r\n                var assets = [];\r\n                var text = '';\r\n\r\n                var assetsResult = content.match(this._subjectiveBaseAssetRegex);\r\n                if (assetsResult) {\r\n                    for (var i = 0; i < assetsResult.length; i++) {\r\n                        var asset = assetsResult[i];\r\n                        assets.push({\r\n                            poster: _utils.getValue(asset, this._subjectiveBaseAssetPosterRegex),\r\n                            src: _utils.getValue(asset, this._subjectiveBaseAssetSrcRegex),\r\n                            type: _utils.getValue(asset, this._subjectiveBaseAssetTypeRegex),\r\n                            width: _utils.getIntValue(asset, this._widthRegex),\r\n                            height: _utils.getIntValue(asset, this._heightRegex)\r\n                        });\r\n                    }\r\n                }\r\n                text = _utils.getValue(content, this._subjectiveBaseTextRegex);\r\n                itemModel.contentData = {\r\n                    asset: assets,\r\n                    text: text\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    var addFeedBack = function (feedback, modelId) {\r\n        var item = {\r\n            content: feedback.content,\r\n            identifier: feedback.identifier,\r\n            modelId: modelId,\r\n            showHide: feedback.show_hide\r\n        };\r\n\r\n        feedbackParser.parse(feedback.content, item);\r\n\r\n        return item;\r\n    };\r\n\r\n\r\n    var questionTypeToModelType = function (questionType) {\r\n        var types = {\r\n            'choice': 'choiceInteraction',\r\n            'multiplechoice': 'choiceInteraction',\r\n            'vote': 'choiceInteraction_vote',\r\n            \"judge\": \"choiceInteraction\",\r\n            \"order\": \"orderInteraction\",\r\n            \"match\": \"matchInteraction\",\r\n            \"extendedtext\": \"extendedTextInteraction\",\r\n            \"graphicgapmatch\": \"graphicGapMatchInteraction\",\r\n            \"textentry\": \"textEntryInteraction\",\r\n            \"textentrymultiple\": \"textEntryMultipleInteraction\",\r\n            \"drawing\": \"drawingInteraction_drawing\",\r\n            \"handwrite\": \"drawingInteraction_handwrite\",\r\n            \"subjectivebase\": \"extendedTextInteraction\",\r\n            \"inlinechoice\": \"inlineChoiceInteraction\"\r\n        };\r\n        return types[questionType];\r\n    };\r\n\r\n    var checkUseMath = function (texts) {\r\n        for (var i = 0; i < texts.length; i++) {\r\n            if (texts[i] && texts[i].indexOf(\"<latex\") != -1) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    var number = /^-?[0-9]+\\.?[0-9]*$/;\r\n\r\n    var addTextEntryModel = function (result, textentrys, responses) {\r\n        for (var j = 0; j < textentrys.length; j++) {\r\n            var keyboard = \"text\";\r\n            if (responses) {\r\n                for (var i = 0; i < responses.length; i++) {\r\n                    var response = responses[i];\r\n                    var modelId = response.identifier;\r\n                    if (modelId === textentrys[j]) {\r\n                        if (response.corrects && number.test(response.corrects[0])) {\r\n                            keyboard = \"number\";\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            result.modelMap[textentrys[j]] = {\r\n                modelId: textentrys[j],\r\n                modelType: \"textEntryInteraction\",\r\n                questionType: '',\r\n                keyboard: keyboard,\r\n                width: 0,\r\n                expectedLength: 0,\r\n                style: ''\r\n            };\r\n        }\r\n    };\r\n    var addMultipleTextEntryModel = function (result, item, questionModel) {\r\n        _logger.debug(filterMultTextentryInteraction(item.prompt, questionModel));\r\n        result.modelMap[item.response_identifier] = {\r\n            modelId: item.response_identifier,\r\n            modelType: \"textEntryMultipleInteraction\",\r\n            questionType: '',\r\n            prompt: filterMultTextentryInteraction(item.prompt, questionModel),\r\n            style: ''\r\n        };\r\n    };\r\n    var filterMultTextentryInteraction = function (text, questionModel) {\r\n        if (!text) return '';\r\n        var i = 0;\r\n        return text.replace(/<textentryinteraction[^>]*?responseidentifier=\"([^\\\"]+)\"[^>]*?><\\/textentryinteraction>/gm, function (text, identifier, otherMsg) {\r\n            var keyboard = '';\r\n            if (questionModel && questionModel.corrects && questionModel.corrects[i] !== 'undefined') {\r\n                if (number.test(questionModel.corrects[i])) {\r\n                    keyboard = \"number\";\r\n                }\r\n            }\r\n            i++;\r\n            return \"<textEntry textentryid=\\\"\" + identifier + \"\\\" keyboard=\\\"\" + keyboard + \"\\\" \\/>\";\r\n        });\r\n    };\r\n\r\n    var modelMap = {\r\n        subjectivebase: {\r\n            _subjectiveBaseAssetRegex: /<div[^<>]*?class=\"asset\"[^<>]*?><\\/div>/g,\r\n            _subjectiveBaseAssetPosterRegex: /data-poster=\"([\\s\\S]*?)\"/,\r\n            _subjectiveBaseAssetSrcRegex: /data-src=\"([\\s\\S]*?)\"/,\r\n            _subjectiveBaseAssetTypeRegex: /data-type=\"([\\s\\S]*?)\"/,\r\n            _subjectiveBaseTextRegex: /<div class=\"subjectivebase_text\">([\\s\\S]*?)<\\/div>\\s*?<div class=\"subjectivebase_asset\"/,\r\n            _widthRegex: /width=\"([\\s\\S]+)\"/,\r\n            _heightRegex: /height=\"([\\s\\S]+)\"/,\r\n            parse: function (resModel, itemModel) {\r\n                var that = this;\r\n                var assets = [];\r\n                var text = '';\r\n                var prompt = resModel.prompt;\r\n                var assetsResult = prompt.match(that._subjectiveBaseAssetRegex);\r\n                if (assetsResult) {\r\n                    for (var i = 0; i < assetsResult.length; i++) {\r\n                        var asset = assetsResult[i];\r\n                        assets.push({\r\n                            poster: _utils.getValue(asset, that._subjectiveBaseAssetPosterRegex),\r\n                            src: _utils.getValue(asset, that._subjectiveBaseAssetSrcRegex),\r\n                            type: _utils.getValue(asset, that._subjectiveBaseAssetTypeRegex),\r\n                            width: _utils.getIntValue(asset, that._widthRegex),\r\n                            height: _utils.getIntValue(asset, that._heightRegex)\r\n                        });\r\n                    }\r\n                }\r\n                text = _utils.getValue(prompt, that._subjectiveBaseTextRegex);\r\n\r\n                itemModel.text = text;\r\n                itemModel.asset = assets;\r\n            }\r\n        },\r\n        rubricBlock: {\r\n            _subjectiveBaseAssetRegex: /<div[^<>]*?class=\"asset\"[^<>]*?><\\/div>/g,\r\n            _subjectiveBaseAssetPosterRegex: /data-poster=\"([\\s\\S]*?)\"/,\r\n            _subjectiveBaseAssetSrcRegex: /data-src=\"([\\s\\S]*?)\"/,\r\n            _subjectiveBaseAssetTypeRegex: /data-type=\"([\\s\\S]*?)\"/,\r\n            _responseTextRegex: /<div class=\"response_text\">([\\s\\S]*?)<\\/div>\\s*?<div class=\"subjectivebase_asset\"/,\r\n            _widthRegex: /width=\"([\\s\\S]+)\"/,\r\n            _heightRegex: /height=\"([\\s\\S]+)\"/,\r\n            parse: function (prompt, itemModel) {\r\n                //该模型为对应的问答题的参考答案\r\n                var that = this;\r\n                var rubricBlock;\r\n                var view = 'scorer';\r\n\r\n                var subjectiveBase = that._responseTextRegex.test(prompt);\r\n                if (subjectiveBase) {\r\n                    var assets = [];\r\n                    var text = '';\r\n\r\n                    var assetsResult = prompt.match(that._subjectiveBaseAssetRegex);\r\n                    if (assetsResult) {\r\n                        for (var i = 0; i < assetsResult.length; i++) {\r\n                            var asset = assetsResult[i];\r\n                            assets.push({\r\n                                poster: _utils.getValue(asset, that._subjectiveBaseAssetPosterRegex),\r\n                                src: _utils.getValue(asset, that._subjectiveBaseAssetSrcRegex),\r\n                                type: _utils.getValue(asset, that._subjectiveBaseAssetTypeRegex),\r\n                                width: _utils.getIntValue(asset, that._widthRegex),\r\n                                height: _utils.getIntValue(asset, that._heightRegex)\r\n                            });\r\n                        }\r\n                    }\r\n                    text = _utils.getValue(prompt, that._responseTextRegex);\r\n\r\n                    rubricBlock = {\r\n                        view: view,\r\n                        text: text,\r\n                        asset: assets\r\n                    };\r\n                } else {\r\n                    rubricBlock = {\r\n                        prompt: prompt,\r\n                        view: view\r\n                    };\r\n                }\r\n                itemModel.rubricBlock = rubricBlock;\r\n            }\r\n        },\r\n        drawing: {\r\n            parse: function (resModel, itemModel) {\r\n                _logger.debug(resModel);\r\n                itemModel.asset = [];\r\n                if (resModel.prompt_object.assets) {\r\n                    var assets = resModel.prompt_object.assets;\r\n                    itemModel.asset = assets;\r\n                }\r\n                if (resModel.prompt_object.asset_titles) {\r\n                    var assetsTitle = resModel.prompt_object.asset_titles;\r\n                    itemModel.assetTitle = assetsTitle;\r\n                }\r\n                itemModel.content = resModel.prompt_object.content;\r\n                itemModel.object = resModel.object;\r\n                itemModel.paperType = resModel.papertype;\r\n                itemModel.title = filterTextentryInteraction(resModel.prompt_object.title, [], true);\r\n                itemModel.titleType = resModel.titletype;\r\n            }\r\n        },\r\n        handwrite: {\r\n            parse: function (resModel, itemModel) {\r\n                itemModel.object = resModel.object;\r\n                itemModel.object.width = itemModel.object.width ? parseInt(itemModel.object.width) : 0;\r\n                itemModel.object.height = itemModel.object.height ? parseInt(itemModel.object.height) : 0;\r\n            }\r\n        },\r\n        graphicgapmatch: {\r\n            parse: function (resModel, itemModel) {\r\n                //TODO .....需要服务端切图。\r\n                //object &gapImg & associableHotspot\r\n                itemModel.object = {};\r\n                itemModel.object = resModel.object;\r\n                itemModel.object.param = [];\r\n                //兼容旧数据\r\n                if (resModel.object.params['blankImage']) {\r\n                    itemModel.object.data = resModel.object.params['blankImage'];\r\n                    var keys = ['rows', 'columns', 'blankImage', 'originalImage'];\r\n                    for (var i = 0; i < keys.length; i++) {\r\n                        var key = keys[i];\r\n                        var value = resModel.object.params[key];\r\n                        itemModel.object.param.push({\r\n                            name: key,\r\n                            value: value,\r\n                            valueType: 'DATA'\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    itemModel.object.param = resModel.object.params;\r\n                    for (var j = 0; j < resModel.object.params.length; j++) {\r\n                        var param = resModel.object.params[j];\r\n                        if (param.name === \"blankImage\") {\r\n                            itemModel.object.data = param.value;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                itemModel.object.width = itemModel.object.width ? parseInt(itemModel.object.width) : 0;\r\n                itemModel.object.height = itemModel.object.height ? parseInt(itemModel.object.height) : 0;\r\n                itemModel.gapImg = resModel.gap_imgs;\r\n                if (itemModel.gapImg) {\r\n                    for (var i = 0; i < itemModel.gapImg.length; i++) {\r\n                        var obj = itemModel.gapImg[i];\r\n                        if (typeof obj.matchMax == 'undefined') {\r\n                            obj.matchMax = 1;\r\n                        }\r\n                        //兼容text数据\r\n                        if (typeof obj.text != 'undefined') {\r\n                            obj.identifier = obj.text;\r\n                        }\r\n                    }\r\n                }\r\n                itemModel.associableHotspot = resModel.associable_hotspots;\r\n                if (itemModel.associableHotspot) {\r\n                    for (var i = 0; i < itemModel.associableHotspot.length; i++) {\r\n                        var obj = itemModel.associableHotspot[i];\r\n                        if (typeof obj.matchMax == 'undefined') {\r\n                            obj.matchMax = 1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        match: {\r\n            parse: function (resModel, itemModel) {\r\n                var groups = {};\r\n                var groupsArray = [];\r\n                for (var i = 0; i < resModel.choices.length; i++) {\r\n                    var choice = resModel.choices[i];\r\n                    var playerChoice = {\r\n                        content: choice.text,\r\n                        fixed: choice.fixed,\r\n                        matchMax: choice.match_max,\r\n                        identifier: choice.identifier\r\n                    };\r\n                    var groupId = choice.group_id;\r\n                    if (!groups[groupId]) {\r\n                        var array = [];\r\n                        groups[groupId] = array;\r\n                        groupsArray.push(array);\r\n                    }\r\n                    groups[groupId].push(playerChoice);\r\n                }\r\n                itemModel.simpleMatchSet = groupsArray;\r\n            }\r\n        }\r\n    };\r\n    var addModel = function (model, result) {\r\n        var textentrys = [];\r\n        var item = {\r\n            layout: model.layout || '',\r\n            modelId: model.response_identifier,\r\n            modelType: questionTypeToModelType(model.type),\r\n            prompt: filterTextentryInteraction(model.prompt, textentrys),\r\n            questionType: model.type,\r\n            shuffle: model.shuffle,\r\n            style: ''\r\n        };\r\n\r\n        if (model.type != 'drawing' && model.type != 'textentrymultiple') {\r\n            addTextEntryModel(result, textentrys, result.correctAnswer);\r\n        }\r\n\r\n        if (model.type != 'match') {\r\n            item.maxChoices = model.max_choices;\r\n            item.minChoices = model.min_choices || 0;\r\n        }\r\n        else {\r\n            item.maxAssociations = model.max_choices;\r\n            item.minAssociations = model.min_choices || 0;\r\n        }\r\n\r\n        if (model.choices && model.choices.length > 0) {\r\n            if (model.type != 'match') {\r\n                item.simpleChoice = [];\r\n                for (var i = 0; i < model.choices.length; i++) {\r\n                    var choice = model.choices[i];\r\n                    item.simpleChoice.push({\r\n                        content: choice.text,\r\n                        fixed: choice.fixed,\r\n                        identifier: choice.identifier\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (modelMap[model.type]) {\r\n            modelMap[model.type].parse(model, item);\r\n        }\r\n        _logger.debug(item);\r\n        return item;\r\n    };\r\n    var findByModelId = function (result, id) {\r\n        return result.modelMap[id];\r\n    };\r\n    var filterTextentryInteraction = function (text, ids, useTextentry) {\r\n        if (!text) return '';\r\n        return text.replace(/<textentryinteraction[^>]*?responseidentifier=\"([^\\\"]+)\"[^>]*?><\\/textentryinteraction>/gm, function (text, identifier) {\r\n            ids.push(identifier);\r\n            return useTextentry ? \"<textEntry\\/>\" : '<span class=\"_qp-model\" data-model-id=\"' + identifier + '\" ></span>';\r\n        });\r\n    };\r\n\r\n    //文本选择题\r\n    var addInlineModel = function (modelMap, resModel) {\r\n        var inlineChoice;\r\n        for (var i = 0; i < resModel.children.length; i++) {\r\n            inlineChoice = [];\r\n            var choice = resModel.children[i];\r\n            for (var j = 0; j < choice.choices.length; j++) {\r\n                var playerChoice = {\r\n                    content: choice.choices[j].text,\r\n                    identifier: choice.choices[j].identifier\r\n                };\r\n                inlineChoice.push(playerChoice);\r\n            }\r\n            modelMap[choice.response_identifier] = {\r\n                inlineChoice: inlineChoice,\r\n                modelId: choice.response_identifier,\r\n                modelType: 'inlineChoiceInteraction',\r\n                questionType: 'inlinechoice',\r\n                shuffle: false\r\n            };\r\n        }\r\n    };\r\n\r\n//检查是否使用mathjax\r\n    var jsonAdapter = {\r\n        convert: function (assessment) {\r\n            _logger.debug(assessment);\r\n            var texts = [];\r\n            var result = {\r\n                answerFeedback: {},\r\n                correctAnswer: {},\r\n                hasMath: false,\r\n                hintFeedback: {},\r\n                modelMap: {},\r\n                prompt: ''\r\n            };\r\n            //反馈\r\n            for (var i = 0; i < assessment.feedbacks.length; i++) {\r\n                var feedback = assessment.feedbacks[i];\r\n                var modelId = 'RESPONSE_' + (feedback.sequence || 1) + \"-1\";\r\n                var playerFeedback = addFeedBack(feedback, modelId);\r\n                if (feedback.identifier == 'showHint') {\r\n                    result.hintFeedback[modelId] = playerFeedback;\r\n                }\r\n                else if (feedback.identifier == 'showAnswer') {\r\n                    result.answerFeedback[modelId] = playerFeedback;\r\n                }\r\n                texts.push(feedback.content);\r\n            }\r\n            //具体题型\r\n            var prompt = '';\r\n            for (var i = 0; i < assessment.items.length; i++) {\r\n                var item = assessment.items[i];\r\n                var modelId = item.response_identifier;\r\n                if (item.type == 'data' || item.type == 'textentry') {\r\n                    var textentrys = [];\r\n                    prompt = prompt + \" \" + filterTextentryInteraction(item.prompt, textentrys);\r\n                    addTextEntryModel(result, textentrys, assessment.responses);\r\n                } else if (item.type == 'textentrymultiple') {\r\n                    var questionModel;\r\n                    for (var j = 0; j < assessment.responses.length; j++) {\r\n                        if (assessment.responses[j]['identifier'] === item.response_identifier) {\r\n                            questionModel = assessment.responses[j];\r\n                            break;\r\n                        }\r\n                    }\r\n                    prompt = prompt + ' <div class=\"_qp-model\" data-model-id=\"' + item.response_identifier + '\" ></div>';\r\n                    addMultipleTextEntryModel(result, item, questionModel);\r\n                }\r\n                else if (item.type === 'inlinechoice') {\r\n                    var regex = /<inlinechoiceinteraction(?:.*?)responseidentifier=\"([\\s\\S]*?)\"(?:.*?)shuffle=([\"'])([^\"']*?)\\2><\\/inlinechoiceinteraction>/ig;\r\n                    prompt = item.prompt.replace(regex, function ($1, responseidentifier, $3, shuffle) {\r\n                        return '<span class=\"_qp-model\" data-model-id=\"' + responseidentifier + '\" style=\"\"></span>';\r\n                    });\r\n                    addInlineModel(result.modelMap, item);\r\n                }\r\n                else {\r\n                    prompt = prompt + \" <div class=\\\"_qp-model\\\" data-model-id=\\\"\" + modelId + \"\\\" style=\\\"\\\"></div>\";\r\n                    var playerItem = addModel(item, result);\r\n                    playerItem.full_score = item.full_score || 0;\r\n                    playerItem.user_score = item.user_score || 0;\r\n                    result.modelMap[modelId] = playerItem;\r\n                }\r\n                texts.push(item.prompt);\r\n                if (item.choices && item.choices.length > 0) {\r\n                    for (var j = 0; j < item.choices.length; j++) {\r\n                        texts.push(item.choices[j].text);\r\n                    }\r\n                }\r\n                //作文题\r\n                if (item.prompt_object) {\r\n                    texts.push(item.prompt_object.title);\r\n                    texts.push(item.prompt_object.content);\r\n                    if (item.prompt_object.assets) {\r\n                        var assets = item.prompt_object.assets;\r\n                        for (var j = 0; j < assets.length; j++) {\r\n                            texts.push(assets[j]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            //答案\r\n            for (var i = 0; i < assessment.responses.length; i++) {\r\n                var response = assessment.responses[i];\r\n                var modelId = response.identifier;\r\n                var questionModel = findByModelId(result, modelId);\r\n\r\n                var playerAnswer = addAnswer(response);\r\n                for (var j = 0; j < response.corrects.length; j++) {\r\n                    texts.push(response.corrects[j]);\r\n                }\r\n                if (questionModel && (questionModel.questionType === 'subjectivebase' || questionModel.questionType == 'extendedtext')) {\r\n                    modelMap.rubricBlock.parse(response.corrects[0], questionModel);\r\n                }\r\n                result.correctAnswer[modelId] = playerAnswer;\r\n            }\r\n\r\n            result.hasMath = checkUseMath(texts);\r\n            result.prompt = prompt;\r\n            _logger.debug(result);\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return jsonAdapter;\r\n});\r\n\n// qti model\r\ndefine('model/json/jsonParser', ['model/logger', 'model/utils', 'model/json/jsonConvert'], function (_logger, _utils, _jsonConvert) {\r\n\r\n    //json数据解析\r\n    var _json = {\r\n        _logger: _logger,\r\n        _refPathRegex: /\\$\\{ref-path\\}/g,\r\n        _refBaseRegex: /\\$\\{ref-base\\}/g,\r\n        _imgFilterRegex: /<img([^<>]*?)><\\/img>/g,\r\n        _convert: null,\r\n        parseJson: function (jsonText, option, url) {\r\n            var that = this;\r\n            var refPath = '';\r\n            var basePath = '';\r\n            if (option && option.refPath) {\r\n                refPath = option.refPath;\r\n            }\r\n            if(option && option.basePath) {\r\n                basePath = option.basePath;\r\n            }\r\n\r\n            //替换refPath表达式\r\n            jsonText = jsonText.replace(that._refPathRegex, refPath);\r\n            //替换basePath表达式\r\n            jsonText = url ? jsonText.replace(that._refBaseRegex, _utils.getBasePath(url)) : jsonText.replace(that._refBaseRegex, basePath);\r\n\r\n            //图片标签转换\r\n            jsonText = jsonText.replace(that._imgFilterRegex, function ($0, $1) {\r\n                var result = '<img' + $1 + '/>';\r\n                return result;\r\n            });\r\n            //解析数据\r\n            var itemModel = JSON.parse(jsonText);\r\n\r\n            //json数据适配\r\n            var assessmentItemModel = that._convert(itemModel);\r\n\r\n            var correctAnswer;\r\n            var model;\r\n            for (var mId in assessmentItemModel.modelMap) {\r\n                model = assessmentItemModel.modelMap[mId];\r\n                if (model.modelType === 'textEntryInteraction' || model.modelType === 'textEntryMultipleInteraction') {\r\n                    //编辑在保存正确的答案的字符串时，会对&<>这个3个符号做2次转义\r\n                    correctAnswer = assessmentItemModel.correctAnswer[mId];\r\n                    if (correctAnswer && correctAnswer.value.length > 0) {\r\n                        for (var index = 0; index < correctAnswer.value.length; index++) {\r\n                            value = correctAnswer.value[index];\r\n                            //针对&<>三个符号进行decode\r\n                            var value = _utils.xmlDecode(value);\r\n                            correctAnswer.value[index] = value;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return assessmentItemModel;\r\n        },\r\n        parse: function (text, option, url) {\r\n            var that = this;\r\n            that._convert = _jsonConvert.convert;\r\n            if (!that._convert) {\r\n                throw '_json:convert未加载';\r\n            }\r\n            //解析数据\r\n            return that.parseJson(text, option, url);\r\n        }\r\n    };\r\n\r\n    return _json;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/choiceInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var choiceInteraction = {\r\n        _choiceInteractionRegex: /<choiceInteraction[^/]*?>[\\s\\S]*?<\\/choiceInteraction>/g,\r\n        _choiceInteractionAttrRegex: /<choiceInteraction([\\s\\S]*?)>/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _shuffleRegex: /shuffle=\"([\\s\\S]*?)\"/,\r\n        _maxChoicesRegex: /maxChoices=\"(\\d+)\"/,\r\n        _minChoicesRegex: /minChoices=\"(\\d+)\"/,\r\n        _promptRegex: /<prompt>([\\s\\S]*?)<\\/prompt>/,\r\n        _simpleChoiceRegex: /<simpleChoice[\\s\\S]*?<\\/simpleChoice>/g,\r\n        _simpleChoiceValueRegex: /<simpleChoice[\\s\\S]*?>([\\s\\S]*?)<\\/simpleChoice>/,\r\n        _identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n        _fixedRegex: /fixed=\"([\\s\\S]*?)\"/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        _layoutRegex: /layout=\"([\\s\\S]*?)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._choiceInteractionRegex, function (modelXml) {\r\n                var choiceInteractionAttr = _utils.getValue(modelXml, that._choiceInteractionAttrRegex);\r\n                var modelId = _utils.getValue(choiceInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var modelType = 'choiceInteraction';\r\n                    var questionType = _utils.getValue(choiceInteractionAttr, that._questionTypeRegex);\r\n                    if (questionType === 'vote') {\r\n                        modelType = modelType + '_' + questionType;\r\n                    }\r\n                    var style = _utils.getValue(choiceInteractionAttr, that._styleRegex);\r\n                    var shuffle = _utils.stringToBoolean(_utils.getValue(choiceInteractionAttr, that._shuffleRegex));\r\n                    var maxChoices = _utils.getIntValue(choiceInteractionAttr, that._maxChoicesRegex);\r\n                    var minChoices = _utils.getIntValue(choiceInteractionAttr, that._minChoicesRegex);\r\n                    var layout = _utils.getValue(choiceInteractionAttr, that._layoutRegex);\r\n                    var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                    var simpleChoiceXmlArr = modelXml.match(that._simpleChoiceRegex);\r\n                    var simpleChoice = [];\r\n                    var simpleChoiceXml;\r\n                    var identifier;\r\n                    var fixed;\r\n                    var content;\r\n                    if (simpleChoiceXmlArr) {\r\n                        for (var index = 0; index < simpleChoiceXmlArr.length; index++) {\r\n                            simpleChoiceXml = simpleChoiceXmlArr[index];\r\n                            identifier = _utils.getValue(simpleChoiceXml, that._identifierRegex);\r\n                            fixed = _utils.stringToBoolean(_utils.getValue(simpleChoiceXml, that._fixedRegex));\r\n                            content = _utils.getValue(simpleChoiceXml, that._simpleChoiceValueRegex);\r\n                            simpleChoice.push({\r\n                                identifier: identifier,\r\n                                fixed: fixed,\r\n                                content: content\r\n                            });\r\n                        }\r\n                    }\r\n                    var model = {\r\n                        modelId: modelId,\r\n                        modelType: modelType,\r\n                        questionType: questionType,\r\n                        style: style,\r\n                        layout: layout,\r\n                        prompt: prompt,\r\n                        shuffle: shuffle,\r\n                        maxChoices: maxChoices,\r\n                        minChoices: minChoices,\r\n                        simpleChoice: simpleChoice\r\n                    };\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<div class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></div>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return choiceInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/correctAnswerParser', ['model/utils'], function (_utils) {\r\n\r\n    var correctAnswerParser = {\r\n        _correctAnswerRegex: /<responseDeclaration[^/]*?>[\\s\\S]*?<\\/responseDeclaration>/g,\r\n        _identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n        _cardinalityRegex: /cardinality=\"([\\s\\S]*?)\"/,\r\n        _baseTypeRegex: /baseType=\"([\\s\\S]*?)\"/,\r\n        _answerRegex: /<value>[\\s\\S]*?<\\/value>/g,\r\n        _answerValueRegex: /<value>([\\s\\S]*?)<\\/value>/,\r\n        parse: function (xml, itemModel) {\r\n            var modelId;\r\n            var correctAnswerXml;\r\n            var cardinality;\r\n            var baseType;\r\n            var values;\r\n            //解析正确答案\r\n            var correctAnswerXmlArr = xml.match(this._correctAnswerRegex);\r\n            if (correctAnswerXmlArr) {\r\n                for (var index = 0; index < correctAnswerXmlArr.length; index++) {\r\n                    correctAnswerXml = correctAnswerXmlArr[index];\r\n                    modelId = _utils.getValue(correctAnswerXml, this._identifierRegex);\r\n                    if (modelId) {\r\n                        values = _utils.getValues(correctAnswerXml, this._answerRegex, this._answerValueRegex);\r\n                        cardinality = _utils.getValue(correctAnswerXml, this._cardinalityRegex);\r\n                        baseType = _utils.getValue(correctAnswerXml, this._baseTypeRegex);\r\n                        itemModel.correctAnswer[modelId] = {\r\n                            identifier: modelId,\r\n                            cardinality: cardinality,\r\n                            baseType: baseType,\r\n                            value: values\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return correctAnswerParser;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/drawingInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var drawingInteraction = {\r\n        _drawingInteractionRegex: /<drawingInteraction[^/]*?>[\\s\\S]*?<\\/drawingInteraction>/g,\r\n        _drawingInteractionAttrRegex: /<drawingInteraction([\\s\\S]*?)>/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        _titleTypeRegex: /titletype=\"([\\s\\S]*?)\"/,\r\n        _paperTypeRegex: /papertype=\"([\\s\\S]*?)\"/,\r\n        _titleRegex: /<div class=\"drawingInteraction_title\">([\\s\\S]*)<\\/div>\\s*?<div class=\"drawingInteraction_content\">/,\r\n        _contentRegex: /<div class=\"drawingInteraction_content\">([\\s\\S]*)<\\/div>\\s*?<div class=\"drawingInteraction_asset\">/,\r\n        _assetRegex: /<div class=\"drawingInteraction_asset\">([\\s\\S]*)<\\/div>\\s*?<\\/prompt>/,\r\n        _assetValueRegex: /<div class=\"asset\">([\\s\\S]*?)<\\/div>\\s*?<div class=\"asset\">/,\r\n        _assetTitleRegex: /<div class=\"drawingInteraction_asset_title\">([\\s\\S]*)<\\/div>\\s*?<\\/prompt>/,\r\n        _assetTitleValueRegex: /<div class=\"asset_title\">([\\s\\S]*?)<\\/div>\\s*?<div class=\"asset_title\">/,\r\n        _emptyAssetRegex: /<div class=\"asset\"\\/>/g,\r\n        _emptyAssetTitleRegex: /<div class=\"asset_title\"\\/>/g,\r\n        _objectRegex: /(<object[\\s\\S]*?<\\/object>)/,\r\n        _dataRegex: /data=\"([\\s\\S]*?)\"/,\r\n        _typeRegex: /type=\"([\\s\\S]*?)\"/,\r\n        _widthRegex: /width=\"(\\d+)\"/,\r\n        _heightRegex: /height=\"(\\d+)\"/,\r\n        _promptRegex: /<prompt>([\\s\\S]*?)<\\/prompt>/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._drawingInteractionRegex, function (modelXml) {\r\n                var drawingInteractionAttr = _utils.getValue(modelXml, that._drawingInteractionAttrRegex);\r\n                var modelId = _utils.getValue(drawingInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var model;\r\n                    var questionType = _utils.getValue(drawingInteractionAttr, that._questionTypeRegex);\r\n                    if (questionType === '') {\r\n                        questionType = 'drawing';\r\n                    }\r\n                    var modelType = 'drawingInteraction_' + questionType;\r\n                    var style = _utils.getValue(drawingInteractionAttr, that._styleRegex);\r\n                    if (modelType === 'drawingInteraction_handwrite') {\r\n                        //特殊题目\r\n                        var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                        model = {\r\n                            modelId: modelId,\r\n                            modelType: modelType,\r\n                            questionType: questionType,\r\n                            style: style,\r\n                            prompt: prompt\r\n                        };\r\n                    } else {\r\n                        var titleType = _utils.getValue(drawingInteractionAttr, that._titleTypeRegex);\r\n                        var title = '';\r\n                        if (titleType === '1') {\r\n                            //固定命题\r\n                            title = _utils.getValue(modelXml, that._titleRegex);\r\n                        }\r\n                        var paperType = _utils.getValue(drawingInteractionAttr, that._paperTypeRegex);\r\n                        var content = _utils.getValue(modelXml, that._contentRegex);\r\n                        var asset = [];\r\n                        //获取asset\r\n                        var assetXml = _utils.getValue(modelXml, that._assetRegex);\r\n                        assetXml = assetXml.replace(that._emptyAssetRegex, '<div class=\"asset\"></div>');\r\n                        assetXml += '<div class=\"asset\">';\r\n                        var hasAsset = true;\r\n                        while (hasAsset) {\r\n                            hasAsset = false;\r\n                            assetXml = assetXml.replace(that._assetValueRegex, function ($0, $1) {\r\n                                hasAsset = true;\r\n                                asset.push($1);\r\n                                return '<div class=\"asset\">';\r\n                            });\r\n                        }\r\n                        //获取asset_title\r\n                        var assetTitleXml = _utils.getValue(modelXml, that._assetTitleRegex);\r\n                        assetTitleXml = assetTitleXml.replace(that._emptyAssetTitleRegex, '<div class=\"asset_title\"></div>');\r\n                        assetTitleXml += '<div class=\"asset_title\">';\r\n                        var hasAssetTitle = true;\r\n                        var assetTitle=[];\r\n                        while (hasAssetTitle) {\r\n                            hasAssetTitle = false;\r\n                            assetTitleXml = assetTitleXml.replace(that._assetTitleValueRegex, function ($0, $1) {\r\n                                hasAssetTitle = true;\r\n                                assetTitle.push($1);\r\n                                return '<div class=\"asset_title\">';\r\n                            });\r\n                        }\r\n\r\n                        model = {\r\n                            modelId: modelId,\r\n                            modelType: modelType,\r\n                            questionType: questionType,\r\n                            style: style,\r\n                            titleType: titleType,\r\n                            paperType: paperType,\r\n                            title: title,\r\n                            content: content,\r\n                            asset: asset,\r\n                            assetTitle:assetTitle\r\n                        };\r\n                    }\r\n                    var object = {};\r\n                    var objectXml = _utils.getValue(modelXml, that._objectRegex);\r\n                    object.type = _utils.getValue(objectXml, that._typeRegex);\r\n                    object.data = _utils.getValue(objectXml, that._dataRegex);\r\n                    object.width = _utils.getIntValue(objectXml, that._widthRegex);\r\n                    object.height = _utils.getIntValue(objectXml, that._heightRegex);\r\n                    model.object = object;\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<div class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></div>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return drawingInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/extendedTextInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var extendedTextInteraction = {\r\n        _extendedTextInteractionRegex: /<extendedTextInteraction[^/]*?>[\\s\\S]*?<\\/extendedTextInteraction>/g,\r\n        _extendedTextInteractionAttrRegex: /<extendedTextInteraction([\\s\\S]*?)>/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _promptRegex: /<prompt>([\\s\\S]*?)<\\/prompt>/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetRegex: /<div[^<>]*?class=\"asset\"[^<>]*?><\\/div>/g,\r\n        _subjectiveBaseAssetPosterRegex: /data-poster=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetSrcRegex: /data-src=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetTypeRegex: /data-type=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseTextRegex: /<div class=\"subjectivebase_text\">([\\s\\S]*?)<\\/div>\\s*?<div class=\"subjectivebase_asset\"/,\r\n        _widthRegex: /width=\"([\\s\\S]+)\"/,\r\n        _heightRegex: /height=\"([\\s\\S]+)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._extendedTextInteractionRegex, function (modelXml) {\r\n                var extendedTextInteractionAttr = _utils.getValue(modelXml, that._extendedTextInteractionAttrRegex);\r\n                var modelId = _utils.getValue(extendedTextInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var questionType = _utils.getValue(extendedTextInteractionAttr, that._questionTypeRegex);\r\n                    var modelType = 'extendedTextInteraction';\r\n                    var style = _utils.getValue(extendedTextInteractionAttr, that._styleRegex);\r\n                    var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                    var model;\r\n                    //特殊题型处理\r\n                    if (questionType === 'subjectivebase') {\r\n                        var assets = [];\r\n                        var text = '';\r\n\r\n                        var assetsResult = prompt.match(that._subjectiveBaseAssetRegex);\r\n                        if (assetsResult) {\r\n                            for (var i = 0; i < assetsResult.length; i++) {\r\n                                var asset = assetsResult[i];\r\n                                assets.push({\r\n                                    poster: _utils.getValue(asset, that._subjectiveBaseAssetPosterRegex),\r\n                                    src: _utils.getValue(asset, that._subjectiveBaseAssetSrcRegex),\r\n                                    type: _utils.getValue(asset, that._subjectiveBaseAssetTypeRegex),\r\n                                    width: _utils.getIntValue(asset, that._widthRegex),\r\n                                    height: _utils.getIntValue(asset, that._heightRegex)\r\n                                });\r\n                            }\r\n                        }\r\n                        text = _utils.getValue(prompt, that._subjectiveBaseTextRegex);\r\n\r\n                        model = {\r\n                            text: text,\r\n                            asset: assets,\r\n                            modelId: modelId,\r\n                            modelType: modelType,\r\n                            questionType: questionType,\r\n                            style: style,\r\n                            rubricBlock: {\r\n                                text: '',\r\n                                asset: [],\r\n                                view: 'scorer'\r\n                            }\r\n                        }\r\n                    } else {\r\n                        model = {\r\n                            modelId: modelId,\r\n                            modelType: modelType,\r\n                            questionType: questionType,\r\n                            style: style,\r\n                            prompt: prompt,\r\n                            rubricBlock: {\r\n                                prompt: '',\r\n                                view: 'scorer'\r\n                            }\r\n                        };\r\n                    }\r\n\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<div class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></div>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return extendedTextInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/feedbackParser', ['model/utils'], function (_utils) {\r\n\r\n    var feedbackParser = {\r\n        _feedbackRegex: /<modalFeedback[^/]*?>[\\s\\S]*?<\\/modalFeedback>/g,\r\n        _showHideRegex: /showHide=\"([\\s\\S]*?)\"/,\r\n        _sequenceRegex: /sequence=\"([\\s\\S]*?)\"/,\r\n        _identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n        _contentRegex: /<modalFeedback[\\s\\S]*?>([\\s\\S]*?)<\\/modalFeedback>/,\r\n        _subjectiveRegex: /class=\"subjectivebase_text\"/i,\r\n        _subjectiveBaseAssetRegex: /<div[^<>]*?class=\"asset\"[^<>]*?><\\/div>/g,\r\n        _subjectiveBaseAssetPosterRegex: /data-poster=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetSrcRegex: /data-src=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetTypeRegex: /data-type=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseTextRegex: /<div class=\"subjectivebase_text\">([\\s\\S]*?)<\\/div>\\s*?<div class=\"subjectivebase_asset\"/,\r\n        _widthRegex: /width=\"([\\s\\S]+)\"/,\r\n        _heightRegex: /height=\"([\\s\\S]+)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var modelId;\r\n            var feedbackXml;\r\n            var identifier;\r\n            var sequence;\r\n            var content;\r\n            var showHide;\r\n            var feedbackXmlArr = xml.match(this._feedbackRegex);\r\n            if (feedbackXmlArr) {\r\n                for (var index = 0; index < feedbackXmlArr.length; index++) {\r\n                    feedbackXml = feedbackXmlArr[index];\r\n                    sequence = _utils.getValue(feedbackXml, this._sequenceRegex);\r\n                    if (sequence) {\r\n                        modelId = 'RESPONSE_' + sequence + '-1';\r\n                        identifier = _utils.getValue(feedbackXml, this._identifierRegex);\r\n                        showHide = _utils.getValue(feedbackXml, this._showHideRegex);\r\n                        content = _utils.getValue(feedbackXml, this._contentRegex);\r\n                        var feedback = {\r\n                            modelId: modelId,\r\n                            showHide: showHide,\r\n                            identifier: identifier,\r\n                            content: content\r\n                        };\r\n                        //是否是主观题提示内容\r\n                        if (this._subjectiveRegex.test(content)) {\r\n                            var assets = [];\r\n                            var text = '';\r\n\r\n                            var assetsResult = content.match(this._subjectiveBaseAssetRegex);\r\n                            if (assetsResult) {\r\n                                for (var i = 0; i < assetsResult.length; i++) {\r\n                                    var asset = assetsResult[i];\r\n                                    assets.push({\r\n                                        poster: _utils.getValue(asset, this._subjectiveBaseAssetPosterRegex),\r\n                                        src: _utils.getValue(asset, this._subjectiveBaseAssetSrcRegex),\r\n                                        type: _utils.getValue(asset, this._subjectiveBaseAssetTypeRegex),\r\n                                        width: _utils.getIntValue(asset, this._widthRegex),\r\n                                        height: _utils.getIntValue(asset, this._heightRegex)\r\n                                    });\r\n                                }\r\n                            }\r\n                            text = _utils.getValue(content, this._subjectiveBaseTextRegex);\r\n                            feedback.contentData = {\r\n                                asset: assets,\r\n                                text: text\r\n                            }\r\n                        }\r\n\r\n                        if (identifier === 'showHint') {\r\n                            itemModel.hintFeedback[modelId] = feedback;\r\n                        } else {\r\n                            itemModel.answerFeedback[modelId] = feedback;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return feedbackParser;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/gapMatchInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var gapMatchInteraction = {\r\n        _gapMatchInteractionRegex: /<gapMatchInteraction[^/]*?>[\\s\\S]*?<\\/gapMatchInteraction>/g,\r\n        _gapMatchInteractionAttrRegex: /<gapMatchInteraction([\\s\\S]*?)>/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _promptRegex: /<prompt>([\\s\\S]*?)<\\/prompt>/,\r\n        _shuffleRegex: /shuffle=\"([\\s\\S]*?)\"/,\r\n        _gapTextRegex: /<gapText[\\s\\S]*?<\\/gapText>/g,\r\n        _gapTextValueRegex: /<gapText[\\s\\S]*?>([\\s\\S]*?)<\\/gapText>/,\r\n        _identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n        _matchMaxRegex: /matchMax=\"([\\s\\S]*?)\"/,\r\n        _fixedRegex: /fixed=\"([\\s\\S]*?)\"/,\r\n        _tableContentRegex: /(<div class=\"gapMatchInteraction_table_content\">[\\s\\S]*<\\/div>)/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._gapMatchInteractionRegex, function (modelXml) {\r\n                var gapMatchInteractionAttr = _utils.getValue(modelXml, that._gapMatchInteractionAttrRegex);\r\n                var modelId = _utils.getValue(gapMatchInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var modelType = 'gapMatchInteraction';\r\n                    var questionType = _utils.getValue(gapMatchInteractionAttr, that._questionTypeRegex);\r\n                    var style = _utils.getValue(gapMatchInteractionAttr, that._styleRegex);\r\n                    var shuffle = _utils.stringToBoolean(_utils.getValue(gapMatchInteractionAttr, that._shuffleRegex));\r\n                    var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                    var gapText = [];\r\n                    var gapTextXmlArr = modelXml.match(that._gapTextRegex);\r\n                    if (gapTextXmlArr) {\r\n                        var gapTextXml;\r\n                        var gapTextObj;\r\n                        for (var index = 0; index < gapTextXmlArr.length; index++) {\r\n                            gapTextXml = gapTextXmlArr[index];\r\n                            gapTextObj = {};\r\n                            gapTextObj.identifier = _utils.getValue(gapTextXml, that._identifierRegex);\r\n                            gapTextObj.matchMax = _utils.getValue(gapTextXml, that._matchMaxRegex);\r\n                            gapTextObj.content = _utils.getValue(gapTextXml, that._gapTextValueRegex);\r\n                            gapText.push(gapTextObj);\r\n                        }\r\n                    }\r\n                    var tableContent = _utils.getValue(modelXml, that._tableContentRegex);\r\n                    var model = {\r\n                        modelId: modelId,\r\n                        modelType: modelType,\r\n                        questionType: questionType,\r\n                        style: style,\r\n                        prompt: prompt,\r\n                        shuffle: shuffle,\r\n                        gapText: gapText,\r\n                        tableMatchContent: tableContent\r\n                    };\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<div class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></div>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return gapMatchInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/graphicGapMatchInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var graphicGapMatchInteraction = {\r\n        _graphicGapMatchInteractionRegex: /<graphicGapMatchInteraction[^/]*?>[\\s\\S]*?<\\/graphicGapMatchInteraction>/g,\r\n        _graphicGapMatchInteractionAttrRegex: /<graphicGapMatchInteraction([\\s\\S]*?)>/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _promptRegex: /<prompt>([\\s\\S]*?)<\\/prompt>/,\r\n        _objectRegex: /(<object[\\s\\S]*?<\\/object>)/,\r\n        _paramRegex: /<param[\\s\\S]*?><\\/param>/g,\r\n        _nameRegex: /name=\"([\\s\\S]*?)\"/,\r\n        _valueRegex: /value=\"([\\s\\S]*?)\"/,\r\n        _valueTypeRegex: /valuetype=\"([\\s\\S]*?)\"/,\r\n        _gapImgRegex: /<gapImg[\\s\\S]*?<\\/gapImg>/g,\r\n        _identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n        _matchMaxRegex: /matchMax=\"([\\s\\S]*?)\"/,\r\n        _dataRegex: /data=\"([\\s\\S]*?)\"/,\r\n        _typeRegex: /type=\"([\\s\\S]*?)\"/,\r\n        _widthRegex: /width=\"(\\d+)\"/,\r\n        _heightRegex: /height=\"(\\d+)\"/,\r\n        _associableHotspotRegex: /<associableHotspot[\\s\\S]*?><\\/associableHotspot>/g,\r\n        _shapeRegex: /shape=\"([\\s\\S]*?)\"/,\r\n        _coordsRegex: /coords=\"([\\s\\S]*?)\"/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._graphicGapMatchInteractionRegex, function (modelXml) {\r\n                var graphicGapMatchInteractionAttr = _utils.getValue(modelXml, that._graphicGapMatchInteractionAttrRegex);\r\n                var modelId = _utils.getValue(graphicGapMatchInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var modelType = 'graphicGapMatchInteraction';\r\n                    var questionType = _utils.getValue(graphicGapMatchInteractionAttr, that._questionTypeRegex);\r\n                    var style = _utils.getValue(graphicGapMatchInteractionAttr, that._styleRegex);\r\n                    var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                    var object = {};\r\n                    var objectXml = _utils.getValue(modelXml, that._objectRegex);\r\n                    object.data = _utils.getValue(objectXml, that._dataRegex);\r\n                    object.type = _utils.getValue(objectXml, that._typeRegex);\r\n                    object.width = _utils.getIntValue(objectXml, that._widthRegex);\r\n                    object.height = _utils.getIntValue(objectXml, that._heightRegex);\r\n                    object.param = [];\r\n                    var paramXmlArr = objectXml.match(that._paramRegex);\r\n                    if (paramXmlArr) {\r\n                        var paramXml;\r\n                        var param;\r\n                        for (var index = 0; index < paramXmlArr.length; index++) {\r\n                            paramXml = paramXmlArr[index];\r\n                            param = {};\r\n                            param.name = _utils.getValue(paramXml, that._nameRegex);\r\n                            param.value = _utils.getValue(paramXml, that._valueRegex);\r\n                            param.valueType = _utils.getValue(paramXml, that._valueTypeRegex);\r\n                            object.param.push(param);\r\n                        }\r\n                    }\r\n                    var gapImg = [];\r\n                    var gapImgXmlArr = modelXml.match(that._gapImgRegex);\r\n                    if (gapImgXmlArr) {\r\n                        var gapImgXml;\r\n                        var gapImgObj;\r\n                        for (var index = 0; index < gapImgXmlArr.length; index++) {\r\n                            gapImgXml = gapImgXmlArr[index];\r\n                            gapImgObj = {};\r\n                            gapImgObj.identifier = _utils.getValue(gapImgXml, that._identifierRegex);\r\n                            gapImgObj.matchMax = _utils.getValue(gapImgXml, that._matchMaxRegex);\r\n                            gapImgObj.data = _utils.getValue(gapImgXml, that._dataRegex);\r\n                            gapImgObj.type = _utils.getValue(gapImgXml, that._typeRegex);\r\n                            gapImgObj.width = _utils.getIntValue(gapImgXml, that._widthRegex);\r\n                            gapImgObj.height = _utils.getIntValue(gapImgXml, that._heightRegex);\r\n                            gapImg.push(gapImgObj);\r\n                        }\r\n                    }\r\n                    var associableHotspot = [];\r\n                    var associableHotspotXmlArr = modelXml.match(that._associableHotspotRegex);\r\n                    if (associableHotspotXmlArr) {\r\n                        var associableHotspotXml;\r\n                        var associableHotspotObj;\r\n                        for (var index = 0; index < associableHotspotXmlArr.length; index++) {\r\n                            associableHotspotXml = associableHotspotXmlArr[index];\r\n                            associableHotspotObj = {};\r\n                            associableHotspotObj.identifier = _utils.getValue(associableHotspotXml, that._identifierRegex);\r\n                            associableHotspotObj.matchMax = _utils.getValue(associableHotspotXml, that._matchMaxRegex);\r\n                            associableHotspotObj.shape = _utils.getValue(associableHotspotXml, that._shapeRegex);\r\n                            associableHotspotObj.coords = _utils.getValue(associableHotspotXml, that._coordsRegex);\r\n                            associableHotspot.push(associableHotspotObj);\r\n                        }\r\n                    }\r\n                    var model = {\r\n                        modelId: modelId,\r\n                        modelType: modelType,\r\n                        questionType: questionType,\r\n                        style: style,\r\n                        prompt: prompt,\r\n                        object: object,\r\n                        gapImg: gapImg,\r\n                        associableHotspot: associableHotspot\r\n                    };\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<div class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></div>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return graphicGapMatchInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/inlineChoiceInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var inlineChoiceInteraction = {\r\n        _inlineChoiceInteractionRegex: /<inlineChoiceInteraction[^/]*?>[\\s\\S]*?<\\/inlineChoiceInteraction>/g,\r\n        _inlineChoiceInteractionAttrRegex: /<inlineChoiceInteraction([\\s\\S]*?)>/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _shuffleRegex: /shuffle=\"([\\s\\S]*?)\"/,\r\n        _inlineChoiceRegex: /<inlineChoice [\\s\\S]*?<\\/inlineChoice>/g,\r\n        _inlineChoiceValueRegex: /<inlineChoice [\\s\\S]*?>([\\s\\S]*?)<\\/inlineChoice>/,\r\n        _identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._inlineChoiceInteractionRegex, function (modelXml) {\r\n                var inlineChoiceInteractionAttr = _utils.getValue(modelXml, that._inlineChoiceInteractionAttrRegex);\r\n                var modelId = _utils.getValue(inlineChoiceInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var modelType = 'inlineChoiceInteraction';\r\n                    var questionType = _utils.getValue(inlineChoiceInteractionAttr, that._questionTypeRegex);\r\n                    var style = _utils.getValue(inlineChoiceInteractionAttr, that._styleRegex);\r\n                    var shuffle = _utils.stringToBoolean(_utils.getValue(inlineChoiceInteractionAttr, that._shuffleRegex));\r\n                    var inlineChoice = [];\r\n                    var inlineChoiceXmlArr = modelXml.match(that._inlineChoiceRegex);\r\n                    if (inlineChoiceXmlArr) {\r\n                        var inlineChoiceXml;\r\n                        var identifier;\r\n                        var content;\r\n                        for (var index = 0; index < inlineChoiceXmlArr.length; index++) {\r\n                            inlineChoiceXml = inlineChoiceXmlArr[index];\r\n                            identifier = _utils.getValue(inlineChoiceXml, that._identifierRegex);\r\n                            content = _utils.getValue(inlineChoiceXml, that._inlineChoiceValueRegex);\r\n                            inlineChoice.push({\r\n                                identifier: identifier,\r\n                                content: content\r\n                            });\r\n                        }\r\n                    }\r\n                    var model = {\r\n                        modelId: modelId,\r\n                        modelType: modelType,\r\n                        questionType: questionType,\r\n                        shuffle: shuffle,\r\n                        style: style,\r\n                        inlineChoice: inlineChoice\r\n                    };\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<span class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></span>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return inlineChoiceInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/matchInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var matchInteraction = {\r\n        _matchInteractionRegex: /<matchInteraction[^/]*?>[\\s\\S]*?<\\/matchInteraction>/g,\r\n        _matchInteractionAttrRegex: /<matchInteraction([\\s\\S]*?)>/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _shuffleRegex: /shuffle=\"([\\s\\S]*?)\"/,\r\n        _maxAssociationsRegex: /maxAssociations=\"(\\d+)\"/,\r\n        _minAssociationsRegex: /minAssociations=\"(\\d+)\"/,\r\n        _promptRegex: /<prompt>([\\s\\S]*?)<\\/prompt>/,\r\n        _simpleMatchSetRegex: /<simpleMatchSet[\\s\\S]*?<\\/simpleMatchSet>/g,\r\n        _simpleMatchSetValueRegex: /<simpleMatchSet[\\s\\S]*?>([\\s\\S]*?)<\\/simpleMatchSet>/,\r\n        _simpleAssociableChoiceRegex: /<simpleAssociableChoice[\\s\\S]*?<\\/simpleAssociableChoice>/g,\r\n        _simpleAssociableChoiceValueRegex: /<simpleAssociableChoice[\\s\\S]*?>([\\s\\S]*?)<\\/simpleAssociableChoice>/,\r\n        _identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n        _fixedRegex: /fixed=\"([\\s\\S]*?)\"/,\r\n        _matchMaxRegex: /matchMax=\"(\\d+)\"/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._matchInteractionRegex, function (modelXml) {\r\n                var matchInteractionAttr = _utils.getValue(modelXml, that._matchInteractionAttrRegex);\r\n                var modelId = _utils.getValue(matchInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var modelType = 'matchInteraction';\r\n                    var questionType = _utils.getValue(matchInteractionAttr, that._questionTypeRegex);\r\n                    var style = _utils.getValue(matchInteractionAttr, that._styleRegex);\r\n                    var shuffle = _utils.stringToBoolean(_utils.getValue(matchInteractionAttr, that._shuffleRegex));\r\n                    var maxAssociations = _utils.getIntValue(matchInteractionAttr, that._maxAssociationsRegex);\r\n                    var minAssociations = _utils.getIntValue(matchInteractionAttr, that._minAssociationsRegex);\r\n                    var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                    var simpleMatchSetXmlArr = modelXml.match(that._simpleMatchSetRegex);\r\n                    var simpleMatchSetXml;\r\n                    var simpleMatchSet = [];\r\n                    var simpleAssociableChoiceXmlArr;\r\n                    var simpleAssociableChoiceXml;\r\n                    var simpleAssociableChoice;\r\n                    var identifier;\r\n                    var fixed;\r\n                    var content;\r\n                    var matchMax;\r\n                    if (simpleMatchSetXmlArr) {\r\n                        for (var index = 0; index < simpleMatchSetXmlArr.length; index++) {\r\n                            simpleMatchSetXml = simpleMatchSetXmlArr[index];\r\n                            simpleAssociableChoiceXmlArr = simpleMatchSetXml.match(that._simpleAssociableChoiceRegex);\r\n                            if (simpleAssociableChoiceXmlArr) {\r\n                                simpleAssociableChoice = [];\r\n                                for (var cIndex = 0; cIndex < simpleAssociableChoiceXmlArr.length; cIndex++) {\r\n                                    simpleAssociableChoiceXml = simpleAssociableChoiceXmlArr[cIndex];\r\n                                    identifier = _utils.getValue(simpleAssociableChoiceXml, that._identifierRegex);\r\n                                    fixed = _utils.stringToBoolean(_utils.getValue(simpleAssociableChoiceXml, that._fixedRegex));\r\n                                    matchMax = _utils.getIntValue(simpleAssociableChoiceXml, that._matchMaxRegex);\r\n                                    content = _utils.getValue(simpleAssociableChoiceXml, that._simpleAssociableChoiceValueRegex);\r\n                                    simpleAssociableChoice.push({\r\n                                        identifier: identifier,\r\n                                        fixed: fixed,\r\n                                        matchMax: matchMax,\r\n                                        content: content\r\n                                    });\r\n                                }\r\n                                simpleMatchSet.push(simpleAssociableChoice);\r\n                            }\r\n                        }\r\n                    }\r\n                    var model = {\r\n                        modelId: modelId,\r\n                        modelType: modelType,\r\n                        questionType: questionType,\r\n                        style: style,\r\n                        prompt: prompt,\r\n                        shuffle: shuffle,\r\n                        maxAssociations: maxAssociations,\r\n                        minAssociations: minAssociations,\r\n                        simpleMatchSet: simpleMatchSet\r\n                    };\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<div class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></div>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return matchInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/orderInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var orderInteraction = {\r\n        _orderInteractionRegex: /<orderInteraction[^/]*?>[\\s\\S]*?<\\/orderInteraction>/g,\r\n        _orderInteractionAttrRegex: /<orderInteraction([\\s\\S]*?)>/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _shuffleRegex: /shuffle=\"([\\s\\S]*?)\"/,\r\n        _maxChoicesRegex: /maxChoices=\"(\\d+)\"/,\r\n        _minChoicesRegex: /minChoices=\"(\\d+)\"/,\r\n        _promptRegex: /<prompt>([\\s\\S]*?)<\\/prompt>/,\r\n        _simpleChoiceRegex: /<simpleChoice[\\s\\S]*?<\\/simpleChoice>/g,\r\n        _simpleChoiceValueRegex: /<simpleChoice[\\s\\S]*?>([\\s\\S]*?)<\\/simpleChoice>/,\r\n        _identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n        _fixedRegex: /fixed=\"([\\s\\S]*?)\"/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._orderInteractionRegex, function (modelXml) {\r\n                var orderInteractionAttr = _utils.getValue(modelXml, that._orderInteractionAttrRegex);\r\n                var modelId = _utils.getValue(orderInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var modelType = 'orderInteraction';\r\n                    var questionType = _utils.getValue(orderInteractionAttr, that._questionTypeRegex);\r\n                    var shuffle = _utils.stringToBoolean(_utils.getValue(orderInteractionAttr, that._shuffleRegex));\r\n                    var style = _utils.getValue(orderInteractionAttr, that._styleRegex);\r\n                    var maxChoices = _utils.getIntValue(orderInteractionAttr, that._maxChoicesRegex);\r\n                    var minChoices = _utils.getIntValue(orderInteractionAttr, that._minChoicesRegex);\r\n                    var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                    var simpleChoiceXmlArr = modelXml.match(that._simpleChoiceRegex);\r\n                    var simpleChoice = [];\r\n                    var simpleChoiceXml;\r\n                    var identifier;\r\n                    var fixed;\r\n                    var content;\r\n                    if (simpleChoiceXmlArr) {\r\n                        for (var index = 0; index < simpleChoiceXmlArr.length; index++) {\r\n                            simpleChoiceXml = simpleChoiceXmlArr[index];\r\n                            identifier = _utils.getValue(simpleChoiceXml, that._identifierRegex);\r\n                            fixed = _utils.stringToBoolean(_utils.getValue(simpleChoiceXml, that._fixedRegex));\r\n                            content = _utils.getValue(simpleChoiceXml, that._simpleChoiceValueRegex);\r\n                            simpleChoice.push({\r\n                                identifier: identifier,\r\n                                fixed: fixed,\r\n                                content: content\r\n                            });\r\n                        }\r\n                    }\r\n                    var model = {\r\n                        modelId: modelId,\r\n                        modelType: modelType,\r\n                        questionType: questionType,\r\n                        style: style,\r\n                        prompt: prompt,\r\n                        shuffle: shuffle,\r\n                        maxChoices: maxChoices,\r\n                        minChoices: minChoices,\r\n                        simpleChoice: simpleChoice\r\n                    };\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<div class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></div>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return orderInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/rubricBlock', ['model/utils'], function (_utils) {\r\n\r\n    var rubricBlock = {\r\n        _rubricBlockRegex: /<rubricBlock[^/]*?>[\\s\\S]*?<\\/rubricBlock>/g,\r\n        _idRegex: /id=\"([\\s\\S]*?)\"/,\r\n        _viewRegex: /view=\"([\\s\\S]*?)\"/,\r\n        _promptRegex: /<rubricBlock[\\s\\S]*?>([\\s\\S]*?)<\\/rubricBlock>/,\r\n        _subjectiveBaseAssetRegex: /<div[^<>]*?class=\"asset\"[^<>]*?><\\/div>/g,\r\n        _subjectiveBaseAssetPosterRegex: /data-poster=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetSrcRegex: /data-src=\"([\\s\\S]*?)\"/,\r\n        _subjectiveBaseAssetTypeRegex: /data-type=\"([\\s\\S]*?)\"/,\r\n        _responseTextRegex: /<div class=\"response_text\">([\\s\\S]*?)<\\/div>\\s*?<div class=\"subjectivebase_asset\"/,\r\n        _widthRegex: /width=\"([\\s\\S]+)\"/,\r\n        _heightRegex: /height=\"([\\s\\S]+)\"/,\r\n        parse: function (xml, itemModel) {\r\n            //该模型为对应的问答题的参考答案\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._rubricBlockRegex, function (modelXml) {\r\n                var id = _utils.getValue(modelXml, that._idRegex);\r\n                if (id) {\r\n                    var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                    var view = _utils.getValue(modelXml, that._viewRegex);\r\n                    var rubricBlock;\r\n\r\n                    var subjectiveBase = that._responseTextRegex.test(prompt);\r\n                    if (subjectiveBase) {\r\n                        var assets = [];\r\n                        var text = '';\r\n\r\n                        var assetsResult = prompt.match(that._subjectiveBaseAssetRegex);\r\n                        if (assetsResult) {\r\n                            for (var i = 0; i < assetsResult.length; i++) {\r\n                                var asset = assetsResult[i];\r\n                                assets.push({\r\n                                    poster: _utils.getValue(asset, that._subjectiveBaseAssetPosterRegex),\r\n                                    src: _utils.getValue(asset, that._subjectiveBaseAssetSrcRegex),\r\n                                    type: _utils.getValue(asset, that._subjectiveBaseAssetTypeRegex),\r\n                                    width: _utils.getIntValue(asset, that._widthRegex),\r\n                                    height: _utils.getIntValue(asset, that._heightRegex)\r\n                                });\r\n                            }\r\n                        }\r\n                        text = _utils.getValue(prompt, that._responseTextRegex);\r\n\r\n                        rubricBlock = {\r\n                            view: view,\r\n                            text: text,\r\n                            asset: assets\r\n                        }\r\n                    } else {\r\n                        rubricBlock = {\r\n                            prompt: prompt,\r\n                            view: view\r\n                        };\r\n                    }\r\n\r\n                    itemModel.rubricBlockMap[id] = rubricBlock;\r\n                }\r\n                return '';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return rubricBlock;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/textEntryInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var textEntryInteraction = {\r\n        _textEntryInteractionRegex: /<textEntryInteraction[\\s\\S]*?\\/>/g,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _expectedLengthRegex: /expectedLength=\"(\\d+)\"/,\r\n        _keyboardRegex: /keyboard=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        _widthRegex: /width=\"(\\d+)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._textEntryInteractionRegex, function (modelXml) {\r\n                var modelId = _utils.getValue(modelXml, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var modelType = 'textEntryInteraction';\r\n                    var questionType = _utils.getValue(modelXml, that._questionTypeRegex);\r\n                    var expectedLength = _utils.getIntValue(modelXml, that._expectedLengthRegex);\r\n                    var style = _utils.getValue(modelXml, that._styleRegex);\r\n                    var keyboard = _utils.getValue(modelXml, that._keyboardRegex);\r\n                    var width = _utils.getIntValue(modelXml, that._widthRegex);\r\n                    if (!keyboard) {\r\n                        keyboard = 'text';\r\n                    }\r\n                    var model = {\r\n                        modelId: modelId,\r\n                        modelType: modelType,\r\n                        questionType: questionType,\r\n                        style: style,\r\n                        expectedLength: expectedLength,\r\n                        keyboard: keyboard,\r\n                        width: width\r\n                    };\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<span class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></span>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return textEntryInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/textEntryMultipleInteraction', ['model/utils'], function (_utils) {\r\n\r\n    var textEntryMultipleInteraction = {\r\n        _textEntryMultipleInteractionRegex: /<textEntryMultipleInteraction[^/]*?>[\\s\\S]*?<\\/textEntryMultipleInteraction>/g,\r\n        _textEntryMultipleInteractionAttrRegex: /<textEntryMultipleInteraction([\\s\\S]*?)>/,\r\n        _responseIdentifierRegex: /responseIdentifier=\"([\\s\\S]*?)\"/,\r\n        _styleRegex: /style=\"([\\s\\S]*?)\"/,\r\n        _promptRegex: /<prompt>([\\s\\S]*?)<\\/prompt>/,\r\n        _questionTypeRegex: /questionType=\"([\\s\\S]*?)\"/,\r\n        parse: function (xml, itemModel) {\r\n            var that = this;\r\n            var result = '';\r\n            result = xml.replace(that._textEntryMultipleInteractionRegex, function (modelXml) {\r\n                var textEntryMultipleInteractionAttr = _utils.getValue(modelXml, that._textEntryMultipleInteractionAttrRegex);\r\n                var modelId = _utils.getValue(textEntryMultipleInteractionAttr, that._responseIdentifierRegex);\r\n                if (modelId) {\r\n                    var modelType = 'textEntryMultipleInteraction';\r\n                    var questionType = _utils.getValue(textEntryMultipleInteractionAttr, that._questionTypeRegex);\r\n                    var prompt = _utils.getValue(modelXml, that._promptRegex);\r\n                    var style = _utils.getValue(textEntryMultipleInteractionAttr, that._styleRegex);\r\n                    var model = {\r\n                        modelId: modelId,\r\n                        modelType: modelType,\r\n                        questionType: questionType,\r\n                        prompt: prompt,\r\n                        style: style\r\n                    };\r\n                    itemModel.modelMap[modelId] = model;\r\n                }\r\n                return '<div class=\"_qp-model\" data-model-id=\"' + modelId + '\" style=\"' + style + '\"></div>';\r\n            });\r\n            return result;\r\n        }\r\n    };\r\n\r\n    return textEntryMultipleInteraction;\r\n\r\n});\r\n\n// qti model\r\ndefine('model/xml/xmlParser', ['model/logger', 'model/utils', 'model/event'], function (logger, utils,_event) {\r\n\r\n    var _utils = utils;\r\n    var choiceInteraction = require('model/xml/choiceInteraction');\r\n    var correctAnswerParser = require('model/xml/correctAnswerParser');\r\n    var drawingInteraction = require('model/xml/drawingInteraction');\r\n    var extendedTextInteraction = require('model/xml/extendedTextInteraction');\r\n    var feedbackParser = require('model/xml/feedbackParser');\r\n    var gapMatchInteraction = require('model/xml/gapMatchInteraction');\r\n    var graphicGapMatchInteraction = require('model/xml/graphicGapMatchInteraction');\r\n    var inlineChoiceInteraction = require('model/xml/inlineChoiceInteraction');\r\n    var matchInteraction = require('model/xml/matchInteraction');\r\n    var orderInteraction = require('model/xml/orderInteraction');\r\n    var rubricBlock = require('model/xml/rubricBlock');\r\n    var textEntryInteraction = require('model/xml/textEntryInteraction');\r\n    var textEntryMultipleInteraction = require('model/xml/textEntryMultipleInteraction');\r\n\r\n    var _xml = {\r\n        _event: _event,\r\n        _logger: logger,\r\n        _refPathRegex: /\\$\\{ref-path\\}/g,\r\n        _refBaseRegex: /\\$\\{ref-base\\}/g,\r\n        _mathLeftDecodeRegex: /&lt;latex( class=\"math-tex\")?&gt;/g,\r\n        _mathRightDecodeRegex: /&lt;\\/latex&gt;/g,\r\n        _mathRegex: /<latex( class=\"math-tex\")?>[\\s\\S]*?<\\/latex>/g,\r\n        _imgFilterRegex: /<img([^<>]*?)><\\/img>/g,\r\n        _textEntryInteractionFilterRegex: /<textEntryInteraction([^<>]*?)><\\/textEntryInteraction>/g,\r\n        _modelFeedbackFilterRegex: /<modalFeedback([^<>]*?)\\/>/g,\r\n        _textEntryFilterRegex: /<textEntry([^<>]*?)><\\/textEntry>/g,\r\n        _paramFilterRegex: /<param([^<>]*?)\\/>/g,\r\n        _associableHotspotFilterRegex: /<associableHotspot([^<>]*?)\\/>/g,\r\n        _objectFilterRegex: /<object([^<>]*?)\\/>/g,\r\n        correctAnswerParser: correctAnswerParser,\r\n        feedbackParser: feedbackParser,\r\n        modelParser: {\r\n            _itemBodyRegex: /<itemBody[\\s\\S]*?>([\\s\\S]*?)<\\/itemBody>/,\r\n            _parserMap: {\r\n                textEntryInteraction: textEntryInteraction,\r\n                inlineChoiceInteraction: inlineChoiceInteraction,\r\n                textEntryMultipleInteraction: textEntryMultipleInteraction,\r\n                choiceInteraction: choiceInteraction,\r\n                orderInteraction: orderInteraction,\r\n                matchInteraction: matchInteraction,\r\n                graphicGapMatchInteraction: graphicGapMatchInteraction,\r\n                gapMatchInteraction: gapMatchInteraction,\r\n                extendedTextInteraction: extendedTextInteraction,\r\n                rubricBlock: rubricBlock,\r\n                drawingInteraction: drawingInteraction\r\n            },\r\n            parse: function (xml, itemModel) {\r\n                var result = _utils.getValue(xml, this._itemBodyRegex);\r\n                var parser;\r\n                itemModel.rubricBlockMap = {};\r\n                //解析所有模型\r\n                for (var modelId in this._parserMap) {\r\n                    parser = this._parserMap[modelId];\r\n                    result = parser.parse(result, itemModel);\r\n                }\r\n                //将问答题的参考答案模型合并到问答题的模型\r\n                var model;\r\n                var rubricBlock;\r\n                for (var modelId in itemModel.rubricBlockMap) {\r\n                    model = itemModel.modelMap[modelId];\r\n                    if (model) {\r\n                        rubricBlock = itemModel.rubricBlockMap[modelId];\r\n                        model.rubricBlock = rubricBlock;\r\n                    }\r\n                }\r\n                delete itemModel.rubricBlockMap;\r\n                return result;\r\n            }\r\n        }\r\n    };\r\n\r\n    _xml.parseXml = function (xmlText, option, url) {\r\n        var that = this;\r\n        var refPath = '';\r\n        if (option && option.refPath) {\r\n            refPath = option.refPath;\r\n        }\r\n        //替换refPath表达式\r\n        xmlText = xmlText.replace(that._refPathRegex, refPath);\r\n        xmlText = xmlText.replace(that._refBaseRegex, _utils.getBasePath(url));\r\n        //图片标签转换\r\n        xmlText = xmlText.replace(that._imgFilterRegex, function ($0, $1) {\r\n            var result = '<img' + $1 + '/>';\r\n            return result;\r\n        });\r\n        //填空题特殊标签转换\r\n        xmlText = xmlText.replace(that._textEntryInteractionFilterRegex, function ($0, $1) {\r\n            var result = '<textEntryInteraction' + $1 + '/>';\r\n            return result;\r\n        });\r\n        xmlText = xmlText.replace(that._textEntryFilterRegex, function ($0, $1) {\r\n            var result = '<textEntry' + $1 + '/>';\r\n            return result;\r\n        });\r\n        //拼图题和手写作文题特殊标签转换\r\n        xmlText = xmlText.replace(that._associableHotspotFilterRegex, function ($0, $1) {\r\n            var result = '<associableHotspot' + $1 + '></associableHotspot>';\r\n            return result;\r\n        });\r\n        xmlText = xmlText.replace(that._paramFilterRegex, function ($0, $1) {\r\n            var result = '<param' + $1 + '></param>';\r\n            return result;\r\n        });\r\n        xmlText = xmlText.replace(that._objectFilterRegex, function ($0, $1) {\r\n            var result = '<object' + $1 + '></object>';\r\n            return result;\r\n        });\r\n        //反馈空标签转换\r\n        xmlText = xmlText.replace(that._modelFeedbackFilterRegex, function ($0, $1) {\r\n            var result = '<modalFeedback' + $1 + '></modalFeedback>';\r\n            return result;\r\n        });\r\n        //数学表达式标签解码\r\n        xmlText = xmlText.replace(that._mathLeftDecodeRegex, '<latex class=\"math-tex\">');\r\n        xmlText = xmlText.replace(that._mathRightDecodeRegex, '</latex>');\r\n        //判断是否含有数学公式\r\n        var hasMath = false;\r\n        if (xmlText.match(that._mathRegex)) {\r\n            hasMath = true;\r\n        }\r\n        //将$xml解析成assessmentItemModel\r\n        var assessmentItemModel = {\r\n            hasMath: hasMath,\r\n            prompt: '',\r\n            correctAnswer: {},\r\n            hintFeedback: {},\r\n            answerFeedback: {},\r\n            modelMap: {}\r\n        };\r\n        var filterXml = xmlText;\r\n        //解析正确答案\r\n        that.correctAnswerParser.parse(filterXml, assessmentItemModel);\r\n        //解析Feedback\r\n        that.feedbackParser.parse(filterXml, assessmentItemModel);\r\n        //解析itemBody\r\n        var prompt = that.modelParser.parse(filterXml, assessmentItemModel);\r\n        //保存html模板\r\n        assessmentItemModel.prompt = prompt;\r\n        //针对填空题的正确答案数据中的&<>3个符号decode编码处理\r\n        var model;\r\n        var correctAnswer;\r\n        var value;\r\n        var decodeAndRegex = /&amp;/g;\r\n        for (var mId in assessmentItemModel.modelMap) {\r\n            model = assessmentItemModel.modelMap[mId];\r\n            if (model.modelType === 'textEntryInteraction' || model.modelType === 'textEntryMultipleInteraction') {\r\n                //编辑在保存正确的答案的字符串时，会对&<>这个3个符号做2次转义\r\n                correctAnswer = assessmentItemModel.correctAnswer[mId];\r\n                if (correctAnswer && correctAnswer.value.length > 0) {\r\n                    for (var index = 0; index < correctAnswer.value.length; index++) {\r\n                        value = correctAnswer.value[index];\r\n                        //第一次针对&符号进行decode\r\n                        value = value.replace(decodeAndRegex, '&');\r\n                        //第二次针对&<>三个符号进行decode\r\n                        value = _utils.xmlDecode(value);\r\n                        correctAnswer.value[index] = value;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return assessmentItemModel;\r\n    };\r\n\r\n    _xml.parse = function (text, option, url) {\r\n        var that = this;\r\n        return that.parseXml(text, option, url);\r\n    };\r\n\r\n    return _xml;\r\n\r\n});\r\n\ndefine('player/assessment/assessmentItem', ['model/logger', 'player/utils/imageLoader', 'player/utils/extendUtils'], function (_logger, _imageLoader, _utils) {\r\n\r\n    var ModelItem = require('player/model/modelItem');\r\n\r\n    //定义AssessmentItem,负责题目的展示和数据存储\r\n    var AssessmentItem = {\r\n        _event: null,\r\n        _media: null,\r\n        _itemModel: null,\r\n        _answer: null,\r\n        _isComposite: false,//标识是否是复合题\r\n        _sequenceNumber: null,// 题目的序号\r\n        _stat: null, //外部传入的统计信息\r\n        _modelItem: null,\r\n        _score: 0,\r\n        _supportType: [\"choiceInteraction\", \"textEntryMultipleInteraction\", \"extendedTextInteraction\"],\r\n        _fullScoreMap: null,//由外部json传入初始化每道题型的满分值键值对\r\n        _userScoreMap: null,//有外部json传入初始化每道题的用户得分值键值对\r\n        _state: 'INCOMPLETE', //INCOMPLETE-未作答,FAILED-答题错误,PASSED-答题正确\r\n        _logger: _logger,\r\n        _titleExtras: null,//标题附加信息\r\n        _answerExtras: null,//题目后面的附加信息\r\n        _imageLoader: _imageLoader,\r\n        _mediaClass: \"_mediaMark\",// elearning播放器渲染audio标签class\r\n        _videoMinSize: {\r\n            height: 300,\r\n            width: 300\r\n        },\r\n        _audioMinSize: {\r\n            height: 200,\r\n            width: 200\r\n        },\r\n        _videoTagRegex: /<video(([\\s\\S])*?)<\\/video>/g,\r\n        _audioTagRegex: /<audio(([\\s\\S])*?)<\\/audio>/g,\r\n        _mediaSrcAttrRegex: /src=\"([^\"]*)\"/,\r\n        _posterAttrRegex: /poster=\"([^\"]*)\"/,\r\n        _heightAttrRegex: /height=\"([^\"]*)\"/,\r\n        _widthAttrRegex: /width=\"([^\"]*)\"/,\r\n        _modelRegex: /<(div|span) class=\"_qp-model\"[\\s\\S]*?><\\/(div|span)>/g,\r\n        _modelIdRegex: /data-model-id=\"([\\s\\S]*?)\"/,\r\n        _modelNumRegex: /_(\\d*?)-/,\r\n        _modelHtmlRegex: /<[\\s\\S]*class=\"_qp-model\"[\\s\\S]*?>([\\s\\S]*?)<\\/[\\s\\S]*>/g,\r\n        _modelLatexRegex: /<latex(?: class=\"math-tex\")?>([\\s\\S]*?)<\\/latex>/g,\r\n        _modelIsWYSIWYG: /<div style=([\"'])[^\"']*?position:absolute;overflow:hidden[^\"']*?\\1 questionType=\"(data|textentry|handwrite)\">/i,\r\n        create: function (assessmentItemModel, event, media) {\r\n            var instance = $.extend({}, this);\r\n            instance._event = event;\r\n            instance._score = 0;\r\n            instance._state = 'INCOMPLETE';\r\n            instance._answer = {};\r\n            instance._stat = {};\r\n            instance._titleExtras = {};\r\n            //初始化答案附件\r\n            instance._answerExtras = {};\r\n            //初始化满分值键值对\r\n            instance._fullScoreMap = {\r\n                totalFullScore: 0//每道题的满分总分\r\n            };\r\n            //初始化用户得分值键值对\r\n            instance._userScoreMap = {\r\n                totalUserScore: 0//用户获得的总分\r\n            };\r\n            instance._modelItem = {};\r\n            instance._itemModel = assessmentItemModel;\r\n            instance._media = media;\r\n            var model;\r\n            var modelNum = 0;\r\n            for (var modelId in instance._itemModel.modelMap) {\r\n                model = instance._itemModel.modelMap[modelId];\r\n                ++modelNum;\r\n                //初始化答案\r\n                instance._answer[modelId] = {\r\n                    state: 'INCOMPLETE',\r\n                    value: []\r\n                };\r\n                //初始化统计\r\n                instance._stat[modelId] = {};\r\n                //初始化标题附加信息\r\n                instance._titleExtras[modelId] = {};\r\n                //初始化题目后面的附加信息KeyMap\r\n                instance._answerExtras[modelId] = {};\r\n                //初始化每道题型的满分值\r\n                instance._fullScoreMap[modelId] = model.full_score || 0;\r\n                //初始化每道题的用户得分值\r\n                instance._userScoreMap[modelId] = model.user_score || 0;\r\n                //实例化modelItem\r\n                var modelItem = ModelItem.create(instance, model, event);\r\n                //保存到assessmentItem\r\n                instance._modelItem[modelItem._model.modelId] = modelItem;\r\n            }\r\n            if (modelNum > 1) {\r\n                instance._isComposite = true;\r\n            }\r\n            this._logger.debug(\"_assessmentTest:解析xml后得到的assessmentItem对象\");\r\n            this._logger.debug(instance);\r\n            return instance;\r\n        },\r\n        //获取得分\r\n        getScore: function () {\r\n            return this._score;\r\n        },\r\n        //设置分数\r\n        setScore: function (score) {\r\n            this._score = score;\r\n        },\r\n        //获取答案\r\n        getAnswer: function () {\r\n            return $.extend(true, {}, this._answer);\r\n        },\r\n        //获取模型\r\n        getItemModel: function () {\r\n            return $.extend(true, {}, this._itemModel);\r\n        },\r\n        //设置答案\r\n        setAnswer: function (answer) {\r\n            var result = true;\r\n            //构造空答案\r\n            var newAnswer = {};\r\n            for (var modelId in this._answer) {\r\n                newAnswer[modelId] = {\r\n                    state: 'INCOMPLETE',\r\n                    value: []\r\n                };\r\n            }\r\n            var modelAnswer;\r\n            var state;\r\n            for (var modelId in newAnswer) {\r\n                modelAnswer = answer[modelId];\r\n                if (modelAnswer && modelAnswer.value) {\r\n                    state = modelAnswer.state;\r\n                    if (!state) {\r\n                        state = '';\r\n                    }\r\n                    newAnswer[modelId].state = state;\r\n                    newAnswer[modelId].value.pushArray(modelAnswer.value);\r\n                }\r\n            }\r\n            this._answer = newAnswer;\r\n            //检测状态变化\r\n            this._checkAnswer();\r\n            return result;\r\n        },\r\n        //设置统计信息 {'RESPONSE_1-1': {'A': '5人','B': '10人'}};\r\n        setStat: function (stat) {\r\n            var result = true;\r\n            //构造空答案\r\n            var newStat = {};\r\n            for (var modelId in this._stat) {\r\n                newStat[modelId] = {};\r\n            }\r\n            for (var modelId in newStat) {\r\n                newStat[modelId] = stat[modelId];\r\n            }\r\n            this._stat = newStat;\r\n            return result;\r\n        },\r\n        //设置统计信息 {'Resopnse-1-1':{prefix:'',suffix:''}}\r\n        setTitleExtras: function (extras) {\r\n            var result = true;\r\n            //构造空答案\r\n            var titleExtras = {};\r\n            for (var modelId in this._titleExtras) {\r\n                titleExtras[modelId] = {};\r\n            }\r\n            titleExtras['composite'] = {};\r\n            for (var modelId in titleExtras) {\r\n                titleExtras[modelId] = extras[modelId];\r\n            }\r\n            this._titleExtras = titleExtras;\r\n            return result;\r\n        },\r\n        //支持拍照上传图片到指定小题后面设置数据方法\r\n        setExtrasAnswer: function ($view, extra, isAppended) {\r\n            var result = true;\r\n            var modelId = extra.modelId;\r\n            var extraHtml = extra.extraHtml;\r\n            for (var modelId in this._answerExtras) {\r\n                this._answerExtras[modelId] = extraHtml;\r\n            }\r\n            var appendView = $(extraHtml);\r\n            var appendToModelId = modelId;\r\n            var cleanModelId = modelId;\r\n\r\n            //清空原有的内容\r\n            if (!isAppended) {\r\n                this.cleanExtras($view, cleanModelId);\r\n            }\r\n\r\n            //渲染到小题后面\r\n            this.appendToExtras($view, appendView, appendToModelId);\r\n\r\n            return result;\r\n        },\r\n        //设置某道题的满分值\r\n        setFullScore: function (retrieveData) {\r\n            var modelId = retrieveData.modelId;\r\n            var fullScore = retrieveData.fullScore || 0;\r\n            if (this._fullScoreMap && this._fullScoreMap[modelId] !== undefined) {\r\n                this._fullScoreMap[modelId] = fullScore;\r\n                //重新计算总分值\r\n                this._calTotalScore();\r\n            }\r\n        },\r\n        //获取某道题的满分值\r\n        getFullScore: function (modelId) {\r\n            if (arguments.length == 0) {// 获取所有题目的满分值\r\n                //重新计算总分值\r\n                var totalScore = this._calTotalScore();\r\n                return totalScore.totalFullScore;\r\n            } else {// 获取某道题的满分值\r\n                if (this._fullScoreMap && this._fullScoreMap[modelId] !== undefined) {\r\n                    return this._fullScoreMap[modelId];\r\n                }\r\n            }\r\n        },\r\n        //设置某道题的用户得分值\r\n        setUserScore: function (retrieveData) {\r\n            var modelId = retrieveData.modelId;\r\n            var userScore = retrieveData.userScore || 0;\r\n            if (this._userScoreMap && this._userScoreMap[modelId] !== undefined) {\r\n                this._userScoreMap[modelId] = userScore;\r\n                //重新计算总分值\r\n                this._calTotalScore();\r\n            }\r\n        },\r\n        //获取某道题的用户得分值\r\n        getUserScore: function (modelId) {\r\n            if (arguments.length == 1) {// 获取用户某道题的得分\r\n                if (this._userScoreMap && this._userScoreMap[modelId] !== undefined) {\r\n                    return this._userScoreMap[modelId];\r\n                }\r\n            } else {// 获取用户所有题目的总分\r\n                //重新计算总分值\r\n                this._calTotalScore();\r\n                return this._userScoreMap.totalUserScore;\r\n            }\r\n        },\r\n        //计算qtiPlayer实例 用户获得的总分 以及 所有题目的满分值\r\n        _calTotalScore: function () {\r\n            var totalUserScore = 0;\r\n            var totalFullScore = 0;\r\n            for (var modelId in this._itemModel.modelMap) {\r\n                var model = this._itemModel.modelMap[modelId];\r\n                totalUserScore += parseFloat(model.user_score);\r\n                totalFullScore += parseFloat(model.full_score);\r\n            }\r\n            return {\r\n                totalUserScore: totalUserScore,\r\n                totalFullScore: totalFullScore\r\n            };\r\n        },\r\n        //获取js版结果模型\r\n        getAnswerState: function () {\r\n            var that = this;\r\n            var result = {\r\n                completionStatus: that._state,\r\n                score: that._score,\r\n                duration: 0,\r\n                numAttempts: 0,\r\n                responseVariable: []\r\n            };\r\n            var correctAnswer;\r\n            var currentAnswer;\r\n            var responseVariable;\r\n            for (var modelId in that._answer) {\r\n                correctAnswer = that._itemModel.correctAnswer[modelId];\r\n                if (correctAnswer) {\r\n                    currentAnswer = that._answer[modelId];\r\n                    responseVariable = {\r\n                        baseType: correctAnswer.baseType,\r\n                        cardinality: correctAnswer.cardinality,\r\n                        identifier: correctAnswer.identifier,\r\n                        state: currentAnswer.state,\r\n                        correctResponse: [],\r\n                        candidateResponse: []\r\n                    };\r\n                    $(correctAnswer.value).each(function (i, v) {\r\n                        responseVariable.correctResponse.push(v);\r\n                    });\r\n                    $(currentAnswer.value).each(function (i, v) {\r\n                        responseVariable.candidateResponse.push(v);\r\n                    });\r\n                    result.responseVariable.push(responseVariable);\r\n                } else {// 模型里无correctAnswer\r\n                    if (result.completionStatus !== \"INCOMPLETE\") {\r\n                        result.completionStatus = \"FAILED\";\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        setAnswerState: function (answerState) {\r\n            var result = false;\r\n            var newAnswer = {};\r\n            var responseVariable = answerState.responseVariable;\r\n            if (responseVariable) {\r\n                var answer;\r\n                var currentAnswer;\r\n                for (var index = 0; index < responseVariable.length; index++) {\r\n                    currentAnswer = responseVariable[index];\r\n                    answer = {\r\n                        state: currentAnswer.state,\r\n                        value: currentAnswer.candidateResponse\r\n                    };\r\n                    newAnswer[currentAnswer.identifier] = answer;\r\n                }\r\n                //保存答案\r\n                result = this.setAnswer(newAnswer);\r\n            }\r\n            return result;\r\n        },\r\n        //qti标准\r\n        getState: function () {\r\n            var that = this;\r\n            var state = ''\r\n                + '<assessmentResult xmlns=\"http://edu.nd.com.cn/xsd/assessmentResult\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://edu.nd.com.cn/xsd/assessmentResult http://nd-schema.dev.web.nd/xsd/assessmentResult.xsd\">'\r\n                + '    <itemResult>'\r\n                + '        <outcomeVariable identifier=\"completionStatus\">'\r\n                + '            <value>' + that._state + '</value>'\r\n                + '        </outcomeVariable>'\r\n                + '        <outcomeVariable identifier=\"SCORE\">'\r\n                + '            <value>' + that._score + '</value>'\r\n                + '        </outcomeVariable>'\r\n                + '        <responseVariable identifier=\"duration\">'\r\n                + '            <candidateResponse><value>0</value></candidateResponse>'\r\n                + '        </responseVariable>'\r\n                + '        <responseVariable identifier=\"numAttempts\">'\r\n                + '            <candidateResponse><value>0</value></candidateResponse>'\r\n                + '        </responseVariable>';\r\n            var correctAnswer;\r\n            var currentAnswer;\r\n            for (var modelId in that._answer) {\r\n                correctAnswer = that._itemModel.correctAnswer[modelId];\r\n                if (correctAnswer) {\r\n                    currentAnswer = that._answer[modelId];\r\n                    state += '<responseVariable baseType=\"' + correctAnswer.baseType\r\n                        + '\" cardinality=\"' + correctAnswer.cardinality\r\n                        + '\" identifier=\"' + correctAnswer.identifier\r\n                        + '\" state=\"' + currentAnswer.state\r\n                        + '\">'\r\n                        + '<correctResponse>';\r\n                    $(correctAnswer.value).each(function (i, v) {\r\n                        v = _utils.xmlEncode(v);\r\n                        state += '<value>' + v + '</value>';\r\n                    });\r\n                    state += '</correctResponse>'\r\n                        + '<candidateResponse>';\r\n                    $(currentAnswer.value).each(function (i, v) {\r\n                        v = _utils.xmlEncode(v);\r\n                        state += '<value>' + v + '</value>';\r\n                    });\r\n                    state += '</candidateResponse>'\r\n                        + '</responseVariable>';\r\n                }\r\n            }\r\n            state += '</itemResult>'\r\n                + '</assessmentResult>';\r\n            return state;\r\n        },\r\n        //qti标准\r\n        _stateParser: {\r\n            responseVariableRegex: /<responseVariable[^/]*?>[\\s\\S]*?<\\/responseVariable>/g,\r\n            identifierRegex: /identifier=\"([\\s\\S]*?)\"/,\r\n            baseTypeRegex: /baseType=\"([\\s\\S]*?)\"/,\r\n            cardinalityRegex: /cardinality=\"([\\s\\S]*?)\"/,\r\n            stateRegex: /state=\"([\\s\\S]*?)\"/,\r\n            candidateResponseRegex: /<candidateResponse[^/]*?>([\\s\\S]*?)<\\/candidateResponse>/,\r\n            valueRegex: /<value>([\\s\\S]*?)<\\/value>/g\r\n        },\r\n        setState: function (state) {\r\n            var result = true;\r\n            var that = this;\r\n            var responseVariableArray = state.match(that._stateParser.responseVariableRegex);\r\n            var responseVariable;\r\n            var baseType;\r\n            var cardinality;\r\n            var identifier;\r\n            var candidateResponse;\r\n            var state;\r\n            var newAnswer = {};\r\n            var modelAnawer;\r\n            var value;\r\n            for (var index = 0; index < responseVariableArray.length; index++) {\r\n                responseVariable = responseVariableArray[index];\r\n                baseType = _utils.getValue(responseVariable, that._stateParser.baseTypeRegex);\r\n                cardinality = _utils.getValue(responseVariable, that._stateParser.cardinalityRegex);\r\n                identifier = _utils.getValue(responseVariable, that._stateParser.identifierRegex);\r\n                if (baseType !== '' && cardinality !== '' && identifier !== '') {\r\n                    state = _utils.getValue(responseVariable, that._stateParser.stateRegex);\r\n                    modelAnawer = {\r\n                        state: state,\r\n                        value: []\r\n                    };\r\n                    //该标签存储了题目信息\r\n                    candidateResponse = _utils.getValue(responseVariable, that._stateParser.candidateResponseRegex);\r\n                    if (candidateResponse !== '') {\r\n                        candidateResponse.replace(that._stateParser.valueRegex, function ($0, $1) {\r\n                            value = _utils.xmlDecode($1);\r\n                            modelAnawer.value.push(value);\r\n                            return $0;\r\n                        });\r\n                    }\r\n                    newAnswer[identifier] = modelAnawer;\r\n                }\r\n            }\r\n            //保存答案\r\n            result = this.setAnswer(newAnswer);\r\n            return result;\r\n        },\r\n        _checkAnswerValue: function (valueType, correctValue, currentValue) {\r\n            //答案比对时，去除latex标签\r\n            correctValue = correctValue.replace(this._modelLatexRegex, function ($1, $2) {\r\n                return $2;\r\n            });\r\n            var result = false;\r\n            if (valueType === 'multipleString') {\r\n                //这一项可以有多个答案\r\n                var valueArray = correctValue.split('|');\r\n                for (var index = 0; index < valueArray.length; index++) {\r\n                    if (valueArray[index].trim() == currentValue) {\r\n                        result = true;\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                //这一项只有一个答案\r\n                if (correctValue == currentValue) {\r\n                    result = true;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        _checkTextAnswerValue: function (modelId, correctValue, currentValue) {\r\n            //检查填空是否正确\r\n            var correctAnswer = this._itemModel.correctAnswer[modelId];\r\n            if (correctAnswer.value.length > 0) {\r\n                return this._checkAnswerValue(correctAnswer.baseType, correctValue, currentValue);\r\n            }\r\n            return false;\r\n        },\r\n        _checkModelAnswer: function (modelId, reset) {\r\n            //触发该方法，说明用户有操作过该题目\r\n            var correctAnswer = this._itemModel.correctAnswer[modelId];\r\n            var currentAnswer = this._answer[modelId];\r\n\r\n            //重置答案\r\n            if (reset) {\r\n                currentAnswer.state = 'INCOMPLETE';\r\n                this._score = 0;\r\n                this._state = 'INCOMPLETE';\r\n            } else if (correctAnswer && correctAnswer.value.length > 0) {\r\n                //有正确答案\r\n                if (currentAnswer.value.length > 0) {\r\n                    //有正确答案,有用户答案\r\n                    var modelResult = true;\r\n                    if (currentAnswer.value.length !== correctAnswer.value.length) {\r\n                        //用户答案的长度和正确答案的长度不一致，答题错误\r\n                        modelResult = false;\r\n                    } else {\r\n                        if (correctAnswer.cardinality === 'single') {\r\n                            //只有一个答案项\r\n                            modelResult = this._checkAnswerValue(correctAnswer.baseType, correctAnswer.value[0], currentAnswer.value[0]);\r\n                        } else {\r\n                            //多个答案项\r\n                            if (correctAnswer.cardinality === 'ordered') {\r\n                                //顺序必须一致\r\n                                for (var cIndex = 0; cIndex < correctAnswer.value.length; cIndex++) {\r\n                                    modelResult = this._checkAnswerValue(correctAnswer.baseType, correctAnswer.value[cIndex], currentAnswer.value[cIndex]);\r\n                                    if (modelResult === false) {\r\n                                        //该位置上正确答案和用户答案不一致，答题错误\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                //顺序可以不一致\r\n                                var tempAnswer = [];\r\n                                tempAnswer.pushArray(currentAnswer.value);\r\n                                //继续判断答案，部分题型答案的顺序会和正确答案不一致，但是内容一致\r\n                                var currentResult;\r\n                                for (var cIndex = 0; cIndex < correctAnswer.value.length; cIndex++) {\r\n                                    currentResult = false;\r\n                                    var errorCount = 0;\r\n                                    while (errorCount < tempAnswer.length) {\r\n                                        var temp = tempAnswer.shift();\r\n                                        currentResult = this._checkAnswerValue(correctAnswer.baseType, correctAnswer.value[cIndex], temp);\r\n                                        if (currentResult) {\r\n                                            break;\r\n                                        } else {\r\n                                            tempAnswer.push(temp);\r\n                                            errorCount++;\r\n                                        }\r\n                                    }\r\n                                    if (currentResult === false) {\r\n                                        //该正确答案在用户答案中不存在，答题错误\r\n                                        modelResult = false;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (modelResult) {\r\n                        //该小题答题正确\r\n                        currentAnswer.state = 'PASSED';\r\n                        //触发检测复合题答题是否正确\r\n                        this._checkAnswer();\r\n                    } else {\r\n                        //该小题答题错误\r\n                        currentAnswer.state = 'FAILED';\r\n                        this._score = 0;\r\n                        this._state = 'FAILED';\r\n                    }\r\n                } else {\r\n                    //有正确答案,但是没有用户答案,该小题答题错误，复合题答题错误\r\n                    currentAnswer.state = 'FAILED';\r\n                    this._score = 0;\r\n                    this._state = 'FAILED';\r\n                }\r\n            } else {\r\n                //没正确答案,该小题答题正确\r\n                currentAnswer.state = 'FAILED';\r\n                //触发检测复合题答题是否正确\r\n                this._checkAnswer();\r\n            }\r\n        },\r\n        _checkAnswer: function () {\r\n            var currentAnswer;\r\n            var isCorrect = true;\r\n            var isIncomplete = true;\r\n            for (var modelId in this._answer) {\r\n                currentAnswer = this._answer[modelId];\r\n                //如果没有小题state值(旧版结果模型没有),则重新计算小题状态值\r\n                if (currentAnswer.state === '') {\r\n                    this._checkModelAnswer(modelId);\r\n                }\r\n                if (currentAnswer.state !== 'PASSED') {\r\n                    isCorrect = false;\r\n                }\r\n                if (currentAnswer.state !== 'INCOMPLETE') {\r\n                    isIncomplete = false;\r\n                }\r\n            }\r\n            if (isCorrect) {\r\n                //答案全部正确\r\n                this._score = 1;\r\n                this._state = 'PASSED';\r\n            } else {\r\n                if (isIncomplete) {\r\n                    //答案全部未作答\r\n                    this._score = 0;\r\n                    this._state = 'INCOMPLETE';\r\n                } else {\r\n                    this._score = 0;\r\n                    this._state = 'FAILED';\r\n                }\r\n            }\r\n        },\r\n        _getTitleExtras: function (modelId) {\r\n            return this._titleExtras[modelId] || {};\r\n        },\r\n        _getCompositeTitleExtras: function () {\r\n            return this._titleExtras['composite'] || {};\r\n        },\r\n        createHintHtml: function (modelId, option) {\r\n            var that = this;\r\n            var hintHtml = '';\r\n            var hintFeedback = that._itemModel.hintFeedback[modelId];\r\n            if (hintFeedback && hintFeedback.showHide === 'show' && hintFeedback.content !== '') {\r\n                var tipTxt = _utils.getLangText('prompt', option);\r\n                var confirm = _utils.getLangText('confirm', option);\r\n//                var confirmHtml = '<div class=\"qp-pop-btn-box\">'\r\n//                        + '    <a href=\"javascript:void(0)\" class=\"qp-pop-btn\">' + confirm + '</a>'\r\n//                        + '</div>';\r\n\r\n//                hintHtml = ''\r\n//                        + '<div class=\"qp-question-hint\">'\r\n//                        + '    <a  href=\"javascript:void(0)\" class=\"qp-question-hint-tip-enter\" data-model-id=\"' + modelId + '\">'\r\n//                        + '      <span class=\"qp-question-hint-tip-enter-icon\"></span><span class=\"qp-question-hint-tip-enter-text\">' + tipTxt + '</span>'\r\n//                        + '   </a>'\r\n//                        + '   <div class=\"qp-question-hint-background\"></div>'\r\n//                        + '   <div class=\"qp-question-hint-tip-wrapper\">'\r\n//                        + '   <div class=\"qp-question-hint-tip\" data-model-id=\"' + modelId + '\">'\r\n//                        + '       <div class=\"qp-question-hint-tip-ts\">' + tipTxt + '</div>'\r\n//                        + '       <div class=\"qp-question-hint-tip-close\"></div>'\r\n//                        + '       <div class=\"qp-question-hint-tip-text\">'\r\n//                        + hintFeedback.content\r\n//                        + '       </div>'\r\n//                        + confirmHtml\r\n//                        + '   </div>'\r\n//                        + '   </div>'\r\n//                        + '</div>';\r\n                hintHtml = ''\r\n                    + '<div class=\"nqti-com-pop-content nqti-hide-dom _hint-pop-content\" data-model-id=\"' + modelId + '\">'\r\n                    + '    <div class=\"nqti-com-pop-box com-pop-hint-box _hint-pop-content-box\">'\r\n                    + '        <p class=\"nqti-com-pop-hd\">'\r\n                    + '            <span class=\"nqti-pop-dec nqti-dec-1\"></span>'\r\n                    + '            <span class=\"nqti-pop-dec nqti-dec-2\"></span>'\r\n                    + '        </p>'\r\n                    + '        <div class=\"nqti-com-pop-bd nqti-scrollbar-style-gray _hint-pop-bd\">'\r\n                    + '            <div class=\"nqti-com-remind-text\">'\r\n                    + '                <span class=\"nqti-text-size\">' + hintFeedback.content + '</span>'\r\n                    + '            </div>'\r\n                    + '        </div>'\r\n                    + '        <div class=\"nqti-com-pop-bt\">'\r\n                    + '            <a class=\"nqti-hint-btn _hint-confirm-btn\" href=\"javascript:;\">'\r\n                    + '                <span class=\"nqti-tip-icon-text\">' + confirm + '</span>'\r\n                    + '            </a>'\r\n                    + '        </div>'\r\n                    + '    </div>'\r\n                    + '</div>'\r\n                    + '<a class=\"nqti-hint-btn _hint-pop-btn \" href=\"javascript:;\" data-model-id=\"' + modelId + '\">'\r\n                    + '    <span class=\"nqti-tip-icon\"></span>'\r\n                    + '    <span class=\"nqti-tip-icon-text\">' + tipTxt + '</span>'\r\n                    + '</a>';\r\n            }\r\n            return hintHtml;\r\n        },\r\n        hintEventHandle: function ($view) {\r\n            //提示按钮\r\n            var $hintEnter = $view.find('._hint-pop-btn');\r\n            //提示弹出框\r\n            var $hintTipWrapper = $view.find('._hint-pop-content');\r\n            if ($hintEnter && $hintEnter.length > 0 && $hintTipWrapper && $hintTipWrapper.length > 0) {\r\n                var $hintText = $view.find('._hint-pop-bd');\r\n                var $hintCloseBtn = $view.find('._hint-confirm-btn');\r\n                //阻止提示框的滚动事件冒泡\r\n                if ($hintTipWrapper.qpStopMouseWheel) {\r\n                    $hintTipWrapper.qpStopMouseWheel();\r\n                }\r\n                //实现滚动条滚动事件\r\n                $hintText.bind('qpMouseWheel', function (event) {\r\n                    var dy = event.deltaY * 1.5;\r\n                    event.currentTarget.scrollTop = event.currentTarget.scrollTop + dy;\r\n                });\r\n                //关闭提示窗口方法\r\n                var closeHintTip = function () {\r\n                    //隐藏遮罩和提示内容\r\n                    $hintTipWrapper.addClass('nqti-hide-dom');\r\n                };\r\n                //提示按钮点击事件\r\n                $hintEnter.bind('qpTap', function () {\r\n                    //显示遮罩和提示内容\r\n                    $hintTipWrapper.removeClass('nqti-hide-dom');\r\n                    //重置提示高度，最高不超过window高度-150\r\n                    var tipHeight = parseInt($hintText.css('maxHeight'));\r\n                    var tipWinHeight = parseInt($hintTipWrapper.height());\r\n                    var windowHeight = $(window).height();\r\n                    if (!isNaN(windowHeight) && windowHeight > 0 && windowHeight - tipWinHeight < 80) {\r\n                        if (!isNaN(tipHeight)) {\r\n                            if (windowHeight - tipWinHeight < 0) {\r\n                                $hintText.css('maxHeight', Math.abs(tipHeight - 80 + (windowHeight - tipWinHeight)) + 'px');\r\n                            } else {\r\n                                $hintText.css('maxHeight', Math.abs(tipHeight - 80) + 'px');\r\n                            }\r\n                        }\r\n                    }\r\n                    $hintTipWrapper.css('height', ($hintTipWrapper.height() + 1) + 'px');\r\n                });\r\n                //提示框上下空白背景点击事件\r\n//                $hintBackground.bind('qpTap', closeHintTip);\r\n//                $hintTip.bind('qpTap', function () {\r\n//                    //为了向上传递事件触发对象\r\n//                });\r\n                //提示框左右空白背景点击事件\r\n                $hintTipWrapper.bind('qpTap', function (e) {\r\n                    var $target = $(e.target);\r\n                    var $tip = $target.closest('._hint-pop-content-box');\r\n                    if ($tip.length === 0) {\r\n                        closeHintTip();\r\n                    }\r\n                });\r\n                //关闭按钮事件\r\n                $hintCloseBtn.bind('qpTap', closeHintTip);\r\n            }\r\n        },\r\n        _setExtrasTitleHtml: function (titleHtml, titleExtras, modelName, option) {\r\n            var prefix = '<span class=\"_qti-title-prefix\">';\r\n            //if (option.showTitleExtras) {\r\n            if (typeof titleExtras.prefix != typeof undefined && titleExtras.prefix.length > 0) {\r\n                prefix += titleExtras.prefix;\r\n            }\r\n            //}\r\n            if (option.showQuestionName) {\r\n                prefix += ' <span class=\"_qti-title-prefix-qtype\">(' + modelName + ')</span>';\r\n            }\r\n            prefix += '</span>';\r\n\r\n            var suffix = '';\r\n            //if (option.showTitleExtras) {\r\n            if (typeof titleExtras.suffix != typeof undefined && titleExtras.suffix.length > 0) {\r\n                suffix = '<span class=\"_qti-title-suffix\">' + titleExtras.suffix + '</span>';\r\n            }\r\n            //}\r\n\r\n\r\n            titleHtml = titleHtml.trim();\r\n            if (prefix !== '') {\r\n                if (/^(<(div|p)(.*?)>(\\s*?))+/.test(titleHtml)) {\r\n                    titleHtml = titleHtml.replace(/^(<(div|p)(.*?)>(\\s*?))+/, function ($0) {\r\n                        return $0 + prefix;\r\n                    });\r\n                } else {\r\n                    titleHtml = prefix + titleHtml;\r\n                }\r\n            }\r\n            if (suffix !== '') {\r\n                if (/(<\\/(div|p)[^<>]*?>(\\s*?))+$/.test(titleHtml)) {\r\n                    titleHtml = titleHtml.replace(/(<\\/(div|p)[^<>]*?>(\\s*?))+$/, function ($0) {\r\n                        return suffix + $0;\r\n                    });\r\n                } else {\r\n                    titleHtml = titleHtml + suffix;\r\n                }\r\n            }\r\n            return titleHtml;\r\n        },\r\n        createExtrasHtml: function (modelItem, modelId, extrasOption) {\r\n            var that = this;\r\n            var html = '';\r\n            //var hintFeedback = that._itemModel.hintFeedback[modelId];\r\n            //var answerFeedback = that._itemModel.answerFeedback[modelId];\r\n            var hintFeedbackContent = that._itemModel.hintFeedback[modelId] ? that._itemModel.hintFeedback[modelId].content : '';\r\n            var answerFeedbackContent = that._itemModel.answerFeedback[modelId] ? that._itemModel.answerFeedback[modelId].content : '';\r\n            var userAnswerHtml = '';\r\n            var correctAnswerHtml = '';\r\n            if (modelItem.getModel().modelType === 'choiceInteraction') {\r\n                userAnswerHtml = modelItem.getAnswer().join('');\r\n                correctAnswerHtml = modelItem.getCorrectAnswer().join('');\r\n            } else {\r\n                userAnswerHtml = modelItem.getAnswer().join(',');\r\n                correctAnswerHtml = modelItem.getCorrectAnswer().join(',');\r\n            }\r\n            var ar = [];\r\n            ar.push('<div class=\"nqti-module-extras-default\">');\r\n            if (extrasOption.showUserAnswer || extrasOption.showCorrectAnswer) {\r\n                var extrasUserAnswer = _utils.getLangText('extras_user_answer', this._option);\r\n                var extrasCorrectAnswer = _utils.getLangText('extras_correct_answer', this._option);\r\n                ar.push('    <div class=\"nqti-extras-answer\"> ');\r\n                if (extrasOption.showUserAnswer) {\r\n                    var checked = this._answer[modelId].state === 'PASSED' ? 'nqti-correct' : 'nqti-wrong';\r\n                    ar.push('        <span class=\"nqti-answer-user ' + checked + '\">【' + extrasUserAnswer + '】' + userAnswerHtml + '</span> ');\r\n                }\r\n                if (extrasOption.showCorrectAnswer) {\r\n                    ar.push('        <span class=\"nqti-answer-correct\">【' + extrasCorrectAnswer + '】' + correctAnswerHtml + '</span>  ');\r\n                }\r\n                ar.push('    </div> ');\r\n            }\r\n            if (extrasOption.showHint) {\r\n                ar.push('    <div class=\"nqti-extras-hint\">  ');\r\n                ar.push('        <span>【' + _utils.getLangText('prompt', this._option) + '】</span> ');\r\n                ar.push('        <span>' + hintFeedbackContent + '</span>');\r\n                ar.push('    </div>');\r\n            }\r\n            if (extrasOption.showAnalyse) {\r\n                ar.push('    <div class=\"nqti-extras-analyse\">');\r\n                ar.push('        <span>【' + _utils.getLangText('analyse', this._option) + '】</span>');\r\n                ar.push('        <span>' + answerFeedbackContent + '</span>');\r\n                ar.push('    </div>');\r\n            }\r\n            ar.push('</div>');\r\n\r\n            html = ar.join('');\r\n            return html;\r\n        },\r\n        _parseHtml: function (html, option, $view) {\r\n            var that = this;\r\n            var isSupport = false;\r\n            var result = html.replace(that._modelRegex, function (modelHtml) {\r\n                var modelResult = '';\r\n                var modelId = _utils.getValue(modelHtml, that._modelIdRegex);\r\n                //没有指定渲染参数,或则渲染参数中包含该小题的modelId\r\n                if (option.modelId.length === 0 || option.modelId.indexOf(modelId) > -1) {\r\n                    //渲染该小题\r\n                    var modelItem = that._modelItem[modelId];\r\n                    var modelType = modelItem.getModel().modelType;\r\n                    if (modelItem.init) {\r\n                        modelItem.init(option);\r\n                    }\r\n\r\n                    // qtiPlayer是否做了该题型的兼容\r\n                    isSupport = that._supportType.indexOf(modelType) !== -1;\r\n\r\n                    var numHtml = '';// 题号\r\n                    var answerHtml = '';// 答案\r\n                    var titleHtml = '';// 标题\r\n                    var hintHtml = '';// 提示\r\n                    var extrasHtml = '';\r\n\r\n                    // 是否渲染题号（这个是渲染单题型 和 复合题小题的 题号）\r\n                    if (option.showNum && modelItem.hasNum()) {\r\n                        var num;\r\n                        if (option.isElearningSkin) {\r\n                            //elearning皮肤需要对复合题大标题设置序号，所以导致单题型也需要对此做兼容处理\r\n                            if (that._sequenceNumber === null) {// 原始的处理方式\r\n                                num = \"null\";\r\n                            } else {\r\n                                if (!that._isComposite) {// 非复合题\r\n                                    num = that._sequenceNumber;\r\n                                } else {\r\n                                    num = _utils.getValue(modelId, that._modelNumRegex);\r\n                                }\r\n                            }\r\n                        } else {\r\n                            // 互动课堂保持原有的处理逻辑\r\n                            num = _utils.getValue(modelId, that._modelNumRegex);\r\n                        }\r\n                        numHtml = '<div class=\"nqti-module-listnum\">'\r\n                            + '<em class=\"nqti-listnum-text\">' + num + '</em>'\r\n                            + '<span class=\"nqti-listnum-dot\">、</span>'\r\n                            + '</div>';\r\n                    }\r\n                    //是否渲染标题\r\n                    if (option.showTitleArea && modelItem.hasTitle()) {\r\n                        titleHtml = modelItem.createTitleHtml(option);\r\n                        if (titleHtml.trim() === '') {\r\n                            titleHtml = '无题目信息';\r\n                        }\r\n                        //渲染附加内容\r\n                        if (modelType !== 'textEntryInteraction') {\r\n                            titleHtml = that._setExtrasTitleHtml(titleHtml, modelItem.getTitleExtras(), modelItem.getName(), option);\r\n                        }\r\n                        titleHtml = '<div class=\"nqti-module-title\">'\r\n                            + '<em class=\"nqti-title-text\">' + titleHtml + '</em>'\r\n                            + '</div>';\r\n                    }\r\n\r\n                    if (isSupport) {\r\n                        //是否渲染答案\r\n                        if (option.hideAnswerArea === false || modelItem.isBlock() === false) {\r\n                            var tag = 'div';\r\n                            if (modelItem.isBlock() === false) {\r\n                                tag = 'span';\r\n                            }\r\n                            answerHtml = modelItem.createAnswerHtml(option);\r\n                            answerHtml = '<' + tag + ' class=\"nqti-module-content\">'\r\n                                + answerHtml\r\n                                + '</' + tag + '>';\r\n                        }\r\n                        //是否渲染提示\r\n                        if (modelItem.hasHint()) {\r\n                            hintHtml = that.createHintHtml(modelId, option);\r\n                            hintHtml = '<div class=\"nqti-hint-box ' + (option.showHint ? '' : 'nqti-hide-dom') + '\">'\r\n                                + hintHtml\r\n                                + '</div>';\r\n                        }\r\n                        if (modelType !== 'textEntryInteraction') {\r\n                            extrasHtml = '<div class=\"nqti-module-extras _qti-module-extras\"></div>';\r\n                        }\r\n                    }\r\n\r\n                    //组合片段\r\n                    var centerHtml;\r\n                    if (titleHtml === '') {\r\n                        if (!isSupport) {\r\n                            titleHtml = '该题没有题目信息';\r\n                            centerHtml = titleHtml + answerHtml + hintHtml;\r\n                        } else {\r\n                            centerHtml = answerHtml + hintHtml;\r\n                        }\r\n                    } else {\r\n                        centerHtml = titleHtml + hintHtml + answerHtml;\r\n                    }\r\n\r\n                    centerHtml = centerHtml + extrasHtml;\r\n\r\n                    centerHtml += isSupport ? \"\" : \"<p style='color: #e02222;font-size: 18px;margin-top: 5px;text-align: left'>当前qtiPlayer不支持该题型</p>\";\r\n\r\n                    if (modelItem.hasNum()) {\r\n                        //该题支持小题编号\r\n                        modelResult += numHtml + centerHtml;\r\n                    } else {\r\n                        modelResult += centerHtml;\r\n                    }\r\n                    //解析内嵌题\r\n                    modelResult = that._parseHtml(modelResult, option);\r\n                    var modelHtmlArr = modelHtml.split('><');\r\n                    modelResult = modelHtmlArr[0] + '>' + modelResult + '<' + modelHtmlArr[1];\r\n                }\r\n                return modelResult;\r\n            });\r\n\r\n            // 表明使用elearning媒体播放器\r\n            if (option.swfHost && window.Video) {\r\n                // 兼容elearing播放器替换video标签为div进行渲染\r\n                result = result.replace(that._videoTagRegex, function (word) {\r\n                    var videoSrc = word.match(that._mediaSrcAttrRegex);\r\n                    var videoHeight = word.match(that._heightAttrRegex);\r\n                    var videoWidth = word.match(that._widthAttrRegex);\r\n                    var videoPoster = word.match(that._posterAttrRegex);\r\n\r\n                    // 检测video src属性\r\n                    if (videoSrc) {\r\n                        videoSrc = videoSrc[1];\r\n                        if (videoSrc === '') {\r\n                            console.log('没有指定视频来源...');\r\n                            //throw new Error('没有指定视频来源...');\r\n                        }\r\n                    } else {\r\n                        videoSrc = '';\r\n                        console.log('没有指定视频来源...');\r\n                        //throw new Error('没有指定视频来源...');\r\n                    }\r\n\r\n                    // 检测video poster属性\r\n                    if (videoPoster) {\r\n                        videoPoster = videoPoster[1];\r\n                    } else {\r\n                        videoPoster = '';\r\n                    }\r\n\r\n                    // 检测video height属性\r\n                    if (videoHeight) {\r\n                        videoHeight = parseFloat(videoHeight[1]);\r\n                        if (isNaN(videoHeight)) {\r\n                            videoHeight = that._videoMinSize.height;\r\n                        }\r\n                    } else {\r\n                        videoHeight = that._videoMinSize.height;\r\n                    }\r\n                    if (videoHeight < that._videoMinSize.height) {\r\n                        videoHeight = that._videoMinSize.height;\r\n                    }\r\n\r\n                    // 检测video width属性\r\n                    if (videoWidth) {\r\n                        videoWidth = parseFloat(videoWidth[1]);\r\n                        if (isNaN(videoWidth)) {\r\n                            videoWidth = that._videoMinSize.width;\r\n                        }\r\n                    } else {\r\n                        videoWidth = that._videoMinSize.width;\r\n                    }\r\n                    if (videoWidth < that._videoMinSize.width) {\r\n                        videoWidth = that._videoMinSize.width;\r\n                    }\r\n\r\n                    return '<div poster_src=\"' + videoPoster + '\" style=\"margin-bottom:5px;width:' + videoWidth + 'px;height:' + videoHeight + 'px;\" media_src=\"' + videoSrc + '\" class=\"' + that._mediaClass + '\"></div>';\r\n                });\r\n\r\n\r\n                // 兼容elearning播放器替换audio标签为div进行渲染\r\n                result = result.replace(that._audioTagRegex, function (word) {\r\n                    var audioSrc = word.match(that._mediaSrcAttrRegex);\r\n                    var audioHeight = word.match(that._heightAttrRegex);\r\n                    var audioWidth = word.match(that._widthAttrRegex);\r\n                    var audioPoster = word.match(that._posterAttrRegex);\r\n\r\n                    // 检测audio src属性\r\n                    if (audioSrc) {\r\n                        audioSrc = audioSrc[1];\r\n                        if (audioSrc === '') {\r\n                            console.log('没有指定音频来源...');\r\n                        }\r\n                    } else {\r\n                        // audio没有配置音频来源信息\r\n                        audioSrc = '';\r\n                        console.log('没有指定音频来源...');\r\n                        //throw new Error('没有指定音频来源...');\r\n                    }\r\n\r\n                    // 检测audio poster属性\r\n                    if (audioPoster) {\r\n                        audioPoster = audioPoster[1];\r\n                    } else {\r\n                        audioPoster = '';\r\n                    }\r\n\r\n                    // 检测audio height属性\r\n                    if (audioHeight) {\r\n                        // 获取正则表达式的子表达式匹配文本信息\r\n                        audioHeight = parseFloat(audioHeight[1]);\r\n                        if (isNaN(audioHeight)) {\r\n                            audioHeight = that._audioMinSize.height;\r\n                        }\r\n                    } else {\r\n                        audioHeight = that._audioMinSize.height;\r\n                    }\r\n                    if (audioHeight < that._audioMinSize.height) {\r\n                        audioHeight = that._audioMinSize.height;\r\n                    }\r\n\r\n                    // 检测audio width属性\r\n                    if (audioWidth) {\r\n                        audioWidth = parseFloat(audioWidth[1]);\r\n                        if (isNaN(audioWidth)) {\r\n                            audioWidth = that._audioMinSize.width;\r\n                        }\r\n                    } else {// json串无配置height属性,使用qtiPlayer的默认值\r\n                        audioWidth = that._audioMinSize.width;\r\n                    }\r\n                    if (audioWidth < that._audioMinSize.width) {\r\n                        audioWidth = that._audioMinSize.width;\r\n                    }\r\n\r\n                    return '<div poster_src=\"' + audioPoster + '\" style=\"margin-bottom:5px;width:' + audioWidth + 'px;height:' + audioHeight + 'px;\" media_src=\"' + audioSrc + '\" class=\"' + that._mediaClass + '\"></div>';\r\n                });\r\n            }\r\n\r\n            return result;\r\n        },\r\n        _parseCompositeHtml: function (html, option) {\r\n            var HTML = {\r\n                compositeTitle: '<div class=\"nqti-composite-title _qti-composite-title\">            ' +\r\n                '    <div class=\"nqti-composite-title-content _qti-composite-title-content\">' +\r\n                '       <div class=\"nqti-composite-title-inside _qti-composite-title-inside\">' +\r\n                '            ${title}    ' +\r\n                '       </div>                                    ' +\r\n                '    </div>                                    ' +\r\n                '    <div class=\"nqti-composite-title-bar\">    ' +\r\n                '        <div class=\"nqti-bar _qti-composite-bar\">                ' +\r\n                '            <div class=\"nqti-icon nqti-up\"></div>     ' +\r\n                '        </div>                                ' +\r\n                '        <div class=\"nqti-line\" ></div>        ' +\r\n                '    </div>                                    ' +\r\n                '</div>                                        ',\r\n                compositeBody: ' <div class=\"nqti-composite-body _qti-composite-body\">'\r\n            };\r\n            var regex = /^([\\w\\W]*?)<div class=\"_qp-model/;\r\n            var title = '';\r\n            var titleResult = regex.exec(html);\r\n            if (titleResult && titleResult.length > 1) {\r\n                title = titleResult[1];\r\n            }\r\n            title = this._setExtrasTitleHtml(title, this._getCompositeTitleExtras(), _utils.getLangText('complex', this._option), option);\r\n\r\n\r\n            if (option.showCompositeSeparate) {\r\n                title = _utils.template(HTML.compositeTitle, {title: title});\r\n                title += HTML.compositeBody;\r\n            }\r\n            html = html.replace(titleResult[1], title) + '</div>';\r\n            return html;\r\n        },\r\n        _compositeSeparateEventHandler: function ($view) {\r\n            var $title = $view.find('._qti-composite-title');\r\n            var $titleContent = $view.find('._qti-composite-title-content');\r\n            var $titleInside = $view.find('._qti-composite-title-inside');\r\n            var $separateBar = $view.find('._qti-composite-bar');\r\n            var $compositeBody = $view.find('._qti-composite-body');\r\n            //var bodyHeight = $(document.body).height();\r\n            var titleInsideHeight = $titleInside.height();\r\n\r\n            //var twoLineHeight = parseInt($titleContent.css('fontSize')) * parseInt($titleContent.css('lineHeight'));\r\n            var lineHeight = parseInt($titleContent.css('lineHeight'));\r\n            var fontSize = parseInt($titleContent.css('fontSize'));\r\n            var twoLineHeight;\r\n            if (lineHeight <= 1 || lineHeight < fontSize) {\r\n                twoLineHeight = 2 * fontSize + 10;\r\n            } else {\r\n                twoLineHeight = 2 * lineHeight\r\n            }\r\n\r\n            if (isNaN(twoLineHeight)) {\r\n                twoLineHeight = 30;\r\n            }\r\n            var paddingTop = parseInt($titleContent.css('paddingTop')) || 0;\r\n            var paddingBottom = parseInt($titleContent.css('paddingBottom')) || 0;\r\n            twoLineHeight = twoLineHeight + paddingTop + paddingBottom;\r\n\r\n            var separate = function (toggle) {\r\n                var barHeight = $separateBar.height();\r\n                //var viewHeight = $view[0].clientHeight;\r\n                var viewHeight = $view.height();\r\n                //var viewHeight = $(window).height();\r\n                viewHeight = viewHeight - barHeight;\r\n                titleInsideHeight = $titleInside.height();\r\n                titleInsideHeight = titleInsideHeight + paddingTop + paddingBottom;\r\n\r\n                if (toggle) {\r\n                    if (!$title.hasClass('nqti-down')) {\r\n                        $title.addClass('nqti-down');\r\n                        //题干小于两行直接显示题干高度\r\n                        if (twoLineHeight < titleInsideHeight) {\r\n                            $titleContent.css('height', twoLineHeight + 'px');\r\n                        } else {\r\n                            $titleContent.css('height', titleInsideHeight + 'px');\r\n                        }\r\n                    } else {\r\n                        $title.removeClass('nqti-down');\r\n                        //题干不超过窗口一半，直接显示题干高度\r\n                        if (titleInsideHeight > viewHeight / 2) {\r\n                            $titleContent.css('height', viewHeight / 2 + 'px');\r\n                        } else {\r\n                            $titleContent.css('height', titleInsideHeight + 'px');\r\n                        }\r\n                    }\r\n                } else {\r\n                    if ($title.hasClass('nqti-down')) {\r\n                        if (twoLineHeight < titleInsideHeight) {\r\n                            $titleContent.css('height', twoLineHeight + 'px');\r\n                        } else {\r\n                            $titleContent.css('height', titleInsideHeight + 'px');\r\n                        }\r\n                    } else {\r\n                        if (titleInsideHeight > viewHeight / 2) {\r\n                            $titleContent.css('height', (viewHeight / 2 ) + 'px');\r\n                        } else {\r\n                            $titleContent.css('height', titleInsideHeight + 'px');\r\n                        }\r\n                    }\r\n                }\r\n                $compositeBody.css('height', viewHeight + barHeight - $title.height() + 'px');\r\n            };\r\n\r\n            separate(false);\r\n\r\n            $titleInside.resize(function () {\r\n                separate(false);\r\n            });\r\n\r\n\r\n            $separateBar.on('qpTap', function () {\r\n                separate(true);\r\n            });\r\n        },\r\n        //render方法\r\n        render: function ($view, option, callback) {\r\n            var that = this;\r\n            this._option = option;\r\n            //设置渲染参数\r\n            for (var modelId in that._modelItem) {\r\n                model = that._modelItem[modelId];\r\n                model.setOption(option);\r\n            }\r\n\r\n            //判断是否有数学公式\r\n            var qpPlayerLatexLoadingClass = '';\r\n            if (that._itemModel.hasMath && typeof MathJax !== 'undefined') {\r\n                qpPlayerLatexLoadingClass = 'nqti-player-run-loading';\r\n            }\r\n            //是否显示小题序号\r\n            var showNumClass = '';\r\n            if (option.showNum) {\r\n                showNumClass = 'nqti-module-show-num';\r\n            }\r\n\r\n            // 是否显示得分\r\n            var showScoreClass = '';\r\n            option.showScore = true;\r\n            if (option.showScore) {\r\n                showScoreClass = 'nqti-module-show-score';\r\n            }\r\n\r\n            //简单的复合题(只有顺序填空题或则文本选择题)增加尾部hint提示信息渲染\r\n            var isSimpleModel = true;\r\n            var isTextEntry = true;\r\n            var firstModelId;\r\n            //题目类型\r\n            var qpModelName = '';\r\n            var isComposite = 0;//是否复合题\r\n            var model;\r\n            var modelType;\r\n            for (var modelId in that._modelItem) {\r\n                if (!firstModelId) {\r\n                    firstModelId = modelId;\r\n                }\r\n                model = that._modelItem[modelId];\r\n                qpModelName = model.getName();\r\n                if (model._model.modelType !== 'textEntryInteraction') {\r\n                    isTextEntry = false;\r\n                }\r\n                if (model._model.modelType !== 'textEntryInteraction' && model._model.modelType !== 'inlineChoiceInteraction') {\r\n                    isSimpleModel = false;\r\n                    isComposite++;\r\n                    if (modelType && modelType !== model._model.modelType) {\r\n                        isComposite++;\r\n                        qpModelName = '复合题';\r\n                        break;\r\n                    }\r\n\r\n                    modelType = model._model.modelType;\r\n                }\r\n            }\r\n            isComposite = isComposite > 1;\r\n            var itemBodyHtml = that._itemModel.prompt;\r\n            if (isComposite) {\r\n                itemBodyHtml = that._parseCompositeHtml(that._itemModel.prompt, option)\r\n            }\r\n            if (isTextEntry) {\r\n                itemBodyHtml = that._setExtrasTitleHtml(itemBodyHtml, that._modelItem[firstModelId].getTitleExtras(), that._modelItem[firstModelId].getName(), option);\r\n            }\r\n            //生成所有的model html片段\r\n            var itemBodyHtml = that._parseHtml(itemBodyHtml, option, $view);\r\n\r\n            //图片资源分析\r\n            itemBodyHtml = that._imageLoader.parseImage($view, itemBodyHtml, option);\r\n\r\n            if (isSimpleModel) {\r\n                //简单的复合题，显示提示，取第一个提示信息\r\n                var mId = '';\r\n                for (var modelId in that._itemModel.hintFeedback) {\r\n                    mId = modelId;\r\n                    break;\r\n                }\r\n                if (mId !== '') {\r\n                    var hintHtml = that.createHintHtml(mId, option);\r\n                    itemBodyHtml += hintHtml;\r\n                }\r\n            }\r\n\r\n            var matjaxLoading = _utils.getLangText('mathjax_loading', option);\r\n\r\n            var bodyClass = ' ' + option.skin + ' ' + option.platForm;\r\n\r\n            var showCompositeClass = 'nqti-show-composite-num';\r\n\r\n            var isElearningSkin = option.isElearningSkin;\r\n\r\n            if (isElearningSkin) {\r\n                //elearning皮肤走新的流程\r\n                // 是否渲染复合题大题号\r\n                if (option.showNum && that._isComposite) {\r\n                    var num;\r\n                    if (that._sequenceNumber === null) {\r\n                        num = '一';\r\n                    } else {\r\n                        num = that._sequenceNumber;\r\n                    }\r\n                    var numHtml = '<div class=\"nqti-composite-listnum\">'\r\n                        + '<em class=\"text\">' + num + '</em>'\r\n                        + '</div>';\r\n                    itemBodyHtml = '<div class=\"nqti-composite-container\">' + numHtml + itemBodyHtml + '</div>';\r\n                }\r\n            }\r\n\r\n            //加载itemBodyHtml\r\n            if (isElearningSkin) {\r\n                //elearning皮肤走新的流程\r\n                itemBodyHtml = ''\r\n                    + '<div class=\"_qti-player ' + bodyClass + '\">'\r\n                    + '    <div class=\"_qti-player-body nqti-player-body nqti-scrollbar-style-gray ' + showCompositeClass + ' ' + showNumClass + '\">'\r\n                    + itemBodyHtml\r\n                    + '        <div class=\"nqti-player-loading ' + qpPlayerLatexLoadingClass + '\">'\r\n                    + '            <em>' + matjaxLoading + '<span class=\"nqti-loading-dotting\"></span></em>'\r\n                    + '        </div>'\r\n                    + '    </div>'\r\n                    + '</div>';\r\n            } else {\r\n                // hdkt皮肤走原来流程\r\n                itemBodyHtml = ''\r\n                    + '<div class=\"_qti-player ' + bodyClass + '\">'\r\n                    + '    <div class=\"_qti-player-body nqti-player-body nqti-scrollbar-style-gray ' + showNumClass + '\">'\r\n                    + itemBodyHtml\r\n                    + '        <div class=\"nqti-player-loading ' + qpPlayerLatexLoadingClass + '\">'\r\n                    + '            <em>' + matjaxLoading + '<span class=\"nqti-loading-dotting\"></span></em>'\r\n                    + '        </div>'\r\n                    + '    </div>'\r\n                    + '</div>';\r\n            }\r\n\r\n            $view.html(itemBodyHtml);\r\n            //多媒体渲染\r\n            if (option.showMedia) {\r\n                that._media.render($view, option);\r\n            } else {\r\n                $view.find('audio,video').each(function () {\r\n                    var $this = $(this);\r\n                    var poster = $this.attr('poster');\r\n                    if (poster) {\r\n                        //有图片链接\r\n                        $this.before('<img src=\"' + poster + '\" alt=\"\"/>');\r\n                    }\r\n                    $this.remove();\r\n                });\r\n            }\r\n            //总体事件处理方法\r\n            var $qpTextModule = $view.find('._qti-player-body');\r\n            var $qpModel = $qpTextModule.find('._qp-model');\r\n            $qpModel.each(function () {\r\n                var $this = $(this);\r\n                var modelId = $this.data('model-id');\r\n                $this.addClass('nqti-module-body');\r\n\r\n                // elearning皮肤 并且 需要显示题目序号\r\n                if (isElearningSkin && option.showNum) {\r\n                    $this.addClass('npti-show-onlymodule-num');\r\n                }\r\n\r\n                var modelItem = that._modelItem[modelId];\r\n                var className = modelItem.getClassName(option);\r\n                $this.addClass(className);\r\n                //动态渲染\r\n                if (modelItem.render) {\r\n                    modelItem.render($this, option);\r\n                }\r\n            });\r\n\r\n            var eventHandle = function () {\r\n                //遍历所有的model,逐个处理事件\r\n                $qpModel.each(function () {\r\n                    var $this = $(this);\r\n                    var modelId = $this.data('model-id');\r\n                    var modelItem = that._modelItem[modelId];\r\n                    //交互事件处理,如果锁定就不处理交互\r\n                    //modelType为手写题、连线题、拼图题、表格题的继续使用旧的showLock控制方式\r\n                    var model = modelItem.getModel();\r\n                    modelItem.eventHandle($this, option);\r\n                    //提示点击事件处理\r\n                    that.hintEventHandle($this, option);\r\n                    //渲染是否锁定\r\n                    if (modelItem.renderLock) {\r\n                        modelItem.renderLock($this);\r\n                    }\r\n                    //渲染答案\r\n                    if (option.showAnswer) {\r\n                        if (modelItem.renderAnswer) {\r\n                            modelItem.renderAnswer($this);\r\n                        }\r\n                    } else if (option.showCheckedAnswer) {\r\n                        if (modelItem.renderCheckedAnswer) {\r\n                            modelItem.renderCheckedAnswer($this);\r\n                        }\r\n                    } else if (option.showCorrectAnswer) {\r\n                        if (modelItem.renderCorrectAnswer) {\r\n                            modelItem.renderCorrectAnswer($this);\r\n                        }\r\n                    } else if (option.showStatisAnswer) {\r\n                        if (modelItem.renderStatisAnswer) {\r\n                            modelItem.renderStatisAnswer($this);\r\n                        }\r\n                    }\r\n                });\r\n                //简单的复合题hint提示处理\r\n                if (isSimpleModel) {\r\n                    that.hintEventHandle($qpTextModule, option);\r\n                }\r\n                //图片点击事件处理\r\n                $view.find('img').bind('qpTap', function () {\r\n                    var $this = $(this);\r\n                    var url = $this.data('src');\r\n                    if (!url) {\r\n                        url = $this.attr('src');\r\n                    }\r\n                    that._event.trigger('image', 'click', {\r\n                        url: url\r\n                    });\r\n                });\r\n                //图片加载\r\n                that._imageLoader.load();\r\n\r\n                that._compositeSeparateEventHandler($view);\r\n\r\n                //是否锁定多媒体\r\n                that._media.setLock(option.lockMedia, $view);\r\n\r\n                //渲染完成回调\r\n                if (callback) {\r\n                    callback();\r\n                }\r\n            };\r\n            //解析数据公式\r\n            if (that._itemModel.hasMath && typeof MathJax !== 'undefined') {\r\n                MathJax.Hub.Queue(['Typeset', MathJax.Hub]);\r\n                MathJax.Hub.Queue(['End', function () {\r\n                    //异步渲染异常处理\r\n                    try {\r\n                        eventHandle();\r\n                    } catch (e) {\r\n                        that._logger.error('异步渲染异常处理');\r\n                        that._logger.error(e);\r\n                    }\r\n                    $qpTextModule.removeClass('nqti-player-run-loading');\r\n                    //触发公式解析回调\r\n                    that._event.trigger('latex', 'onEnded');\r\n                    that._event.trigger('render', 'rendered', that._option);\r\n                }]);\r\n            } else {\r\n                //处理事件\r\n                eventHandle();\r\n                //触发公式解析回调\r\n                that._event.trigger('latex', 'onEnded');\r\n                that._event.trigger('render', 'rendered', that._option);\r\n            }\r\n        },\r\n        _modelEach: function ($view, callback) {\r\n            var that = this;\r\n            var $qpModel = $view.find('._qti-player-body ._qp-model');\r\n            $qpModel.each(function () {\r\n                var $this = $(this);\r\n                var modelId = $this.data('model-id');\r\n                var modelItem = that._modelItem[modelId];\r\n                callback.apply(that, [$this, modelItem, modelId]);\r\n            });\r\n        },\r\n        //锁定\r\n        setLock: function ($view, lockArea) {\r\n            this._modelEach($view, function ($modelView, modelItem) {\r\n                if (modelItem.setLock) {\r\n                    modelItem.setLock($modelView, lockArea);\r\n                }\r\n            });\r\n            this._event.trigger('render', 'renderChanged', this._option);\r\n        },\r\n        showAnswer: function ($view) {\r\n            this._modelEach($view, function ($modelView, modelItem) {\r\n                if (modelItem.showAnswer) {\r\n                    modelItem.showAnswer($modelView);\r\n                }\r\n            });\r\n            this._event.trigger('render', 'renderChanged', this._option);\r\n        },\r\n        // 设置题目的序号\r\n        setSequenceNumber: function (num) {\r\n            this._sequenceNumber = num;\r\n        },\r\n        getSupportType: function () {\r\n            return this._supportType;\r\n        },\r\n        showCheckedAnswer: function ($view) {\r\n            this._modelEach($view, function ($modelView, modelItem) {\r\n                if (modelItem.showCheckedAnswer) {\r\n                    modelItem.showCheckedAnswer($modelView);\r\n                }\r\n            });\r\n            this._event.trigger('render', 'renderChanged', this._option);\r\n        },\r\n        showUsrAndCorrectAnswer: function ($view) {\r\n            this._modelEach($view, function ($modelView, modelItem) {\r\n                var questionType = modelItem._model.questionType;\r\n                var isSupportThisInterface = (questionType === \"choice\" || questionType === \"multiplechoice\");\r\n                if (isSupportThisInterface) {\r\n                    // 该接口只是多项选择 与 单项选择支持\r\n                    if (modelItem.showUsrAndCorrectAnswer) {\r\n                        modelItem.showUsrAndCorrectAnswer($modelView);\r\n                    }\r\n                } else {\r\n                    console.warn(\"只有单项选择和多项选择才支持showUsrAndCorrectAnswer接口\");\r\n                }\r\n            });\r\n            this._event.trigger('render', 'renderChanged', this._option);\r\n        },\r\n        showCorrectAnswer: function ($view) {\r\n            this._modelEach($view, function ($modelView, modelItem) {\r\n                if (modelItem.showCorrectAnswer) {\r\n                    modelItem.showCorrectAnswer($modelView);\r\n                }\r\n            });\r\n            this._event.trigger('render', 'renderChanged', this._option);\r\n        },\r\n        showStatisAnswer: function ($view) {\r\n            this._modelEach($view, function ($modelView, modelItem) {\r\n                if (modelItem.showStatisAnswer) {\r\n                    modelItem.showStatisAnswer($modelView);\r\n                }\r\n            });\r\n            this._event.trigger('render', 'renderChanged', this._option);\r\n        },\r\n        reset: function ($view) {\r\n            this._modelEach($view, function ($modelView, modelItem) {\r\n                if (modelItem.reset) {\r\n                    modelItem.reset($modelView);\r\n                }\r\n            });\r\n            this._event.trigger('render', 'renderChanged', this._option);\r\n        },\r\n        showDefaultExtras: function ($view, extrasOption) {\r\n            var that = this;\r\n            this._modelEach($view, function ($modelView, modelItem, modelId) {\r\n                var html = that.createExtrasHtml(modelItem, modelId, extrasOption);\r\n                $modelView.find('._qti-module-extras').html(html);\r\n                var newOption = $.extend(true, that._option, {img: {render: true}});\r\n                that._media.render($modelView, newOption);\r\n            });\r\n            if (typeof  MathJax != typeof undefined) {\r\n                MathJax.Hub.Queue(['Typeset', MathJax.Hub, $view[0]]);\r\n            }\r\n        },\r\n        //在指定区域添加自定义内容\r\n        appendToExtras: function ($view, appendView, appendToModelId) {\r\n            var that = this;\r\n            this._modelEach($view, function ($modelView, modelItem, modelId) {\r\n                if (appendToModelId && typeof appendToModelId != typeof undefined) {\r\n                    if (appendToModelId === modelId) {\r\n                        $modelView.find('._qti-module-extras').append(appendView);\r\n                        var newOption = $.extend(true, that._option, {img: {render: true}});\r\n                        that._media.render($modelView, newOption);\r\n                    }\r\n                } else {\r\n                    $modelView.find('._qti-module-extras').append(appendView);\r\n                    that._media.render($modelView, that._option);\r\n                }\r\n            });\r\n            if (typeof  MathJax != typeof undefined) {\r\n                MathJax.Hub.Queue(['Typeset', MathJax.Hub, $view[0]]);\r\n            }\r\n        },\r\n        //清空指定区域内容\r\n        cleanExtras: function ($view, cleanModelId) {\r\n            this._modelEach($view, function ($modelView, modelItem, modelId) {\r\n                console.log(modelId);\r\n                if (cleanModelId && cleanModelId != typeof undefined) {\r\n                    if (cleanModelId === modelId) {\r\n                        $modelView.find('._qti-module-extras').html('');\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        //destroy方法\r\n        destroy: function () {\r\n            var modelItem;\r\n            for (var modelId in this._modelItem) {\r\n                modelItem = this._modelItem[modelId];\r\n                if (modelItem.destroy && $.type(modelItem.destroy) === 'function') {\r\n                    modelItem.destroy();\r\n                }\r\n            }\r\n            this._media.destroy();\r\n        }\r\n    };\r\n\r\n    return AssessmentItem;\r\n});\r\n\ndefine('player/assessment/assessmentTest', ['model/logger', 'player/utils/extendUtils'], function (_logger, _utils) {\r\n\r\n    var AssessmentItem = require('player/assessment/assessmentItem');\r\n\r\n    //创建AssessmentTest\r\n    //暂时,AssessmentTest中只有一个AssessmentItem\r\n    var AssessmentTest = {\r\n        _assessmentItem: null,\r\n        _sequenceNumber: null,// 由于现在player和题目的对应关系是1对1的（复合题也算一道题目），该player对应的题目的序号\r\n        _option: null,\r\n        _event: null,\r\n        _media: null,\r\n        _logger: _logger,\r\n        create: function (option, event, media) {\r\n            var instance = $.extend({}, this);\r\n            instance._event = event;\r\n            instance._option = option;\r\n            instance._media = media;\r\n            instance._sequenceNumber = option.sequenceNumber || null;\r\n            return instance;\r\n        },\r\n        //递归解析$itemBody对象\r\n        loadAssessmentItem: function (assessmentItemModel) {\r\n            this._assessmentItem = AssessmentItem.create(assessmentItemModel, this._event, this._media);\r\n            if (this._sequenceNumber) {\r\n                this._assessmentItem.setSequenceNumber(this._sequenceNumber)\r\n            }\r\n        },\r\n        getAssessmentItem: function () {\r\n            return this._assessmentItem;\r\n        },\r\n        render: function ($view, option, callback) {\r\n            this._sequenceNumber = option.sequenceNumber || null;\r\n            if (this._sequenceNumber) {\r\n                this._assessmentItem.setSequenceNumber(this._sequenceNumber)\r\n            }\r\n            if (this._assessmentItem) {\r\n                this._assessmentItem.render($view, option, callback);\r\n\r\n            } else {\r\n                this._logger.warn('_assessmentTest:render失败,请先加载数据');\r\n            }\r\n        }\r\n    };\r\n    return AssessmentTest;\r\n});\r\n\n/**\r\n * Created by ylf on 2015/5/28.\r\n */\r\n\r\ndefine('player/cls/baseInteraction', function () {\r\n    var Class = require('player/cls/class');\r\n    var utils = require('player/utils/extendUtils');\r\n    var lang = require('player/config/lang');\r\n\r\n    var classUtilsObject = function () {\r\n    };\r\n\r\n    classUtilsObject.prototype.base = function () {\r\n        var base = this.Type.Base;\r\n        if (!base.Base) {\r\n            base.apply(this, arguments);\r\n        } else {\r\n            this.base = MakeBase(base);\r\n            base.apply(this, arguments);\r\n            delete this.base;\r\n        }\r\n\r\n        function MakeBase(type) {\r\n            var Base = type.Base;\r\n            if (!Base.Base) return Base;\r\n            return function () {\r\n                this.base = MakeBase(Base);\r\n                Base.apply(this, arguments);\r\n            };\r\n        }\r\n    };\r\n\r\n    var BaseInteraction = Class(classUtilsObject, (function () {\r\n        var member = {\r\n            //constructor\r\n            Create: function (modelItem) {\r\n                this.base();\r\n                if (lang == null || lang == undefined) {\r\n                    lang = {};\r\n                }\r\n                var model = modelItem.getModel();\r\n                this.name = model.modelType;\r\n                this.interactionId = utils.Rd.getRandom(this.name);\r\n\r\n                this.modalItem = modelItem;\r\n                this.modalModel = model;\r\n            },\r\n            setOption: function (option) {\r\n                this.option = option;\r\n            },\r\n            /**\r\n             * dom是否还存在\r\n             * @returns {boolean}\r\n             */\r\n            isDomExist: function () {\r\n                return $('[data-key=\"' + this.interactionId + '\"]').length > 0;\r\n            },\r\n            getLangText: function (key, str) {\r\n                return lang[key] != null && lang[key] != undefined ? lang[key] : str;\r\n            },\r\n            /**\r\n             * 获取选项随机数组\r\n             * @param len\r\n             * @returns {Array}\r\n             */\r\n            getAnswerRandom: function (len, start) {\r\n                return lang.Rd.getAnswerRandom((len - 1), start, this.option.randomSeed);\r\n            },\r\n            /**\r\n             * 是否锁定\r\n             * @returns {boolean|showLock|*|qtiplayer.showLock|_option.showLock|member.option.showLock}\r\n             */\r\n            isLock: function () {\r\n                return this.option.showLock;\r\n            },\r\n            //common api end\r\n\r\n            //modalItem api start\r\n            getAnswer: function () {\r\n                return this.modalItem.getAnswer();\r\n            },\r\n            getCorrectAnswer: function () {\r\n                return this.modalItem.getCorrectAnswer();\r\n            },\r\n            setAnswer: function (arry) {\r\n                return this.modalItem.setAnswer(arry);\r\n            },\r\n            getLogger: function () {\r\n                return this.modalItem.getLogger();\r\n            },\r\n            /**\r\n             * 是否随机排列\r\n             * @returns {*}\r\n             */\r\n            getShuffle: function () {\r\n                return !!this.modalItem.getModel().shuffle;\r\n            }\r\n\r\n            //modalItem api end\r\n        };\r\n\r\n        return member;\r\n    })());\r\n    return BaseInteraction;\r\n});\r\n\n/**\r\n * Created by ylf on 2015/5/28.\r\n */\r\ndefine('player/cls/class', function () {\r\n\r\n    var Class = function (baseClass, member) {\r\n\r\n        function prototype_() {\r\n        };\r\n        prototype_.prototype = baseClass.prototype;\r\n        var aPrototype = new prototype_();\r\n        for (var m in member) {\r\n            if (m != \"Create\") {\r\n                aPrototype[m] = member[m];\r\n            }\r\n        }\r\n        if (member.toString() != Object.prototype.toString()) {\r\n            aPrototype.toString = member.toString;\r\n        }\r\n        if (member.toLocaleString() != Object.prototype.toLocaleString()) {\r\n            aPrototype.toLocaleString = member.toLocaleString;\r\n        }\r\n        if (member.valueOf() != Object.prototype.valueOf()) {\r\n            aPrototype.valueOf = member.valueOf;\r\n        }\r\n\r\n        var aType = null;\r\n        if (member.Create) {\r\n            aType = member.Create;\r\n        } else {\r\n            aType = function () {\r\n                this.base.apply(this, [baseClass, member]);\r\n            };\r\n        }\r\n\r\n        aType.prototype = aPrototype;\r\n        aType.Base = baseClass;\r\n        aType.prototype.Type = aType;\r\n        return aType;\r\n    };\r\n\r\n\r\n\r\n    return Class;\r\n});\ndefine('player/config/extrasOption', function () {\r\n\r\n    var ExtrasOption = {\r\n        showHint: true,\r\n        showUserAnswer: true,\r\n        showCorrectAnswer: true,\r\n        showAnalyse: true\r\n    };\r\n\r\n\r\n    return ExtrasOption;\r\n});\r\n\ndefine('player/config/lang', function () {\r\n\r\n    var zh = {\r\n        \"mathjax_loading\": \"正在努力解析中...\",\r\n        \"confirm\": \"确定\",\r\n        \"prompt\": \"提示\",\r\n        \"drawing_source_material\": \"素材\",\r\n        \"drawing_stem\": \"题干\",\r\n        \"drawing_view_material\": \"查看素材\",\r\n        \"drawing_view_topics\": \"查看题目\",\r\n        \"drawing_continue_write\": \"继续书写\",\r\n        \"gapmath_title\": \"将以下选项进行归类\",\r\n        \"inline_choice_choose\": \"请选择\",\r\n        \"vote_sigleitem\": \"单项投票\",\r\n        \"vote_mutipleitem\": \"不定项投票\",\r\n        \"vote_tip_pre\": \"总共有\",\r\n        \"vote_tip_end\": \"个投票项，投票时请注意查看，避免遗漏。\",\r\n        \"choice_screenshot_title\": \"请选择正确的答案\",\r\n        \"text_title\": \"请完成下面的填空\",\r\n        \"extras_user_answer\": \"您的答案\",\r\n        \"extras_correct_answer\": \"正确答案\",\r\n        \"analyse\": \"解析\",\r\n        \"single_choise\": '单选题',\r\n        \"multiple_choise\": '多选题',\r\n        \"blank_filling\": '填空题',\r\n        \"connection\": '连线题',\r\n        \"sort\": '排序题',\r\n        \"question\": '问答题',\r\n        \"voting\": '投票题',\r\n        \"true_or_false\": '判断题',\r\n        \"puzzle\": '拼图题',\r\n        \"complex\": '复合题'\r\n    };\r\n\r\n    var ja = {\r\n        \"mathjax_loading\": \"解析中...\",\r\n        \"confirm\": \"OK\",\r\n        \"prompt\": \"ヒント\",\r\n        \"drawing_source_material\": \"素材\",\r\n        \"drawing_stem\": \"問題テキスト\",\r\n        \"drawing_view_material\": \"素材をみる\",\r\n        \"drawing_view_topics\": \"問題をみる\",\r\n        \"drawing_continue_write\": \"書き続ける\",\r\n        \"gapmath_title\": \"以下の選択肢を分類してください\",\r\n        \"inline_choice_choose\": \"ご選択を\",\r\n        \"vote_sigleitem\": \"単一選択肢投票\",\r\n        \"vote_mutipleitem\": \"複数選択肢投票\",\r\n        \"vote_tip_pre\": \"合計\",\r\n        \"vote_tip_end\": \"投票選択肢，投票の時に、見逃さないようにしてください。\",\r\n        \"choice_screenshot_title\": \"正しい回答を選択してください\",\r\n        \"text_title\": \"以下の穴埋めを完成してください\",\r\n        \"extras_user_answer\": \"ご解答\",\r\n        \"extras_correct_answer\": \"正解\",\r\n        \"analyse\": \"解析\",\r\n        \"single_choise\": '単一選択問題',\r\n        \"multiple_choise\": '複数選択問題',\r\n        \"blank_filling\": '穴埋め問題',\r\n        \"connection\": 'リンク問題',\r\n        \"sort\": '並べ替え問題',\r\n        \"question\": '記述問題',\r\n        \"voting\": '投票問題',\r\n        \"true_or_false\": '正誤問題',\r\n        \"puzzle\": 'ジグソーパズル問題',\r\n        \"complex\": '複合問題'\r\n    }\r\n\r\n    var lang = {\r\n        'zh': zh,\r\n        'ja': ja,\r\n        'ja_jp': ja,\r\n        'en': {\r\n            \"mathjax_loading\": \"Loading...\",\r\n            \"confirm\": \"Confirm\",\r\n            \"prompt\": \"Hints\",\r\n            \"drawing_source_material\": \"Material\",\r\n            \"drawing_stem\": \"Question Stem\",\r\n            \"drawing_view_material\": \"查看素材\",\r\n            \"drawing_view_topics\": \"查看题目\",\r\n            \"drawing_continue_write\": \"继续书写\",\r\n            \"gapmath_title\": \"将以下选项进行归类\",\r\n            \"inline_choice_choose\": \"Please select\",\r\n            \"vote_sigleitem\": \"Single Vote\",\r\n            \"vote_mutipleitem\": \"Multiple Votes\",\r\n            \"vote_tip_pre\": \"There is \",\r\n            \"vote_tip_end\": \" voting items, please check carefully to avoid the omission.\",\r\n            \"choice_screenshot_title\": \"Please choose the correct answer\",\r\n            \"text_title\": \"Please fill in the following blanks\",\r\n            \"extras_correct_answer\": \"Correct Answer\",\r\n            \"analyse\": \"Analysis\",\r\n            \"single_choise\": 'Single Choice',\r\n            \"multiple_choise\": 'Multiple Choice',\r\n            \"blank_filling\": 'Fill-in-the-blank ',\r\n            \"connection\": 'Matching',\r\n            \"sort\": 'Sorting Exercise',\r\n            \"question\": 'Question',\r\n            \"voting\": 'Voting',\r\n            \"true_or_false\": 'True or False',\r\n            \"puzzle\": 'Puzzle',\r\n            \"complex\": 'Mixed Question Types'\r\n        },\r\n        'es_ec': {\r\n            \"mathjax_loading\": \"正在努力解析中...\",\r\n            \"confirm\": \"Confirmar\",\r\n            \"prompt\": \"Sugerencia\",\r\n            \"drawing_source_material\": \"Materiales\",\r\n            \"drawing_stem\": \"Tema\",\r\n            \"drawing_view_material\": \"Consultar Materiales\",\r\n            \"drawing_view_topics\": \"Consultar Ejercicios\",\r\n            \"drawing_continue_write\": \"Sigue escribiendo\",\r\n            \"gapmath_title\": \"Clasificar siguientes opciones\",\r\n            \"inline_choice_choose\": \"请选择\",\r\n            \"vote_sigleitem\": \"单项投票\",\r\n            \"vote_mutipleitem\": \"不定项投票\",\r\n            \"vote_tip_pre\": \"总共有\",\r\n            \"vote_tip_end\": \"个投票项，投票时请注意查看，避免遗漏。\",\r\n            \"choice_screenshot_title\": \"请选择正确的答案\",\r\n            \"text_title\": \"请完成下面的填空\",\r\n            \"extras_correct_answer\": \"正确答案\",\r\n            \"analyse\": \"解析\"\r\n        }\r\n    };\r\n\r\n    return lang;\r\n});\r\n\ndefine('player/config/option', function () {\r\n\r\n    var Option = {\r\n        refPath: '',\r\n        unifyTextEntry: false,//统一填空题结构\r\n        lang: 'zh',\r\n        skin: 'wood', //皮肤\r\n        platForm: '', //接入平台\r\n        showNum: false,\r\n        screenshotLayout: false,\r\n        showTitleArea: true,\r\n        hideAnswerArea: false,\r\n        showAnswerArea: true,\r\n        showSubSequence: false,\r\n        showHint: true,\r\n        showStat: false, //显示统计信息\r\n        showLock: false,//锁定作答区域\r\n        showAnswer: false,\r\n        showCheckedAnswer: false,\r\n        showCorrectAnswer: false,\r\n        showStatisAnswer: false,\r\n        showMedia: true,\r\n        lockMedia: false,//禁用多媒体\r\n        modelId: [],\r\n        randomSeed: [],\r\n        event: true,\r\n        expectWidth: 0,\r\n        expectHeight: 0,\r\n        thumbnailEnable: true,\r\n        //showTitleExtras: false,//显示标题补充信息\r\n        showQuestionName: false,//显示题目类型\r\n        showCompositeSeparate: false,//显示复合题分割\r\n        graphicGapMatchImageLoaderEnable:true\r\n    };\r\n\r\n\r\n    return Option;\r\n});\r\n\ndefine('player/config/platForm', function () {\r\n\r\n    //接入平台\r\n    var platForm = {\r\n        pptshell: 'qp-player-pptshell',\r\n        statis: 'qp-statis'//pc新统计模块\r\n    };\r\n\r\n\r\n    return platForm;\r\n});\r\n\n// qti model\r\ndefine('player/config/skin', function () {\r\n\r\n    var skin = {\r\n        //木纹\r\n        wood: 'nqti-player-skin-wood',\r\n        elearning: 'nqti-player-skin-elearning'\r\n    };\r\n\r\n    return skin;\r\n});\r\n\ndefine('player/media/defaultMediaPlayer', function () {\r\n\r\n    var _emptyFunc = function () {\r\n    };\r\n\r\n    var mediaPlayer = {\r\n        _$medias: null,\r\n        _eventHandler: null,\r\n        create: function () {\r\n            var instance = $.extend({}, this);\r\n            instance._eventHandler = {\r\n                play: _emptyFunc,\r\n                pause: _emptyFunc,\r\n                ended: _emptyFunc,\r\n                timeupdate: _emptyFunc,\r\n                seeked: _emptyFunc,\r\n                volumeChange: _emptyFunc,\r\n                fullScreenChange: _emptyFunc\r\n            };\r\n            instance._$medias = {};\r\n            return instance;\r\n        },\r\n        render: function ($view, option) {\r\n        },\r\n        renderImg: function () {\r\n            //TODO:\r\n        },\r\n        eventHandle: function ($view, option) {\r\n            var that = this;\r\n            //多媒体事件处理\r\n            var mediaHandler = function (index) {\r\n                var $media = $(this);\r\n                var mediaType = $media[0].tagName;\r\n                var mediaId = mediaType + '-' + index;\r\n                //记录\r\n                that._$medias[mediaId] = $media;\r\n                //\r\n                var mediaTarget = {\r\n                    mediaId: mediaId,\r\n                    index: index,\r\n                    mediaType: mediaType\r\n                };\r\n                //绑定事件\r\n                var eventTypes = ['play', 'pause', 'ended', 'timeupdate', 'seeked'];\r\n                $(eventTypes).each(function (i, eventType) {\r\n                    if (eventType === 'seeked') {\r\n                        mediaTarget.seeked = $media[0].currentTime;\r\n                    } else {\r\n                        delete mediaTarget.seeked;\r\n                    }\r\n                    $media.bind(eventType, function () {\r\n                        that._eventHandler[eventType](mediaTarget);\r\n                    });\r\n                });\r\n            };\r\n            $view.find('audio').each(mediaHandler);\r\n            $view.find('video').each(mediaHandler);\r\n        },\r\n        mediaOnStart: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.play = callback;\r\n            }\r\n        },\r\n        mediaOnPause: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.pause = callback;\r\n            }\r\n        },\r\n        mediaOnEnded: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.ended = callback;\r\n            }\r\n        },\r\n        mediaOnTimeupdate: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.timeupdate = callback;\r\n            }\r\n        },\r\n        mediaOnVolumeChange: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.volumeChange = callback;\r\n            }\r\n        },\r\n        mediaOnSeeked: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.seeked = callback;\r\n            }\r\n        },\r\n        _getMedia: function (mediaType, index) {\r\n            var mediaId = mediaType + '-' + index;\r\n            var $media = this._$medias[mediaId];\r\n            return $media;\r\n        },\r\n        mediaPlay: function (mediaType, index) {\r\n            var $media = this._getMedia(mediaType, index);\r\n            if ($media) {\r\n                $media.trigger('play');\r\n            }\r\n        },\r\n        mediaPause: function (mediaType, index) {\r\n            var $media = this._getMedia(mediaType, index);\r\n            if ($media) {\r\n                $media.trigger('pause');\r\n            }\r\n        },\r\n        mediaPauseAll: function (obj) {\r\n\r\n        },\r\n        mediaSkip: function (mediaType, index, seeked) {\r\n            var $media = this._getMedia(mediaType, index);\r\n            if ($media) {\r\n                $media[0].currentTime = seeked;\r\n                $media.trigger('pause');\r\n            }\r\n        },\r\n        mediaVolumeChange: function (mediaType, index, volume, diaplay) {\r\n            //TODO:\r\n        },\r\n        mediaOnFullScreenChange: function (callback) {\r\n            //TODO:\r\n        },\r\n        destroy: function () {\r\n            //TODO:\r\n        },\r\n        setLock:function(lock,view){\r\n            //TODO:\r\n        }\r\n    };\r\n\r\n    return mediaPlayer;\r\n});\r\n\n/**\r\n * Created by LinMingDao on 2016/9/1.\r\n * eLearning媒体播放器Adapter\r\n */\r\ndefine('player/media/eLearningMediaPlayer', function () {\r\n\r\n    if (!window.Video) {\r\n        throw new Error(\"未加载elearning媒体播放器资源，请手动加载\");\r\n    }\r\n\r\n    var _emptyFunc = function () {\r\n    };\r\n\r\n    // elearning 播放器 impl\r\n    window.ELMediaPlayer = {\r\n        _players: [],//\r\n        _eventHandler: {\r\n            play: _emptyFunc,\r\n            pause: _emptyFunc,\r\n            ended: _emptyFunc,\r\n            timeupdate: _emptyFunc,\r\n            seeked: _emptyFunc,\r\n            volumeChange: _emptyFunc,\r\n            fullScreenChange: _emptyFunc,\r\n            fullScreen: _emptyFunc,\r\n            fullScreenExit: _emptyFunc\r\n        },\r\n        _getMedia: function (mediaType, index) {\r\n            var that = this;\r\n            var mediaId = mediaType + '-' + index;\r\n            for (var key in this._$medias) {\r\n                if (that._getKeyMedia(key) === mediaId) {\r\n                    var $media = this._$medias[key];\r\n                    return $media;\r\n                }\r\n            }\r\n            return null;\r\n        },\r\n        render: function ($view, option) {\r\n            var that = this;\r\n            that._players.length = 0;\r\n            var $media = $view.find(\"._mediaMark\");\r\n            for (var i = 0; i < $media.length; ++i) {\r\n                // 解析media资源url\r\n                var mediaUrl = $($media[i]).attr(\"media_src\");\r\n                var config = {\r\n                    video: {\r\n                        swfHost: option.swfHost || \"http://static.auxo.test.huayu.nd/auxo/addins/flowplayer/v1.0.0/\",\r\n                        url: mediaUrl,\r\n                        autoPlay: false\r\n                    }\r\n                };\r\n                var player = new window.Video.Player($media[i], config);\r\n                // 注册回调事件\r\n                player.addEventListener(\"onStart\", function () {\r\n                    console.log('onStart...');\r\n                    // 暂停所有其他视频\r\n                    for (var i = 0; i < that._players.length; ++i) {\r\n                        if (this != that._players[i]) {\r\n                            that._players[i].pause();\r\n                        }\r\n                    }\r\n                    that._eventHandler.play();\r\n                });\r\n                player.addEventListener(\"onPause\", function () {\r\n                    console.log('onPause...');\r\n                    that._eventHandler.pause();\r\n                });\r\n                player.addEventListener(\"onFullscreen\", function () {\r\n                    console.log('onFullscreen...');\r\n                    that._eventHandler.fullScreenChange();\r\n                    that._eventHandler.fullScreen();\r\n                });\r\n                player.addEventListener(\"onFullscreenExit\", function () {\r\n                    console.log('onFullscreenExit...');\r\n                    that._eventHandler.fullScreenChange();\r\n                    that._eventHandler.fullScreenExit();\r\n                });\r\n                player.addEventListener(\"onFinish\", function () {\r\n                    console.log('onFinish...');\r\n                    that._eventHandler.ended();\r\n                });\r\n                player.addEventListener(\"onSeek\", function () {\r\n                    console.log('onSeek...');\r\n                    that._eventHandler.seeked();\r\n                });\r\n\r\n                player.addEventListener(\"onResume\", function () {\r\n                    // 暂停所有其他视频\r\n                    console.log('onResume');\r\n                    for (var i = 0; i < that._players.length; ++i) {\r\n                        if (this != that._players[i]) {\r\n                            that._players[i].pause();\r\n                        }\r\n                    }\r\n                });\r\n\r\n                // 缓存播放器实例\r\n                this._players.push(player);\r\n            }\r\n        },\r\n        mediaOnStart: function (callback) {\r\n            if (typeof callback === 'function') {\r\n                this._eventHandler.play = callback;\r\n            }\r\n        },\r\n        mediaOnPause: function (callback) {\r\n            if (typeof callback === 'function') {\r\n                this._eventHandler.pause = callback;\r\n            }\r\n        },\r\n        mediaOnEnded: function (callback) {\r\n            if (typeof callback === 'function') {\r\n                this._eventHandler.ended = callback;\r\n            }\r\n        },\r\n        mediaOnTimeupdate: function (callback) {\r\n            if (typeof callback === 'function') {\r\n                this._eventHandler.timeupdate = callback;\r\n            }\r\n        },\r\n        mediaOnSeeked: function (callback) {\r\n            if (typeof callback === 'function') {\r\n                this._eventHandler.seeked = callback;\r\n            }\r\n        },\r\n        mediaOnVolumeChange: function (callback) {\r\n            if (typeof callback === 'function') {\r\n                this._eventHandler.volumeChange = callback;\r\n            }\r\n        },\r\n        getMedia: function () {\r\n        },\r\n        mediaPlay: function () {\r\n            debugger;\r\n            var that = this;\r\n            for (var i = 0; i < that._players.length; ++i) {\r\n                that._players[i].replay();\r\n            }\r\n        },\r\n        mediaPause: function () {\r\n            var that = this;\r\n            for (var i = 0; i < that._players.length; ++i) {\r\n                that._players[i].pause();\r\n            }\r\n        },\r\n        mediaPauseAll: function () {\r\n        },\r\n        mediaSkip: function () {\r\n        },\r\n        mediaVolumeChange: function () {\r\n        },\r\n        mediaOnFullScreenChange: function (callback) {// ok\r\n            if (typeof callback === 'function') {\r\n                this._eventHandler.fullScreenChange = callback;\r\n            }\r\n        },\r\n        mediaOnFullScreen: function (callback) {// ok\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.fullScreen = callback;\r\n            }\r\n        },\r\n        mediaOnFullScreenExit: function (callback) {// ok\r\n            if (typeof callback === 'function') {\r\n                this._eventHandler.fullScreenExit = callback;\r\n            }\r\n        },\r\n        destroy: function () {\r\n            var that = this;\r\n            this._fullChangeEvent.remove(this._eventHandler.fullScreenChange);\r\n            for (var i = 0; i < that._players.length; ++i) {\r\n                that._players[i].close();\r\n            }\r\n            that._players = null;\r\n        }\r\n    };\r\n\r\n    var eMediaPlayer = {\r\n        _mediaImpl: window.ELMediaPlayer,\r\n        _eventHandler: null,\r\n        _fullChangeEvent: {\r\n            onFullScreenChange: [],\r\n            trigger: function (isFull) {\r\n                this.onFullScreenChange.forEach(function (callback) {\r\n                    if (callback) {\r\n                        callback(isFull);\r\n                    }\r\n                })\r\n            },\r\n            push: function (callback) {\r\n                this.onFullScreenChange.push(callback);\r\n            },\r\n            remove: function (callback) {\r\n                var len = this.onFullScreenChange.length;\r\n                for (var i = 0; i < len; i++) {\r\n                    if (callback === this.onFullScreenChange[i]) {\r\n                        this.onFullScreenChange.splice(i, 1);\r\n                        i--;\r\n                        len--;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        create: function () {\r\n            var instance = $.extend({}, this);\r\n            instance._eventHandler = {\r\n                play: _emptyFunc,\r\n                pause: _emptyFunc,\r\n                ended: _emptyFunc,\r\n                timeupdate: _emptyFunc,\r\n                seeked: _emptyFunc,\r\n                volumeChange: _emptyFunc,\r\n                fullScreenChange: _emptyFunc\r\n            };\r\n            return instance;\r\n        },\r\n        render: function ($view, option) {\r\n            option.onPlay = this._eventHandler.play;\r\n            option.onPause = this._eventHandler.pause;\r\n            option.onEnd = this._eventHandler.ended;\r\n            option.onSeek = this._eventHandler.seeked;\r\n            option.onVolumeChange = this._eventHandler.volumeChange;\r\n            option.onTimeUpdate = this._eventHandler.timeupdate;\r\n            option.onFullScreenChange = this._eventHandler.fullScreenChange;\r\n            this._mediaImpl.render($view, option);\r\n        },\r\n        renderImg: function () {// eLearning无此接口，留空不实现\r\n        },\r\n        mediaOnStart: function (callback) {// ok\r\n            if ($.type(callback) === 'function') {\r\n                this._mediaImpl.mediaOnStart(callback);\r\n            }\r\n        },\r\n        mediaOnPause: function (callback) {// ok\r\n            if ($.type(callback) === 'function') {\r\n                this._mediaImpl.mediaOnPause(callback);\r\n            }\r\n        },\r\n        mediaOnEnded: function (callback) {// ok\r\n            if ($.type(callback) === 'function') {\r\n                //this._eventHandler.ended = callback;\r\n                this._mediaImpl.mediaOnEnded(callback);\r\n            }\r\n        },\r\n        mediaOnTimeupdate: function (callback) {// eLearning无该api\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.timeupdate = callback;\r\n            }\r\n        },\r\n        mediaOnVolumeChange: function (callback) {// eLearning无该api\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.volumeChange = callback;\r\n            }\r\n        },\r\n        mediaOnSeeked: function (callback) {// ok\r\n            if ($.type(callback) === 'function') {\r\n                this._mediaImpl.mediaOnSeeked(callback);\r\n            }\r\n        },\r\n        mediaPlay: function () {// ok\r\n            this._mediaImpl.mediaPlay();\r\n        },\r\n        mediaPause: function () {// ok\r\n            this._mediaImpl.mediaPause();\r\n        },\r\n        mediaPauseAll: function () {// ok\r\n            this._mediaImpl.mediaPauseAll();\r\n        },\r\n        mediaSkip: function () {// has\r\n            this._mediaImpl.seek();\r\n        },\r\n        mediaVolumeChange: function () {// has\r\n            this._mediaImpl.setVolume();\r\n        },\r\n        mediaOnFullScreenChange: function (callback) {// ok\r\n            if ($.type(callback) === 'function') {\r\n                this._mediaImpl.mediaOnFullScreenChange(callback);\r\n                this._fullChangeEvent.push(this._eventHandler.fullScreenChange);\r\n            }\r\n        },\r\n        mediaOnFullScreen: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._mediaImpl.mediaOnFullScreen(callback);\r\n            }\r\n        },\r\n        mediaOnFullScreenExit: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._mediaImpl.mediaOnFullScreenExit(callback);\r\n            }\r\n        },\r\n        destroy: function () {\r\n            this._fullChangeEvent.remove(this._eventHandler.fullScreenChange);\r\n            this._mediaImpl.destroy();\r\n        },\r\n        setLock: function () {\r\n        }\r\n    };\r\n\r\n    return eMediaPlayer;\r\n});\ndefine('player/media/eMedia', function () {\r\n    var eLearningMediaPlayer = require('player/media/eLearningMediaPlayer');\r\n    var Media = require('player/media/mediaApi');\r\n\r\n    //扩展media对象api\r\n    var extendMedia = function (media) {\r\n        var methods = [\r\n            'create', 'render', 'renderImg', 'mediaOnStart', 'mediaOnPause',\r\n            'mediaOnEnded', 'mediaOnTimeupdate', 'mediaOnSeeked', 'mediaOnVolumeChange',\r\n            'mediaPlay', 'mediaPause', 'mediaSkip', 'mediaVolumeChange', 'mediaOnFullScreenChange', 'mediaPauseAll', 'setLock'\r\n        ];\r\n        var method;\r\n        var isComplete = true;\r\n        for (var index = 0; index < methods.length; index++) {\r\n            method = methods[index];\r\n            if (!media[method] || $.type(media[method]) !== 'function') {\r\n                isComplete = false;\r\n                break;\r\n            }\r\n        }\r\n        if (isComplete) {\r\n            $.extend(Media, media);\r\n        } else {\r\n            throw 'QtiPlayer.extendMedia输入错误,请确认输入的对象是否有实现所有的api';\r\n        }\r\n    };\r\n\r\n    extendMedia(eLearningMediaPlayer);\r\n\r\n    return Media;\r\n});\r\n\ndefine('player/media/lowVersionMediaPlayer', [], function () {\r\n\r\n    var _emptyFunc = function () {\r\n    };\r\n\r\n    var mediaPlayer = {\r\n        _fullChangeEvent: {\r\n            onFullScreenChange: [],\r\n            trigger: function (isFull) {\r\n                this.onFullScreenChange.forEach(function (callback) {\r\n                    if (callback) {\r\n                        callback(isFull);\r\n                    }\r\n                })\r\n            },\r\n            push: function (callback) {\r\n                this.onFullScreenChange.push(callback);\r\n            },\r\n            remove: function (callback) {\r\n                var len = this.onFullScreenChange.length;\r\n                for (var i = 0; i < len; i++) {\r\n                    if (callback === this.onFullScreenChange[i]) {\r\n                        this.onFullScreenChange.splice(i, 1);\r\n                        i--;\r\n                        len--;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _mediaImpl: window.NDMediaPlayer,\r\n        _eventHandler: null,\r\n        create: function () {\r\n            var instance = $.extend({}, this);\r\n            instance._eventHandler = {\r\n                play: _emptyFunc,\r\n                pause: _emptyFunc,\r\n                ended: _emptyFunc,\r\n                timeupdate: _emptyFunc,\r\n                seeked: _emptyFunc,\r\n                volumeChange: _emptyFunc,\r\n                fullScreenChange: _emptyFunc\r\n            };\r\n            return instance;\r\n        },\r\n        render: function ($view, option) {\r\n            option.onPlay = this._eventHandler.play;\r\n            option.onPause = this._eventHandler.pause;\r\n            option.onEnd = this._eventHandler.ended;\r\n            option.onSeek = this._eventHandler.seeked;\r\n            option.onVolumeChange = this._eventHandler.volumeChange;\r\n            option.onTimeUpdate = this._eventHandler.timeupdate;\r\n            option.onFullScreenChange = this._eventHandler.fullScreenChange;\r\n            $view.find('audio').removeAttr('height');\r\n            $view.find('audio').removeAttr('width');\r\n            $view.find('audio').removeAttr('poster');\r\n            $view.find('video,audio').mediaelementplayer({});\r\n        },\r\n        renderImg: function ($img, option) {\r\n            // do nothing\r\n        },\r\n        mediaOnStart: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.play = callback;\r\n            }\r\n        },\r\n        mediaOnPause: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.pause = callback;\r\n            }\r\n        },\r\n        mediaOnEnded: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.ended = callback;\r\n            }\r\n        },\r\n        mediaOnTimeupdate: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.timeupdate = callback;\r\n            }\r\n        },\r\n        mediaOnVolumeChange: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.volumeChange = callback;\r\n            }\r\n        },\r\n        mediaOnSeeked: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.seeked = callback;\r\n            }\r\n        },\r\n        mediaPlay: function (mediaType, index) {\r\n            this._mediaImpl.mediaPlay(mediaType, index);\r\n        },\r\n        mediaPause: function (mediaType, index) {\r\n            this._mediaImpl.mediaPause(mediaType, index);\r\n        },\r\n        mediaPauseAll: function (obj) {\r\n            this._mediaImpl.mediaPauseAll(obj);\r\n        },\r\n        mediaSkip: function (mediaType, index, seeked) {\r\n            this._mediaImpl.mediaSkip(mediaType, index, seeked);\r\n        },\r\n        mediaVolumeChange: function (mediaType, index, volume, diaplay) {\r\n            this._mediaImpl.mediaVolumeChange(mediaType, index, volume, diaplay);\r\n        },\r\n        mediaOnFullScreenChange: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.fullScreenChange = callback;\r\n                this._fullChangeEvent.push(this._eventHandler.fullScreenChange);\r\n            }\r\n        },\r\n        destroy: function () {\r\n            this._fullChangeEvent.remove(this._eventHandler.fullScreenChange);\r\n        },\r\n        setLock:function(lock,view){\r\n            //TODO:\r\n        }\r\n    };\r\n\r\n\r\n    return mediaPlayer;\r\n});\r\n\ndefine('player/media/media', function () {\r\n    var lowVersionMediaPlayer = require('player/media/lowVersionMediaPlayer');\r\n    var defaultMediaPlayer = require('player/media/defaultMediaPlayer');\r\n    var ndMediaPlayer = require('player/media/ndMediaPlayer');\r\n    var Media = require('player/media/mediaApi');\r\n\r\n    //扩展media对象api\r\n    var extendMedia = function (media) {\r\n        var methods = [\r\n            'create', 'render', 'renderImg', 'mediaOnStart', 'mediaOnPause',\r\n            'mediaOnEnded', 'mediaOnTimeupdate', 'mediaOnSeeked', 'mediaOnVolumeChange',\r\n            'mediaPlay', 'mediaPause', 'mediaSkip', 'mediaVolumeChange', 'mediaOnFullScreenChange', 'mediaPauseAll', 'setLock'\r\n        ];\r\n        var method;\r\n        var isComplete = true;\r\n        for (var index = 0; index < methods.length; index++) {\r\n            method = methods[index];\r\n            if (!media[method] || $.type(media[method]) !== 'function') {\r\n                isComplete = false;\r\n                break;\r\n            }\r\n        }\r\n        if (isComplete) {\r\n            $.extend(Media, media);\r\n        } else {\r\n            throw 'QtiPlayer.extendMedia输入错误,请确认输入的对象是否有实现所有的api';\r\n        }\r\n    };\r\n\r\n    // qti内置的媒体播放器\r\n    if (typeof Audio == typeof undefined) {\r\n        extendMedia(lowVersionMediaPlayer);\r\n        //扩充渲染img接口\r\n        if (window.NDMediaPlayer) {\r\n            Media.renderImg = (function () {\r\n                var that = ndMediaPlayer;\r\n                return function () {\r\n                    var args = Array.prototype.slice.apply(arguments, [0]);\r\n                    return ndMediaPlayer.renderImg.apply(that, args);\r\n                }\r\n            })();\r\n        }\r\n    } else if (window.NDMediaPlayer) {\r\n        extendMedia(ndMediaPlayer);\r\n    } else {\r\n        extendMedia(defaultMediaPlayer);\r\n    }\r\n\r\n    return Media;\r\n});\r\n\ndefine('player/media/mediaApi', function () {\r\n    var Media = {\r\n        create: function () {\r\n        },\r\n        render: function ($view, option) {\r\n        },\r\n        renderImg: function ($view) {\r\n        },\r\n        mediaOnStart: function (callback) {\r\n        },\r\n        mediaOnPause: function (callback) {\r\n        },\r\n        mediaOnEnded: function (callback) {\r\n        },\r\n        mediaOnTimeupdate: function (callback) {\r\n        },\r\n        mediaOnVolumeChange: function (callback) {\r\n        },\r\n        mediaOnSeeked: function (callback) {\r\n        },\r\n        mediaPlay: function (mediaType, index) {\r\n        },\r\n        mediaPause: function (mediaType, index) {\r\n        },\r\n        mediaPauseAll: function () {\r\n        },\r\n        mediaSkip: function (mediaType, index, seeked) {\r\n        },\r\n        mediaVolumeChange: function (mediaType, index, volume, diaplay) {\r\n        },\r\n        mediaOnFullScreenChange: function (callback) {\r\n        },\r\n        destroy: function () {\r\n        },\r\n        setLock: function (lock, view) {\r\n        }\r\n    };\r\n    return Media;\r\n});\r\n\ndefine('player/media/ndMediaPlayer', function () {\r\n\r\n    var _emptyFunc = function () {\r\n    };\r\n\r\n    var mediaPlayer = {\r\n        _fullChangeEvent: {\r\n            onFullScreenChange: [],\r\n            trigger: function (isFull) {\r\n                this.onFullScreenChange.forEach(function (callback) {\r\n                    if (callback) {\r\n                        callback(isFull);\r\n                    }\r\n                })\r\n            },\r\n            push: function (callback) {\r\n                this.onFullScreenChange.push(callback);\r\n            },\r\n            remove: function (callback) {\r\n                var len = this.onFullScreenChange.length;\r\n                for (var i = 0; i < len; i++) {\r\n                    if (callback === this.onFullScreenChange[i]) {\r\n                        this.onFullScreenChange.splice(i, 1);\r\n                        i--;\r\n                        len--;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _mediaImpl: window.NDMediaPlayer,\r\n        _eventHandler: null,\r\n        create: function () {\r\n            var instance = $.extend({}, this);\r\n            instance._eventHandler = {\r\n                play: _emptyFunc,\r\n                pause: _emptyFunc,\r\n                ended: _emptyFunc,\r\n                timeupdate: _emptyFunc,\r\n                seeked: _emptyFunc,\r\n                volumeChange: _emptyFunc,\r\n                fullScreenChange: _emptyFunc\r\n            };\r\n            return instance;\r\n        },\r\n        render: function ($view, option) {\r\n            option.onPlay = this._eventHandler.play;\r\n            option.onPause = this._eventHandler.pause;\r\n            option.onEnd = this._eventHandler.ended;\r\n            option.onSeek = this._eventHandler.seeked;\r\n            option.onVolumeChange = this._eventHandler.volumeChange;\r\n            option.onTimeUpdate = this._eventHandler.timeupdate;\r\n            option.onFullScreenChange = this._eventHandler.fullScreenChange;\r\n            if (option && typeof Audio == typeof undefined) {\r\n                //ie8不渲染video\\audio\r\n                if (!option.video) {\r\n                    option.video = {};\r\n                }\r\n                option.video.render = false;\r\n                if (!option.audio) {\r\n                    option.audio = {}\r\n                }\r\n                option.audio.render = false;\r\n            }\r\n            option.lock = option.lockMedia;\r\n            this._mediaImpl.render($view, option);\r\n        },\r\n        renderImg: function ($img, option, lang,lock) {\r\n            var that = this;\r\n\r\n            var defaultOption = {\r\n                video: {\r\n                    render: false\r\n                },\r\n                audio: {\r\n                    render: false\r\n                },\r\n                img: {\r\n                    render: true,\r\n                    renderUI: true,\r\n                    renderImmediately: true\r\n                },\r\n                lang: lang,\r\n                lock: lock\r\n            };\r\n\r\n            defaultOption.onFullScreenChange = function (isFull) {\r\n                that._fullChangeEvent.trigger(isFull);\r\n            };\r\n\r\n            $.extend(defaultOption.img, option);\r\n\r\n            this._mediaImpl.renderMediaEle($img, defaultOption);\r\n        },\r\n        mediaOnStart: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.play = callback;\r\n            }\r\n        },\r\n        mediaOnPause: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.pause = callback;\r\n            }\r\n        },\r\n        mediaOnEnded: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.ended = callback;\r\n            }\r\n        },\r\n        mediaOnTimeupdate: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.timeupdate = callback;\r\n            }\r\n        },\r\n        mediaOnVolumeChange: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.volumeChange = callback;\r\n            }\r\n        },\r\n        mediaOnSeeked: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.seeked = callback;\r\n            }\r\n        },\r\n        mediaPlay: function (mediaType, index) {\r\n            this._mediaImpl.mediaPlay(mediaType, index);\r\n        },\r\n        mediaPause: function (mediaType, index) {\r\n            this._mediaImpl.mediaPause(mediaType, index);\r\n        },\r\n        mediaPauseAll: function (obj) {\r\n            this._mediaImpl.mediaPauseAll(obj);\r\n        },\r\n        mediaSkip: function (mediaType, index, seeked) {\r\n            this._mediaImpl.mediaSkip(mediaType, index, seeked);\r\n        },\r\n        mediaVolumeChange: function (mediaType, index, volume, diaplay) {\r\n            this._mediaImpl.mediaVolumeChange(mediaType, index, volume, diaplay);\r\n        },\r\n        mediaOnFullScreenChange: function (callback) {\r\n            if ($.type(callback) === 'function') {\r\n                this._eventHandler.fullScreenChange = callback;\r\n                this._fullChangeEvent.push(this._eventHandler.fullScreenChange);\r\n            }\r\n        },\r\n        destroy: function () {\r\n            this._fullChangeEvent.remove(this._eventHandler.fullScreenChange);\r\n        },\r\n        setLock: function (lock, view) {\r\n            this._mediaImpl.setLock(lock, view);\r\n        }\r\n    };\r\n\r\n    return mediaPlayer;\r\n});\r\n\ndefine('player/model/modelHandlerFactory', ['model/logger'], function (_logger) {\r\n\r\n    var modelHandlerFactory = {\r\n        _modelHandler: {},\r\n        _logger: _logger,\r\n        //值否支持该模型\r\n        isSupport: function (modelName) {\r\n            var result = false;\r\n            if (this._modelHandler[modelName]) {\r\n                result = true;\r\n            }\r\n            return result;\r\n        },\r\n        //注册modelHandler,每个model对应一种特定的AssessmentItem类型\r\n        register: function (modelHandler) {\r\n            if (modelHandler.getName && modelHandler.create) {\r\n                this._logger.debug('_modelHandlerFactory:regiser modelHandler:' + modelHandler.getName());\r\n                this._modelHandler[modelHandler.getName()] = modelHandler;\r\n            }\r\n        },\r\n        //获取model\r\n        getModelHandler: function (modelName) {\r\n            return this._modelHandler[modelName];\r\n        }\r\n    };\r\n    return modelHandlerFactory;\r\n});\r\n\ndefine('player/model/modelItem', ['model/logger', 'player/model/modelHandlerFactory'], function (_logger, _modelHandlerFactory) {\r\n\r\n    //定义ModelItem，负责每model的展示和数据存储\r\n    var ModelItem = {\r\n        _logger: _logger,\r\n        _modelHandlerFactory: _modelHandlerFactory,\r\n        _event: null,\r\n        _assessmentItem: null,\r\n        _model: null,\r\n        _option: null,\r\n        create: function (assessmentItem, model, event) {\r\n            var instance = $.extend({}, this);\r\n            //属性赋值\r\n            instance._model = model;\r\n            instance._assessmentItem = assessmentItem;\r\n            instance._event = event;\r\n            //创建渲染方法\r\n            var modelHandler = this._modelHandlerFactory.getModelHandler(instance._model.modelType);\r\n            if (modelHandler) {\r\n                modelHandler.create(instance);\r\n            } else {\r\n                this._logger.error('model:' + instance._model.modelType + '不存在');\r\n            }\r\n            return instance;\r\n        },\r\n        setOption: function (option) {\r\n            this._option = option;\r\n        },\r\n        getOption: function () {\r\n            return this._option;\r\n        },\r\n        triggerOptionClick: function (index, val) {\r\n            //index:每个modalitem内部答案的索引，默认0\r\n            var param = {\r\n                identifier: this._model.modelId,\r\n                index: index,\r\n                val: val\r\n            };\r\n            this._event.trigger('assessmentItem', 'optionClick', param);\r\n        },\r\n        hasNum: function () {\r\n            return true;\r\n        },\r\n        hasHint: function () {\r\n            return true;\r\n        },\r\n        hasTitle: function () {\r\n            return true;\r\n        },\r\n        isBlock: function () {\r\n            return true;\r\n        },\r\n        getName: function () {\r\n            return '';\r\n        },\r\n        getClassName: function () {\r\n            return '';\r\n        },\r\n        getLogger: function () {\r\n            return this._logger;\r\n        },\r\n        getModel: function () {\r\n            return $.extend(true, {}, this._model);\r\n        },\r\n        getAnswer: function () {\r\n            var answer = this._assessmentItem._answer[this._model.modelId].value;\r\n            var newAnswer = [];\r\n            newAnswer.pushArray(answer);\r\n            return newAnswer;\r\n        },\r\n        getStat: function () {\r\n            return this._assessmentItem._stat[this._model.modelId] || {};\r\n        },\r\n        getTitleExtras: function () {\r\n            return this._assessmentItem._titleExtras[this._model.modelId] || {};\r\n        },\r\n        getCorrectAnswer: function () {\r\n            var answer = [];\r\n            var correctAnswer = this._assessmentItem._itemModel.correctAnswer[this._model.modelId];\r\n            if (correctAnswer) {\r\n                answer.pushArray(correctAnswer.value);\r\n            }\r\n            return answer;\r\n        },\r\n        setAnswer: function (answer, reset) {\r\n            var currentAnswer = this._assessmentItem._answer[this._model.modelId].value;\r\n            //判断答案是否变化\r\n            var isChange = false;\r\n            var isEmpty = true;\r\n            if (answer) {\r\n                answer.forEach(function (an) {\r\n                    if (an !== '') {\r\n                        isEmpty = false;\r\n                    }\r\n                })\r\n            }\r\n            if (currentAnswer.length === 0 && isEmpty) {\r\n                isChange = false;\r\n            } else if (currentAnswer.length !== answer.length) {\r\n                isChange = true;\r\n            } else {\r\n                $(currentAnswer).each(function (i, v) {\r\n                    if (v !== answer[i]) {\r\n                        isChange = true;\r\n                        return false;\r\n                    }\r\n                });\r\n            }\r\n            //设置新答案\r\n            currentAnswer.clear();\r\n            if (answer) {\r\n                currentAnswer.pushArray(answer);\r\n            }\r\n            //触发答案变化事件\r\n            if (isChange) {\r\n                //判断答案是否正确\r\n                this._assessmentItem._checkModelAnswer(this._model.modelId, reset);\r\n                var answerTemp = $.extend(true, {}, this._assessmentItem._answer);\r\n                this._event.trigger('answer', 'change', answerTemp);\r\n            }\r\n        },\r\n        checkTextAnswer: function (correctValue, currentValue) {\r\n            return this._assessmentItem._checkTextAnswerValue(this._model.modelId, correctValue, currentValue);\r\n        },\r\n        showAnswer: function ($view) {\r\n            this._option.showAnswer = true;\r\n            this._option.showCorrectAnswer = false;\r\n            this._option.showCheckedAnswer = false;\r\n            this._option.showStatisAnswer = false;\r\n            if (this.renderReset) {\r\n                this.renderReset($view);\r\n            }\r\n            if (this.renderAnswer) {\r\n                this.renderAnswer($view);\r\n            }\r\n            if (this.renderLock) {\r\n                this.renderLock($view);\r\n            }\r\n        },\r\n        showCheckedAnswer: function ($view) {\r\n            this._option.showCorrectAnswer = true;\r\n            this._option.showAnswer = true;\r\n            this._option.showCheckedAnswer = true;\r\n            this._option.showStatisAnswer = true;\r\n            if (this.renderReset) {\r\n                this.renderReset($view);\r\n            }\r\n            if (this.renderCheckedAnswer) {\r\n                this.renderCheckedAnswer($view);\r\n            }\r\n            if (this.renderLock) {\r\n                this.renderLock($view);\r\n            }\r\n        },\r\n        showUsrAndCorrectAnswer: function ($view) {\r\n            this._option.showCorrectAnswer = true;\r\n            this._option.showAnswer = true;\r\n            this._option.showCheckedAnswer = false;\r\n            this._option.showStatisAnswer = false;\r\n            if (this.renderReset) {\r\n                this.renderReset($view);\r\n            }\r\n            // 显示用户答案\r\n            if (this.renderAnswer) {\r\n                this.renderAnswer($view);\r\n            }\r\n            // 显示正确答案\r\n            if (this.renderCorrectAnswer) {\r\n                this.renderCorrectAnswerNoneGrayBg($view);\r\n            }\r\n            if (this.renderLock) {\r\n                this.renderLock($view);\r\n            }\r\n        },\r\n        showCorrectAnswer: function ($view) {\r\n            this._option.showCorrectAnswer = true;\r\n            this._option.showAnswer = false;\r\n            this._option.showCheckedAnswer = false;\r\n            this._option.showStatisAnswer = false;\r\n            if (this.renderReset) {\r\n                this.renderReset($view);\r\n            }\r\n            if (this.renderCorrectAnswer) {\r\n                this.renderCorrectAnswer($view);\r\n            }\r\n            if (this.renderLock) {\r\n                this.renderLock($view);\r\n            }\r\n        },\r\n        showStatisAnswer: function ($view) {\r\n            this._option.showAnswer = false;\r\n            this._option.showCorrectAnswer = false;\r\n            this._option.showCheckedAnswer = false;\r\n            this._option.showStatisAnswer = true;\r\n            if (this.renderReset) {\r\n                this.renderReset($view);\r\n            }\r\n            if (this.renderStatisAnswer) {\r\n                this.renderStatisAnswer($view);\r\n            }\r\n            if (this.renderLock) {\r\n                this.renderLock($view);\r\n            }\r\n        },\r\n        reset: function ($view) {\r\n            this._option.showCorrectAnswer = false;\r\n            this._option.showAnswer = false;\r\n            this._option.showCheckedAnswer = false;\r\n            this._option.showStatisAnswer = false;\r\n\r\n            //重置当前用户答案\r\n            this.setAnswer([], true);\r\n\r\n            if (this.renderReset) {\r\n                var answer = this.renderReset($view);\r\n                if (answer) {\r\n                    this.setAnswer(answer);\r\n                }\r\n            }\r\n\r\n            this.setLock($view, false);\r\n        },\r\n        setLock: function ($view, lock) {\r\n            this._option.showLock = lock;\r\n            if (this.renderLock) {\r\n                this.renderLock($view);\r\n            }\r\n        },\r\n        isLock: function () {\r\n            return this._option.showLock || this._option.showCorrectAnswer || this._option.showCheckedAnswer;\r\n        }\r\n    };\r\n    return ModelItem;\r\n});\r\n\n// qti model\r\ndefine('player/utils/area', function () {\r\n\r\n\r\n    var area = {\r\n        getRectIntersectArea: function (rect1, rect2) {\r\n            var m = 0;\r\n            //左上角\r\n            if (rect1.l > rect2.l && rect1.l < rect2.r && rect1.t > rect2.t && rect1.t < rect2.b) {\r\n                m = (rect2.r - rect1.l) * (rect2.b - rect1.t);\r\n            }\r\n            //右上角\r\n            if (rect1.r > rect2.l && rect1.r < rect2.r && rect1.t > rect2.t && rect1.t < rect2.b) {\r\n                var s = (rect1.r - rect2.l) * (rect2.b - rect1.t);\r\n                if (s > m) {\r\n                    m = s;\r\n                }\r\n            }\r\n            //左下角\r\n            if (rect1.l > rect2.l && rect1.l < rect2.r && rect1.b > rect2.t && rect1.b < rect2.b) {\r\n                var s = (rect2.r - rect1.l) * (rect1.b - rect2.t);\r\n                if (s > m) {\r\n                    m = s;\r\n                }\r\n            }\r\n            //右下角\r\n            if (rect1.r > rect2.l && rect1.r < rect2.r && rect1.b > rect2.t && rect1.b < rect2.b) {\r\n                var s = (rect1.r - rect2.l) * (rect1.b - rect2.t);\r\n                if (s > m) {\r\n                    m = s;\r\n                }\r\n            }\r\n            //四个点都不相交\r\n            if (rect1.l < rect2.l && rect1.r > rect2.r && rect1.t > rect2.t && rect1.b < rect2.b) {\r\n                var s = (rect2.r - rect2.l) * (rect1.b - rect1.t);\r\n                if (s > m) {\r\n                    m = s;\r\n                }\r\n            }\r\n            return m;\r\n        },\r\n        getInteractRect: function (l, t, h, w, targetRects) {\r\n            var that = this;\r\n            var rects,\r\n                max = 0,\r\n                matchCount = 0,\r\n                matchIndex;\r\n\r\n            targetRects.forEach(function (rect, i) {\r\n\r\n                //计算面积\r\n                var m = that.getRectIntersectArea({\r\n                    l: l,\r\n                    t: t,\r\n                    r: l + w,\r\n                    b: t + h\r\n                }, rect);\r\n                var cm = that.getRectIntersectArea(rect, {\r\n                    l: l,\r\n                    t: t,\r\n                    r: l + w,\r\n                    b: t + h\r\n                });\r\n\r\n                if (cm > m) {\r\n                    m = cm;\r\n                }\r\n\r\n                if (m > 0) {\r\n                    matchCount++;\r\n                }\r\n\r\n                if (m > max) {\r\n                    max = m;\r\n                    matchIndex = i;\r\n                }\r\n            });\r\n\r\n            //匹配区域超过1个且匹配度不高，按最高匹配\r\n            if (matchCount > 1) {\r\n                rects = targetRects[matchIndex];\r\n            } else if (max >= ((w * h * 2) / 5)) {\r\n                rects = targetRects[matchIndex];\r\n            }\r\n            return rects;\r\n        },\r\n        //点到线的距离\r\n        pointToLine: function (x1, y1, x2, y2, x0, y0) {\r\n            var space = 0;\r\n            var a, b, c;\r\n            a = this.lineSpace(x1, y1, x2, y2);// 线段的长度\r\n            b = this.lineSpace(x1, y1, x0, y0);// (x1,y1)到点的距离\r\n            c = this.lineSpace(x2, y2, x0, y0);// (x2,y2)到点的距离\r\n            if (c <= 0.000001 || b <= 0.000001) {\r\n                space = 0;\r\n                return space;\r\n            }\r\n            if (a <= 0.000001) {\r\n                space = b;\r\n                return space;\r\n            }\r\n            if (c * c >= a * a + b * b) {\r\n                space = b;\r\n                return space;\r\n            }\r\n            if (b * b >= a * a + c * c) {\r\n                space = c;\r\n                return space;\r\n            }\r\n            var p = (a + b + c) / 2;// 半周长\r\n            var s = Math.sqrt(p * (p - a) * (p - b) * (p - c));// 海伦公式求面积\r\n            space = 2 * s / a;// 返回点到线的距离（利用三角形面积公式求高）\r\n            return space;\r\n        },\r\n        // 计算两点之间的距离\r\n        lineSpace: function (x1, y1, x2, y2) {\r\n            var lineLength = Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\r\n            return lineLength;\r\n        }\r\n    };\r\n    return area;\r\n\r\n});\r\n\n// qti model\r\ndefine('player/utils/browser', function () {\r\n\r\n    var userAgent = window.navigator.userAgent.toLowerCase();\r\n\r\n    // Figure out what browser is being used\r\n    jQuery.browser = {\r\n        version: (userAgent.match(/.+(?:rv|it|ra|ie)[\\/: ]([\\d.]+)/) || [])[1],\r\n        safari: /webkit/.test(userAgent),\r\n        opera: /opera/.test(userAgent),\r\n        msie: /msie/.test(userAgent) && !/opera/.test(userAgent),\r\n        mozilla: /mozilla/.test(userAgent) && !/(compatible|webkit)/.test(userAgent)\r\n    };\r\n\r\n    var browser = {\r\n        Android: function () {\r\n            return navigator.userAgent.match(/Android/i) ? true : false;\r\n        },\r\n        BlackBerry: function () {\r\n            return navigator.userAgent.match(/BlackBerry/i) ? true : false;\r\n        },\r\n        iOS: function () {\r\n            return navigator.userAgent.match(/iPhone|iPad|iPod/i) ? true : false;\r\n        },\r\n        Windows: function () {\r\n            return navigator.userAgent.match(/IEMobile/i) ? true : false;\r\n        },\r\n        any: function () {\r\n            return (this.Android() || this.BlackBerry() || this.iOS() || this.Windows());\r\n        },\r\n        Mobile: function () {\r\n            return (this.Android() || this.BlackBerry() || this.iOS() || this.Windows());\r\n        },\r\n        IEVersion: function () {\r\n            var engine = 999999;\r\n            if (window.navigator.appName == \"Microsoft Internet Explorer\" || window.navigator.appVersion.indexOf('MSIE') > 0) {\r\n                // This is an IE browser. What mode is the engine in?\r\n                if (document.documentMode) {\r\n                    // IE8\r\n                    engine = document.documentMode;\r\n                }\r\n                else // IE 5-7\r\n                {\r\n                    engine = 5; // Assume quirks mode unless proven otherwise\r\n                    if (document.compatMode) {\r\n                        if (document.compatMode == \"CSS1Compat\")\r\n                            engine = 7; // standards mode\r\n                    }\r\n                }\r\n                // the engine variable now contains the document compatibility mode.\r\n            } else {\r\n                var isIE11 = (/Trident\\/7\\./).test(navigator.userAgent);\r\n                if (isIE11) {\r\n                    engine = 11;\r\n                }\r\n            }\r\n            return engine;\r\n        },\r\n        isIE:function(){\r\n            return this.IEVersion() != 999999;\r\n        }\r\n    };\r\n\r\n\r\n    return browser;\r\n\r\n});\r\n\n// qti model\r\ndefine('player/utils/checkOption', ['player/config/skin', 'player/config/platform'], function (_skin, _platform) {\r\n\r\n    var checkOption = function (option) {\r\n        if (option && $.type(option) === 'object') {\r\n            option = $.extend({}, option);\r\n            //删除null,undefined项\r\n            for (var name in option) {\r\n                if (option[name] === null || option[name] === undefined) {\r\n                    delete option[name];\r\n                }\r\n            }\r\n            //用户输入answer相关渲染参数处理\r\n            //处理逻辑:1、用户输入的答案渲染参数只能有一个为true，如果有多个true，按照以下顺序，保留第一个为true，其他赋值为false;\r\n            //2、如果用户输入的参数全为false，或则没有输入任何参数，则hideAnswerArea为true，其他都为false\r\n            var answerOptions = ['showAnswerArea', 'showAnswer', 'showCheckedAnswer', 'showCorrectAnswer', 'showStatisAnswer', 'hideAnswerArea'];\r\n            var optionName;\r\n            //判断是否有答案渲染项配置,如果没有定义答案渲染项\r\n            var hasAnswerOption = false;\r\n            for (var index = 0; index < answerOptions.length; index++) {\r\n                optionName = answerOptions[index];\r\n                if (option[optionName] !== undefined) {\r\n                    //有答案渲染选项\r\n                    hasAnswerOption = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (hasAnswerOption) {\r\n                //如果有答案渲染配置，判断是否有为true的答案渲染选项,保证只有一个渲染项为true\r\n                var hasTrueAnswerOption = false;\r\n                for (var index = 0; index < answerOptions.length; index++) {\r\n                    optionName = answerOptions[index];\r\n                    if (option[optionName] && hasTrueAnswerOption === false) {\r\n                        hasTrueAnswerOption = true;\r\n                        option[optionName] = true;\r\n                    } else {\r\n                        option[optionName] = false;\r\n                    }\r\n                }\r\n                //如果有答案渲染项，但是所有渲染都为false，则隐藏答案渲染\r\n                if (hasTrueAnswerOption === false) {\r\n                    option.hideAnswerArea = true;\r\n                }\r\n            }\r\n            //处理复合小题单独渲染参数\r\n            if (option.modelId && $.type(option.modelId) !== 'array') {\r\n                option.modelId = [];\r\n            }\r\n            //处理随机渲染参数\r\n            if (option.randomSeed && $.type(option.randomSeed) !== 'array') {\r\n                option.randomSeed = [];\r\n            }\r\n\r\n            if (option.platForm) {\r\n                var platForm = _platform[option.platForm];\r\n                option.platForm = platForm || '';\r\n            }\r\n            if (option.lang && $.type(option.lang) === 'string') {\r\n                option.lang = option.lang.toLowerCase();\r\n            }\r\n\r\n            //重置主题和平台\r\n            if (!option.skin && option.theme) {\r\n                option.skin = option.theme;\r\n            }\r\n            if (option.skin) {\r\n                //增加是否是elearning参数的判断\r\n                option.isElearningSkin = (option.skin === 'elearning');\r\n                var skinCls = _skin[option.skin];\r\n                option.skin = skinCls || _skin.wood;\r\n            }else{\r\n                option.skin = _skin.wood;\r\n            }\r\n\r\n\r\n        } else {\r\n            option = {};\r\n        }\r\n        return option;\r\n    };\r\n\r\n    return checkOption;\r\n\r\n});\r\n\n// qti model\r\ndefine('player/utils/dom', function () {\r\n\r\n\r\n    var dom = {\r\n        getParentElement: function ($el, className) {\r\n            //$el = $el.parent();\r\n            while (!$el.hasClass(className) && $el[0].nodeName.toLocaleLowerCase() != \"body\") {\r\n                $el = $el.parent();\r\n            }\r\n            return $el;\r\n        },\r\n        toCenter: function (obj) {\r\n            var screenHeight = 0;\r\n            if (window.innerHeight)\r\n                screenHeight = window.innerHeight;\r\n            else if ((document.body) && (document.body.clientHeight))\r\n                screenHeight = document.body.clientHeight;\r\n            if (document.documentElement && document.documentElement.clientHeight) {\r\n                screenHeight = document.documentElement.clientHeight;\r\n            }\r\n            var scrolltop = $(document).scrollTop();//获取当前窗口距离页面顶部高度\r\n            var objTop = (screenHeight - obj.height()) / 2 + scrolltop;\r\n            if (objTop < 0) {\r\n                objTop = 50;\r\n            }\r\n            $(obj).css(\"top\", objTop + \"px\");\r\n            $(obj).css(\"position\", \"absolute\");\r\n            $(obj).show();\r\n        },\r\n        addListener: function (target, type, handler) {\r\n            if (target.addEventListener) {\r\n                target.addEventListener(type, handler, false);\r\n            } else if (target.attachEvent) {\r\n                target.attachEvent(\"on\" + type, handler);\r\n            } else {\r\n                target[\"on\" + type] = handler;\r\n            }\r\n        },\r\n        allowNumKeyCodes: [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 110, 109, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 108, 190, 8, 37, 38, 40, 39, 46, 189],\r\n        allowNumKeyDown: function () {\r\n            var eventKeyCode = event.keyCode;\r\n            if (event.shiftKey) {\r\n                eventKeyCode = 0;\r\n            }\r\n            var input = event.srcElement || event.target;\r\n            var txtVal = input.value;\r\n            var result = false;\r\n            for (var i = 0; i < this.allowNumKeyCodes.length; i++) {\r\n                var keyCode = this.allowNumKeyCodes[i];\r\n                if (eventKeyCode === keyCode) {\r\n                    if (eventKeyCode == 109 || eventKeyCode == 189) {//负号\r\n                        if (txtVal.length == 0) {\r\n                            input.value = '';\r\n                            result = true;\r\n                        } else {\r\n                            result = !(txtVal.toString().indexOf('-') > -1);\r\n                        }\r\n                    } else if (eventKeyCode == 190 || eventKeyCode == 110) {//小数点\r\n                        if (txtVal.length == 0) {\r\n                            input.value = '';\r\n                        }\r\n                        result = !(txtVal.toString().indexOf('.') > -1);\r\n                    } else {\r\n                        result = true;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n            input.setAttribute(\"key-result\", result + \"|\" + eventKeyCode + \"|\" + event.ctrlKey);\r\n            return result;\r\n        },\r\n        allowNumInput: function () {\r\n            var input = event.srcElement || event.target;\r\n            var keydown = input.getAttribute(\"key-result\");\r\n            var inputResults = keydown != null ? keydown.split('|') : [];\r\n            if (inputResults.length < 3) {//黏贴\r\n                if (input.value == '') {\r\n                    input.value = '';\r\n                }\r\n                return false;\r\n            }\r\n            if (input.value.length > 0) {\r\n                return;\r\n            }\r\n            var keyResult = inputResults[0],\r\n                eventKeyCode = inputResults[1],\r\n                ctrl = inputResults[2],\r\n                inputPreVal = input.getAttribute(\"pre-v\") || '';\r\n\r\n            if (keyResult == \"true\" || ctrl == \"true\") {\r\n                if (inputPreVal != \"\" && input.value == \"\" && eventKeyCode != 37 && eventKeyCode != 39 && eventKeyCode != 8 && eventKeyCode != 46 && eventKeyCode != 38 && eventKeyCode != 40 && !(ctrl && eventKeyCode == 88)) {\r\n                    input.value = inputPreVal;\r\n                } else if (ctrl && eventKeyCode == 86) {\r\n                    input.value = input.value;\r\n                }\r\n                input.setAttribute(\"pre-v\", input.value);\r\n            } else {\r\n                input.value = inputPreVal;\r\n            }\r\n            input.setAttribute('key-result', '');\r\n            return false;\r\n        },\r\n        getCursorPos: function ($dom) {\r\n            var el = $dom.get(0);\r\n            var pos = 0;\r\n            if ('selectionStart' in el) {\r\n                pos = el.selectionStart;\r\n            } else if ('selection' in document) {\r\n                el.focus();\r\n                var Sel = document.selection.createRange();\r\n                var SelLength = document.selection.createRange().text.length;\r\n                Sel.moveStart('character', -el.value.length);\r\n                pos = Sel.text.length - SelLength;\r\n            }\r\n            return pos;\r\n        },\r\n        //兼容ie11和ff的方法\r\n        getSelectedText: function () {\r\n            var selText = \"\";\r\n            if (window.getSelection) {  // all browsers, except IE before version 9\r\n                var sel = document.activeElement;\r\n                if (sel &&\r\n                    (sel.tagName.toLowerCase() == \"textarea\" ||\r\n                    (sel.tagName.toLowerCase() == \"input\" &&\r\n                    ((sel.getAttribute(\"type\").toLowerCase() == \"text\")||sel.getAttribute(\"type\").toLowerCase() == \"number\")))) {\r\n                    var text = sel.value;\r\n                    selText = text.substring(\r\n                        sel.selectionStart,\r\n                        sel.selectionEnd\r\n                    );\r\n                }\r\n                else {\r\n                    var selRange = window.getSelection();\r\n                    selText = selRange.toString();\r\n                }\r\n            } else {\r\n                if (document.getSelection) {  // all browsers, except IE before version 9\r\n                    range = document.getSelection();\r\n                    selText = range.toString();\r\n                } else if (document.selection.createRange) { // IE below version 9\r\n                    var range = document.selection.createRange();\r\n                    selText = range.text;\r\n                }\r\n            }\r\n            return selText;\r\n        },\r\n        inputNumberKeydown: function ($input, e) {\r\n            var val = $input.val();\r\n            var eventKeyCode = e.keyCode;\r\n            var result = true;\r\n            var cursorPos = this.getCursorPos($input);\r\n            var selectText = this.getSelectedText();\r\n            var selectTextLength = selectText.length;\r\n\r\n            if (eventKeyCode == 109 || eventKeyCode == 189) {//负号\r\n                if (val.length == 0) {\r\n                    $input.val('');\r\n                    result = true;\r\n                } else {\r\n                    result = (val.toString().indexOf('-') <= -1)\r\n                        || selectText.indexOf('-') >= 0;\r\n                }\r\n            } else if (eventKeyCode == 190 || eventKeyCode == 110) {//小数点\r\n                if (val.length == 0) {\r\n                    $input.val('')\r\n                }\r\n\r\n                var index = val.toString().indexOf('.');\r\n                result = (index <= -1) || selectText.indexOf('.') >= 0;\r\n            } else {\r\n                result = true;\r\n            }\r\n            if (!result) {\r\n                return false;\r\n            }\r\n\r\n\r\n            //allow first letter\r\n            if ((val === '' || this.getCursorPos($input) === 0)\r\n                && (e.keyCode === 189 || e.keyCode === 109 )\r\n                && val.indexOf('-') < 0\r\n                || (val.substring(0, 1) === '-'\r\n                && cursorPos === 0\r\n                && selectTextLength > 0\r\n                && (e.keyCode === 189 || e.keyCode === 109 ))\r\n            ) {\r\n                return;\r\n            }\r\n            var index = val.indexOf('.');\r\n\r\n            // Allow: backspace, delete, tab, escape, enter and .\r\n            if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||\r\n                    // Allow: Ctrl+A, Command+A\r\n                (e.keyCode == 65 && ( e.ctrlKey === true || e.metaKey === true ) ) ||\r\n                    // Allow: home, end, left, right, down, up\r\n                (e.keyCode >= 35 && e.keyCode <= 40)) {\r\n                // let it happen, don't do anything\r\n                return;\r\n            }\r\n            //不允许在-号前输入字符\r\n            if (val.substring(0, 1) === '-'\r\n                && this.getCursorPos($input) === 0 && selectTextLength <= 0\r\n                && (e.keyCode !== 189 || e.keyCode !== 109)) {\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n            // Ensure that it is a number and stop the keypress\r\n            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    return dom;\r\n\r\n});\r\n\n// qti model\r\ndefine('player/utils/extendUtils', ['model/utils', 'player/config/lang', 'player/utils/checkOption', 'player/config/platForm'],\r\n    function (_utils, _lang, _checkOption, _platForm) {\r\n\r\n        var random = require('player/utils/random');\r\n        var img = require('player/utils/img');\r\n        var svg = require('player/utils/svg');\r\n        var area = require('player/utils/area');\r\n        var dom = require('player/utils/dom');\r\n        var browser = require('player/utils/browser');\r\n\r\n\r\n        _utils.getPlatForm = function () {\r\n            return _platForm;\r\n        };\r\n\r\n        //获取国际化参数值\r\n        _utils.getLangText = function (key, option) {\r\n            var lang = _lang[option.lang] ? _lang[option.lang] : _lang['zh'];\r\n            var result = lang[key];\r\n            if (result === null || result === undefined || result === '') {\r\n                result = '';\r\n            }\r\n            return result;\r\n        };\r\n\r\n        _utils.checkOption = _checkOption;\r\n\r\n        //扩展\r\n        _utils.Svg = svg;\r\n\r\n        _utils.Img = img;\r\n\r\n        _utils.Rd = random;\r\n\r\n        _utils.Area = area;\r\n\r\n        _utils.Dom = dom;\r\n\r\n        _utils.Broswer = browser;\r\n\r\n        return _utils;\r\n\r\n    });\r\n\ndefine('player/utils/imageLoader', ['model/logger', 'player/utils/extendUtils'], function (_logger, _utils) {\r\n\r\n    var Media = require('player/media/media');\r\n    var _emptyFunc=function(){};\r\n\r\n    //图片加载器\r\n    var ImageLoader = {\r\n        _waitingQueue: null,\r\n        _loadQueue: null,\r\n        _loadingIconData: null, //加载时显示图片\r\n        _imageLoaderPool: null,\r\n        _emptyIconData: null,\r\n        _errorIconData: null, //加载错误显示图片\r\n        _imageRegex: /<img([\\s\\S]*?)\\/>/g,\r\n        _srcRegex: /src=\"([\\s\\S]*?)\"/,\r\n        _widthRegex: /width=\"([\\s\\S]*?)\"/,\r\n        _heightRegex: /height=\"([\\s\\S]*?)\"/,\r\n        _dataClassRegex: /data-class=\"([\\s\\S]*?)\"/,\r\n        _dataWidthRegex: /data-width=\"([\\s\\S]*?)\"/,\r\n        _dataHeightRegex: /data-height=\"([\\s\\S]*?)\"/,\r\n        _lazyLoadRegex: /data-lazy-load=\"(true|false)\"/,\r\n        _renderMediaImgRegex: /data-media-img-render=([\"'])([\\s\\S]*?)\\1/, //默认使用多媒体渲染图片 {render:'true',renderUi:'false'} |true|false\r\n        _loadingImageStart: false,\r\n        _imageIndex: 0,\r\n        _imageLoaderMaxNum: 6,\r\n        create: function () {\r\n            var instance = $.extend({}, this);\r\n            instance._waitingQueue = [];\r\n            instance._loadQueue = [];\r\n            instance._emptyIconData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=';\r\n            instance._errorIconData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADKUlEQVRIS6WVX0hTcRTHv2eba//UVuhLVBD5FAhRIJVNLZAoFAOF/hDOUIqiMiRRJIQso6QgJYTqYWXoQ1YK+hJhcyhUEBTRQ+JT9JKG+W+bTHdP5+76b7rNW56ny73nnM/5nnN+v0vQaQwYkGVPi7h/8I8SoOgJFT99xnmWHJCxSbyFFb5GfTM+PZG6AJwNJ5Lsz0F0VEvKPeOK/4zTi/G1IPoALttZGOmhACxafg6Kjgvk9XvWDeD9lu3YYOyU5HujkrHyEbNcQgPBH4kgCRVEBptjq5Pq66ViI5SwlstgBAhhKFwPb+B2ooEnBrhsu2EydEpLdiB1E5B7XAN4XwMTY/JAw6KimAb8X+KpiAvgXTAjzdEsGs4hPAcUVYAv3YvkoZYqoOsxYDSpO9WKkelK+oZQLEh8gMueDxO1S9BmzAnAXQMuq9cAngbA07gA+C0KT8rA3+oGjO1BqjPZ1gaDoSASpCooKANXNkt2AjVfXVKgfleUbkwFSukTJlZCYirgXEupHKpWSWaNBKjD3XcEfP2ZBrjpBgZ7tWFHjAMy8vPU729bE8Au61bZmhcgQ9aisyK3QkYmuKlH3R5QdSHw/bMADEv5FLwXqSXkDf5cDolSIGtJyLPVSpU35HGhPClQAGlbwA/eqBMAXckHRiUPLQOAZW1RB6//riSVVJpFAw6aM2Eyv5S3O6OksvinOMGNnVK1AGqKgUlZU2nXChvCXKiYfKGvqwCRtUy33ZeqLq7aBhVgsYJrn2gzaCwHZgKxAKraFkwGqmTgs1EK5LY8LHvXIQm0KzmWueu0t55bcV2EMIIwnaD+6XeLAM5CCuwOj7yYP6or4lUFyRuBY6Xah96nwJRcpKtbpH1nvEJo2k2DmIo0kV320zDhkUTYYpamnoPCcvDlZSe5W9qlnuSYxn7Z7QrqC3YQZ1u3IcnYLoM9EFf3PwPUqpUBhPkUca6jAQaulurNcQHzWwRXkebi65It+hO/RVqfQnKF3CE+ZP8lnukJpjbfV5lD1HWt51/FIwJwDEmGjDUB/+PAyrC0yJot2+CSySf9T464MSTngNmnR+e6uH8BvXgVNfoEydIAAAAASUVORK5CYII=';\r\n            instance._loadingIconData = 'data:image/png;base64,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';\r\n            instance._imageLoaderPool = [];\r\n            var poolNum = 0;\r\n            while (poolNum < instance._imageLoaderMaxNum) {\r\n                instance._imageLoaderPool.push(new Image());\r\n                poolNum++;\r\n            }\r\n            return instance;\r\n        },\r\n        _getImageLoader: function () {\r\n            return this._imageLoaderPool.shift();\r\n        },\r\n        _returnImageLoader: function (imageLoader) {\r\n            imageLoader.onerror = _emptyFunc;\r\n            imageLoader.onload = _emptyFunc;\r\n            imageLoader.src = this._emptyIconData;\r\n            this._imageLoaderPool.push(imageLoader);\r\n        },\r\n        parseImage: function ($view, html, option) {\r\n            var that = this;\r\n            var resultHtml = html.replace(that._imageRegex, function (imageInfo) {\r\n                var src = _utils.getValue(imageInfo, that._srcRegex);\r\n                var result = '';\r\n                if (src !== '') {\r\n                    var lazyLoad = _utils.getValue(imageInfo, that._lazyLoadRegex);\r\n                    if (lazyLoad === 'false') {\r\n                        result = imageInfo;\r\n                    } else {\r\n                        var imageId = 'qp-loading-image-' + that._imageIndex;\r\n                        var clazz = _utils.getValue(imageInfo, that._dataClassRegex);\r\n\r\n                        var width = parseInt(_utils.getValue(imageInfo, that._dataWidthRegex));\r\n                        if (!width) {\r\n                            width = parseInt(_utils.getValue(imageInfo, that._widthRegex));\r\n                            if (!width) {\r\n                                width = 0;\r\n                            }\r\n                        }\r\n                        var height = parseInt(_utils.getValue(imageInfo, that._dataHeightRegex));\r\n                        if (!height) {\r\n                            height = parseInt(_utils.getValue(imageInfo, that._heightRegex));\r\n                            if (!height) {\r\n                                height = 0;\r\n                            }\r\n                        }\r\n\r\n                        var renderImgOption = _utils.getValue(imageInfo, that._renderMediaImgRegex, 2);\r\n                        if (!option.thumbnailEnable) {\r\n                            renderImgOption = false;\r\n                        }\r\n                        result = '<img class=\"' + imageId + ' ' + clazz + '\" '\r\n                            + 'data-src=\"' + src + '\" '\r\n                            + 'data-media-img-render=\\'' + renderImgOption + '\\' '\r\n                            + 'data-lang=\"' + option.lang + '\" '\r\n                            + 'data-lockmedia=\"' + option.lockMedia + '\" '\r\n                            + 'src=\"' + that._loadingIconData + '\" />';\r\n\r\n                        that._imageIndex++;\r\n                        that._waitingQueue.push({\r\n                            $view: $view,\r\n                            imageId: imageId,\r\n                            src: src,\r\n                            width: width,\r\n                            height: height\r\n                        });\r\n                    }\r\n                }\r\n                return result;\r\n            });\r\n            return resultHtml;\r\n        },\r\n        _renderMediaImg: function ($img, width, height) {\r\n            //超过大小的使用media插件渲染\r\n            var that = this;\r\n            var minHeight = 180;\r\n            var minWidth = 260;\r\n            //默认使用多媒体组件渲染图片\r\n            var renderOption = $img.data('media-img-render');\r\n            var lang = $img.data('lang');\r\n            var lockMedia = $img.data('lockmedia');\r\n            var renderMediaImg = !(renderOption === false);\r\n            if (typeof renderOption === 'object') {\r\n                minWidth = renderOption.minWidth;\r\n                minHeight = renderOption.minHeight;\r\n            }\r\n\r\n            if ($img[0] && renderMediaImg && $img[0].parentNode && (width > minWidth || height > minHeight)) {\r\n\r\n                Media.renderImg($img[0], typeof renderOption === 'object' ? renderOption : {}, lang,lockMedia);\r\n                return true;\r\n            }\r\n            return false;\r\n        },\r\n        _loadImage: function () {\r\n            var that = this;\r\n            //执行图片加载\r\n            var imageHandler = function (targetImageInfo, imageLoader) {\r\n                imageLoader.onerror = function () {\r\n                    //加载错误\r\n                    //返回图片加载对象\r\n                    //显示默认错误图片\r\n                    that._returnImageLoader(imageLoader);\r\n                    targetImageInfo.$image[0].src = that._errorIconData;\r\n                };\r\n                imageLoader.onload = function () {\r\n                    //图片加载成功，开始往目标位置渲染图片\r\n                    //图片实际高宽\r\n                    var imageWidth = this.width;\r\n                    var imageHeight = this.height;\r\n                    //目标显示高宽\r\n                    var targetWidth = targetImageInfo.width;\r\n                    var targetHeight = targetImageInfo.height;\r\n                    //先将目标位置图片改为透明图片\r\n                    if (targetImageInfo.$image.length > 0) {\r\n                        targetImageInfo.$image[0].src = that._emptyIconData;\r\n                        var newWidth = 0;\r\n                        var newHeight = 0;\r\n                        //调整目标位置图片的额实际高宽\r\n                        if (targetWidth && targetHeight) {\r\n                            newWidth = targetWidth;\r\n                            newHeight = targetHeight;\r\n                            //如果有目标显示高宽\r\n                            if (imageWidth > targetWidth || imageHeight > targetHeight) {\r\n                                //如果图片实际高宽大于目标高宽，则根据比例缩小\r\n                                var wc = imageWidth / targetWidth;\r\n                                var hc = imageHeight / targetHeight;\r\n                                if (wc > hc) {\r\n                                    newHeight = parseInt(imageHeight / wc);\r\n                                    newWidth = targetWidth;\r\n                                } else {\r\n                                    newHeight = targetHeight;\r\n                                    newWidth = parseInt(imageWidth / hc);\r\n                                }\r\n                                targetImageInfo.$image.attr('width', newWidth);\r\n                                targetImageInfo.$image.attr('height', newHeight);\r\n                            }\r\n                            //目标位置加载图片\r\n                            targetImageInfo.$image[0].src = targetImageInfo.src;\r\n                        } else {\r\n                            //目标位置加载图片\r\n                            targetImageInfo.$image[0].src = targetImageInfo.src;\r\n                            newWidth = imageWidth;\r\n                            newHeight = imageHeight;\r\n                            //没有显示指定期望宽高的直接使用多媒体渲染\r\n                            if (targetWidth) {\r\n                                targetImageInfo.$image.attr('width', targetWidth);\r\n                            }\r\n                            if (targetHeight) {\r\n                                targetImageInfo.$image.attr('height', targetHeight);\r\n                            }\r\n                        }\r\n                        that._renderMediaImg(targetImageInfo.$image, newWidth, newHeight);\r\n                    }\r\n                    //返回图片加载对象\r\n                    that._returnImageLoader(imageLoader);\r\n                };\r\n                imageLoader.src = targetImageInfo.src;\r\n            };\r\n            var loadingImageHandler = function () {\r\n                //触发加载图片\r\n                var imageInfo = that._loadQueue.shift();\r\n                var imageLoader;\r\n                while (imageInfo) {\r\n                    //有等待加载的图片\r\n                    imageLoader = that._imageLoaderPool.shift();\r\n                    if (imageLoader) {\r\n                        //有空闲图片加载对象,则开始加载\r\n                        imageHandler(imageInfo, imageLoader);\r\n                        //获取下一个等待加载的图片\r\n                        imageInfo = that._loadQueue.shift();\r\n                    } else {\r\n                        //没有空闲图片加载对象，待加载图片放会加载队列\r\n                        that._loadQueue.unshift(imageInfo);\r\n                        //结束本次加载\r\n                        imageInfo = null;\r\n                    }\r\n                }\r\n                //判断是否还有图片未加载\r\n                if (that._loadQueue.length > 0) {\r\n                    //图片未加载完，触发下次加载\r\n                    setTimeout(loadingImageHandler, 500);\r\n                } else {\r\n                    that._loadingImageStart = false;\r\n                }\r\n            };\r\n            //player是多示例，共用一个ImageLoader示例，多次运行加载图片任务，保证只有一个定时加载任务执行\r\n            if (that._loadingImageStart === false && that._loadQueue.length > 0) {\r\n                that._loadingImageStart = true;\r\n                loadingImageHandler();\r\n            }\r\n        },\r\n        load: function () {\r\n            var that = this;\r\n            var imageInfo;\r\n            var waitingQueueTemp = that._waitingQueue;\r\n            that._waitingQueue = [];\r\n            //初始化等待加载队列中的图片数据\r\n            for (var index = 0; index < waitingQueueTemp.length; index++) {\r\n                imageInfo = waitingQueueTemp[index];\r\n                imageInfo.$image = imageInfo.$view.find('.' + imageInfo.imageId);\r\n                if (imageInfo.$image.length === 1) {\r\n                    //带加载图片对象存在，将图片移动到加载队列\r\n                    this._loadQueue.push(imageInfo);\r\n                }\r\n            }\r\n            //触发加载图片\r\n            that._loadImage();\r\n        }\r\n    };\r\n\r\n    //实例化图片加载器,全局单例\r\n    var _imageLoader = ImageLoader.create();\r\n    return _imageLoader;\r\n});\r\n\n// qti model\r\ndefine('player/utils/img', function () {\r\n\r\n\r\n    var img = {\r\n        PreLoadingImg: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjFFQjM3Q0UzNDAxRDExRTFCMDY2RjdDNTdFQjYzRUM1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjFFQjM3Q0U0NDAxRDExRTFCMDY2RjdDNTdFQjYzRUM1Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MUVCMzdDRTE0MDFEMTFFMUIwNjZGN0M1N0VCNjNFQzUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MUVCMzdDRTI0MDFEMTFFMUIwNjZGN0M1N0VCNjNFQzUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4pDOh4AAAABlBMVEX///8AAABVwtN+AAAAAXRSTlMAQObYZgAAABhJREFUeNpiYBgFo2AUjIJRMApoBwACDAAGaAABg+4RpgAAAABJRU5ErkJggg==\",\r\n\r\n        resizeImage: function (imgElement, url, maxWidth, maxHeight) {\r\n            var $imgElement = $(imgElement);\r\n            var dataLoad = $imgElement.attr(\"data-load\");\r\n            if ('true' != dataLoad) {\r\n                var callback = function () {\r\n\r\n                    //imgElement.src = url;\r\n                    var scale = 1,\r\n                        w = img.width,\r\n                        h = img.height;\r\n                    if (img.width > maxWidth) {\r\n                        w = maxWidth;\r\n                        h = img.height * (w / img.width);\r\n                    }\r\n                    if (h > maxHeight) {\r\n                        h = maxHeight;\r\n                        w = img.width * (h / img.height);\r\n                    }\r\n                    $imgElement.attr(\"src\", url);\r\n                    $imgElement.attr(\"width\", w + \"px\");\r\n                    $imgElement.attr(\"height\", h + \"px\");\r\n                    $imgElement.attr(\"data-load\", true);\r\n                };\r\n\r\n                var img = new Image();\r\n                img.src = url;\r\n                if (img.complete) {\r\n                    callback(img.width, img.height);\r\n                } else {\r\n                    img.onload = function () {\r\n                        callback(img.width, img.height);\r\n                        img.onload = null;\r\n                    };\r\n                }\r\n            }\r\n\r\n        },\r\n        resize: function (oWidth, oHeight, maxW, maxH, minW, minH) {\r\n            var w = oWidth, h = oHeight, scale = 1;\r\n\r\n            if (minW && w < minW) {\r\n                scale = (minW / w).toFixed(3);\r\n                h = parseInt(scale * h);\r\n                w = minW;\r\n            }\r\n\r\n            if (minH && h < minH) {\r\n                scale = (minH / h).toFixed(3);\r\n                w = parseInt(scale * w);\r\n                h = minH;\r\n            }\r\n\r\n            if (oWidth > maxW) {\r\n                scale = (maxW / oWidth).toFixed(3);\r\n                h = parseInt(scale * oHeight);\r\n                w = maxW;\r\n\r\n            }\r\n            if (h > maxH) {\r\n                scale = (maxH / oHeight).toFixed(3);\r\n                w = parseInt(scale * oWidth);\r\n                h = maxH;\r\n            }\r\n\r\n\r\n            return {w: w, h: h, scale: scale};\r\n        }\r\n    };\r\n    return img;\r\n\r\n});\r\n\ndefine('player/utils/playerEvent', ['model/logger'], function (_logger) {\r\n\r\n    var _emptyFunc = function (obj) {\r\n        _logger.debug('empty func invoke:');\r\n        _logger.debug(obj);\r\n    };\r\n\r\n    var playerEvent = {\r\n        _logger: _logger,\r\n        _eventHandler: null,\r\n        create: function () {\r\n            var instance = $.extend({}, this);\r\n            instance._eventHandler = {\r\n                //答案事件\r\n                answer: {\r\n                    change: _emptyFunc\r\n                },\r\n                //图片事件\r\n                image: {\r\n                    click: _emptyFunc\r\n                },\r\n                //公式解析\r\n                latex: {\r\n                    onEnded: _emptyFunc\r\n                },\r\n                assessmentItem: {\r\n                    optionClick: _emptyFunc\r\n                },\r\n                render: {\r\n                    rendered: _emptyFunc,\r\n                    renderChanged: _emptyFunc,\r\n                    destroy: _emptyFunc,\r\n                    resize: _emptyFunc\r\n                },\r\n                on: {\r\n                    error: _emptyFunc\r\n                }\r\n            };\r\n            return instance;\r\n        },\r\n        trigger: function (group, type, para) {\r\n            this._logger.debug('player trigger event:' + group + '-' + type);\r\n            this._eventHandler[group][type](para);\r\n        },\r\n        bind: function (group, type, callback) {\r\n            if (this._eventHandler[group] && this._eventHandler[group][type] && $.type(callback) === 'function') {\r\n                this._logger.debug('player bind event:' + group + '-' + type);\r\n                this._eventHandler[group][type] = callback;\r\n            }\r\n        }\r\n    };\r\n    return playerEvent;\r\n});\r\n\n// qti model\r\ndefine('player/utils/random', function () {\r\n\r\n\r\n    var getRandomRange = function (n, m) {\r\n        var c = m - n + 1;\r\n        return Math.floor(Math.random() * c + n);\r\n    }\r\n    var getRandomArry = function (end, start) {\r\n        var length = end + 1;\r\n        if (typeof start != 'undefined' && start > 0) {\r\n            length = end - start + 1;\r\n        }\r\n\r\n\r\n        var getRandomPri = function (randomEnd, arry) {\r\n            var s = 0;\r\n            if (typeof start != 'undefined' && start > 0) {\r\n                s = start;\r\n            }\r\n            var rd = getRandomRange(s, randomEnd);\r\n            var contain = false;\r\n            for (var j = 0; j < arry.length; j++) {\r\n                if (rd == arry[j]) {\r\n                    contain = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (contain) {\r\n                getRandomPri(randomEnd, arry);\r\n            } else {\r\n                arry.push(rd);\r\n            }\r\n        };\r\n\r\n        var arry = [];//随机索引\r\n        for (var i = 0; i < length; i++) {\r\n            getRandomPri(end, arry);\r\n        }\r\n        return arry;\r\n    };\r\n\r\n    var random = {\r\n        getRandom: function (name) {\r\n            var random = (Math.random() * 10 + new Date().getMilliseconds()).toString().replace(\".\", \"\");\r\n            if (name) {\r\n                return name + random;\r\n            }\r\n            return random;\r\n        },\r\n        getRandomRange: getRandomRange,\r\n        //获取随机长度数组\r\n        getRandomArray: function (length) {\r\n            var order = [];\r\n            var random = [];\r\n            for (var i = 0; i < length; i++) {\r\n                order[i] = i;\r\n            }\r\n            while (order.length) {\r\n                var seed = Math.random();\r\n                random.push(order.splice(Math.floor(seed * order.length), 1)[0]);\r\n            }\r\n            return random;\r\n        },\r\n\r\n        //数组乱序\r\n        shuffleArray: function (array, randomSeed) {\r\n            var result = array;\r\n            if (randomSeed && randomSeed.length > 0) {\r\n                result = [];\r\n                var index;\r\n                var value;\r\n                for (var i = 0; i < randomSeed.length; i++) {\r\n                    index = randomSeed[i];\r\n                    value = array[index];\r\n                    if (value) {\r\n                        result.push(value);\r\n                    }\r\n                }\r\n                for (var i = 0; i < array.length; i++) {\r\n                    value = array[i];\r\n                    if (result.indexOf(value) === -1) {\r\n                        result.push(value);\r\n                    }\r\n                }\r\n            } else {\r\n                var j;\r\n                var temp;\r\n                for (var i = result.length - 1; i > 0; i--) {\r\n                    j = Math.floor(Math.random() * (i + 1));\r\n                    temp = result[i];\r\n                    result[i] = result[j];\r\n                    result[j] = temp;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        getAnswerRandom: function (end, start, answerRandom) {\r\n\r\n            if (!start) {\r\n                start = 0;\r\n            }\r\n            if (!answerRandom || !(answerRandom instanceof Array) || answerRandom.length <= 0) {\r\n                return getRandomArry(end, start);\r\n            } else {\r\n                var arry = answerRandom;\r\n                var resultArry = [];\r\n                for (var i = 0; i < arry.length; i++) {\r\n                    var ar = parseInt(arry[i]);\r\n                    if (ar > end) {\r\n                        continue;\r\n                    }\r\n                    if (typeof start != 'undefined' && ar < start) {\r\n                        continue;\r\n                    }\r\n                    resultArry.push(ar);\r\n                }\r\n                if ((end + 1) > resultArry.length) {\r\n                    for (var j = start; j < (end + 1); j++) {\r\n                        var contain = false;\r\n                        for (var k = 0; k < resultArry.length; k++) {\r\n                            if (resultArry[k] == j) {\r\n                                contain = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (!contain) {\r\n                            resultArry.push(j);\r\n                        }\r\n                    }\r\n                }\r\n                return resultArry;\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    return random;\r\n\r\n});\r\n\n// qti model\r\ndefine('player/utils/svg', function () {\r\n\r\n\r\n    var svg = {\r\n        twConstants: {\r\n            DIALECT_SVG: 'svg',\r\n            DIALECT_VML: 'vml',\r\n            NS_SVG: 'http://www.w3.org/2000/svg',\r\n            NS_XLINK: 'http://www.w3.org/1999/xlink'\r\n        },\r\n        getSVGDocument: function (svg) {\r\n            if (!svg) return null;\r\n            var result = null;\r\n            var isIE = false;\r\n            if (isIE) {\r\n                if (svg.tagName.toLowerCase() == \"embed\") {\r\n                    try {\r\n                        result = svg.getSVGDocument();\r\n                    } catch (e) {\r\n                        alert(e + \" may be svg embed not init\");\r\n                    }\r\n                }\r\n            } else {\r\n                result = svg.ownerDocument;\r\n            }\r\n            return result;\r\n        },\r\n        getSVGRoot: function (svg, doc) {\r\n            if (!svg) return null;\r\n            if (svg.tagName.toLowerCase() == \"embed\") {\r\n                if (doc) {\r\n                    return doc.documentElement;\r\n                } else {\r\n                    return this.getSVGDocument(svg).documentElement;\r\n                }\r\n            } else if (svg.tagName.toLowerCase() == \"svg\") {\r\n                return svg;\r\n            }\r\n            return null;\r\n        },\r\n        addLine: function (svgdoc, svgRoot, id, x1, y1, x2, y2, className, style) {\r\n            var line = svgdoc.createElementNS(this.twConstants.NS_SVG, 'line');\r\n            line.setAttribute(\"id\", id);\r\n            line.setAttribute(\"x1\", x1);\r\n            line.setAttribute(\"y1\", y1);\r\n            line.setAttribute(\"x2\", x2);\r\n            line.setAttribute(\"y2\", y2);\r\n            line.setAttribute(\"style\", style);\r\n            line.setAttribute(\"class\", className);\r\n            svgRoot.appendChild(line);\r\n            return line;\r\n        },\r\n        addImgLine: function (svgdoc, svgRoot, id, x1, y1, x2, y2, className, style, iscorrect, showForeignObject) {\r\n            var line = svgdoc.createElementNS(this.twConstants.NS_SVG, 'line');\r\n            line.setAttribute(\"id\", id);\r\n            line.setAttribute(\"x1\", x1);\r\n            line.setAttribute(\"y1\", y1);\r\n            line.setAttribute(\"x2\", x2);\r\n            line.setAttribute(\"y2\", y2);\r\n            line.setAttribute(\"style\", style);\r\n            line.setAttribute(\"class\", className);\r\n            svgRoot.appendChild(line);\r\n\r\n            if (showForeignObject) {\r\n                var foreignObject = svgdoc.createElementNS(this.twConstants.NS_SVG, 'foreignObject');\r\n                foreignObject.setAttribute(\"x\", (parseInt(x1) + parseInt(x2)) / 2 - 19);\r\n                foreignObject.setAttribute(\"y\", (parseInt(y1) + parseInt(y2)) / 2 - 20);\r\n                foreignObject.setAttribute(\"id\", \"foreignObject_\" + id);\r\n                foreignObject.setAttribute(\"height\", \"39px\");\r\n                foreignObject.setAttribute(\"width\", \"38px\");\r\n                var div = svgdoc.createElement('div');\r\n                if (iscorrect) {\r\n                    div.setAttribute(\"class\", \"qp-correct-answer\");\r\n                } else {\r\n                    div.setAttribute(\"class\", \"qp-wrong-answer\");\r\n                }\r\n                foreignObject.appendChild(div);\r\n                svgRoot.appendChild(foreignObject);\r\n            }\r\n        }\r\n    }\r\n    return svg;\r\n\r\n});\r\n\ndefine('player/player', ['model/logger', 'player/utils/extendUtils'], function (_logger, _utils) {\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    var Media;\r\n    var AssessmentTest = require('player/assessment/assessmentTest');\r\n    var PlayerEvent = require('player/utils/playerEvent');\r\n    var ExtrasOption = require('player/config/extrasOption');\r\n    var Option = require('player/config/option');\r\n    var Exception = require('model/exception');\r\n\r\n    //api\r\n    var Player = {\r\n        _event: null,\r\n        _media: null,\r\n        _assessmentTest: null,\r\n        _option: null,\r\n        _uuid: null,//渲染容器的标识\r\n        create: function (option) {\r\n            var instance = $.extend({}, this);\r\n            //校验并纠正输入的渲染参数\r\n            option = _utils.checkOption(option);\r\n            //实例化配置\r\n            var defaultOption = $.extend({}, Option, option);\r\n            //实例化事件管理对象\r\n            var event = PlayerEvent.create();\r\n            //实例化多媒体对象\r\n            var media;\r\n            if (option.swfHost) {\r\n                Media = require('player/media/eMedia');\r\n                media = Media.create();\r\n            } else {\r\n                Media = require('player/media/media');\r\n                media = Media.create();\r\n            }\r\n            //实例化assessmentTest对象\r\n            var assessmentTest = AssessmentTest.create(defaultOption, event, media);\r\n            //初始化属性\r\n            instance._option = defaultOption;\r\n            instance._event = event;\r\n            instance._media = media;\r\n            instance._assessmentTest = assessmentTest;\r\n            return instance;\r\n        },\r\n        setOption: function (option) {\r\n            $.extend(this._option, option);\r\n        },\r\n        load: function (url, callback) {\r\n            var that = this;\r\n            _QtiPlayer.load(url, that._option, function (assessmentItemModel) {\r\n                that._assessmentTest.loadAssessmentItem(assessmentItemModel);\r\n                if (callback) {\r\n                    callback();\r\n                }\r\n            }, function (ex) {\r\n                var e = Exception.create('load', ex);\r\n                that._event.trigger('on', 'error', e);\r\n            });\r\n        },\r\n        _render: function (obj, option, callback) {\r\n            try {\r\n                var type = $.type(obj);\r\n                var $view = null;\r\n                if (type === 'string') {\r\n                    $view = $('#' + obj);\r\n                } else if (type === 'object') {\r\n                    if (obj instanceof jQuery) {\r\n                        $view = obj;\r\n                    } else {\r\n                        $view = $(obj);\r\n                    }\r\n                }\r\n                //设置一个唯一标识\r\n                this._uuid = _utils.getUuid();\r\n                $view.attr('data-qti-id', this._uuid);\r\n\r\n                //深度克隆一个新对象\r\n                var newOption = $.extend(true, {}, option);\r\n                //校验并纠正输入的渲染参数\r\n                newOption = _utils.checkOption(newOption);\r\n                //补充默认配置\r\n                $.extend(this._option, newOption);\r\n                //处理extend时数组会合并的问题\r\n                if (newOption.randomSeed && $.type(newOption.randomSeed) === 'array' && newOption.randomSeed.length > 0) {\r\n                    this._option.randomSeed = newOption.randomSeed;\r\n                }\r\n                this._assessmentTest.render($view, this._option, callback);\r\n            } catch (ex) {\r\n                var e = Exception.create('render', ex);\r\n                _logger.error('render异常', e);\r\n                this._event.trigger('on', 'error', e);\r\n            }\r\n        },\r\n        render: function (obj, option, callback) {\r\n            this._render(obj, option, callback);\r\n        },\r\n        _destroy: function () {\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            _QtiPlayer.resetMedia();\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                assessmentItem.destroy();\r\n            }\r\n        },\r\n        destroy: function () {\r\n            this._destroy();\r\n        },\r\n        getModelType: function () {\r\n            var modelType = {};\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                var itemModel = assessmentItem.getItemModel();\r\n                var model;\r\n                for (var modelId in itemModel.modelMap) {\r\n                    model = itemModel.modelMap[modelId];\r\n                    modelType[modelId] = model.modelType;\r\n                }\r\n            }\r\n            return modelType;\r\n        },\r\n        // 获取支持的题目类型\r\n        getSupportType: function () {\r\n            return this._assessmentTest.getAssessmentItem().getSupportType();\r\n        },\r\n        // 获取该题型的具体类型\r\n        getModelQuestionType: function () {\r\n            var modelType = {};\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                var itemModel = assessmentItem.getItemModel();\r\n                var model;\r\n                for (var modelId in itemModel.modelMap) {\r\n                    model = itemModel.modelMap[modelId];\r\n                    modelType[modelId] = model.questionType;\r\n                }\r\n            }\r\n            return modelType;\r\n        },\r\n        isMultipleModel: function () {\r\n            var result = false;\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                var itemModel = assessmentItem.getItemModel();\r\n                var num = 0;\r\n                for (var modelId in itemModel.modelMap) {\r\n                    num++;\r\n                }\r\n                if (num > 1) {\r\n                    result = true;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        //获取分数\r\n        getScore: function () {\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            return assessmentItem ? assessmentItem.getScore() : 0;\r\n        },\r\n        //设置分数\r\n        _setScore: function (score) {\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            assessmentItem.setScore(score);\r\n        },\r\n        getAnswerState: function () {\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            return assessmentItem ? assessmentItem.getAnswerState() : {};\r\n        },\r\n        setAnswerState: function (answerState) {\r\n            var result = false;\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                result = assessmentItem.setAnswerState(answerState);\r\n            }\r\n            return result;\r\n        },\r\n        getAnswer: function () {\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            return assessmentItem ? assessmentItem.getAnswer() : {};\r\n        },\r\n        answerOnChange: function (callback) {\r\n            this._event.bind('answer', 'change', callback);\r\n        },\r\n        latexOnEnded: function (callback) {\r\n            this._event.bind('latex', 'onEnded', callback);\r\n        },\r\n        answerOnClick: function (callback) {\r\n            this._event.bind('assessmentItem', 'optionClick', callback);\r\n        },\r\n        getAssessmentModel: function () {\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            return assessmentItem ? assessmentItem.getItemModel() : {};\r\n        },\r\n        setAnswer: function (answer) {\r\n            var result = false;\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                result = assessmentItem.setAnswer(answer);\r\n                this._event.trigger('answer', 'change', assessmentItem.getAnswer());\r\n            }\r\n            return result;\r\n        },\r\n        setStat: function (stat) {\r\n            var result = false;\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                result = assessmentItem.setStat(stat);\r\n            }\r\n            return result;\r\n        },\r\n        setTitleExtras: function (stat) {\r\n            var result = false;\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                result = assessmentItem.setTitleExtras(stat);\r\n            }\r\n            return result;\r\n        },\r\n        getState: function () {\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            return assessmentItem ? assessmentItem.getState() : '';\r\n        },\r\n        setState: function (state) {\r\n            var result = false;\r\n            var assessmentItem = this._assessmentTest.getAssessmentItem();\r\n            if (assessmentItem) {\r\n                result = assessmentItem.setState(state);\r\n                this._event.trigger('answer', 'change', assessmentItem.getAnswer());\r\n            }\r\n            return result;\r\n        },\r\n        mediaOnStart: function (callback) {\r\n            this._media.mediaOnStart(callback);\r\n        },\r\n        mediaOnPause: function (callback) {\r\n            this._media.mediaOnPause(callback);\r\n        },\r\n        mediaOnEnded: function (callback) {\r\n            this._media.mediaOnEnded(callback);\r\n        },\r\n        mediaOnTimeupdate: function (callback) {\r\n            this._media.mediaOnTimeupdate(callback);\r\n        },\r\n        mediaOnVolumeChange: function (callback) {\r\n            this._media.mediaOnVolumeChange(callback);\r\n        },\r\n        mediaOnSeeked: function (callback) {\r\n            this._media.mediaOnSeeked(callback);\r\n        },\r\n        mediaPlay: function (mediaType, index) {\r\n            if (this._option.swfHost && arguments.length === 0) {\r\n                this._media.mediaPlay();\r\n            } else {\r\n                this._media.mediaPlay(mediaType, index);\r\n            }\r\n        },\r\n        mediaPause: function (mediaType, index) {\r\n            if (this._option.swfHost && arguments.length === 0) {\r\n                this._media.mediaPause();\r\n            } else {\r\n                this._media.mediaPause(mediaType, index);\r\n            }\r\n        },\r\n        mediaPauseAll: function () {\r\n            if (this._option.swfHost) {\r\n                this._media.mediaPauseAll();\r\n            } else {\r\n                this._media.mediaPauseAll(this._getView());\r\n            }\r\n        },\r\n        mediaSkip: function (mediaType, index, seeked) {\r\n            if (this._option.swfHost) {\r\n                this._media.mediaSkip();\r\n            } else {\r\n                this._media.mediaSkip(mediaType, index, seeked);\r\n            }\r\n        },\r\n        mediaVolumeChange: function (mediaType, index, volume, display) {\r\n            if (!this._option.swfHost) {\r\n                this._media.mediaVolumeChange(mediaType, index, volume, display);\r\n            }\r\n        },\r\n        _mediaOnFullScreenChange: function (callback) {\r\n            this._media.mediaOnFullScreenChange(callback);\r\n        },\r\n        mediaOnFullScreenChange: function (callback) {\r\n            this._media.mediaOnFullScreenChange(callback);\r\n        },\r\n        mediaOnFullScreen: function (callback) {\r\n            this._media.mediaOnFullScreen(callback);\r\n        },\r\n        mediaOnFullScreenExit: function (callback) {\r\n            this._media.mediaOnFullScreenExit(callback);\r\n        },\r\n        loadOnError: function (callback) {\r\n            _QtiPlayer.loadOnError(callback);\r\n        },\r\n        imageOnClick: function (callback) {\r\n            this._event.bind('image', 'click', callback);\r\n        },\r\n        //显示题目\r\n        showQuestion: function (obj, identifiers) {\r\n            var type = $.type(obj);\r\n            var $view = null;\r\n            if (type === 'string') {\r\n                $view = $('#' + obj);\r\n            } else if (type === 'object') {\r\n                if (obj instanceof jQuery) {\r\n                    $view = obj;\r\n                } else {\r\n                    $view = $(obj);\r\n                }\r\n            }\r\n\r\n            if ($.type(identifiers) !== 'array') {\r\n                identifiers = [];\r\n            }\r\n\r\n            if (identifiers.length === 0) {\r\n                $view.find('._qp-model').show();\r\n            } else {\r\n                $view.find('._qp-model').each(function () {\r\n                    var $model = $(this);\r\n                    var hasIdentifier = false;\r\n                    identifiers.forEach(function (identifier) {\r\n                        if ($model.attr('data-model-id') === identifier) {\r\n                            hasIdentifier = true;\r\n                        }\r\n                    });\r\n                    if (hasIdentifier) {\r\n                        $model.show();\r\n                    } else {\r\n                        $model.hide();\r\n                    }\r\n                });\r\n            }\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n        },\r\n        showAnswer: function () {\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            this._assessmentTest.getAssessmentItem().showAnswer(this._getView());\r\n        },\r\n        showCheckedAnswer: function () {\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            this._assessmentTest.getAssessmentItem().showCheckedAnswer(this._getView());\r\n        },\r\n        showUsrAndCorrectAnswer: function () {\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            this._assessmentTest.getAssessmentItem().showUsrAndCorrectAnswer(this._getView());\r\n        },\r\n        showCorrectAnswer: function () {\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            this._assessmentTest.getAssessmentItem().showCorrectAnswer(this._getView());\r\n        },\r\n        showStatisAnswer: function () {\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            this._assessmentTest.getAssessmentItem().showStatisAnswer(this._getView());\r\n        },\r\n        showDefaultExtras: function (extrasOption) {\r\n            extrasOption = $.extend(true, ExtrasOption, extrasOption);\r\n            this._assessmentTest.getAssessmentItem().showDefaultExtras(this._getView(), extrasOption);\r\n        },\r\n        appendToExtras: function (appendView, appendModelId) {\r\n            this._assessmentTest.getAssessmentItem().appendToExtras(this._getView(), appendView, appendModelId);\r\n        },\r\n        // 存储extraAnswer,为HTML字符串\r\n        // extra格式为：{modelId:'Resopnse-1-1',extraHtml: '<div>这是图片信息</div>'}\r\n        setExtrasAnswer: function (extra, isAppended) {\r\n            this._assessmentTest.getAssessmentItem().setExtrasAnswer(this._getView(), extra, isAppended);\r\n        },\r\n        // 清空extraAnswer内容\r\n        cleanExtrasAnswer: function (modelId) {\r\n            this._assessmentTest.getAssessmentItem().cleanExtras(this._getView(), modelId);\r\n        },\r\n        // 获取满分值\r\n        getFullScore: function (modelId) {\r\n            return this._assessmentTest.getAssessmentItem().getFullScore(modelId);\r\n        },\r\n        // 设置满分值\r\n        setFullScore: function (retrieveData) {\r\n            this._assessmentTest.getAssessmentItem().setFullScore(retrieveData);\r\n        },\r\n        // 获取用户得分\r\n        getUserScore: function (modelId) {\r\n            return this._assessmentTest.getAssessmentItem().getUserScore(modelId);\r\n        },\r\n        // 设置用户得分\r\n        setUserScore: function (retrieveData) {\r\n            this._assessmentTest.getAssessmentItem().setUserScore(retrieveData);\r\n        },\r\n        reset: function () {\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            this._assessmentTest.getAssessmentItem().reset(this._getView());\r\n        },\r\n        setLock: function (lockArea, lockMedia) {\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            this._option.showLock = lockArea;\r\n            this._assessmentTest._option.showLock = lockArea;\r\n            this._assessmentTest.getAssessmentItem().setLock(this._getView(), lockArea);\r\n\r\n            if (typeof lockMedia !== typeof  undefined) {\r\n                this.lockMedia(lockMedia, this._getView());\r\n            }\r\n        },\r\n        setHintVisible: function (visible) {\r\n            _QtiPlayer.resetMedia();\r\n            _QtiPlayer.closeCustomKeyBoard();\r\n            var $view = this._getView();\r\n            this._option.showHint = visible;\r\n            this._assessmentTest._option.showHint = visible;\r\n            if (visible) {\r\n                $view.find('._hint-pop-btn').removeClass('nqti-hide-dom');\r\n            } else {\r\n                $view.find('._hint-pop-btn').addClass('nqti-hide-dom');\r\n            }\r\n        },\r\n        lockMedia: function (lock, view) {\r\n            this._media.setLock(lock, view);\r\n        },\r\n        _getView: function () {\r\n            return $('[data-qti-id=\"' + this._uuid + '\"]');\r\n        },\r\n        on: function (key, callback) {\r\n            this._event.bind('on', key, callback);\r\n        }\r\n    };\r\n    return Player;\r\n});\r\n\n//qti主入口\r\ndefine('player/qtiPlayer', ['model/qtiModel'], function () {\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    if (!_QtiPlayer) {\r\n        throw '请先加载qti-model';\r\n    }\r\n\r\n    var Player = require('player/player');\r\n    var modelHandlerFactory = require('player/model/modelHandlerFactory');\r\n    var baseInteraction = require('player/cls/baseInteraction');\r\n    var Class = require('player/cls/class');\r\n\r\n    //全局api\r\n    //获取qtiplayer实例\r\n    _QtiPlayer.createPlayer = function (option) {\r\n        return _QtiPlayer._createPlayer(option);\r\n    };\r\n\r\n    _QtiPlayer._createPlayer = function (option) {\r\n        var player = Player.create(option);\r\n        return player;\r\n    };\r\n    //注册modelHandler\r\n    _QtiPlayer.registerModelHandler = function (modelHandler) {\r\n        modelHandlerFactory.register(modelHandler);\r\n    };\r\n\r\n    _QtiPlayer.BaseInteraction = baseInteraction;\r\n    _QtiPlayer.Class = Class;\r\n\r\n    //扩展键盘,关闭自定义的键盘\r\n    _QtiPlayer.closeCustomKeyBoard = function () {\r\n        //关闭DigitalInput数字键盘\r\n        if (typeof DigitalInput !== 'undefined' && DigitalInput.InputManager && DigitalInput.InputManager.getInstance) {\r\n            var instance = DigitalInput.InputManager.getInstance();\r\n            if (instance && instance.closeKeyBoard) {\r\n                instance.closeKeyBoard();\r\n            }\r\n        }\r\n    };\r\n\r\n    _QtiPlayer.resetMedia = function () {\r\n        if (window.NDMediaPlayer && window.NDMediaPlayer.reset) {\r\n            window.NDMediaPlayer.reset();\r\n        }\r\n    }\r\n\r\n});\r\n\r\n//qti主入口初始化\r\nrequire('player/qtiPlayer');\r\n\n(function ($) {\r\n\r\n    $.support.touch = 'ontouchend' in document;\r\n    $.support.mobile = navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i) ? true : false;\r\n    var vEventHandler = {};\r\n    if ($.support.touch && $.support.mobile) {\r\n        //拥有触屏事件\r\n        vEventHandler.mouseDown = 'touchstart';\r\n        vEventHandler.mouseUp = 'touchend';\r\n        vEventHandler.mouseWheel = 'touchmove';\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientY;\r\n        };\r\n    } else {\r\n        //没有触屏幕事件\r\n        vEventHandler.mouseDown = 'mousedown';\r\n        vEventHandler.mouseUp = 'mouseup';\r\n        vEventHandler.mouseWheel = 'mousewheel';\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.clientY;\r\n        };\r\n    }\r\n    //解决fixed布局，touch事件无效bug http://stackoverflow.com/questions/8809706/ios-5-safari-bug-with-html-touch-events-on-positionfixed-div\r\n    $.support.fixed = function () {\r\n        var bodys = document.getElementsByTagName(\"body\");\r\n        if (bodys && bodys.length > 0) {\r\n            $(bodys[0]).on(\"touchstart\", function () {\r\n            });\r\n        }\r\n        $.support.fixed = true;\r\n    };\r\n    $.support.fixed();\r\n    //点击事件\r\n    $.event.special.qpTap = {\r\n        setup: function () {\r\n            var $that = $(this);\r\n            //$that.unbind('click');\r\n            if ($.support.touch&& $.support.mobile) {\r\n                if ($.support.fixed !== true) {\r\n                    $.support.fixed();\r\n                }\r\n                var vMouseDown = vEventHandler.mouseDown;\r\n                var vMouseUp = vEventHandler.mouseUp;\r\n                //$that.unbind(vMouseUp).unbind(vMouseDown);\r\n                var _start = 0;\r\n                var _startX = 0;\r\n                var _startY = 0;\r\n                $that.bind(vMouseDown, function (event) {\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        _start = new Date().getTime();\r\n                        _startX = vEventHandler.getEventX(event);\r\n                        _startY = vEventHandler.getEventY(event);\r\n                    }\r\n                });\r\n                $that.bind(vMouseUp, function (event) {\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        var end = new Date().getTime();\r\n                        var endX = vEventHandler.getEventX(event);\r\n                        var endY = vEventHandler.getEventY(event);\r\n                        var holdTime = end - _start;\r\n                        var dx = Math.abs(endX - _startX);\r\n                        var dy = Math.abs(endY - _startY);\r\n                        if (holdTime <= 850 && dx < 6 && dy < 6) {\r\n                            //触发tap事件\r\n                            event = $.event.fix(event);\r\n                            event.type = 'qpTap';\r\n                            $that.triggerHandler(event);\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                $that.bind('click', function (event) {\r\n                    //触发tap事件\r\n                    event = $.event.fix(event);\r\n                    event.type = 'qpTap';\r\n                    $that.triggerHandler(event);\r\n                });\r\n            }\r\n        },\r\n        teardown: function () {\r\n            var vMouseDown = vEventHandler.mouseDown;\r\n            var vMouseUp = vEventHandler.mouseUp;\r\n            var $that = $(this);\r\n            $that.unbind(vMouseUp).unbind(vMouseDown);\r\n        }\r\n    };\r\n    $.fn.qpTap = function (callback) {\r\n        return this.bind('qpTap', callback);\r\n    };\r\n    //滚动事件\r\n    $.event.special.qpMouseWheel = {\r\n        setup: function () {\r\n            var $that = $(this);\r\n            if ($.support.touch && $.support.mobile) {\r\n                var _startY = 0;\r\n                $that.unbind('touchstart').unbind('touchmove');\r\n                $that.bind('touchstart', function (event) {\r\n                    _startY = event.originalEvent.changedTouches[0].pageY;\r\n                });\r\n                $that.bind('touchmove', function (event) {\r\n                    var currentY = event.originalEvent.changedTouches[0].pageY;\r\n                    if (currentY !== _startY) {\r\n                        event = $.event.fix(event);\r\n                        event.type = 'qpMouseWheel';\r\n                        event.deltaY = currentY - _startY;\r\n                        //触发qpMouseWheel事件\r\n                        $that.trigger(event);\r\n                        _startY = currentY;\r\n                    }\r\n                });\r\n            } else {\r\n                $that.unbind('mousewheel');\r\n                $that.bind('mousewheel', function (event) {\r\n                    event = $.event.fix(event);\r\n                    event.type = 'qpMouseWheel';\r\n                    event.deltaY = event.originalEvent.deltaY;\r\n                    //触发qpMouseWheel事件\r\n                    $that.trigger(event);\r\n                });\r\n            }\r\n        },\r\n        teardown: function () {\r\n            var $that = $(this);\r\n            if ($.support.touch && $.support.mobile) {\r\n                $that.unbind('touchstart').unbind('touchmove');\r\n            } else {\r\n                $that.unbind('mousewheel');\r\n            }\r\n        }\r\n    };\r\n    $.fn.qpMouseWheel = function (callback) {\r\n        return this.bind('qpMouseWheel', callback);\r\n    };\r\n    $.fn.qpStopMouseWheel = function () {\r\n        this.bind(vEventHandler.mouseWheel, function (event) {\r\n            event.preventDefault();\r\n        });\r\n    };\r\n})(jQuery);\n\r\n/**\r\n * ccy 拖动\r\n * @date 2015.06.16\r\n * @param $\r\n */\r\n(function ($) {\r\n  'use strict';\r\n\r\n  var Draggable,\r\n  \t//__bind用处，当对象相互调用传递方法：如 将a对象的f方法传递给b对象当属性 b={bf:a.f} ; b.bf()的this是b\r\n\t//如果 a.f = __bind(a.f,a) ;  b={bf:a.f} ;b.bf()的this是a ;\r\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\r\n  __slice = [].slice;\r\n\r\n    var getScale = function ($dom) {\r\n        if ($dom && $dom.length > 0) {\r\n            var offWidth = $dom[0].offsetWidth;\r\n            return (offWidth > 0 ? ($dom[0].getBoundingClientRect().width / offWidth) : 1) || 1;\r\n        }\r\n        return 1;\r\n    };\r\n\r\n  Draggable = (function() {\r\n\r\n\r\n\r\n    function Draggable($container, options) {\r\n\r\n      this.click = __bind(this.click, this);\r\n      this.moved = __bind(this.moved, this);\r\n      this.ended = __bind(this.ended, this);\r\n      this.began = __bind(this.began, this);\r\n      this.coordinate = __bind(this.coordinate, this);\r\n      this.off = __bind(this.off, this);\r\n      this.on = __bind(this.on, this);\r\n      this.toggle = __bind(this.toggle, this);\r\n      this.bind = __bind(this.bind, this);\r\n      this.$container = $container;\r\n      this.getElements = __bind(this.getElements, this);\r\n      this.resetElements = __bind(this.getElements, this);\r\n      this.options = $.extend({},Draggable.DEFAULTS,options);\r\n      this.$elements =  this.$container.find( this.options.selector );\r\n      if(  this.$elements.length === 0 ) return ;\r\n\r\n\t  this.elementOpts = {\r\n\t    \t\t  count : this.$elements.length,\r\n\t    \t\t  width : this.$elements.eq(0).width(),\r\n\t    \t\t  height: this.$elements.eq(0).height()\r\n\t  };\r\n\r\n      this.toggle();\r\n\r\n\r\n    }\r\n\r\n    Draggable.DEFAULTS = {\r\n    \t\t\"z-index\":999,\r\n    \t\topacity: \"0.8\",\r\n    \t\tversion:\"0.01\",\r\n    \t\tselector:' [data-toggle=\"draggable\"]'\r\n    };\r\n\r\n    Draggable.prototype.getElements = function() {\r\n    \treturn this.$container.find( this.options.selector );\r\n    };\r\n    //重置拖动元素\r\n    Draggable.prototype.resetElements = function() {\r\n    \tdelete this.$elements ;\r\n    \tthis.$elements = this.getElements() ;\r\n    \treturn this.$elements;\r\n    };\r\n\r\n    //处理鼠标移动，鼠标键松开事件\r\n    Draggable.prototype.bind = function(method) {\r\n      if (method == null) {\r\n        method = 'on';\r\n      }\r\n      this.$container[method]('mousemove touchmove', this.moved);\r\n      return this.$container[method]('mouseup mouseleave touchend touchcancel', this.ended);\r\n    };\r\n\r\n    Draggable.prototype.toggle = function(method) {\r\n      if (method == null) {\r\n        method = 'on';\r\n      }\r\n\r\n      this.$container[method]('mousedown touchstart',this.options.selector, this.began);\r\n      return this.$container[method]('click', this.options.selector, this.click);\r\n    };\r\n\r\n    Draggable.prototype.on = function() {\r\n      return this.toggle('on');\r\n    };\r\n\r\n    Draggable.prototype.off = function() {\r\n      return this.toggle('off');\r\n    };\r\n\r\n    Draggable.prototype.coordinate = function(event) {\r\n      switch (event.type) {\r\n        case 'touchstart':\r\n        case 'touchmove':\r\n        case 'touchend':\r\n        case 'touchcancel':\r\n          return event.originalEvent.touches[0];\r\n        default:\r\n          return event;\r\n      }\r\n    };\r\n    //鼠标点击开始\r\n    Draggable.prototype.began = function(event) {\r\n        this.bodyRect = {\r\n            height: $(document.body).height(),\r\n            width: $(document.body).width()\r\n        };\r\n      var _ref;\r\n      if( this.$container.data(\"disabled\")===\"disabled\" ||  this.$container.data(\"disabled\")===\"true\" ){\r\n    \treturn ;\r\n      }\r\n      if (this.$target) {\r\n        return;\r\n      }\r\n        if (!this.scale) {\r\n            this.scale = getScale(this.$container);\r\n        }\r\n      //event.preventDefault();\r\n      //event.stopPropagation();\r\n      //绑定鼠标移动，鼠标松开事件\r\n      this.bind('on');\r\n      this.$target = $(event.target).closest( '[data-toggle=\"draggable\"]');\r\n\r\n\r\n  \t  if( !this.containerOpts || this.containerOpts.width !==  this.$container.width() ){\r\n\t\t  this.containerOpts = {\r\n\t    \t\t  width : this.$container.width(),\r\n\t      \t\t  height: this.$container.height()\r\n\t      };\r\n      }\r\n\r\n      //计算行列数\r\n  \t  if( this.$elements.length>1 ){\r\n\r\n\t  \t  var fPosition = this.$elements.first().position() ;\r\n\t  \t  var sPosition = this.$elements.eq(1).position() ;\r\n\t  \t  var lPosition = this.$elements.last().position() ;\r\n\r\n\t  \t  var spaceWidth= sPosition.left-fPosition.left - this.elementOpts.width;\r\n\t  \t  this.elementOpts.columns = \t Math.floor( ( this.containerOpts.width -this.elementOpts.width-spaceWidth/2)/(sPosition.left-fPosition.left)+1 );\r\n\t  \t  this.elementOpts.rows =  Math.ceil( this.elementOpts.count / this.elementOpts.columns );\r\n\t  \t  //console.log( spaceWidth+\"|\"+this.containerOpts.width +\"|\"+ this.elementOpts.columns  +\"||\"+ this.elementOpts.rows )\r\n  \t  }else {\r\n  \t\t//0个元素 0列0行，1同\r\n  \t\tthis.elementOpts = {\r\n  \t\t\t\tcolumns:this.$elements.length,\r\n  \t\t\t\trows:this.$elements.length\r\n  \t\t};\r\n  \t  }\r\n      //console.log(\"||--拖动点击前的位置--\"+this.$target.position().left+\"|\"+this.$target.position().top);\r\n      //设置拖动对象样式前要先占位 修复拖动时，添加了新元素导致的换行问题\r\n      var position=this.$target.position();\r\n      this.$target.css({\r\n        \"position\" : \"absolute\"\r\n      });\r\n      this.$placeHolder = $(this.$target[0].outerHTML).css({visibility: \"hidden\",\"position\" : \"\"});\r\n      this.$target.after(this.$placeHolder);\r\n      this.resetElements();\r\n      this.$target.css({\r\n        \"position\" : \"absolute\",\r\n        left:position.left/this.scale,\r\n        top:position.top/this.scale,\r\n        opacity:this.options.opacity\r\n      });\r\n\r\n  \t  if ( (/^(?:a|\\d)/).test(this.$target.css(\"z-index\")) ) {\r\n  \t\tthis.$target[0].style[\"z-index\"] = \"999\";\r\n      }\r\n      this.$target.addClass('on');\r\n\r\n      this.origin = {\r\n        x: this.coordinate(event).pageX - this.$target.position().left ,\r\n        y: this.coordinate(event).pageY - this.$target.position().top\r\n      };\r\n\r\n      return (_ref = this.options) != null ? typeof _ref.began === \"function\" ? _ref.began(event) : void 0 : void 0;\r\n    };\r\n\r\n    //鼠标拖动\r\n    Draggable.prototype.moved = function(event) {\r\n        var coor=this.coordinate(event);\r\n        if (event.type === 'touchmove' &&\r\n            (Math.abs(coor.clientY - this.bodyRect.height) <= 15 ||\r\n                Math.abs(coor.clientX - this.bodyRect.width) <= 15 ||\r\n                coor.clientX <= 15 ||\r\n                coor.clientY <= 15\r\n            )) {\r\n            //console.log(this.coordinate(event), this.bodyRect);\r\n            this.ended(event);\r\n            return;\r\n        }\r\n      //console.log(\" Draggable.prototype.moved ...............\")\r\n      var _ref;\r\n      if (this.$target == null) {\r\n        return;\r\n      }\r\n      event.preventDefault();\r\n      //event.stopPropagation();\r\n      this.$target.css({\r\n        left: (this.coordinate(event).pageX - this.origin.x)/this.scale,\r\n        top: (this.coordinate(event).pageY - this.origin.y)/this.scale\r\n      });\r\n\r\n      //计算拖动元素需插入的位置，当交互面积最大，且是矩形元素的四分一面积以上的时候做插入\r\n      var maxIndex = -1 , maxArea = -1  ;\r\n      var $target = this.$target ;\r\n      var tarPos = this.$target.position() ;\r\n        if (this.elementOpts.width == 0) {\r\n            this.elementOpts.width = this.$elements.eq(0).width()\r\n        }\r\n      var eleWidth = this.elementOpts.width;\r\n      var eleHeight = this.elementOpts.height;\r\n      var overArea = eleWidth * eleHeight / 4 ;\r\n      var placeHolderIndex = this.$placeHolder.index() ;\r\n\r\n      this.$elements = this.getElements();\r\n\t  this.$elements.each(function(i){\r\n\t\t  if($target.index() === i ) {\r\n\t\t\t  return ;\r\n\t      }\r\n\t\t  var tempPos = $(this).position();\r\n\r\n\t\t  if( Math.abs( tarPos.left - tempPos.left ) > eleWidth || Math.abs( tarPos.top - tempPos.top ) > eleHeight ) return ;\r\n\t\t  //console.log(\"width****\"+tarPos.left +\"||\"+ tempPos.left + \"||\" + eleWidth )\r\n\t\t // console.log( \"height***\"+tarPos.top +\"||\"+tempPos.top + \"||\" + eleHeight )\r\n\t\t  var tempW = tarPos.left - tempPos.left ;\r\n\t\t  var tempH = tarPos.top - tempPos.top ;\r\n\r\n\t\t  tempW = tempW <= 0 ? tempW + eleWidth :  tempW = eleWidth - tempW ;\r\n\t\t  tempH = tempH <= 0 ? tempH + eleHeight : eleHeight - tempH ;\r\n\r\n\t\t  var tempA = tempW * tempH ;\r\n\t\t  //console.log( \"area---\" + tempW + \"|| \"+tempH+\"|\"+ maxArea +\"||\"+overArea+\"||\" +tempA )\r\n\t\t  if( maxArea < tempA  && overArea <= tempA ){\r\n\t\t\t  maxArea = tempA ;\r\n\t\t\t  maxIndex = i ;\r\n\r\n\t\t  }\r\n\r\n\t  });\r\n\r\n\t  if( maxIndex !== -1 ) {\r\n\t\t  if( this.$placeHolder.index() !== maxIndex ){\r\n\t\t\t  var $tempEle = this.$elements.eq(maxIndex) ;\r\n\t\t\t  var isAfter = this.$placeHolder.index() < $tempEle.index() ? true : false ;\r\n\t\t\t  if(isAfter){\r\n\t\t\t\t  this.$elements.eq(maxIndex).after(this.$placeHolder) ;\r\n\t\t\t  }else {\r\n\t\t\t\t  this.$elements.eq(maxIndex).before(this.$placeHolder) ;\r\n\t\t\t  }\r\n\t\t\t  this.$elements = this.$container.find( this.options.selector );\r\n\t\t  }\r\n\t  }\r\n\t  //计算拖动元素需插入的位置 end\r\n\r\n      //当前拖拽的对象\r\n      this.dragged = this.$target;\r\n      return (_ref = this.options) != null ? typeof _ref.moved === \"function\" ? _ref.moved(event) : void 0 : void 0;\r\n    };\r\n\r\n    Draggable.prototype.ended = function(event) {\r\n        var _ref;\r\n        if (this.$target == null) {\r\n          return;\r\n        }\r\n\r\n        //event.preventDefault();\r\n        //event.stopPropagation();\r\n        this.bind('off');\r\n        this.$placeHolder.before( this.$target) ;\r\n        this.$target.removeClass('on');\r\n\r\n        this.$target.attr(\"style\",this.$placeHolder.attr(\"style\")) ;\r\n        this.$placeHolder.remove();\r\n        this.$target.css({\"visibility\":\"\"});\r\n\r\n        delete this.$target;\r\n        delete this.$placeHolder ;\r\n        delete this.origin;\r\n        this.$elements =  this.resetElements();\r\n\r\n\r\n        return (_ref = this.options) != null ? typeof _ref.ended === \"function\" ? _ref.ended(event) : void 0 : void 0;\r\n    };\r\n\r\n    Draggable.prototype.click = function(event) {\r\n      if (!this.dragged) {\r\n        return;\r\n      }\r\n      //event.preventDefault();\r\n      //event.stopPropagation();\r\n      return delete this.dragged;\r\n    };\r\n\r\n\r\n    return Draggable;\r\n\r\n  })();\r\n\r\n\r\n  function Plugin(option) {\r\n\r\n\toption = option || {} ;\r\n    return this.each(function () {\r\n      var $this   = $(this) ;\r\n      if(typeof option  === \"string\"){\r\n    \t  $this.data('disabled',option) ;\r\n    \t  return ;\r\n      }\r\n  \t  //console.log($this.css(\"z-index\"));\r\n\r\n\r\n      var data    = $this.data('my.draggable') ;\r\n      var options = $.extend({}, $this.data(), typeof option == 'object' && option)\r\n      //插件缓存\r\n      if (!data){\r\n    \t  data = new Draggable($this) ;\r\n    \t  $this.data('my.draggable', data);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  $.fn.draggabled             = Plugin ;\r\n  $.fn.draggabled.Constructor = Draggable  ;\r\n\r\n})(jQuery);\r\n\n/**\r\n * ccy 排序拖动\r\n * @date 2015.06.16\r\n * @param $\r\n * @depend jquery,query.draggable.js\r\n */\r\n(function ($) {\r\n  'use strict';\r\n\r\n  var Dragsort,\r\n  \t//__bind用处，当对象相互调用传递方法：如 将a对象的f方法传递给b对象当属性 b={bf:a.f} ; b.bf()的this是b\r\n\t//如果 a.f = __bind(a.f,a) ;  b={bf:a.f} ;b.bf()的this是a ;\r\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\r\n  __slice = [].slice;\r\n\r\n  Dragsort = (function() {\r\n\r\n    function Dragsort($container, options) {\r\n    \t//将当前this存放入各个方法中\r\n        this.draggingMoved = __bind(this.draggingMoved, this);\r\n        this.draggingEnded = __bind(this.draggingEnded, this);\r\n        this.draggingBegan = __bind(this.draggingBegan, this);\r\n        this.draggable = __bind(this.draggable, this);\r\n        this.$ = __bind(this.$, this);\r\n        //end\r\n\r\n        this.options = $.extend({}, Dragsort.DEFAULTS, options);\r\n        this.$container = $container ;\r\n        this.$elements = this.$(this.options.draggable.selector) ;\r\n        this.$elements.each(function(){\r\n        \tvar $ele = $(this) ;\r\n        \tif(!$ele.attr(\"data-toggle\")){\r\n        \t\t$ele.attr(\"data-toggle\",\"draggable\");\r\n        \t}\r\n        });\r\n        this.options.tagName = this.$elements.length>0? this.$elements.get(0).tagName.toLowerCase() :\"div\" ;\r\n        //this.ordinalize(this.$('> *'));\r\n        if (this.options.draggable !== false) {\r\n          this.draggable();\r\n        }\r\n        return this;\r\n\r\n    }\r\n\r\n    Dragsort.DEFAULTS = {\r\n    \tbase: 60,\r\n\t    gutter: 20,\r\n\t    columns: 12,\r\n\t    draggable: {\r\n\t        zIndex: 999,\r\n\t        selector: '> *'\r\n\t    },\r\n\t    placeHolderTemplate:\"\"\r\n\r\n    };\r\n\r\n    Dragsort.prototype.$ = function(selector) {\r\n        return this.$container.find(selector);\r\n    };\r\n\r\n    Dragsort.prototype.draggable = function(method) {\r\n        if (this._draggable == null) {\r\n          this._draggable = new  $.fn.draggabled.Constructor(\r\n        \t  this.$container,\r\n\t          {\r\n\t        \t  id  \t  : this.options.id,\r\n\t        \t  selector: this.options.draggable.selector,\r\n\t           // began: this.draggingBegan,\r\n\t            ended: this.draggingEnded\r\n\t           // moved: this.draggingMoved\r\n\t          }\r\n          );\r\n        }\r\n        if (method != null) {\r\n          // return this._draggable[method]();\r\n        }\r\n    };\r\n\r\n\r\n\r\n    Dragsort.prototype.draggingBegan = function(event) {\r\n\r\n    };\r\n\r\n    Dragsort.prototype.draggingEnded = function(event) {\r\n      var  _ref, _update;\r\n\r\n      return (_ref = this.options) != null ? ( _update = this.options.update) != null ? typeof _update === \"function\" ? _update(event) : void 0 : void 0 : void 0;\r\n    };\r\n\r\n    Dragsort.prototype.draggingMoved = function(event) {\r\n\r\n    };\r\n    return Dragsort;\r\n\r\n  })();\r\n\r\n\r\n  function Plugin(option) {\r\n\toption = option || {} ;\r\n    return this.each(function () {\r\n      var $this   = $(this) ;\r\n\r\n      if(typeof option  === \"string\"){\r\n    \t  $this.data('disabled',option) ;\r\n    \t  return ;\r\n      }\r\n      if(option.disabled){\r\n    \t  $this.data('disabled',option.disabled) ;\r\n    \t  return\r\n      };\r\n      if(!$this.attr(\"id\")){\r\n    \t  $this.attr(\"id\",\"dragsort\");\r\n      }\r\n      //console.log( $this.attr(\"id\"))\r\n      option.id = $this.attr(\"id\") ;\r\n\r\n      //position非relative , absolute, fixed ,则默认取 relative\r\n  \t  if (!(/^(?:r|a|f)/).test($this.css(\"position\"))) {\r\n  \t\tthis.style.position = \"relative\";\r\n\t  }\r\n      var data    = $this.data('my.dragsort') ;\r\n      var options = $.extend({}, $this.data(), typeof option == 'object' && option)\r\n      //插件缓存\r\n      if (!data){\r\n    \t  data = new Dragsort($this,options) ;\r\n    \t  $this.data('my.dragsort', data);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  $.fn.dragsort             = Plugin ;\r\n  $.fn.dragsort.Constructor = Dragsort  ;\r\n\r\n})(jQuery);\r\n\r\n\n// choiceInteraction\r\n(function (window, $) {\r\n    var _utils = window.QtiPlayer.getUtils();\r\n    //创建\r\n    var _modelHandler = {\r\n        _name: 'choiceInteraction',\r\n        //获取model名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n            //获取模型数据\r\n            var _model = modelItem.getModel();\r\n\r\n            var _renderAnswer = function (answer, correctAnswer, $option, showChecked) {\r\n                if (answer) {\r\n                    //渲染作答\r\n                    $option.each(function () {\r\n                        var $this = $(this);\r\n                        for (var index = 0; index < answer.length; index++) {\r\n                            if ($this.attr('identifier') === answer[index]) {\r\n                                if (_modelHandler.isElearningSkin) {\r\n                                    //elearning皮肤走原来流程\r\n                                    $this.addClass('nqti-option-on');\r\n                                    if (showChecked) {\r\n                                        if (correctAnswer.indexOf(answer[index]) > -1) {\r\n                                            $this.addClass('nqti-option-right');\r\n                                        } else {\r\n                                            $this.addClass('nqti-option-wrong');\r\n                                        }\r\n                                    }\r\n                                    break;\r\n                                } else {\r\n                                    $this.addClass('nqti-option-on');\r\n                                    //显示用户反馈\r\n                                    if (showChecked) {\r\n                                        if (correctAnswer.indexOf(answer[index]) > -1) {\r\n                                            $this.addClass('nqti-option-right');\r\n                                        } else {\r\n                                            $this.addClass('nqti-option-wrong');\r\n                                        }\r\n                                    }\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n\r\n            // 保持原有的流程，为elearning皮肤单独提供同时显示用户答案和正确答案的接口\r\n            var _renderCorrectAnswerNoneGrayBg = function (answer, correctAnswer, $option, showChecked) {\r\n                if (answer) {\r\n                    //渲染作答\r\n                    $option.each(function () {\r\n                        var $this = $(this);\r\n                        for (var index = 0; index < answer.length; index++) {\r\n                            if ($this.attr('identifier') === answer[index]) {\r\n                                if (_modelHandler.isElearningSkin) {\r\n                                    if (showChecked) {\r\n                                        if (correctAnswer.indexOf(answer[index]) > -1) {\r\n                                            $this.addClass('nqti-option-right');\r\n                                        } else {\r\n                                            $this.addClass('nqti-option-wrong');\r\n                                        }\r\n                                    }\r\n                                    break;\r\n                                } else {\r\n                                    console.warn(\"非elearning皮肤，不支持同时显示用户答案和正确答案...\");\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                var simpleChoice = _model.simpleChoice;\r\n                if (simpleChoice.length === 2) {\r\n                    var option1 = simpleChoice[0].identifier.toLowerCase();\r\n                    var option2 = simpleChoice[1].identifier.toLowerCase();\r\n                    if (option1 === 'yes' && option2 === 'no') {\r\n                        return _utils.getLangText('true_or_false', this.getOption());\r\n                    }\r\n                }\r\n                return _model.maxChoices === 1 ? _utils.getLangText('single_choise', this.getOption()) : _utils.getLangText('multiple_choise', this.getOption());\r\n            };\r\n            modelItem.getClassName = function (option) {\r\n                var name = 'nqti-base-choice';\r\n                if (option.screenshotLayout && _model.maxChoices === 1) {\r\n                    name = 'nqti-player-srcm-body';\r\n                }\r\n                return name;\r\n            };\r\n            //返回标题片段\r\n            modelItem.createTitleHtml = function () {\r\n                return _model.prompt;\r\n            };\r\n            //普通类答案渲染\r\n            modelItem._createCommonAnswerHtml = function (isJudgment, option) {\r\n                var result = '';\r\n                var simpleChoice = _model.simpleChoice;\r\n                if (isJudgment) {\r\n                    //判断\r\n                    result += '<ul class=\"nqti-base-judment-list\">';\r\n                } else if (_model.maxChoices === 1) {\r\n                    //单选\r\n                    result += '<ul class=\"nqti-base-choice-list\">';\r\n                } else {\r\n                    //多选\r\n                    result += '<ul class=\"nqti-base-choice-multiple\">';\r\n                }\r\n                var object;\r\n                for (var i = 0; i < simpleChoice.length; i++) {\r\n                    object = simpleChoice[i];\r\n                    result += '<li class=\"nqti-option _qp-option\" data-index=\"' + i + '\" identifier=\"' + object.identifier + '\">';\r\n                    if (isJudgment || _model.maxChoices === 1) {\r\n                        result += '<i class=\"nqti-option-radio-icon\"></i>';\r\n                    } else {\r\n                        result += '<i class=\"nqti-option-checkbox-icon\"></i>';\r\n                    }\r\n                    result += '<span class=\"nqti-check\">';\r\n                    if (isJudgment === false) {\r\n                        result += '<em class=\"size\">' + object.identifier + '</em>';\r\n                    }\r\n                    result += '</span>'\r\n                        + '<div class=\"nqti-content\"><em class=\"size\">' + object.content + '</em></div>'\r\n                        + '</li>';\r\n                }\r\n                result += '</ul>';\r\n                return result;\r\n            };\r\n            //截图类答案渲染(单选、判断)\r\n            modelItem._createScreenshotAnswerHtml = function (isJudgment, option) {\r\n                var result = '';\r\n                var tipText = _utils.getLangText('choice_screenshot_title', option);\r\n                var simpleChoice = _model.simpleChoice;\r\n                result += '<div class=\"nqti-srcm-layout-options\">'\r\n                    + '<p class=\"nqti-com-layout-title-answer\">'\r\n                    + '<span class=\"nqti-txt\">' + tipText + ' :</span>';\r\n                var object;\r\n                var optionId;\r\n\r\n                for (var i = 0; i < simpleChoice.length; i++) {\r\n                    object = simpleChoice[i];\r\n                    optionId = object.identifier;\r\n                    if (isJudgment) {\r\n                        optionId = object.content;\r\n                    }\r\n                    result += '<label class=\"nqti-com-btn-radio _qp-option\" data-index=\"' + i + '\" identifier=\"' + object.identifier + '\">'\r\n                        + '<i class=\"nqti-option-radio-icon\"></i><span class=\"nqti-txt\">' + optionId + '</span>'\r\n                        + '</label>';\r\n                }\r\n                result += '</p></div>';\r\n                return result;\r\n            };\r\n            //返回答案片段\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var simpleChoice = _model.simpleChoice;\r\n                //是否判断题\r\n                var isJudgment = false;\r\n                if (simpleChoice.length === 2) {\r\n                    var option1 = simpleChoice[0].identifier.toLowerCase();\r\n                    var option2 = simpleChoice[1].identifier.toLowerCase();\r\n                    if (option1 === 'yes' && option2 === 'no') {\r\n                        isJudgment = true;\r\n                    }\r\n                }\r\n                var result = '';\r\n                if (option.screenshotLayout) {\r\n                    if (isJudgment || _model.maxChoices === 1) {\r\n                        //判断或则单选\r\n                        result = this._createScreenshotAnswerHtml(isJudgment, option);\r\n                    } else {\r\n                        //多选，普通模式渲染\r\n                        result = this._createCommonAnswerHtml(isJudgment, option);\r\n                    }\r\n                } else {\r\n                    result = this._createCommonAnswerHtml(isJudgment, option);\r\n                }\r\n                return result;\r\n            };\r\n            //动态渲染\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n                _modelHandler.isElearningSkin = option.isElearningSkin;\r\n                var $option = $view.find('._qp-option');\r\n                //填空点击回调\r\n                $option.bind('qpTap', function () {\r\n                    var val = $(this).attr('identifier');\r\n                    var index = $(this).data('index');\r\n                    that.triggerOptionClick(index, val);\r\n                });\r\n            };\r\n            //交互事件处理\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                var $option = $view.find('._qp-option');\r\n                var getAnswer = function () {\r\n                    var answer = [];\r\n                    $option.each(function () {\r\n                        var $this = $(this);\r\n                        if ($this.hasClass('nqti-option-on')) {\r\n                            answer.push($this.attr('identifier'));\r\n                        }\r\n                    });\r\n                    return answer;\r\n                };\r\n                $option.each(function () {\r\n                    var $this = $(this);\r\n                    $this.bind('qpTap', function () {\r\n                        if (that.isLock()) {\r\n                            return;\r\n                        }\r\n                        if (_model.maxChoices === 1) {\r\n                            //单选\r\n                            if ($this.hasClass('nqti-option-on') === false) {\r\n                                $option.each(function () {\r\n                                    $(this).removeClass('nqti-option-on');\r\n                                });\r\n                                $this.addClass('nqti-option-on');\r\n                            }\r\n                        } else {\r\n                            //多选\r\n                            if ($this.hasClass('nqti-option-on')) {\r\n                                $this.removeClass('nqti-option-on');\r\n                            } else {\r\n                                $this.addClass('nqti-option-on');\r\n                            }\r\n                        }\r\n                        that.setAnswer(getAnswer());\r\n                    });\r\n                });\r\n            };\r\n\r\n            modelItem.renderReset = function ($view) {\r\n                //do nothing\r\n                var $options = $view.find('._qp-option');\r\n                $options.each(function () {\r\n                    var $this = $(this);\r\n                    $this.removeClass('nqti-option-on');\r\n                    $this.removeClass('nqti-option-right');\r\n                    $this.removeClass('nqti-option-wrong');\r\n                });\r\n            };\r\n\r\n\r\n            modelItem.renderAnswer = function ($view) {\r\n                _renderAnswer(this.getAnswer(), this.getCorrectAnswer(), $view.find('._qp-option'), false);\r\n            };\r\n\r\n            modelItem.renderCheckedAnswer = function ($view) {\r\n                _renderAnswer(this.getAnswer(), this.getCorrectAnswer(), $view.find('._qp-option'), true);\r\n            };\r\n\r\n            modelItem.renderCorrectAnswer = function ($view) {\r\n                _renderAnswer(this.getCorrectAnswer(), this.getCorrectAnswer(), $view.find('._qp-option'), true);\r\n            };\r\n\r\n            modelItem.renderCorrectAnswerNoneGrayBg = function ($view) {\r\n                _renderCorrectAnswerNoneGrayBg(this.getCorrectAnswer(), this.getCorrectAnswer(), $view.find('._qp-option'), true);\r\n            };\r\n\r\n            modelItem.renderLock = function ($view) {\r\n\r\n            };\r\n        }\r\n    };\r\n    //注册\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})(window, jQuery);\r\n\r\n\n// choiceInteraction_vote\r\n(function (window, $) {\r\n\r\n    var _utils = window.QtiPlayer.getUtils();\r\n    //创建\r\n    var _modelHandler = {\r\n        _name: 'choiceInteraction_vote',\r\n        //获取model名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n            //获取数据模型\r\n            var _model = modelItem.getModel();\r\n\r\n            //选项单字文本标识\r\n            var _singleText = true;\r\n            //非单字文本，且投票项超过8个\r\n            var _tooManyOptions = false;\r\n            //正则\r\n            var imageRegex = /<img[\\s\\S]*?\\/>/g;\r\n            var imageSrcRegex = /src=\"([\\s\\S]*?)\"/;\r\n            var contentTextRegex = /<p[\\s\\S]*?>([\\s\\S]*)<\\/p>/;\r\n            //特殊字符判断&<>\r\n            var specifiedCharacterRegex = /^&(gt|lt|amp);$/i;\r\n\r\n            //选项数据处理\r\n            var simpleChoice = _model.simpleChoice;\r\n            var choice;\r\n            var choiceText;\r\n            for (var index = 0; index < simpleChoice.length; index++) {\r\n                choice = simpleChoice[index];\r\n                //编号处理\r\n                choice.identifier = choice.identifier.replace('ndvote_', '');\r\n                //图片内容处理,只取最后一个img的内容，其他img的内容全部清空。清空图片后剩下的都是文字内容\r\n                var image = '';\r\n                choice.content = choice.content.replace(imageRegex, function (imageHtml) {\r\n                    //设置图片期望高宽属性\r\n                    var imageSrc = _utils.getValue(imageHtml, imageSrcRegex);\r\n                    image = '<img data-media-img-render=\"false\" src=\"' + imageSrc + '\" alt=\"\"/>';\r\n                    return '';\r\n                });\r\n                choice.image = image;\r\n                //提取图片后判断是否还有文字\r\n                //替换掉html的空格编码\r\n                choiceText = _utils.getValue(choice.content, contentTextRegex).trim();\r\n                choice.content = choiceText;\r\n                //判断是否单字文本\r\n                if (choice.image !== '' || (choiceText.length !== 1 && !specifiedCharacterRegex.test(choiceText))) {\r\n                    _singleText = false;\r\n                }\r\n                //判断是否是空文本\r\n                if (choiceText === '') {\r\n                    choice.content = '';\r\n                }\r\n            }\r\n            //判断是否有太多的选项\r\n            if (_singleText === false && simpleChoice.length > 8) {\r\n                _tooManyOptions = true;\r\n            }\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return _utils.getLangText('voting',this.getOption()) ;\r\n            };\r\n            modelItem.getClassName = function () {\r\n                return 'nqti-vote';\r\n            };\r\n            //该model没有提示\r\n            modelItem.hasHint = function () {\r\n                return false;\r\n            };\r\n            //返回标题片段\r\n            modelItem.createTitleHtml = function (option) {\r\n                var sigleitem = _utils.getLangText('vote_sigleitem', option);\r\n                var mutipleitem = _utils.getLangText('vote_mutipleitem', option);\r\n                //标题处理，增加单项投票和不定项投票提示\r\n                var prefix = '<div>(' + sigleitem + ')</div>';\r\n                if (_model.maxChoices !== 1) {\r\n                    prefix = '<div>(' + mutipleitem + ')</div>';\r\n                }\r\n                return prefix + _model.prompt;\r\n            };\r\n            //返回答案片段\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var optionHtml = '';\r\n                var tipPre = _utils.getLangText('vote_tip_pre', option);\r\n                var tipEnd = _utils.getLangText('vote_tip_end', option);\r\n                var simpleChoice = _model.simpleChoice;\r\n                var choice;\r\n                //选项布局类型\r\n                //是否增加选项过多提示\r\n                if (_tooManyOptions) {\r\n                    optionHtml += '<div class=\"nqti-base-vote-hint\">'\r\n                            + '<span class=\"nqti-base-vote-txt\">'\r\n                            + tipPre + simpleChoice.length + tipEnd\r\n                            + '</span></div>';\r\n                }\r\n                var ulClass = 'nqti-fixed';\r\n                //单字文本去除nqti-fixed样式\r\n                if (_singleText) {\r\n                    ulClass = '';\r\n                }\r\n                optionHtml += '<ul class=\"nqti-base-vote-list ' + ulClass + '\">';\r\n                var liHtml;\r\n                for (var index = 0; index < simpleChoice.length; index++) {\r\n                    choice = simpleChoice[index];\r\n                    if (_singleText) {\r\n                        liHtml = '<span class=\"nqti-base-vote-list-txt\">' + choice.content + '</span>';\r\n                    } else {\r\n                        if (choice.image.length > 0) {\r\n                            //有图片\r\n                            liHtml = choice.image;\r\n                            if (choice.content.length > 0) {\r\n                                liHtml += '<p class=\"nqti-base-vote-list-desc\">'\r\n                                        +'<i class=\"opacity_black_bg\" style=\"display: none;\"></i>'\r\n                                        + '<sapn class=\"nqti-base-vote-list-desc-txt\">'\r\n                                        + choice.content\r\n                                        + '</span>'\r\n                                        + '</p>';\r\n                            }\r\n                        } else {\r\n                            liHtml = '<p class=\"nqti-base-vote-list-txt\">' + choice.content + '</p>';\r\n                        }\r\n                    }\r\n                    var iconText = choice.identifier;\r\n                    //获取统计信息\r\n                    if (option.showStat) {\r\n                        var stat = this.getStat();\r\n                        if (typeof stat[iconText] !== typeof undefined && stat[iconText] !== '') {\r\n                            iconText = iconText + '(' + stat[iconText] + ')';\r\n                        }\r\n                    }\r\n                    optionHtml += '<li class=\"nqti-base-vote-list-cell _qp-option\" data-identifier=\"' + choice.identifier + '\">'\r\n                            + '<div class=\"nqti-base-vote-list-box\">'\r\n                            + '<div class=\"nqti-base-vote-list-views\">'\r\n                            + liHtml\r\n                            + '<i class=\"nqti-checked-icon\"></i>'\r\n                            + '</div>'\r\n                            + '<p class=\"nqti-base-vote-list-index\">'\r\n                            + iconText\r\n                            + '</p>'\r\n                            + '</div>'\r\n                            + '</li>';\r\n                }\r\n                optionHtml += '</ul>';\r\n                return optionHtml;\r\n            };\r\n            //动态渲染\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n            };\r\n            //交互事件处理\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                var $option = $view.find('._qp-option');\r\n                $option.each(function () {\r\n                    var $that = $(this);\r\n                    $that.bind('qpTap', function () {\r\n                        if (that.isLock()) {\r\n                            return;\r\n                        }\r\n                        var optionChecked = $that.data('identifier');\r\n                        if ($that.hasClass('nqti-checked')) {\r\n                            $that.removeClass('nqti-checked');\r\n                        } else {\r\n                            $that.addClass('nqti-checked');\r\n                            if (_model.maxChoices === 1) {\r\n                                //单选,清除其他选中\r\n                                $option.each(function () {\r\n                                    var $this = $(this);\r\n                                    var option = $this.data('identifier');\r\n                                    if (option != optionChecked) {\r\n                                        $this.removeClass('nqti-checked');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                        //保存当前答案\r\n                        var answer = [];\r\n                        $option.each(function () {\r\n                            var $this = $(this);\r\n                            if ($this.hasClass('nqti-checked')) {\r\n                                answer.push($this.data('identifier').toString());\r\n                            }\r\n                        });\r\n                        that.setAnswer(answer);\r\n                    });\r\n                });\r\n            };\r\n\r\n            modelItem.renderReset = function ($view) {\r\n                $view.find('._qp-option').each(function () {\r\n                    var $this = $(this);\r\n                    $this.removeClass('nqti-checked');\r\n                });\r\n            };\r\n\r\n\r\n            modelItem.renderAnswer = function ($view) {\r\n                var answer = this.getAnswer();\r\n                $view.find('._qp-option').each(function () {\r\n                    var $this = $(this);\r\n                    for (var index = 0; index < answer.length; index++) {\r\n                        if ($this.data('identifier') == answer[index]) {\r\n                            $this.addClass('nqti-checked');\r\n                            break;\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n\r\n            modelItem.renderCheckedAnswer = function ($view) {\r\n                this.renderAnswer($view)\r\n            };\r\n\r\n            modelItem.renderCorrectAnswer = function ($view) {\r\n            };\r\n\r\n            modelItem.renderLock = function ($view) {\r\n\r\n            };\r\n        }\r\n    };\r\n    //注册\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})(window, jQuery);\r\n\r\n\n// drawingInteraction_handwrite\r\n(function (window, $) {\r\n    var _utils=QtiPlayer.getUtils();\r\n    //创建\r\n    var _modelHandler = {\r\n        _name: 'drawingInteraction_handwrite',\r\n        //获取model名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n            var _model = modelItem.getModel();\r\n            var _canvasWidth = _model.object.width - 4;\r\n            var _canvasHeight = _model.object.height - 8;\r\n            var _canvasId = 'cvs';\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return '手写题';\r\n            };\r\n\r\n            //该model没有小题编号\r\n            modelItem.hasNum = function () {\r\n                return false;\r\n            };\r\n            modelItem.createTitleHtml = function () {\r\n                return '<div class=\"qp-model-header\">' + _model.prompt + '</div>';\r\n            }\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var html = '';\r\n                var bg = _model.object.data;\r\n                var style = '';\r\n                var cavsBoxClass = '';\r\n                if (bg.length > 0) {\r\n                    style = 'background-image: url(\\'' + bg + '\\');'\r\n                }else{\r\n                    cavsBoxClass = ' qp-hw-cavs-nobg';\r\n                }\r\n\r\n                html += '      <div class=\"qp-hw-drawing-content qp-hw-bar-visible\"  \">                                                                                                                       ';\r\n                html += '      <div style=\"position: relative\" class=\"qp-hw-drawing-box '+cavsBoxClass+'\" >                                                                                                                       ';\r\n                html += '        <div  class=\"qp-hw-writing_edit\" >                                                                                                                          ';\r\n                html += '          <a href=\"javascript:void(0)\" class=\"qp-hw-writing_botton qp-hw-classlink\"  style=\"display: none\" id=\"btn_back\">                                                                  ';\r\n                html += '              <ins class=\"qp-hw-icon_back\"></ins>                                                                                                                ';\r\n                html += '          </a>                                                                                                                                                ';\r\n                html += '          <a href=\"javascript:void(0)\" class=\"qp-hw-writing_botton qp-hw-classlink qp-on\" id=\"write\">                                                                     ';\r\n                html += '              <ins class=\"qp-hw-icon_writing\"></ins>                                                                                                             ';\r\n                html += '          </a>                                                                                                                                                ';\r\n                html += '              <a href=\"javascript:void(0)\" class=\"qp-hw-writing_botton qp-hw-botton_clear\" id=\"clear\">                                                              ';\r\n                html += '                  <ins class=\"qp-hw-icon_clear\"></ins>                                                                                                           ';\r\n                html += '              </a>                                                                                                                                            ';\r\n                html += '              <a href=\"javascript:void(0)\"  class=\"qp-hw-writing_botton qp-hw-botton_allclear qp-hw-classlink\" id=\"clearall\">                                          ';\r\n                html += '                  <ins class=\"qp-hw-icon_allclear\"></ins>                                                                                                        ';\r\n                html += '              </a>                                                                                                                                            ';\r\n                html += '        </div>                                                                                                   ';\r\n                html += '          <canvas class=\"qp-hw-cavs \" id=\"' + _canvasId + '\" style=\"' + style + '\">               ';\r\n                html += '              Fallback content, in case the browser does not support Canvas.                                                                                  ';\r\n                html += '          </canvas>                                                                                                                                           ';\r\n                html += '      </div>                                                                                                                                                  ';\r\n                html += '      </div>                                                                                                                                                  ';\r\n                return html;\r\n            }\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n                //画板\r\n                var $canvas = $view.find(\".qp-hw-drawing-content canvas\");\r\n                //工具栏\r\n                var $writingBar = $view.find('.qp-hw-writing_edit');\r\n                //移动端不显示编辑按钮\r\n                if (_utils.Broswer.any()) {\r\n                    $writingBar.hide();\r\n                    $view.find('.qp-hw-bar-visible').removeClass('qp-hw-bar-visible');\r\n                }\r\n\r\n                //初始化画板大小\r\n                $canvas.css({\r\n                    width: _canvasWidth,\r\n                    height: _canvasHeight\r\n                });\r\n                if ($canvas.length > 0 && $canvas[0]) {\r\n                    $canvas[0].width = _canvasWidth;\r\n                    $canvas[0].height = _canvasHeight;\r\n                }\r\n                $view.find('.qp-hw-drawing-box').css({\r\n                    width: _canvasWidth\r\n                });\r\n\r\n                //渲染答案\r\n                if (option.showAnswer || option.showCorrectAnswer|| option.showCheckedAnswer) {\r\n                    var answers = option.showCorrectAnswer ? that.getCorrectAnswer() : that.getAnswer();\r\n                    if (answers && answers.length > 0 && answers[0]) {\r\n                        var answers = answers[0].split('|$*-*$|')[1];\r\n                        var ctx = $canvas[0].getContext(\"2d\");\r\n                        var image = new Image();\r\n                        image.onload = function () {\r\n                            ctx.drawImage(image, 0, 0);\r\n                        };\r\n                        image.src = answers;\r\n                    }\r\n                }\r\n\r\n            }\r\n            modelItem.eventHandle = function ($view, option) {\r\n                if (option.hideAnswerArea) {\r\n                    return;\r\n                }\r\n                //qti-player内部已经略过该题型，eventHandle默认就会执行\r\n                if (option.showLock) {\r\n                    return;\r\n                }\r\n                var that = this;\r\n                //画板\r\n                var $canvas = $view.find(\".qp-hw-drawing-content canvas\");\r\n\r\n                var lock = false,\r\n                    lastX = -1,\r\n                    lastY = -1,\r\n                    isEraser = false,\r\n                    cxt = $canvas[0].getContext('2d');\r\n                cxt.lineJoin = \"round\";//指定两条线段的连接方式\r\n\r\n\r\n                var getMousePos = function (evt) {\r\n                    var rect = $canvas[0].getBoundingClientRect();\r\n                    var point = {};\r\n                    switch (evt.type) {\r\n                        case 'touchstart':\r\n                        case 'touchmove':\r\n                        case 'touchend':\r\n                        case 'touchcancel':\r\n                            point = {\r\n                                x: evt.originalEvent.targetTouches[0].clientX - rect.left,\r\n                                y: evt.originalEvent.targetTouches[0].clientY - rect.top\r\n                            };\r\n                            break;\r\n                        default :\r\n                            point = {\r\n                                x: evt.clientX - rect.left,\r\n                                y: evt.clientY - rect.top\r\n                            };\r\n                            break;\r\n\r\n                    }\r\n\r\n                    return point;\r\n                };\r\n\r\n                //清除函数\r\n                var clearLine = function (coordinate) {\r\n                    //获取坐标\r\n                    var x = coordinate.x;\r\n                    var y = coordinate.y;\r\n                    //清除\r\n                    cxt.clearRect(x - 15, y - 15, 30, 30);\r\n                };\r\n\r\n\r\n                var drawPoint = function (coordinate) {\r\n                    //console.log(coordinate);\r\n                    var x = coordinate.x;\r\n                    var y = coordinate.y;\r\n                    cxt.beginPath();//准备绘制一条路径\r\n                    if (lastX === -1) {\r\n                        cxt.moveTo(x - 1, y);\r\n                    } else {\r\n                        cxt.moveTo(lastX, lastY);\r\n                    }\r\n                    cxt.lineTo(x, y);//将当前点与指定的点用一条笔直的路径连接起来\r\n                    cxt.closePath();//关闭当前路径\r\n                    cxt.stroke();//绘制当前路径\r\n                    //将但前坐标作为下一线的起点\r\n                    lastX = x;\r\n                    lastY = y;\r\n                };\r\n\r\n                var clear = function () {\r\n                    cxt.clearRect(0, 0, _canvasWidth, _canvasHeight);//清除画布，左上角为起点\r\n                    that.setAnswer(getAnswer());\r\n                };\r\n\r\n                var getAnswer = function () {\r\n                    var answer = [];\r\n\r\n                    var arry = {\r\n                        img: {\r\n                            width: _canvasWidth,\r\n                            height: _canvasHeight\r\n                        }\r\n                    };\r\n                    answer.push(JSON.stringify(arry) + \"|$*-*$|\" + $canvas[0].toDataURL());\r\n                    return answer;\r\n                };\r\n\r\n                var event = (function () {\r\n                    //if (ModuleUtil.IsMobile.any() && ( 'ontouchend' in document)) {\r\n                        return {\r\n                            move: 'touchmove mousemove',\r\n                            down: 'touchstart mousedown',\r\n                            up: 'touchend touchcancel mouseup mouseleave'\r\n                        };\r\n                    //} else {\r\n                    //    return {\r\n                    //        move: 'mousemove',\r\n                    //        down: 'mousedown',\r\n                    //        up: 'mouseup'\r\n                    //    };\r\n                    //}\r\n                })();\r\n\r\n\r\n                $canvas.on(event.move, function (e) {\r\n                    //t.lock为true则执行\r\n                    if (lock) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        var point = getMousePos(e);\r\n                        if (isEraser) {\r\n                            clearLine(point);\r\n                        } else {\r\n                            drawPoint(point);//绘制路线\r\n                        }\r\n                    }\r\n                });\r\n                $canvas.on(event.down, function (e) {\r\n                    $(\"input\").blur();\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    var point = getMousePos(e);\r\n                    if (isEraser) {\r\n                        clearLine(point);\r\n                    } else {\r\n                        drawPoint(point);//绘制路线\r\n                    }\r\n                    lock = true;\r\n\r\n                });\r\n                $canvas.on(event.up, function (e) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    lock = false;\r\n                    that.setAnswer(getAnswer());\r\n                    lastX = -1;\r\n                    lastY = -1;\r\n                });\r\n                $canvas.on('click',function(e){\r\n                    $(\"input\").blur();\r\n                });\r\n                $view.on(event.move, function (ev) {\r\n                    if (lock) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        var oEvent = ev.originalEvent || event;\r\n                        if (oEvent.target.id != _canvasId) {\r\n                            lock = false;\r\n                            that.setAnswer(getAnswer());\r\n                        }\r\n                    }\r\n                });\r\n                var $clear= $view.find('#clear');\r\n                var $write= $view.find('#write');\r\n                var $clearall= $view.find('#clearall');\r\n                $clear.on(\"click\", function () {\r\n                    isEraser = true;\r\n                    $clear.addClass('qp-on');\r\n                    $write.removeClass('qp-on');\r\n                });\r\n                $write.on(\"click\", function () {\r\n                    isEraser = false;\r\n                    $write.addClass('qp-on');\r\n                    $clear.removeClass('qp-on');\r\n                });\r\n                $clearall.on(\"click\", function () {\r\n                    clear();\r\n                });\r\n            }\r\n\r\n        }\r\n    };\r\n    //注册\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})\r\n(window, jQuery);\r\n\n// drawingInteraction_drawing\r\n(function (window, $) {\r\n    var _utils = window.QtiPlayer.getUtils();\r\n    //创建modal\r\n    var _modelHandler = {\r\n        _modalName: 'drawingInteraction_drawing',\r\n        //获取modal名称\r\n        getName: function () {\r\n            return this._modalName;\r\n        },\r\n        create: function (modelItem) {\r\n            //获取模型数据\r\n            var _model = modelItem.getModel();\r\n            //初始化导航和按钮文本\r\n\r\n            //标题输入框正则\r\n            var _textEntryRegex = /<textEntry([\\s\\S])*?\\/>/g;\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return '作文题';\r\n            };\r\n\r\n            //该model没有小题编号\r\n            modelItem.hasNum = function () {\r\n                return false;\r\n            };\r\n            //该model没有提示\r\n            modelItem.hasHint = function () {\r\n                return false;\r\n            };\r\n            //返回标题片段\r\n            modelItem.createTitleHtml = function () {\r\n                return '';\r\n            };\r\n            //返回答案区域片段\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var _stem = _utils.getLangText('drawing_stem', option);\r\n                var _sourceMaterial = _utils.getLangText('drawing_source_material', option);\r\n                var _viewTopics = _utils.getLangText('drawing_view_topics', option);\r\n                var _viewMaterial = _utils.getLangText('drawing_view_material', option);\r\n                var _continueWrite = _utils.getLangText('drawing_continue_write', option);\r\n                //导航栏\r\n                var nav = '<div class=\"qp-drawing-navigation-wrapper\">'\r\n                        + '<ul class=\"qp-drawing-navigation qp-clearfix\">';\r\n                nav += '<li class=\"qp-drawing-navigation-item selected qp-drawing-navigation-title\">' + _stem + '</li>';\r\n                if (_model.asset.length > 0) {\r\n                    nav += '<li class=\"qp-drawing-navigation-item qp-drawing-navigation-asset\">' + _sourceMaterial + '</li>';\r\n                }\r\n                nav += '</ul></div>';\r\n                //按钮栏\r\n                var toolBar = '<div class=\"qp-drawing-toolbar qp-clearfix\">'\r\n                        + '<a href=\"javascript:void(0)\" class=\"qp-drawing-button qp-view-title-button\">' + _viewTopics + '</a>';\r\n                if (_model.asset.length > 0) {\r\n                    toolBar += '<a href=\"javascript:void(0)\" class=\"qp-drawing-button qp-view-asset-button\">' + _viewMaterial + '</a>';\r\n                }\r\n                toolBar += '</div>';\r\n                //内容区域-题干内容\r\n                var title = _model.title.replace(_textEntryRegex, '<span class=\"qp-underline\"></span>');\r\n                var titleContent = '<div class=\"qp-drawing-content-item \" data-index=\"title\">'\r\n                        + '<div class=\"qp-title-contnet\">'\r\n                        + '<div class=\"qp-text\">' + title + '</div>'\r\n                        + '<div class=\"qp-text\">' + _model.content + '</div>'\r\n                        + '</div>'\r\n                        + '</div>';\r\n                //内容区域-素材内容\r\n                var assetClass = '';\r\n                if (_model.asset.length === 1) {\r\n                    assetClass = 'qp-asset-one';\r\n                } else if (_model.asset.length === 2) {\r\n                    assetClass = 'qp-asset-two';\r\n                }\r\n\r\n                var assetNav = '<ul class=\"qp-asset-navigation '+assetClass+'\">';\r\n                var assetContentItem = '<div class=\"qp-asset-content\">';\r\n                var selectClass = 'selected';\r\n                for (var index = 0; index < _model.asset.length; index++) {\r\n                    assetNav += '<li data-index=\"asset' + index + '\" class=\"qp-asset-navigation-item ' + selectClass + '\">' + _sourceMaterial + (index + 1) + '</li>';\r\n                    assetContentItem += '<div data-index=\"asset' + index + '\" class=\"qp-asset-content-item ' + (index == 0 ? '' : ' qp-left-hide') + '\">'\r\n                        + '<div class=\"qp-text\">' + _model.asset[index] + '</div>'\r\n                        + '</div>';\r\n                    selectClass = '';\r\n                }\r\n                assetNav += '</ul>';\r\n                assetContentItem += '</div>';\r\n                var assetContent = '<div class=\"qp-drawing-content-item qp-left-hide\" data-index=\"asset\">'\r\n                        + assetNav\r\n                        + assetContentItem\r\n                        + '</div>';\r\n                //内容区域\r\n                var content = '<div class=\"qp-drawing-content\">'\r\n                        + titleContent\r\n                        + assetContent\r\n                        + '</div>';\r\n                //书写区域-工具栏\r\n                var editToolBar = '<div class=\"qp-drawing-edit-toolbar\">'\r\n                        + '<a href=\"javascript:void(0)\" class=\"qp-edit-button qp-edit-button-back\"><ins class=\"qp-edit-button-icon\"></ins></a>'\r\n                        + '<a href=\"javascript:void(0)\" class=\"qp-edit-button qp-edit-button-clear\"><ins class=\"qp-edit-button-icon\"></ins></a>'\r\n                        + '<a href=\"javascript:void(0)\" class=\"qp-edit-button qp-edit-button-allclear\"><ins class=\"qp-edit-button-icon\"></ins></a>'\r\n                        + '<a href=\"javascript:void(0)\" class=\"qp-edit-button qp-edit-button-writing qp-on\"><ins class=\"qp-edit-button-icon\"></ins></a>'\r\n                        + '</div>';\r\n                //书写区域-内容\r\n                var inputIndex = 0;\r\n                var editContentTitle = '<div class=\"qp-drawing-edit-content-title\">';\r\n                editContentTitle += _model.title.replace(_textEntryRegex, function (m) {\r\n                    var result = '<span class=\"qp-textentry\">'\r\n                            + '<input class=\"qp-textentry-input\" type=\"text\" placeholder=\"\" data-index=\"' + inputIndex + '\"/>'\r\n                            + '</span>';\r\n                    inputIndex++;\r\n                    return result;\r\n                });\r\n                editContentTitle += '</div>';\r\n                var editContent = '<div class=\"qp-drawing-edit-content\">'\r\n                        + editContentTitle\r\n                        + '    <div class=\"qp-drawing-edit-content-canvas-wrapper\">'\r\n                        + '    <canvas class=\"qp-drawing-edit-content-canvas\" width=\"770\" height=\"750\">Fallback content, in case the browser does not support Canvas.</canvas>'\r\n                        + '    </div>'\r\n                        + '</div>';\r\n                //书写区域\r\n                var edit = '<div class=\"qp-drawing-edit qp-left-hide\">'\r\n                        + editToolBar\r\n                        + editContent\r\n                        + '</div>';\r\n                //底部按钮\r\n                var bottomBar = '<div class=\"qp-drawing-bottom\">'\r\n                        + '<a href=\"javascript:void(0)\" class=\"qp-drawing-button qp-write-button\">' + _continueWrite + '</a>'\r\n                        + '</div>';\r\n                //返回\r\n                var result = '<div class=\"qp-model-content qp-drawing\">'\r\n                        + nav\r\n                        + toolBar\r\n                        + content\r\n                        + edit\r\n                        + bottomBar;\r\n                return result;\r\n            };\r\n            //动态渲染\r\n            modelItem.render = function ($view, option) {\r\n                //书写区域背景图片渲染\r\n                var $editCanvas = $view.find('.qp-drawing-edit-content-canvas');\r\n                if ($editCanvas.length > 0) {\r\n                    //加载题目设定的背景图片，如果背景图片不存在，则使用默认背景\r\n                    var imgUrl = _model.object.data;\r\n                    if (imgUrl === '') {\r\n                        //没有设定背景图片,使用默认背景\r\n                        $editCanvas.addClass('qp-edit-default-background');\r\n                    } else {\r\n                        //有设定背景图片，开始加载背景\r\n                        var img = new Image();\r\n                        img.onerror = function () {\r\n                            //设定的图片加载异常，改为默认图片\r\n                            $editCanvas.addClass('qp-edit-default-background');\r\n                        };\r\n                        img.onload = function () {\r\n                            //设定的图片加载成功,设置为背景\r\n                            $editCanvas.css('background-image', 'url(' + imgUrl + ')');\r\n                        };\r\n                        img.src = imgUrl;\r\n                    }\r\n                }\r\n                //渲染导航、素材交互事件\r\n                //导航title项\r\n                var $navTitleItem = $view.find('.qp-drawing-navigation-title');\r\n                //导航asset项\r\n                var $navAssetItem = $view.find('.qp-drawing-navigation-asset');\r\n                //内容\r\n                var $contentItem = $view.find('.qp-drawing-content-item');\r\n                //导航title项点击\r\n                $navTitleItem.bind('qpTap', function () {\r\n                    if ($navTitleItem.hasClass('selected') === false) {\r\n                        //title项没有被选中，切换到title内容\r\n                        $navAssetItem.removeClass('selected');\r\n                        $navTitleItem.addClass('selected');\r\n                        //切换到title内容\r\n                        $contentItem.each(function () {\r\n                            var $this = $(this);\r\n                            var contentIndex = $this.data('index');\r\n                            if ('title' === contentIndex) {\r\n                                $this.removeClass('qp-left-hide');\r\n                            } else {\r\n                                $this.addClass('qp-left-hide');\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n                //导航asset项点击事件\r\n                $navAssetItem.bind('qpTap', function () {\r\n                    if ($navAssetItem.hasClass('selected') === false) {\r\n                        //asset项没有被选中，切换到asset内容\r\n                        $navTitleItem.removeClass('selected');\r\n                        $navAssetItem.addClass('selected');\r\n                        //切换asset内容\r\n                        $contentItem.each(function () {\r\n                            var $this = $(this);\r\n                            var contentIndex = $this.data('index');\r\n                            if ('asset' === contentIndex) {\r\n                                $this.removeClass('qp-left-hide');\r\n                            } else {\r\n                                $this.addClass('qp-left-hide');\r\n\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n                //素材导航\r\n                var $assetNavItem = $view.find('.qp-asset-navigation-item');\r\n                //素材内容\r\n                var $assetContentItem = $view.find('.qp-asset-content-item');\r\n                //素材导航事件\r\n                $assetNavItem.bind('qpTap', function () {\r\n                    var $that = $(this);\r\n                    if ($that.hasClass('selected') === false) {\r\n                        //当前导航项没有被选中，切换到新的导航内容，旧导航内容隐藏\r\n                        $assetNavItem.removeClass('selected');\r\n                        $that.addClass('selected');\r\n                        //切换内容\r\n                        var navIndex = $that.data('index');\r\n                        $assetContentItem.each(function () {\r\n                            var $this = $(this);\r\n                            var contentIndex = $this.data('index');\r\n                            if (navIndex === contentIndex) {\r\n                                $this.removeClass('qp-left-hide');\r\n                            } else {\r\n                                $this.addClass('qp-left-hide');\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            };\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                //作文题显示区域$drawing\r\n                var $drawing = $view.find('.qp-drawing');\r\n                //导航title项\r\n                var $navTitleItem = $view.find('.qp-drawing-navigation-title');\r\n                //导航asset项\r\n                var $navAssetItem = $view.find('.qp-drawing-navigation-asset');\r\n                //查看题目按钮\r\n                var $viewTitleButton = $view.find('.qp-view-title-button');\r\n                //查看素材按钮\r\n                var $viewAssetButton = $view.find('.qp-view-asset-button');\r\n                //作答按钮\r\n                var $wirteButton = $view.find('.qp-write-button');\r\n                //画板\r\n                var $editCanvas = $view.find('.qp-drawing-edit-content-canvas');\r\n                //画板按钮-画笔按钮\r\n                var $drawButton = $view.find('.qp-edit-button-writing');\r\n                //画板按钮-清除按钮\r\n                var $allClearButton = $view.find('.qp-edit-button-allclear');\r\n                //画板按钮-橡皮擦按钮\r\n                var $clearButton = $view.find('.qp-edit-button-clear');\r\n                //画板按钮-撤销按钮\r\n                var $backButton = $view.find('.qp-edit-button-back');\r\n                //作文题内容区域\r\n                var $drawingEdit = $view.find('.qp-drawing-edit');\r\n                //写作按钮事件\r\n                $wirteButton.bind('qpTap', function () {\r\n                    //进入书写状态\r\n                    $drawing.addClass('qp-writing');\r\n                    $drawingEdit.removeClass('qp-left-hide');\r\n                });\r\n                //查看题目事件\r\n                $viewTitleButton.bind('qpTap', function () {\r\n                    //退出书写状态\r\n                    $drawing.removeClass('qp-writing');\r\n                    $drawingEdit.addClass('qp-left-hide');\r\n                    //触发导航中title项点击事件处理\r\n                    $navTitleItem.triggerHandler('qpTap');\r\n                });\r\n                //查看素材事件\r\n                $viewAssetButton.bind('qpTap', function () {\r\n                    //退出书写状态\r\n                    $drawing.removeClass('qp-writing');\r\n                    $drawingEdit.addClass('qp-left-hide');\r\n                    //触发导航中asset项点击事件处理\r\n                    $navAssetItem.triggerHandler('qpTap');\r\n                });\r\n                if ($editCanvas.length > 0) {\r\n                    //输入框\r\n                    var $input = $drawing.find('input');\r\n                    //画布\r\n                    var editCanvas = $editCanvas[0];\r\n                    var ctx = editCanvas.getContext('2d');\r\n                    ctx.lineJoin = \"round\";//指定两条线段的连接方式\r\n                    ctx.lineWidth = 1;\r\n                    //状态\r\n                    var state = {\r\n                        edit: false,\r\n                        type: 'draw',\r\n                        lastX: -1,\r\n                        lastY: -1,\r\n                        //dataUrl保存绘图的结果数据，最新的数据放在最前面\r\n                        dataUrl: [],\r\n                        inputState: {},\r\n                        inputAnswer: []\r\n                    };\r\n                    //初始化状态\r\n                    $input.each(function () {\r\n                        var $this = $(this);\r\n                        var index = $this.data('index');\r\n                        state.inputState[index] = {\r\n                            timer: null,\r\n                            lastValue: ''\r\n                        };\r\n                    });\r\n                    //保存整道题答案\r\n                    var saveAllAnswer = function () {\r\n                        var dataUrl = '';\r\n                        if (state.dataUrl.length > 0) {\r\n                            dataUrl = state.dataUrl[0];\r\n                        }\r\n                        var allAnswer = {\r\n                            img: dataUrl,\r\n                            answer: state.inputAnswer\r\n                        };\r\n                        var answer = [];\r\n                        answer.push(allAnswer);\r\n                        that.setAnswer(answer);\r\n                    };\r\n                    //标题填空区域处理\r\n                    //保存填空题答案\r\n                    var saveInputAnswer = function (index, value) {\r\n                        if (state.inputAnswer.length === 0) {\r\n                            var length = $input.length;\r\n                            while (length > 0) {\r\n                                state.inputAnswer.push('');\r\n                                length--;\r\n                            }\r\n                        }\r\n                        state.inputAnswer[index] = value;\r\n                        //保存整道题答案\r\n                        saveAllAnswer();\r\n                    };\r\n                    //获取焦点时定时检测输入输入框变化\r\n                    $input.bind('focus', function () {\r\n                        //定时检测输入输入框变化\r\n                        var $this = $(this);\r\n                        var index = $this.data('index');\r\n                        var inputState = state.inputState[index];\r\n                        inputState.timer = setInterval(function () {\r\n                            var newValue = $this.val();\r\n                            if (newValue !== inputState.lastValue) {\r\n                                //输入内容有变化\r\n                                inputState.lastValue = newValue;\r\n                                saveInputAnswer(index, newValue);\r\n                            }\r\n                        }, 500);\r\n                    });\r\n                    //输入结束后保存答案\r\n                    $input.bind('blur', function () {\r\n                        var $this = $(this);\r\n                        var index = $this.data('index');\r\n                        //清除定时器\r\n                        var inputState = state.inputState[index];\r\n                        clearInterval(inputState.timer);\r\n                        inputState.timer = null;\r\n                        //保存答案\r\n                        var newValue = $this.val();\r\n                        $this.val(newValue);\r\n                        saveInputAnswer(index, newValue);\r\n                        inputState.lastValue = newValue;\r\n                    });\r\n                    //书写区域canvas处理\r\n                    //获取鼠标在画布上的坐标\r\n                    var getMousePos = function (evt) {\r\n\r\n                        var rect = editCanvas.getBoundingClientRect();\r\n                        var point = {};\r\n                        switch (evt.type) {\r\n                            case 'touchstart':\r\n                            case 'touchmove':\r\n                            case 'touchend':\r\n                            case 'touchcancel':\r\n                                point = {\r\n                                    x: evt.originalEvent.targetTouches[0].clientX - rect.left,\r\n                                    y: evt.originalEvent.targetTouches[0].clientY - rect.top\r\n                                };\r\n                                break;\r\n                            default :\r\n                                point = {\r\n                                    x: evt.clientX - rect.left,\r\n                                    y: evt.clientY - rect.top\r\n                                };\r\n                                break;\r\n\r\n                        }\r\n                        point.x=point.x* (editCanvas.width / rect.width);\r\n                        point.y=point.y* (editCanvas.height / rect.height);\r\n                        return point;\r\n                    };\r\n                    //绘图函数\r\n                    var drawLine = function (evt) {\r\n                        //获取坐标\r\n                        var coordinate = getMousePos(evt);\r\n                        var x = coordinate.x;\r\n                        var y = coordinate.y;\r\n                        ctx.beginPath();//准备绘制一条路径\r\n                        if (state.lastX === -1) {\r\n                            ctx.moveTo(x - 1, y);\r\n                        } else {\r\n                            ctx.moveTo(state.lastX, state.lastY);\r\n                        }\r\n                        ctx.lineTo(x, y);//将当前点与指定的点用一条笔直的路径连接起来\r\n                        ctx.closePath();//关闭当前路径\r\n                        ctx.stroke();//绘制当前路径\r\n                        //将但前坐标作为下一线的起点\r\n                        state.lastX = x;\r\n                        state.lastY = y;\r\n                    };\r\n                    //清除函数\r\n                    var clearLine = function (evt) {\r\n                        //获取坐标\r\n                        var coordinate = getMousePos(evt);\r\n                        var x = coordinate.x;\r\n                        var y = coordinate.y;\r\n                        //清除\r\n                        ctx.clearRect(x - 15, y - 15, 30, 30);\r\n                    };\r\n                    //保存绘图数据\r\n                    var saveImageData = function () {\r\n                        var data = editCanvas.toDataURL();\r\n                        //最新数据插入带数据的开头\r\n                        state.dataUrl.unshift(data);\r\n                        //控制最多保存30次操作\r\n//                        while (state.dataUrl.length > 30) {\r\n//                            state.dataUrl.pop();\r\n//                        }\r\n                        //保存整道题答案\r\n                        saveAllAnswer();\r\n                    };\r\n                    //画笔按钮点击事件\r\n                    $drawButton.bind('qpTap', function () {\r\n                        state.type = 'draw';\r\n                        $drawButton.addClass('qp-on');\r\n                        $clearButton.removeClass('qp-on');\r\n                    });\r\n                    //橡皮擦按钮点击事件\r\n                    $clearButton.bind('qpTap', function () {\r\n                        state.type = 'clear';\r\n                        $drawButton.removeClass('qp-on');\r\n                        $clearButton.addClass('qp-on');\r\n                    });\r\n                    //清除按钮点击事件\r\n                    $allClearButton.bind('qpTap', function () {\r\n                        ctx.clearRect(0, 0, editCanvas.width, editCanvas.height);//清除画布，左上角为起点\r\n                        //保存绘图数据\r\n                        saveImageData();\r\n                    });\r\n                    //撤销钮点击事件\r\n                    $backButton.bind('qpTap', function () {\r\n                        state.dataUrl.shift();\r\n                        if (state.dataUrl.length > 0) {\r\n                            //还原图像\r\n                            var dataUrl = state.dataUrl[0];\r\n                            var img = new Image();\r\n                            img.onload = function () {\r\n                                //先清除画布\r\n                                ctx.clearRect(0, 0, editCanvas.width, editCanvas.height);\r\n                                //还原图片\r\n                                ctx.drawImage(img, 0, 0);\r\n                                //保存整道题答案\r\n                                saveAllAnswer();\r\n                            };\r\n                            img.src = dataUrl;\r\n                        } else {\r\n                            //没有图片数据，直接清除画布\r\n                            ctx.clearRect(0, 0, editCanvas.width, editCanvas.height);\r\n                            //保存整道题答案\r\n                            saveAllAnswer();\r\n                        }\r\n                    });\r\n                    //鼠标按住事件\r\n                    $editCanvas.bind('mousedown touchstart', function (evt) {\r\n                        evt.preventDefault();\r\n                        state.edit = true;\r\n                        if (state.type === 'draw') {\r\n                            //绘制\r\n                            drawLine(evt);\r\n                        } else {\r\n                            //擦除\r\n                            clearLine(evt);\r\n                        }\r\n                        //\r\n                        $editCanvas.bind('mousemove touchmove', function (evt) {\r\n                            if (state.edit) {\r\n                                evt.preventDefault();\r\n                                if (state.type === 'draw') {\r\n                                    //绘制\r\n                                    drawLine(evt);\r\n                                } else {\r\n                                    //擦除\r\n                                    clearLine(evt);\r\n                                }\r\n                            }\r\n                        });\r\n                    });\r\n                    //鼠标放开事件\r\n                    $editCanvas.bind('mouseup mouseout touchend touchcancel', function (evt) {\r\n                        if (state.edit) {\r\n                            evt.preventDefault();\r\n                            //保存绘图数据\r\n                            saveImageData();\r\n                            $editCanvas.unbind('mousemove');\r\n                            state.edit = false;\r\n                            state.lastX = -1;\r\n                            state.lastY = -1;\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    };\r\n    //注册modal\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})(window, jQuery);\r\n\r\n\n// choiceInteraction\r\n(function (window, $) {\r\n    var _utils = window.QtiPlayer.getUtils();\r\n    //创建\r\n    var _modelHandler = {\r\n        _name: 'extendedTextInteraction',\r\n        //获取modal名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n            var _model = modelItem.getModel();\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return _utils.getLangText('question', this.getOption());\r\n            };\r\n\r\n            modelItem.getClassName = function () {\r\n                return 'nqti-base-essayQuestion';\r\n            };\r\n            modelItem.createTitleHtml = function () {\r\n                return _model.prompt;\r\n            };\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var result = '';\r\n                //if(option.showCorrectAnswer) {\r\n                //参考答案\r\n                var rubricBlock = _model.rubricBlock;\r\n                if (rubricBlock && rubricBlock.prompt) {\r\n                    result += '<div class=\"_nqti-answer nqti-hide-dom\">' + rubricBlock.prompt + '</div>';\r\n                }\r\n                //} else {\r\n                result += '<div class=\"nqti-base-essayQuestion-wrap _nqti-textarea\">'\r\n                    + '<textarea class=\"nqti-base-essay-area nqti-scrollbar-style-gray _essay-area\"></textarea>'\r\n                    + '</div>';\r\n                //}\r\n                return result;\r\n            };\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n\r\n            };\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                var _$textarea = $view.find('._essay-area');\r\n                _$textarea.bind('input propertychange', function (e) {\r\n                    var answer = [];\r\n                    answer.push(_$textarea.val());\r\n                    if (e.type === 'propertychange') {\r\n                        if (e.originalEvent.propertyName === 'value') {\r\n                            that.setAnswer(answer);\r\n                        }\r\n                    } else {\r\n                        that.setAnswer(answer);\r\n                    }\r\n                    //if ((that.__reset === true ||that.__lock === true) && answer[0] === '') {\r\n                    //    that.__reset = false;\r\n                    //    that.__lock = false;\r\n                    //    return;\r\n                    //} else {\r\n                    //    that.__reset = false;\r\n                    //\r\n                    //}\r\n\r\n                });\r\n            };\r\n\r\n            modelItem.__unbind = function ($view) {\r\n                //var _$textarea = $view.find('._essay-area');\r\n                //_$textarea.unbind('input propertychange ');\r\n            };\r\n\r\n            modelItem.renderReset = function ($view) {\r\n                //this.__unbind($view);\r\n                $view.find('._nqti-answer').addClass('nqti-hide-dom');\r\n                $view.find('._nqti-textarea').removeClass('nqti-hide-dom');\r\n                var $textarea = $view.find('._essay-area');\r\n                //this.__reset = true;\r\n                $textarea.text('');\r\n            };\r\n\r\n\r\n            modelItem.renderAnswer = function ($view) {\r\n                this.__unbind($view);\r\n                //this.__reset = false;\r\n                var $textarea = $view.find('._essay-area');\r\n                var answer = this.getAnswer();\r\n                var currentAnswer = '';\r\n                if (answer.length > 0) {\r\n                    currentAnswer = answer[0];\r\n                }\r\n                //使用text兼容ie8\r\n                $textarea.text(currentAnswer);\r\n            };\r\n\r\n            modelItem.renderCheckedAnswer = function ($view) {\r\n                this.__unbind($view);\r\n                //this.__reset = false;\r\n                this.renderAnswer($view);\r\n                var $textarea = $view.find('._essay-area');\r\n                $textarea.attr('readonly', 'readonly');\r\n            };\r\n\r\n            modelItem.renderCorrectAnswer = function ($view) {\r\n                this.__unbind($view);\r\n                //this.__reset = false;\r\n                $view.find('._nqti-answer').removeClass('nqti-hide-dom');\r\n                $view.find('._nqti-textarea').addClass('nqti-hide-dom');\r\n            };\r\n\r\n            modelItem.renderLock = function ($view) {\r\n                var $textarea = $view.find('._essay-area');\r\n                //this.__lock = true;\r\n                if (this.isLock()) {\r\n                    $textarea.attr('readonly', 'readonly');\r\n                } else {\r\n                    $textarea.removeAttr('readonly');\r\n                }\r\n            };\r\n        }\r\n    };\r\n\r\n    //注册\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})(window, jQuery);\r\n\r\n\n// matchInteraction\r\n(function (window, $) {\r\n//创建modal\r\n    var _utils = window.QtiPlayer.getUtils();\r\n    var _logger = window.QtiPlayer.getLogger();\r\n    var _modelHandler = {\r\n        _modalName: 'gapMatchInteraction',\r\n        //获取modal名称\r\n        getName: function () {\r\n            return this._modalName;\r\n        },\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n\r\n            var interaction = null;\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return '表格题';\r\n            };\r\n\r\n            modelItem.init = function () {\r\n                interaction = new GraphicGapMatchInteraction(modelItem);\r\n            }\r\n            //该model没有小题编号\r\n            modelItem.hasNum = function () {\r\n                return false;\r\n            };\r\n            //该model没有提示\r\n            modelItem.hasHint = function () {\r\n                return false;\r\n            };\r\n            modelItem.createTitleHtml = function () {\r\n                return '';\r\n            }\r\n            modelItem.createAnswerHtml = function (option) {\r\n                interaction.setOption(option);\r\n                return interaction.createHtml();\r\n            }\r\n            modelItem.render = function ($view, option) {\r\n                interaction.setOption(option);\r\n            }\r\n            modelItem.eventHandle = function ($view, option) {\r\n                if (option.hideAnswerArea) {\r\n                    return;\r\n                }\r\n                interaction.eventHandle($view);\r\n            };\r\n        }\r\n    };\r\n//注册modal\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n\r\n    var GraphicGapMatchInteraction = window.QtiPlayer.Class(window.QtiPlayer.BaseInteraction, (function () {\r\n\r\n        //要严格按照顺序\r\n        var LocationType = {\r\n            Left: \"Left\",\r\n            Right: \"Right\",\r\n            LeftTop: \"LeftTop\",\r\n            RightTop: \"RightTop\",\r\n            LeftBottom: \"LeftBottom\",\r\n            RightBottom: \"RightBottom\",\r\n            Bottom: \"Bottom\",\r\n            Middle: \"Middle\",\r\n            Top: \"Top\",\r\n            TopToBottom: \"TopToBottom\",\r\n            None: \"None\"\r\n        };\r\n\r\n        //类成员\r\n        var member = {\r\n\r\n            /**\r\n             * 构造函数，并声明全局变量\r\n             * @param modalItem\r\n             * @param $view\r\n             * @param option\r\n             * @constructor\r\n             */\r\n            Create: function (modalItem, $view, option) {\r\n                this.base(modalItem, $view, option);\r\n\r\n                this.RESBOX_HEIGHT = 70;//选项高度\r\n                this.TARGET_MARGIN_TOP = 5;//选项放置时，距离上面高度\r\n                this.TARGET_BOX_WIDTH = 140;//表格td宽度\r\n                this.RES_BORDER = 1;//选项边框宽度\r\n                this.TD_BORDER = 0;//表格宽度\r\n                this.TABLE_SPACING = 10;//表格宽度\r\n                this.RESBOX_MARGIN_RIGHT = 15;\r\n\r\n\r\n                this.resBoxRects = [];\r\n                this.targetBoxsRects = [];\r\n                this.absOffset = null;\r\n\r\n                this.zindex = 1;//拖动的zindex最高值\r\n            },\r\n\r\n            /**\r\n             * 渲染数据\r\n             */\r\n            eventHandle: function ($view) {\r\n                var _self = this;\r\n                var $targetBoxs = $view.find(\" .qp-gapText-td\");\r\n                var $resBoxs = {};\r\n                $view.find(\" .edu-question-list-container\").each(function (i) {\r\n                    $resBoxs[$(this).attr(\"identifier\")] = $(this);\r\n                });\r\n                var $container = $view.find(\".edu-question-gm_theme_wood_bg\");\r\n\r\n\r\n                /**\r\n                 * 大小变化时重置坐标数据\r\n                 */\r\n                var resizeCoor = function () {\r\n                    if (!($targetBoxs && $resBoxs)) {\r\n                        return;\r\n                    }\r\n                    var cOffset = $container.offset();\r\n                    initTargetRects(cOffset);\r\n                    if (_self.resBoxRects && _self.resBoxRects.length > 0) {\r\n                        for (var key in $resBoxs) {\r\n                            var $box = $resBoxs[key];\r\n                            var w = $box.width() + _self.RES_BORDER * 2,\r\n                                h = $box.height() + _self.RES_BORDER * 2,\r\n                                offset = $box.offset();\r\n\r\n                            var rect = _self.resBoxRects[key];\r\n                            rect.l = offset.left - cOffset.left;\r\n                            rect.t = offset.top - cOffset.top;\r\n                            rect.r = offset.left + w - cOffset.left;\r\n                            rect.b = offset.top + h - cOffset.top;\r\n                            rect.w = w;\r\n                            rect.h = h;\r\n                            _self.resBoxRects[key] = rect;\r\n                        }\r\n                    }\r\n                };\r\n\r\n\r\n                /**\r\n                 * 初始化坐标数据\r\n                 */\r\n                var initCoor = function () {\r\n                    _self.resBoxRects = [];\r\n                    var cOffset = $container.offset();\r\n                    for (var key in $resBoxs) {\r\n                        var $box = $resBoxs[key],\r\n                            w = $box.width() + _self.RES_BORDER * 2,\r\n                            h = $box.height() + _self.RES_BORDER * 2,\r\n                            offset = $box.offset();\r\n                        //$box.parent().css({width: w});\r\n\r\n                        _self.resBoxRects[key] = {\r\n                            l: offset.left - cOffset.left,\r\n                            t: offset.top - cOffset.top,\r\n                            r: offset.left + w - cOffset.left,\r\n                            b: offset.top + h - cOffset.top,\r\n                            w: w,\r\n                            h: h,\r\n                            id: key,\r\n                            f: \"\",\r\n                            tid: \"\"//目前支持一对多\r\n                        };\r\n                    }\r\n                    initTargetRects(cOffset);\r\n                };\r\n\r\n                var initTargetRects = function (cOffset) {\r\n                    _self.targetBoxsRects = [];\r\n                    $targetBoxs.each(function () {\r\n                        var $box = $(this),\r\n                            w = $box.width(),\r\n                            h = $box.height(),\r\n                            offset = $box.offset();\r\n\r\n                        _self.targetBoxsRects.push({\r\n                            l: offset.left - cOffset.left,\r\n                            t: offset.top - cOffset.top,\r\n                            r: offset.left + w - cOffset.left,\r\n                            b: offset.top + h - cOffset.top,\r\n                            w: w,\r\n                            h: h,\r\n                            id: $box.attr(\"identifier\")\r\n                        });\r\n                    });\r\n                };\r\n\r\n                /**\r\n                 * 判断拖动元素和目标区域是否有交集并绑定\r\n                 */\r\n                var intersectBind = function (l, t, h, w, id) {\r\n                    var rect = _utils.Area.getInteractRect(l, t, h, w, _self.targetBoxsRects);\r\n                    if (!rect) {\r\n                        _self.resBoxRects[id].f = \"\";\r\n                    } else {\r\n                        _self.resBoxRects[id].f = rect.id;\r\n                    }\r\n                    return rect;\r\n                };\r\n\r\n\r\n                /**\r\n                 * 移动高亮处理\r\n                 * @returns {*}\r\n                 */\r\n                var moveBox = function (l, t, h, w, id) {\r\n                    var rect = _utils.Area.getInteractRect(l, t, h, w, _self.targetBoxsRects);\r\n                    $targetBoxs.removeClass(\"qp-move\");\r\n                    if (rect) {\r\n                        $view.find(\"td[identifier='\" + rect.id + \"']\").addClass(\"qp-move\");\r\n                    }\r\n                    return rect;\r\n                };\r\n\r\n\r\n                var toTarget = function ($target, rect, show, callback) {\r\n\r\n                    if (show) {\r\n                        $target.css({\r\n                            left: rect.l,\r\n                            top: rect.t\r\n                        });\r\n                        if (callback) {\r\n                            callback();\r\n                        }\r\n                    } else {\r\n                        $target.stop().animate({\r\n                            left: rect.l,\r\n                            top: rect.t\r\n                        }, function () {\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n\r\n\r\n                var initDrawEvent = function () {\r\n                    var  lastPoint = null,\r\n                        $target,\r\n                        targetWidth,\r\n                        targetHeight,\r\n                        targetIdentifier,\r\n                        targetCssText,\r\n                        absPoint,\r\n                        touchend = true,\r\n                        maxContainerWidth = $view.find(\".edu-question-table_footer\").width(),\r\n                        $gapMathMain = $view.find(\".qp-gapmatch-container .edu-question-main\"),\r\n                        $gapMathTable = $view.find(\".qp-gapmatch-container>table\");\r\n\r\n                    var changeRectColor = function (selected) {\r\n                        if (selected) {\r\n                            $targetBoxs.addClass(\"qp-active\");\r\n                        } else {\r\n                            $targetBoxs.removeClass(\"qp-active\");\r\n                        }\r\n                    };\r\n\r\n\r\n                    var downEvent = function (touch, e) {\r\n                        if (_self.isLock()) {\r\n                            return;\r\n                        }\r\n                        var $targetNew = _utils.Dom.getParentElement($(e.target), \"qp-gapText\");//.parents(\".qp-gapText\");\r\n\r\n                        if (!$targetNew.hasClass(\"edu-question-list-container\")) {\r\n                            return;\r\n                        }\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n\r\n\r\n                        if ($target && $target.attr(\"id\") === $targetNew.attr(\"id\")) {\r\n                            $target.stop();\r\n                        }\r\n\r\n                        $target = $targetNew;\r\n                        targetWidth = $target.width();\r\n                        targetHeight = $target.height();\r\n                        targetIdentifier = $target.attr(\"identifier\");\r\n                        var currentAbsOffset = $container.offset();\r\n                        //重新计算坐标\r\n                        if (!_self.absOffset || currentAbsOffset.left !== _self.absOffset.left || currentAbsOffset.top !== _self.absOffset.top) {\r\n                            resizeCoor();\r\n                        }\r\n                        _self.absOffset = currentAbsOffset;//重新获取\r\n                        //拖动未归类的选项\r\n                        if ($target.attr(\"location\") === LocationType.None || typeof $target.attr(\"location\") === \"undefined\") {\r\n                            $target.parent().css({\r\n                                width: targetWidth + _self.RESBOX_MARGIN_RIGHT + _self.RES_BORDER * 2\r\n                            });\r\n                        }\r\n                        var offset = $gapMathMain.offset();\r\n                        $gapMathTable.css({\r\n                            left: offset.left - _self.absOffset.left,\r\n                            top: offset.top - _self.absOffset.top\r\n                        });\r\n\r\n\r\n                        changeRectColor(true);\r\n\r\n                        lastPoint = getEventPoint(touch, e);\r\n                        var tOffset = $target.offset();\r\n                        absPoint = {\r\n                            x: lastPoint.x - tOffset.left + _self.absOffset.left,\r\n                            y: lastPoint.y - tOffset.top + _self.absOffset.top\r\n                        };\r\n\r\n                        targetCssText = $target[0].style.cssText.replace(\"left\", \"\").replace(\"top\", \"\").replace(\"position\", \"\").replace(\"z-index\", \"\");\r\n                        $target[0].style.cssText = targetCssText + \";position:absolute;\" + \"z-index:\" + (_self.zindex++) + \";left:\" + (lastPoint.x - absPoint.x) + \"px;\" + \"top:\" + (lastPoint.y - absPoint.y) + \"px;\";\r\n                        targetCssText = $target[0].style.cssText.replace(\"left\", \"\").replace(\"top\", \"\");\r\n\r\n                        resizeResBox(targetIdentifier, (lastPoint.y - absPoint.y), targetHeight);\r\n                    };\r\n\r\n                    var moveEvent = function (touch, e) {\r\n                        if (_self.isLock()) {\r\n                            return;\r\n                        }\r\n                        if (!lastPoint) {\r\n                            return;\r\n                        }\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n\r\n                        lastPoint = getEventPoint(touch, e);\r\n                        $target[0].style.cssText = targetCssText + \";\" + \"left:\" + (lastPoint.x - absPoint.x) + \"px;\" + \"top:\" + (lastPoint.y - absPoint.y) + \"px;\";\r\n                        moveBox(lastPoint.x - absPoint.x, lastPoint.y - absPoint.y, targetHeight, targetWidth, targetIdentifier);\r\n                    };\r\n\r\n                    var stopEvent = function (e) {\r\n                        if (!lastPoint || !absPoint) {\r\n                            return;\r\n                        }\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n\r\n\r\n                        stopHandler();\r\n                        changeRectColor(false);\r\n                        if (lastPoint != null) {\r\n                            _self.setAnswer(getAnswer());\r\n                        }\r\n                        lastPoint = null;\r\n                        absPoint = null;\r\n\r\n\r\n                    };\r\n\r\n                    /**\r\n                     * 元素拖动停止回调处理\r\n                     * @param $originalthis\r\n                     * @param event\r\n                     * @param ui\r\n                     */\r\n                    var stopHandler = function () {\r\n                        var oldTargetId = getTargetRectId(targetIdentifier);//旧id\r\n                        var targetRect = intersectBind(lastPoint.x - absPoint.x, lastPoint.y - absPoint.y, targetHeight, targetWidth, targetIdentifier);\r\n                        $targetBoxs.removeClass(\"qp-move\");\r\n                        if (targetRect) {\r\n\r\n                            if (oldTargetId !== targetRect.id) {\r\n                                $target.attr(\"location\", LocationType.None);\r\n                            }\r\n                            var location = $target.attr(\"location\");\r\n\r\n                            //超过高度，不能排在下方\r\n                            var targetAreaRect = getTargetLocationRect($target, targetRect, targetHeight, targetWidth, location, getResRectsByTid(targetRect.id));\r\n\r\n                            //相交\r\n                            $target.parent().css({width: 0});\r\n                            toTarget($target, targetAreaRect, false, function () {\r\n                                //resizeCoor();\r\n                            });\r\n                            //$target.attr(\"center\", true);\r\n                        }\r\n                        else {\r\n                            $target.attr(\"location\", LocationType.None);\r\n                            //还原\r\n                            $target.parent().css({\r\n                                width: targetWidth + _self.RESBOX_MARGIN_RIGHT + _self.RES_BORDER * 2\r\n                            });\r\n\r\n\r\n                            (function ($target) {\r\n                                backToParent($target, $target.parent(), false, function () {\r\n                                    $target.attr(\"style\", \"\");\r\n                                });\r\n                            })($target);\r\n                        }\r\n\r\n                    };\r\n\r\n\r\n                    /**\r\n                     * 目标区域拖动选项向上移动\r\n                     * @param id\r\n                     * @param top\r\n                     */\r\n                    var resizeResBox = function (id, top, targetHeight) {\r\n\r\n                        var tid = getTargetRectId(id);\r\n\r\n                        if (!tid) {\r\n                            return;\r\n                        }\r\n\r\n                        if ($target.attr(\"location\") !== LocationType.TopToBottom) {\r\n                            return;\r\n                        }\r\n\r\n                        for (var key in _self.resBoxRects) {\r\n                            var resRect = _self.resBoxRects[key];\r\n                            if (resRect.f === tid) {\r\n                                if (id !== resRect.id) {\r\n                                    var $res = $resBoxs[resRect.id];\r\n                                    if ($res.attr(\"location\") !== LocationType.TopToBottom) {\r\n                                        continue;\r\n                                    }\r\n                                    var resTop = parseInt($res.css(\"top\"));\r\n                                    if (resTop > top) {\r\n                                        $res.animate({top: resTop - targetHeight - 2 * _self.RES_BORDER});\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n\r\n\r\n                    var getTargetRectId = function (id) {\r\n                        return _self.resBoxRects[id] && _self.resBoxRects[id].f;\r\n                    };\r\n\r\n                    var backToParent = function ($target, $TargetContainer, show, callback) {\r\n                        var w = $TargetContainer.width(),\r\n                            h = $TargetContainer.height(),\r\n                            offset = $TargetContainer.offset();\r\n                        var height = (_self.RESBOX_HEIGHT - $target.height()) / 2;\r\n                        var rectTarget = {\r\n                            l: offset.left - _self.absOffset.left,\r\n                            t: offset.top - _self.absOffset.top + height,\r\n                            w: w,\r\n                            h: h\r\n                        };\r\n                        if (rectTarget.l < 0) {\r\n                            rectTarget.l = 0;\r\n                        }\r\n                        if (rectTarget.l > maxContainerWidth - targetWidth) {\r\n                            rectTarget.l = maxContainerWidth - targetWidth;\r\n                        }\r\n                        toTarget($target, rectTarget, show, callback);\r\n                        $target.attr(\"center\", false);\r\n\r\n                    };\r\n\r\n                    var getEventPoint = function (touch, e) {\r\n\r\n                        var point = {}, x, y;\r\n                        if (touch) {\r\n                            x = e.targetTouches[0].pageX - _self.absOffset.left;\r\n                            y = e.targetTouches[0].pageY - _self.absOffset.top;\r\n                            point = {x: x, y: y};\r\n                        } else {\r\n                            x = typeof e.pageX !== 'undefined' ? ( e.pageX - _self.absOffset.left ) : e.layerX;\r\n                            y = typeof e.pageY !== 'undefined' ? ( e.pageY - _self.absOffset.top ) : e.layerY;\r\n                            point = {x: x, y: y};\r\n                        }\r\n                        return point;\r\n                    };\r\n\r\n\r\n                    var bindEvent = function () {\r\n                        var cover = $view.find(\".edu-question-gm_theme_wood_bg\")[0];\r\n\r\n                        _utils.Dom.addListener(cover, 'mousedown', function (e) {\r\n                            downEvent(false, e);\r\n                        });\r\n                        _utils.Dom.addListener(cover, 'mousemove', function (e) {\r\n                            moveEvent(false, e);\r\n                        });\r\n                        _utils.Dom.addListener(cover, 'click', function (e) {\r\n                            //e.preventDefault();\r\n                            //e.stopPropagation();\r\n                        });\r\n                        _utils.Dom.addListener(cover, 'mouseup', stopEvent);\r\n                        _utils.Dom.addListener(cover, 'mouseleave', stopEvent);\r\n\r\n\r\n                        _utils.Dom.addListener(cover, 'touchstart', function (e) {\r\n                            if (touchend) {\r\n                                touchend = false;\r\n                                downEvent(true, e);\r\n                            }\r\n                        });\r\n                        _utils.Dom.addListener(cover, 'touchmove', function (e) {\r\n                            if (!touchend) {\r\n                                moveEvent(true, e);\r\n                            }\r\n                        });\r\n                        _utils.Dom.addListener(cover, 'touchend', function (e) {\r\n                            touchend = true;\r\n                            stopEvent(e);\r\n                        });\r\n                        _utils.Dom.addListener(cover, 'touchcancel', function (e) {\r\n                            touchend = true;\r\n                            stopEvent(e);\r\n                        });\r\n\r\n                    };\r\n\r\n                    var bindScroll = function () {\r\n                        var $lisbox = $view.find(\".edu-question-list_box\");\r\n                        var allWidth = 0, boxWidth = $lisbox.width();\r\n                        //$view.find(\".qp-gapTxt-parent\").each(function () {\r\n                        //    allWidth += $(this).width() + _self.RESBOX_MARGIN_RIGHT;\r\n                        //});\r\n                        var scrolling = false;\r\n\r\n                        $view.find(\".edu-question-icon_right\").bind(\"click touchstart\", function () {\r\n                            if (scrolling) {\r\n                                return;\r\n                            }\r\n                            var srollLeft = $lisbox.scrollLeft();\r\n                            allWidth = 0;\r\n                            for (var key in $resBoxs) {\r\n                                var $res = $resBoxs[key];\r\n                                //拖动未归类的选项\r\n                                if ($res.attr(\"location\") === LocationType.None || typeof $res.attr(\"location\") === \"undefined\") {\r\n                                    allWidth += $res.parent().width();\r\n                                }\r\n\r\n                            }\r\n\r\n                            var left = allWidth - srollLeft - boxWidth;\r\n                            if (left > 0) {\r\n                                if (left <= srollLeft) {\r\n                                    left = srollLeft + left;\r\n                                } else {\r\n                                    left = srollLeft > 0 ? srollLeft * 2 : boxWidth;\r\n                                }\r\n                                scrolling = true;\r\n                                $lisbox.animate({scrollLeft: left}, function () {\r\n                                    scrolling = false;\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                        $view.find(\".edu-question-icon_left\").bind(\"click touchstart\", function () {\r\n                            if (scrolling) {\r\n                                return;\r\n                            }\r\n                            var srollLeft = $lisbox.scrollLeft();\r\n                            if (srollLeft > 0) {\r\n                                if (srollLeft > boxWidth) {\r\n                                    srollLeft = srollLeft - boxWidth;\r\n                                } else {\r\n                                    srollLeft = 0;\r\n                                }\r\n                                scrolling = true;\r\n                                $lisbox.animate({scrollLeft: srollLeft}, function () {\r\n                                    scrolling = false;\r\n                                });\r\n                            }\r\n                        });\r\n                    };\r\n\r\n                    var init = function () {\r\n                        _self.absOffset = $container.offset();\r\n                        initCoor();\r\n                        bindEvent();\r\n                        bindScroll();\r\n                    };\r\n\r\n                    init();\r\n                };\r\n\r\n                /**\r\n                 * //获取下一个合适的坐标\r\n                 * @param $resBox 当前选项\r\n                 * @param targetRect 目标矩形\r\n                 * @param resHeight 当前选项高\r\n                 * @param resWidth 当前选项宽\r\n                 * @param reslocationType 当前选项类型\r\n                 * @param resRects 当前选项所在目标区域所有选项\r\n                 * @returns {*}\r\n                 */\r\n                var getTargetLocationRect = function ($resBox, targetRect, resHeight, resWidth, reslocationType, resRects) {\r\n\r\n                    var resId = $resBox.attr(\"identifier\");\r\n\r\n                    var locationRect = {\r\n                        Left: function () {\r\n                            return {\r\n                                l: targetRect.l,\r\n                                t: targetRect.t + (targetRect.h - resHeight + _self.RES_BORDER * 2 + _self.TD_BORDER) / 2\r\n                            };\r\n                        },\r\n                        Right: function () {\r\n                            return {\r\n                                l: targetRect.l + targetRect.w - resWidth,\r\n                                t: targetRect.t + (targetRect.h - resHeight + _self.RES_BORDER * 2 + _self.TD_BORDER) / 2\r\n                            };\r\n                        },\r\n                        Bottom: function () {\r\n                            return {\r\n                                l: targetRect.l + (targetRect.w - resWidth + _self.RES_BORDER * 2 + _self.TD_BORDER) / 2,\r\n                                t: targetRect.t + targetRect.h - resHeight\r\n                            };\r\n                        },\r\n                        LeftTop: function () {\r\n                            return {\r\n                                l: targetRect.l,\r\n                                t: targetRect.t\r\n                            };\r\n                        },\r\n                        RightTop: function () {\r\n                            return {\r\n                                l: targetRect.l + targetRect.w - resWidth,\r\n                                t: targetRect.t\r\n                            };\r\n                        },\r\n                        LeftBottom: function () {\r\n                            return {\r\n                                l: targetRect.l,\r\n                                t: targetRect.t + targetRect.h - resHeight\r\n                            };\r\n                        },\r\n                        RightBottom: function () {\r\n                            return {\r\n                                l: targetRect.l + targetRect.w - resWidth,\r\n                                t: targetRect.t + targetRect.h - resHeight\r\n                            };\r\n                        },\r\n                        Middle: function () {\r\n                            return {\r\n                                l: targetRect.l + (targetRect.w - resWidth + _self.RES_BORDER * 2 + _self.TD_BORDER) / 2,\r\n                                t: targetRect.t + (targetRect.h - resHeight + _self.RES_BORDER * 2 + _self.TD_BORDER) / 2\r\n                            };\r\n                        }\r\n                    };\r\n\r\n                    var hasLocation = function (location) {\r\n                        var has = false;\r\n                        for (var key in $resBoxs) {\r\n                            if ($resBoxs[key].attr(\"location\") === location) {\r\n                                if ($resBox) {\r\n                                    if (key !== $resBox.attr(\"identifier\") && _self.resBoxRects[key].f == targetRect.id) {\r\n                                        has = true;\r\n                                    }\r\n                                } else {\r\n                                    has = true;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        return has;\r\n                    };\r\n\r\n                    var targetAreaRect = {\r\n                        l: targetRect.l,\r\n                        t: targetRect.t,\r\n                        h: targetRect.h,\r\n                        w: targetRect.w\r\n                    };\r\n\r\n                    var totalHeight = 0;\r\n                    for (var i = 0; i < resRects.length; i++) {\r\n                        var rect = resRects[i];\r\n                        var $res = $resBoxs[rect.id];\r\n                        if (resId !== rect.id) {\r\n                            if ($res.attr(\"location\") === LocationType.TopToBottom) {\r\n                                totalHeight += rect.h;\r\n                                targetAreaRect.t = targetAreaRect.t + rect.h;\r\n                            }\r\n                        } else {\r\n                            targetAreaRect.l = targetAreaRect.l + (targetAreaRect.w - rect.w + _self.RES_BORDER * 2 + _self.TD_BORDER) / 2;\r\n                            if (location !== LocationType.TopToBottom) {\r\n                                totalHeight += rect.h;\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                    //上、左、下、右 位置判断\r\n                    targetAreaRect.t = targetAreaRect.t + _self.TARGET_MARGIN_TOP;\r\n                    totalHeight += _self.TARGET_MARGIN_TOP;//总高度\r\n\r\n                    if (totalHeight > targetRect.h) {\r\n                        if (reslocationType && reslocationType !== LocationType.None && reslocationType !== LocationType.Top && reslocationType !== LocationType.TopToBottom) {\r\n                            return locationRect[reslocationType]();\r\n                        } else {\r\n                            for (var key in LocationType) {\r\n                                if (key === LocationType.None || key === LocationType.TopToBottom || key === LocationType.Top) {\r\n                                    continue;\r\n                                }\r\n                                //if (key == LocationType.TopToBottom) continue;\r\n                                //if (key == LocationType.Top) continue;\r\n                                if (!hasLocation(key)) {\r\n                                    $resBox.attr(\"location\", key);\r\n                                    return locationRect[key]();\r\n                                }\r\n                            }\r\n                            $resBox.attr(\"location\", LocationType.Middle);\r\n                            return locationRect[LocationType.Middle]();\r\n                        }\r\n                    } else {\r\n                        $resBox.attr(\"location\", LocationType.TopToBottom);\r\n                    }\r\n\r\n                    return targetAreaRect;\r\n                };\r\n\r\n\r\n                var getResRectsByTid = function (tid) {\r\n                    var rects = [];\r\n                    for (var key in _self.resBoxRects) {\r\n                        var rect = _self.resBoxRects[key];\r\n                        if (rect.f === tid) {\r\n                            rects.push(rect);\r\n                        }\r\n                    }\r\n                    return rects;\r\n                };\r\n\r\n                var resizeTable = function () {\r\n\r\n                    var resizeBoxs = [];\r\n                    for (var i = 0; i < _self.targetBoxsRects.length; i++) {\r\n                        var targetRect = _self.targetBoxsRects[i];\r\n                        var resRects = getResRectsByTid(targetRect.id);\r\n                        var $targetBox = $view.find(\" [identifier='\" + targetRect.id + \"']\");\r\n                        var boxs = [];\r\n                        //重新计算和设置该td的宽度，并返回td上面的选项\r\n                        for (var k = 0; k < resRects.length; k++) {\r\n                            var box = {};\r\n                            var rect = resRects[k];\r\n                            box.index = $resBoxs[rect.id].css(\"z-index\");\r\n                            box.$targetBox = $targetBox;\r\n                            box.targetRect = targetRect;\r\n                            //box.resRect = rect;\r\n                            box.$resBox = $resBoxs[rect.id];\r\n                            boxs.push(box);\r\n                        }\r\n                        resizeBoxs.push(boxs);\r\n                    }\r\n\r\n                    //重新设置td上选项的位置\r\n                    for (var l = 0; l < resizeBoxs.length; l++) {\r\n                        var nboxs = resizeBoxs[l];\r\n                        if (nboxs.length > 0) {\r\n                            var nResRects = getResRectsByTid(nboxs[0].targetRect.id);\r\n                            for (var m = 0; m < nboxs.length; m++) {\r\n                                var nbox = nboxs[m];\r\n                                var locationRect = getTargetLocationRect(nbox.$resBox, nbox.targetRect, nbox.$resBox.height(), nbox.$resBox.width(), LocationType.None, nResRects);\r\n                                toTarget(nbox.$resBox, locationRect, true);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                };\r\n\r\n                var getAnswer = function () {\r\n                    var answer = [];\r\n                    for (var key in _self.resBoxRects) {\r\n                        var rect = _self.resBoxRects[key];\r\n                        if (rect.f) {\r\n                            answer.push(rect.id + \" \" + rect.f);\r\n                        }\r\n                    }\r\n                    _logger.debug(answer);\r\n                    return answer;\r\n                };\r\n\r\n                /**\r\n                 * 初始化答案\r\n                 * @param answers\r\n                 */\r\n                var updateAnswer = function (answers) {\r\n                    if (!answers || answers.length <= 0) {\r\n                        return;\r\n                    }\r\n\r\n                    for (var i = 0; i < answers.length; i++) {\r\n                        var answer = answers[i];\r\n                        var answerArry = answer.split(\" \");\r\n                        if (answerArry.length !== 2) {\r\n                            continue;\r\n                        }\r\n                        var id = answerArry[0], tid = answerArry[1];\r\n                        _self.resBoxRects[id].f = tid;\r\n                        //设置绝对定位\r\n                        $resBoxs[id].css(\"position\", \"absolute\");\r\n                    }\r\n\r\n                    _self.zindex = answers.length + 1;\r\n                    resizeTable();\r\n                    _self.setAnswer(getAnswer());\r\n                };\r\n\r\n                var layoutTable = function () {\r\n                    var $main = $view.find(\".qp-gapmatch-container .edu-question-main\");\r\n                    var $table = $view.find(\".qp-gapmatch-container > table\");\r\n                    var offset = $main.offset();\r\n                    var absOffset = $view.find(\".edu-question-gm_theme_wood_bg\").offset();\r\n                    $view.find(\".qp-gapmatch-container> table\").css({\r\n                        left: offset.left - absOffset.left,\r\n                        top: offset.top - absOffset.top\r\n                    });\r\n\r\n                    var thHeight = $main.find(\".edu-question-title_hang\").height() - 2 * _self.TABLE_SPACING;\r\n                    var th1Width = $main.find(\".edu-question-table_lie_side\").width() - 2 * _self.TABLE_SPACING;\r\n                    var tdHeight = ($main.find(\".edu-question-table_lie_side\").height() - _self.TABLE_SPACING * ($table.find(\"  tr\").length - 2)) / ($table.find(\"  tr\").length - 1);\r\n                    var tdWidth = $main.find(\".edu-question-table_box\").width() - _self.TABLE_SPACING;\r\n                    $table.find(\"tr:eq(0)\").find(\"td\").css({\r\n                        height: thHeight,\r\n                        width: tdWidth\r\n                    });\r\n                    $table.find(\"tr:eq(0)\").find(\" td:eq(0)\").css({width: th1Width});\r\n                    $table.find(\" tr \").each(function (i) {\r\n                        if (i === 0) {\r\n                            return;\r\n                        }\r\n                        $(this).find(\" td\").css({height: tdHeight, width: tdWidth});\r\n                        $(this).find(\"td:eq(0)\").css({width: th1Width});\r\n                        $(this).find(\"td:eq(0)\").html(\"\");\r\n                    });\r\n                    $table.attr(\"cellspacing\", \"10px\");\r\n\r\n                };\r\n                var init = function () {\r\n                    layoutTable();\r\n\r\n                    if (_self.option.event) {\r\n                        initDrawEvent();\r\n                    }\r\n\r\n                    if (_self.option.showAnswer && !_self.option.showCorrectAnswer) {\r\n                        updateAnswer(_self.getAnswer());\r\n\r\n                    }\r\n                    if (_self.option.showCorrectAnswer) {\r\n                        updateAnswer(_self.getCorrectAnswer());\r\n                    }\r\n\r\n                };\r\n                init();\r\n\r\n            },\r\n            createHtml: function () {\r\n                var _self = this;\r\n                var createHtml = function () {\r\n                    var titleClass = _self.modalModel.prompt.length > 105 ? \"edu-question-text_s\" : \"edu-question-text_m\";\r\n                    var $ths = $(_self.modalModel.tableMatchContent).find(\" thead td\");\r\n                    var $tds = $(_self.modalModel.tableMatchContent).find(\" tbody tr\");\r\n                    //注意：这边行列样式被美工写反了\r\n                    var columnCount = \"main_lie0\" + $tds.length;//第一列空白\r\n                    var rowsCount = \"main_hang0\" + ($ths.length - 1);\r\n                    var gapmath_title=_utils.getLangText('gapmath_title', _self.option);\r\n\r\n                    var html = \"\";\r\n                    html += '<div class=\"edu-question-gm_theme_wood_bg\" id=\"' + _self.interactionId + '\">                                                                                                                                                                                                          ';\r\n                    html += '    <div class=\"edu-question-qp_gm_header clearfix\">                                                                                                                                                                                                        ';\r\n                    html += '        <h1 class=\"edu-question-title_s\">' + gapmath_title + '</h1>                                                                                                      ';\r\n                    html += '    </div>                                                                                                                                                                                                                               ';\r\n                    html += '    <div class=\"clearfix\">                                                                                                                                                                                                       ';\r\n                    html += '        <div class=\"edu-question-side\">                                                                                                                                                                                                               ';\r\n                    html += '            <div class=\"edu-question-side_content\">                                                                                                                                                                                                     ';\r\n                    html += '                <p class=\"' + titleClass + '\" > ' + _self.modalModel.prompt + '</p>                                                                                                                                                                                ';\r\n                    html += '            </div>                                                                                                                                                                                                                       ';\r\n                    html += '        </div>                                                                                                                                                                                                                           ';\r\n                    html += '                                                                                                                                                                                                                                         ';\r\n                    html += '        <div class=\"qp-gapmatch-container\">                                                                                                                                                                                              ';\r\n                    html += '                                                                                                                                                                                                                                         ';\r\n                    html += '            <div class=\"edu-question-main ' + columnCount + ' ' + rowsCount + '\">                                                                                                                                                                                    ';\r\n\r\n                    html += '                <div class=\"edu-question-title_hang\">                                                                                                                                                                                                 ';\r\n                    $ths.each(function (i) {\r\n                        if (i > 0) {\r\n                            html += '            <div class=\"edu-question-table_box\"><span class=\"edu-question-table_btn\">' + $(this).html() + '</span></div>                                                                                                                                                     ';\r\n                        }\r\n                    });\r\n                    html += '                </div>                                                                                                                                                                                                                   ';\r\n\r\n                    html += '                <div class=\"edu-question-table_lie_side clearfix\">                                                                                                                                                                                    ';\r\n                    $tds.each(function () {\r\n                        html += '                 <span class=\"edu-question-table_lie_btn\">' + $(this).find(\"td:eq(0)\").html() + '</span>                                                                                                                                                    ';\r\n                    });\r\n                    html += '                </div>                                                                                                                                                                                                                   ';\r\n\r\n                    html += '                <div class=\"edu-question-table_lie clearfix\">                                                                                                                                                                                         ';\r\n\r\n                    for (var i = 0; i < $tds.length; i++) {\r\n                        html += '                    <div class=\"edu-question-table_lie_box\">                                                                                                                                                                                          ';\r\n                        for (var j = 1; j < $ths.length; j++) {\r\n                            html += '                        <div class=\"edu-question-table_img_box\">                                                                                                                                                                                      ';\r\n                            html += '                        </div>                                                                                                                                                                                                           ';\r\n                        }\r\n                        html += '                    </div>                                                                                                                                                                                                               ';\r\n                    }\r\n\r\n                    html += '                </div>                                                                                                                                                                                                                   ';\r\n                    html += '            </div>                                                                                                                                                                                                                       ';\r\n                    html += getTableHtml();\r\n                    html += '                                                                                                                                                                                                                                         ';\r\n                    html += '        </div>                                                                                                                                                                                                                           ';\r\n                    html += '    </div>                                                                                                                                                                                                                               ';\r\n                    html += '                                                                                                                                                                                                                                         ';\r\n                    html += getGapTextsHtml();\r\n\r\n\r\n                    html += '</div>                                                                                                                                                                                                                                   ';\r\n                    html += '                                                                                                                                                                                                                                         ';\r\n                    return html;\r\n                };\r\n\r\n                var setImageData = function (html) {\r\n                    var imageRegex = /<img([\\s\\S]*?)\\/>/g;\r\n                    var match = html.match(imageRegex);\r\n                    for (var i = 0; i < match.length; i++) {\r\n                        html = html.replace(match[i], match[i].replace('<img', '<img data-media-img-render=\"false\" data-width=\"112\" data-height=\"70\"'));\r\n                    }\r\n                    return html;\r\n                };\r\n                var getGapTextsHtml = function () {\r\n\r\n                    var html = \"\";\r\n                    html += '    <div class=\"edu-question-table_footer\">                                                                                                                                                                                                           ';\r\n                    html += '        <a href=\"javascript:void(0)\" class=\"edu-question-icon_left\"></a>                                                                                                                                                                                             ';\r\n                    html += '                                                                                                                                                                                                                                         ';\r\n                    html += '        <div class=\"edu-question-list_box\">                                                                                                                                                                                                           ';\r\n\r\n                    html += '<div class=\"qp-gaptxt-container\" > ';\r\n                    var randomArry = _self.getAnswerRandom(_self.modalModel.gapText.length);// ModuleUtil.RandomUtil.getAnswerRandom(_self.modalModel.gapText.length - 1);\r\n                    for (var i = 0; i < _self.modalModel.gapText.length; i++) {\r\n                        var gapText = _self.modalModel.gapText[_self.getShuffle() ? randomArry[i] : i];\r\n                        var pid = _utils.getRandom(_self.interactionId + \"-container\" + i);\r\n                        html += '<div class=\"qp-gapTxt-parent\"  >';\r\n                        if (gapText.content.indexOf(\"<img\") > -1) {\r\n                            html += '   <div class=\"qp-gapText qp-gapText-img  edu-question-list-container\"  id=\"' + pid + '\"  identifier=\"' + gapText.identifier + '\" > ';\r\n                            //html += ModuleUtil.IMG.resizeHtmlImg(gapText.content);\r\n                            html += setImageData(gapText.content);\r\n                        } else {\r\n                            html += '   <div class=\"qp-gapText edu-question-list-container\"  id=\"' + pid + '\"  identifier=\"' + gapText.identifier + '\" > ';\r\n                            html += '<span class=\"qp-gapText-span\">' + gapText.content + '</span>';\r\n                        }\r\n                        html += '   </div>';\r\n                        html += '</div>';\r\n                    }\r\n                    html += '</div>  ';\r\n\r\n                    html += '        </div>                                                                                                                                                                                                                           ';\r\n                    html += '        <a href=\"javascript:void(0)\" class=\"edu-question-icon_right\"></a>                                                                                                                                                                                            ';\r\n                    html += '    </div>';\r\n                    return html;\r\n                };\r\n\r\n\r\n                var getTableHtml = function () {\r\n                    var $table = $(_self.modalModel.tableMatchContent);\r\n                    var gaps = $table.find(\"gap\");\r\n                    gaps.parent().parent().addClass(\"qp-gapText-td\");\r\n                    for (var i = 0; i < gaps.length; i++) {\r\n                        var $gaps = $(gaps[i]);\r\n                        var identifier = $gaps.attr(\"identifier\");\r\n                        $gaps.parent().parent().attr(\"identifier\", identifier);\r\n                    }\r\n                    $table.find(\"thead td\").html(\"\");\r\n                    return $table._xml().replace(/<thead>/ig, \"\").replace(/<\\/thead>/ig, \"\").replace(/<tbody>/ig, \"\").replace(/<\\/tbody>/ig, \"\");\r\n                };\r\n\r\n                return createHtml();\r\n            }\r\n        };\r\n        return member;\r\n    })());\r\n\r\n})(window, jQuery);\r\n\r\n\n(function (window, $) {\r\n    //创建\r\n\r\n    var _utils = window.QtiPlayer.getUtils();\r\n    var _logger = window.QtiPlayer.getLogger();\r\n\r\n\r\n    var HTML = {\r\n        TR: '<tr>${content}</tr>',\r\n        TD: '<td id=\"${id}\" width=\"${width}\" height=\"${height}\" class=\"_nqti-js-td\">${content}</td>',\r\n        SIDE_ITEM: '<li  class=\"on ${cls}\"><span  class=\"nqti-base-puzzle-img-con ${orientation} _nqti-js-img\"  id=\"${id}\"><img   data-lazy-load=\"${lazyloader}\"  data-media-img-render=\"false\"  ${width} src=\"${src}\"/></span></li>',\r\n        QUS_BODY: '<div class=\"nqti-base-puzzle-wrap clearfix _nqti-js-wrap\" style=\"${c-height}\">' +\r\n        '               <div class=\"nqti-base-puzzle-module\" style=\"${c-width}\">' +\r\n        '                   <table class=\"nqti-base-puzzle-table\" style=\"${width};${height}\"><tbody>${tbody}</tbody></table>' +\r\n        '               </div>' +\r\n        '               <div class=\"nqti-base-side-puzzle _nqti-js-side\"> ' +\r\n        '                   <ul class=\"nqti-base-puzzle-list nqti-scrollbar-style-gray _nqti-js-side-ul\">${list}</ul>' +\r\n        '               </div> ' +\r\n        '          </div>'\r\n    };\r\n    var _maxSvgWidth = 600;\r\n    var _maxSvgHeight = 500;\r\n    var _minSvgWidth = 100;\r\n    var _minSvgHeight = 100;\r\n\r\n    //跟样式比例耦合\r\n    var _tdBorderWidth = 2;\r\n    var _tableBorderWidth = 5;\r\n    var _sideWidthPerHeight = 7.25 / 5.25;\r\n\r\n    var gapUtil = {\r\n        winSize: function () {\r\n            var winWidth = 0;\r\n            var winHeight = 0;\r\n            if (document.documentElement && document.documentElement.clientHeight && document.documentElement.clientWidth) {\r\n                winWidth = document.documentElement.clientWidth;\r\n                winHeight = document.documentElement.clientHeight;\r\n            }\r\n            return {\r\n                'width': winWidth,\r\n                'height': winHeight\r\n            };\r\n        },\r\n        qtiMaxSize: function ($view) {\r\n            var parent = $view.closest('._qti-player').parent();\r\n            var width = parent.width();\r\n            var maxW = 0, maxH = 0;\r\n            //按可视区域大小缩放\r\n            if (width > 0) {\r\n                var scale = width / 1080;\r\n                maxW = _maxSvgWidth * scale;\r\n                maxH = _maxSvgHeight * scale;\r\n                if (maxW < 300) {\r\n                    maxW = 300;\r\n                }\r\n                if (maxH < 300) {\r\n                    maxH = 300;\r\n                }\r\n            }\r\n            return {\r\n                maxW: maxW,\r\n                maxH: maxH\r\n            };\r\n        },\r\n        mathMaxSize: function () {\r\n            var winSize = this.winSize();\r\n            var scale = 1;\r\n            var maxW = 0, maxH = 0;\r\n            if (winSize.width / winSize.height > 1280 / 800) {\r\n                scale = winSize.height / 800;\r\n            } else {\r\n                scale = winSize.width / 1280;\r\n            }\r\n            maxW = parseInt(_maxSvgWidth * scale);\r\n            maxH = parseInt(_maxSvgHeight * scale);\r\n            if (maxH < _minSvgHeight) {\r\n                maxH = _minSvgHeight;\r\n            }\r\n            if (maxW < _minSvgWidth) {\r\n                maxW = _minSvgWidth;\r\n            }\r\n            return {\r\n                maxW: maxW,\r\n                maxH: maxH\r\n            };\r\n        },\r\n        getOffsetInt: function ($dom) {\r\n            var offset = $dom.offset();\r\n            if (!offset) {\r\n                return;\r\n            }\r\n            return {left: parseInt(offset.left), top: parseInt(offset.top)};\r\n        },\r\n        getScale: function ($dom) {\r\n            if ($dom && $dom.length > 0) {\r\n                var offWidth = $dom[0].offsetWidth;\r\n                return (offWidth > 0 ? ($dom[0].getBoundingClientRect().width / offWidth) : 1) || 1;\r\n            }\r\n            return 1;\r\n        },\r\n        getTableData: function (model) {\r\n            var maxW = 0, maxH = 0;\r\n            var rows = 0, cols = 0;\r\n            var oneWidth = model.gapImg[0].width, oneHeight = model.gapImg[0].height;\r\n            var matrix = {};\r\n            for (var j = 0; j < model.associableHotspot.length; j++) {\r\n                var spot = model.associableHotspot[j];\r\n                var vcoords = spot.coords.split(\",\");\r\n                if (parseInt(vcoords[3]) > maxH) {\r\n                    maxH = parseInt(vcoords[3]);\r\n                }\r\n                if (parseInt(vcoords[2]) > maxW) {\r\n                    maxW = parseInt(vcoords[2]);\r\n                }\r\n                var tbPos = spot.identifier.split('_');\r\n                var row = parseInt(tbPos[1]);\r\n                var col = parseInt(tbPos[2]);\r\n                if (col > cols) {\r\n                    cols = col;\r\n                }\r\n                if (!matrix[row]) {\r\n                    matrix[row] = [];\r\n                    rows++;\r\n                }\r\n                matrix[row][col - 1] = spot;\r\n            }\r\n            return {\r\n                matrix: matrix,\r\n                width: maxW,\r\n                height: maxH,\r\n                rows: rows,\r\n                cols: cols,\r\n                oneWidth: oneWidth,\r\n                oneHeight: oneHeight\r\n            };\r\n        },\r\n        getAreaSize: function (maxW, maxH, expectWidth, expectHeight, columns, rows, oneWidth, oneHeight, maxSvgWidth, maxSvgHeight) {\r\n            //不超过最大限制\r\n            var resize = _utils.Img.resize(maxW, maxH, maxSvgWidth, maxSvgHeight, _minSvgWidth, _minSvgHeight);\r\n            var maxScale = resize.scale;\r\n            maxW = resize.w;\r\n            maxH = resize.h;\r\n\r\n            //外部设置了期望宽高，进行重置\r\n            if (expectWidth || expectHeight) {\r\n                expectWidth = expectWidth - (columns * _tdBorderWidth + _tdBorderWidth);\r\n                expectHeight = expectHeight - (rows * _tdBorderWidth + _tdBorderWidth);\r\n                //超过原始宽高则不缩放，图片会变模糊\r\n                if (expectWidth < maxW || expectHeight < maxH) {\r\n                    var relativeWidth = true;\r\n                    if (expectWidth < maxW && expectHeight < maxH) {\r\n                        relativeWidth = expectWidth / maxW < expectHeight / maxH;\r\n                    } else if (expectWidth < maxW) {\r\n                        relativeWidth = true;\r\n                    } else if (expectHeight < maxH) {\r\n                        relativeWidth = false;\r\n                    }\r\n                    if (relativeWidth) {\r\n                        resize.w = expectWidth;\r\n                        resize.scale = (expectWidth / maxW).toFixed(3);\r\n                        resize.h = parseInt(resize.scale * maxH);\r\n                    } else {\r\n                        resize.h = expectHeight;\r\n                        resize.scale = (expectHeight / maxH).toFixed(3);\r\n                        resize.w = parseInt(resize.scale * maxW);\r\n                    }\r\n                    //计算真实缩放值\r\n                    resize.scale = resize.scale * maxScale;\r\n                }\r\n            }\r\n            //整数处理\r\n            var moRows = resize.h % rows;\r\n            var moCols = resize.w % columns;\r\n            if (expectWidth && expectHeight) {\r\n                if (moCols > 0) {\r\n                    resize.w = (resize.w - (columns - moCols));\r\n                }\r\n                if (moRows > 0) {\r\n                    resize.h = (resize.h - (rows - moRows ));\r\n                }\r\n            } else {\r\n                if (moCols > 0) {\r\n                    resize.w = (resize.w + (columns - moCols));\r\n                }\r\n                if (moRows > 0) {\r\n                    resize.h = (resize.h + (rows - moRows ));\r\n                }\r\n                //如果单项的高宽比大于总体高宽比，高度统一加1像素防止抖动\r\n                if (oneHeight / oneWidth > (resize.h / rows) / (resize.w / columns)) {\r\n                    resize.h += rows;\r\n                }\r\n            }\r\n\r\n            //计算完整表格宽高\r\n            resize.w += (columns) * _tdBorderWidth + _tdBorderWidth;\r\n            resize.h += (rows) * _tdBorderWidth + _tdBorderWidth;\r\n            return resize;\r\n        },\r\n        getRects: function (cOffset, $rects) {\r\n            var rects = [];\r\n            var scale = this.getScale($($rects[0]));\r\n            $rects.each(function () {\r\n                var $this = $(this);\r\n                var width = $this.width();\r\n                var height = $this.height();\r\n                var id = $this.attr('id');\r\n                var offset = gapUtil.getOffsetInt($this);\r\n                offset.left = offset.left - cOffset.left;\r\n                offset.top = offset.top - cOffset.top;\r\n\r\n                rects.push({\r\n                    l: offset.left,\r\n                    t: offset.top,\r\n                    r: offset.left + width * scale,\r\n                    b: offset.top + height * scale,\r\n                    w: width * scale,\r\n                    h: height * scale,\r\n                    id: id\r\n                });\r\n            });\r\n            return rects;\r\n        },\r\n        initFill: function (rects, answers) {\r\n            rects.forEach(function (rect) {\r\n                //初始化答案\r\n                var f = '';\r\n                answers.forEach(function (answer) {\r\n                    var answerArry = answer.split(\" \");\r\n                    if (answerArry[1] === rect.id) {\r\n                        f = answerArry[0];\r\n                    }\r\n                });\r\n                rect.f = f;\r\n            });\r\n        },\r\n        //取消绑定\r\n        removeFill: function (rects, tId) {\r\n            rects.forEach(function (rect) {\r\n                if (rect.f === tId) {\r\n                    rect.f = \"\";\r\n                }\r\n            });\r\n        },\r\n        //取消绑定\r\n        removeAllFill: function (rects) {\r\n            rects.forEach(function (rect) {\r\n                rect.f = \"\";\r\n            });\r\n        },\r\n        //绑定\r\n        addFill: function (rects, id, tId) {\r\n            this.removeFill(rects, tId);\r\n            rects.forEach(function (rect) {\r\n                if (rect.id === id) {\r\n                    rect.f = tId;\r\n                }\r\n            });\r\n        },\r\n        getEventPoint: function (e, absOffset) {\r\n            var point = {}, x, y;\r\n            var isTouch = e.originalEvent && (e.originalEvent.targetTouches || e.originalEvent.changedTouches);\r\n            if (isTouch) {\r\n                var event = (e.originalEvent.targetTouches && e.originalEvent.targetTouches.length > 0) ? e.originalEvent.targetTouches : e.originalEvent.changedTouches;\r\n                x = event[0].pageX - absOffset.left;\r\n                y = event[0].pageY - absOffset.top;\r\n                point = {x: x, y: y, touch: true};\r\n            } else {\r\n                var event = e.originalEvent || e;\r\n                x = event.pageX - absOffset.left;\r\n                y = event.pageY - absOffset.top;\r\n                point = {x: x, y: y, touch: false};\r\n            }\r\n            return point;\r\n        },\r\n        coordinate: function (e) {\r\n            switch (e.type) {\r\n                case 'touchstart':\r\n                case 'touchmove':\r\n                case 'touchend':\r\n                case 'touchcancel':\r\n                    var event = (e.originalEvent.targetTouches && e.originalEvent.targetTouches.length > 0) ? e.originalEvent.targetTouches : e.originalEvent.changedTouches;\r\n                    return event[0];\r\n                default:\r\n                    return e;\r\n            }\r\n        },\r\n        /**\r\n         * 判断拖动元素和目标区域是否有交集并绑定\r\n         */\r\n        intersectRect: function (rects, l, t, h, w, tId) {\r\n            var that = this;\r\n            var result = false;\r\n            var max = 0, matchCount = 0, matchIndex;\r\n            var area = (w * h * 2) / 5;\r\n            var matchRect;\r\n            rects.forEach(function (rect, i) {\r\n                if (result || ( rect.f && rect.f != tId)) {\r\n                    return;\r\n                }\r\n                //计算面积\r\n                var m = _utils.Area.getRectIntersectArea({l: l, t: t, r: l + w, b: t + h}, rect);\r\n                var cm = _utils.Area.getRectIntersectArea(rect, {l: l, t: t, r: l + w, b: t + h});\r\n\r\n                if (cm > m) {\r\n                    m = cm;\r\n                }\r\n                if (m > 0) {\r\n                    matchCount++;\r\n                }\r\n                if (m > max) {\r\n                    max = m;\r\n                    matchIndex = i;\r\n                }\r\n                if (m > area) {\r\n                    result = true;\r\n                    matchRect = rect;\r\n                }\r\n            });\r\n\r\n            //匹配区域超过1个且匹配度不高，按最高匹配\r\n            if (!result && matchCount > 1) {\r\n                result = true;\r\n                matchRect = rects[matchIndex];\r\n            }\r\n            return matchRect;\r\n        },\r\n        renderAnswer: function ($view, $gapImgs, answers) {\r\n            //显示答案\r\n            $gapImgs.each(function (i) {\r\n                    var $this = $(this),\r\n                        id = $this.attr(\"id\"),\r\n                        targetId = '',\r\n                        target = false;\r\n                    if (answers) {\r\n                        answers.forEach(function (answer) {\r\n                            var answerArry = answer.split(\" \");\r\n                            if (answerArry[0] === id) {\r\n                                targetId = answerArry[1];\r\n                                target = true;\r\n                            }\r\n                        });\r\n                    }\r\n                    if (target) {\r\n                        var $parent = $this.parent();\r\n                        $this.attr('data-parent-style', $parent.attr('style'));\r\n                        $this.attr('data-parent-class', $parent.attr('class'));\r\n                        $parent.remove();\r\n                        $view.find('#' + targetId).append($this);\r\n                    }\r\n                }\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    var _modelHandler = {\r\n        _name: 'graphicGapMatchInteraction',\r\n        //获取modal名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n            var _model = modelItem.getModel();\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return _utils.getLangText('puzzle', this.getOption());\r\n            };\r\n\r\n            modelItem.getClassName = function () {\r\n                return 'nqti-base-puzzle';\r\n            };\r\n\r\n            modelItem.createTitleHtml = function () {\r\n                return _model.prompt;\r\n            }\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var that = this;\r\n                //计算最大宽高值\r\n                var data = gapUtil.getTableData(_model);\r\n\r\n                //不超过最大限制\r\n                var resize = gapUtil.getAreaSize(data.width, data.height, option.expectWidth, option.expectHeight, data.cols, data.rows, data.oneWidth, data.oneHeight, _maxSvgWidth, _maxSvgHeight);\r\n\r\n                var tBody = '';\r\n                for (var row in data.matrix) {\r\n                    var td = '';\r\n                    data.matrix[row].forEach(function (spot) {\r\n                        td += _utils.template(HTML.TD, {id: spot.identifier, content: '', width: (100 / data.matrix[row].length) + '%', height: (100 / data.rows) + '%'});\r\n                    });\r\n                    tBody += _utils.template(HTML.TR, {content: td});\r\n                }\r\n\r\n                _model.gapImg = _utils.Rd.shuffleArray(_model.gapImg, option.randomSeed);\r\n                var imgHtml = '';\r\n\r\n                for (var i = 0; i < _model.gapImg.length; i++) {\r\n                    var gapImg = _model.gapImg[i];\r\n\r\n                    var orientation = gapImg.width / gapImg.height <= _sideWidthPerHeight ? '_horizontal' : '';\r\n                    var liOrientation = gapImg.width / gapImg.height > _sideWidthPerHeight ? '_autoh' : '';\r\n                    imgHtml += _utils.template(HTML.SIDE_ITEM, {\r\n                        src: gapImg.data,\r\n                        width: '',\r\n                        id: gapImg.identifier,\r\n                        orientation: orientation,\r\n                        cls: liOrientation,\r\n                        lazyloader: (option.graphicGapMatchImageLoaderEnable ? true : false)\r\n                    });\r\n                }\r\n\r\n                var tableBorderWidth = _utils.getPlatForm().statis === option.platForm ? 0 : _tableBorderWidth;\r\n\r\n                var html = _utils.template(HTML.QUS_BODY, {\r\n                    list: imgHtml, tbody: tBody, width: 'width:' + resize.w + 'px', height: 'height:' + resize.h + 'px',\r\n                    'c-width': 'width:' + ( resize.w + tableBorderWidth * 2) + 'px', 'c-height': 'height:' + (resize.h + tableBorderWidth * 2) + 'px'\r\n                });\r\n\r\n                return html;\r\n            }\r\n\r\n\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n                //选项\r\n                var $side = $view.find('._nqti-js-side');\r\n\r\n                var platStatis = _utils.getPlatForm().statis === option.platForm;\r\n\r\n                if (platStatis) {\r\n                    $view.closest('._qti-player').addClass('nqti-base-puzzle-stati');\r\n                }\r\n\r\n                var $table = $view.find('.nqti-base-puzzle-table');\r\n                var $wrap = $view.find('._nqti-js-wrap');\r\n                var $puzzleModule = $view.find('.nqti-base-puzzle-module');\r\n\r\n                //默认隐藏\r\n                $side.hide();\r\n\r\n                var resizeTable = function () {\r\n                    var option = that.getOption();\r\n                    var max = gapUtil.qtiMaxSize($view);\r\n                    if (!option.expectWidth && !option.expectHeight) {\r\n                        var tableBorderWidth = _utils.getPlatForm().statis === option.platForm ? 0 : _tableBorderWidth;\r\n                        if (max.maxW) {\r\n                            var data = gapUtil.getTableData(_model);\r\n                            var resize = gapUtil.getAreaSize(data.width, data.height, option.expectWidth, option.expectHeight, data.cols,\r\n                                data.rows, data.oneWidth, data.oneHeight, max.maxW, max.maxH);\r\n\r\n\r\n                            $table.css({width: resize.w + 'px', height: resize.h + 'px'});\r\n                            $wrap.css('height', (resize.h + tableBorderWidth * 2) + 'px');\r\n                            $puzzleModule.css('width', (resize.w + tableBorderWidth * 2) + 'px');\r\n                        }\r\n                    }\r\n                    //有宽高时，显示内容\r\n                    if (max.maxW && !option.showCorrectAnswer && !platStatis) {\r\n                        $side.show();\r\n                    }\r\n                    //重新计算，如果高度不超过最大高度直接自适应高度\r\n                    var height = $view.find('._nqti-js-side-ul li').height();\r\n                    if (_model.gapImg[0].height < height) {\r\n                        $view.find('._nqti-js-side-ul li').css('height', 'auto');\r\n                    }\r\n                };\r\n\r\n                resizeTable();\r\n                $view.find('.nqti-module-content').resize(function () {\r\n                    resizeTable();\r\n                });\r\n            };\r\n\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                //做题区域容器\r\n                var $container = $view.find('._nqti-js-wrap');\r\n                //svg块\r\n                var $rects = $view.find(\"._nqti-js-td\");\r\n                //\r\n                var $ul = $view.find('._nqti-js-side-ul');\r\n                //gapimg的offset和css的left的相差值\r\n                var cOffset = $container.offset();\r\n                //填写区域的块坐标\r\n                that.__rects = [];\r\n\r\n                /**\r\n                 * 初始化目标矩形坐标位置\r\n                 */\r\n                that.__rects = gapUtil.getRects(cOffset, $rects);\r\n\r\n\r\n                var resizeCoor = function () {\r\n                    cOffset = gapUtil.getOffsetInt($container);\r\n                    var newRects = gapUtil.getRects(cOffset, $rects);\r\n\r\n                    newRects.forEach(function (rect, i) {\r\n                        rect.f = that.__rects[i].f;\r\n                    });\r\n                    that.__rects = newRects;\r\n                };\r\n\r\n\r\n                var getAnswer = function () {\r\n                    var answer = [];\r\n                    that.__rects.forEach(function (rect) {\r\n                        if (rect.f) {\r\n                            answer.push(rect.f + \" \" + rect.id);\r\n                        }\r\n                    });\r\n                    _logger.debug(answer);\r\n                    return answer;\r\n                };\r\n\r\n                var initDrawEvent = function () {\r\n                    var lastPoint = null,\r\n                        $target,\r\n                        targetCssText,\r\n                        absPoint,\r\n                        scale = 1;\r\n\r\n                    var lastActiveTarget;\r\n                    var moveNum = 0, rect;\r\n                    var width, height, id;\r\n                    var supportTouch = ('ontouchend' in document);\r\n\r\n                    var downEvent = function (e) {\r\n                        var _$target = $(e.target).closest('._nqti-js-img');\r\n                        //防止多点触控造成的bug\r\n                        if (!_$target || !_$target[0] || _$target.hasClass('_move')) {\r\n                            return;\r\n                        }\r\n                        scale = gapUtil.getScale($container);\r\n                        moveNum = 0;\r\n                        e.preventDefault();\r\n                        width = _$target.find('img').width();\r\n                        height = _$target.find('img').height();\r\n                        id = _$target.attr('id');\r\n\r\n                        //获取原始位置\r\n                        var tOffset = _$target.find('img').offset();\r\n                        $target = _$target.clone();\r\n                        $container.append($target);\r\n                        if (_$target.parent()[0].tagName === 'LI') {\r\n                            $target.attr('data-parent-style', _$target.parent().attr('style'));\r\n                            $target.attr('data-parent-class', _$target.parent().attr('class'));\r\n                            _$target.parent().addClass('_old');\r\n                        } else {\r\n                            _$target.addClass('_old');\r\n                        }\r\n                        var currentAbsOffset = gapUtil.getOffsetInt($container);\r\n                        //重新计算坐标\r\n                        if (!cOffset || currentAbsOffset.left !== cOffset.left || currentAbsOffset.top !== cOffset.top) {\r\n                            resizeCoor();\r\n                        }\r\n                        cOffset = currentAbsOffset;\r\n\r\n                        lastPoint = gapUtil.getEventPoint(e, cOffset);\r\n\r\n                        absPoint = {\r\n                            x: lastPoint.x - tOffset.left + cOffset.left,\r\n                            y: lastPoint.y - tOffset.top + cOffset.top\r\n                        };\r\n\r\n                        $target.addClass('_move');\r\n                        $target.css({'width': width + 'px', 'height': height + 'px', 'left': (lastPoint.x - absPoint.x) / scale + 'px', 'top': (lastPoint.y - absPoint.y) / scale + 'px'});\r\n                        targetCssText = $target[0].style.cssText.replace('left', '').replace('top', '');\r\n                    };\r\n\r\n                    var moveEvent = function (e) {\r\n                        if (!lastPoint) {\r\n                            return;\r\n                        }\r\n                        //pc端重新计算坐标，移动端考虑的效率问题不实时获取坐标\r\n                        if (!supportTouch) {\r\n                            var currentAbsOffset = gapUtil.getOffsetInt($container);\r\n                            //重新计算坐标\r\n                            if (!cOffset || currentAbsOffset.left !== cOffset.left || currentAbsOffset.top !== cOffset.top) {\r\n                                resizeCoor();\r\n                                cOffset = currentAbsOffset;//重新获取\r\n                            }\r\n                        }\r\n                        lastPoint = gapUtil.getEventPoint(e, cOffset);\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        if (moveNum % 3 === 0) {\r\n                            rect = gapUtil.intersectRect(that.__rects, lastPoint.x - absPoint.x, lastPoint.y - absPoint.y, height * scale, width * scale, id);\r\n                            if (rect) {\r\n                                if (lastActiveTarget)\r\n                                    lastActiveTarget.removeClass('td-move');\r\n                                lastActiveTarget = $view.find('#' + rect.id);\r\n                                lastActiveTarget.addClass('td-move');\r\n                            } else {\r\n                                if (lastActiveTarget)\r\n                                    lastActiveTarget.removeClass('td-move');\r\n                            }\r\n                        }\r\n                        moveNum++;\r\n                        $target[0].style.cssText = targetCssText + \";\" + \"left:\" + (lastPoint.x - absPoint.x) / scale + \"px;\" + \"top:\" + (lastPoint.y - absPoint.y) / scale + \"px;\";\r\n                    };\r\n\r\n                    var stopEvent = function (e) {\r\n                        if (!lastPoint || !absPoint) {\r\n                            return;\r\n                        }\r\n                        if (moveNum === 0) {\r\n                            rect = gapUtil.intersectRect(that.__rects, lastPoint.x - absPoint.x, lastPoint.y - absPoint.y, height * scale, width * scale, id);\r\n                        }\r\n                        $view.find('._old').remove();\r\n                        if (rect) {\r\n                            //相交  定位到目标中心\r\n                            gapUtil.addFill(that.__rects, rect.id, id);\r\n                            $view.find('#' + rect.id).append($target);\r\n                            $target.removeClass('_move').attr('style', '');\r\n                        } else {\r\n                            gapUtil.removeFill(that.__rects, id);\r\n                            var $li = $('<li style=\"' + $target.attr('data-parent-style') + '\" class=\"' + $target.attr('data-parent-class') + '\"></li>');\r\n                            $target.removeClass('_move').attr('style', '');\r\n                            $li.append($target);\r\n                            $ul.append($li);\r\n                        }\r\n                        //移除旧元素\r\n                        $rects.removeClass('td-move');\r\n                        if (lastPoint != null) {\r\n                            that.setAnswer(getAnswer());\r\n                        }\r\n                        lastPoint = null;\r\n                        absPoint = null;\r\n                        rect = null;\r\n                    };\r\n\r\n                    var _event = (function (e) {\r\n                        var _downTrigger = false;\r\n                        var bodyRect = null;\r\n                        var __event = function (e) {\r\n                            if (that.isLock()) {\r\n                                return;\r\n                            }\r\n                            if (e.type !== 'touchmove' && e.type !== 'mousemove') {\r\n                                _logger.debug(e.type);\r\n                            }\r\n                            switch (e.type) {\r\n                                case 'touchstart':\r\n                                case 'mousedown':\r\n                                    if (_downTrigger) {\r\n                                        return;\r\n                                    }\r\n                                    _downTrigger = true;\r\n                                    downEvent(e);\r\n                                    bodyRect = {\r\n                                        height: $(document.body).height(),\r\n                                        width: $(document.body).width()\r\n                                    };\r\n                                    break;\r\n                                case 'touchmove':\r\n                                case 'mousemove':\r\n                                    if (!_downTrigger) {\r\n                                        return;\r\n                                    }\r\n                                    moveEvent(e);\r\n                                    var point = gapUtil.coordinate(e);\r\n\r\n                                    if (e.type === 'touchmove' &&\r\n                                        (Math.abs(point.clientY - bodyRect.height) <= 15\r\n                                        || Math.abs(point.clientX - bodyRect.width) <= 15\r\n                                        || point.clientX <= 12\r\n                                        || point.clientY <= 12)) {\r\n                                        _downTrigger = false;\r\n                                        stopEvent(e);\r\n                                        return;\r\n                                    }\r\n                                    break;\r\n                                case 'touchend':\r\n                                case 'touchcancel':\r\n                                case 'mouseup':\r\n                                case 'mouseleave':\r\n                                    _downTrigger = false;\r\n                                    stopEvent(e);\r\n                                    break;\r\n\r\n                            }\r\n                        };\r\n                        return __event;\r\n                    })();\r\n\r\n                    if (_utils.Broswer.any()) {\r\n                        $container.on('touchstart touchmove touchend touchcancel ', _event);\r\n                    } else {\r\n                        $container.on('touchstart touchmove touchend touchcancel mousedown mousemove mouseup mouseleave', _event);\r\n                    }\r\n                };\r\n\r\n                initDrawEvent();\r\n                $container.resize(function () {\r\n                    cOffset = gapUtil.getOffsetInt($container);\r\n                    resizeCoor();\r\n                });\r\n            };\r\n\r\n            modelItem.renderReset = function ($view) {\r\n                //svg块\r\n                var $gapImgs = $view.find(\"._nqti-js-td ._nqti-js-img\");\r\n                var $ul = $view.find('._nqti-js-side-ul');\r\n                var $side = $view.find('._nqti-js-side');\r\n                $side.show();\r\n                $gapImgs.each(function () {\r\n                    var $this = $(this);\r\n                    var $li = $('<li style=\"' + $this.attr('data-parent-style') + '\" class=\"' + $this.attr('data-parent-class') + '\"></li>');\r\n                    $this.removeClass('_move').attr('style', '');\r\n                    $li.append($this);\r\n                    $ul.append($li);\r\n                });\r\n                gapUtil.removeAllFill(this.__rects);\r\n            };\r\n\r\n            modelItem.renderAnswer = function ($view) {\r\n                var answers = this.getAnswer();\r\n                gapUtil.initFill(this.__rects, answers);\r\n                var $gapImgs = $view.find('._nqti-js-img');\r\n                gapUtil.renderAnswer($view, $gapImgs, answers);\r\n            };\r\n\r\n            modelItem.renderCheckedAnswer = function ($view) {\r\n                this.renderAnswer($view);\r\n            };\r\n\r\n            modelItem.renderCorrectAnswer = function ($view) {\r\n                var answers = this.getCorrectAnswer();\r\n                gapUtil.initFill(this.__rects, answers);\r\n                var $side = $view.find('._nqti-js-side');\r\n                var $gapImgs = $view.find('._nqti-js-img');\r\n                $side.hide();\r\n                gapUtil.renderAnswer($view, $gapImgs, answers);\r\n            };\r\n\r\n            modelItem.destroy = function () {\r\n\r\n            }\r\n        }\r\n    };\r\n    //注册\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n\r\n})(window, jQuery);\r\n\r\n\n// inlineChoiceInteraction\r\n(function (window, $) {\r\n    //创建\r\n    var _utils = window.QtiPlayer.getUtils();\r\n    var _modelHandler = {\r\n        _name: 'inlineChoiceInteraction',\r\n        //获取model名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n            var _model = modelItem.getModel();\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return '文本选择题';\r\n            };\r\n            //该model没有小题编号\r\n            modelItem.hasNum = function () {\r\n                return false;\r\n            };\r\n            //该model没有提示\r\n            modelItem.hasHint = function () {\r\n                return false;\r\n            };\r\n            modelItem.createTitleHtml = function () {\r\n                return '';\r\n            };\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var result = '';\r\n                var choose=_utils.getLangText('inline_choice_choose', option);\r\n                var choice;\r\n                var choiceArr = _model.inlineChoice;\r\n                result += '<span class=\"qp-model-content\"><select class=\"qp-inline-choice\">'\r\n                            + '<option>--' + choose + '--</option>';\r\n                for (var i = 0; i < choiceArr.length; i++) {\r\n                    choice = choiceArr[i];\r\n                    result += '<option value=\"' + choice.identifier + '\">' + choice.content + '</option>';\r\n                }\r\n                result += '</select></span>';\r\n                return result;\r\n            };\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n                var $select = $view.find('.qp-inline-choice');\r\n                //初始化答案\r\n                var answer = null;\r\n                if (option.showAnswer || option.showCheckedAnswer) {\r\n                    //显示当前用户答案\r\n                    answer = that.getAnswer();\r\n                } else if (option.showCorrectAnswer) {\r\n                    //显示正确答案\r\n                    answer = that.getCorrectAnswer();\r\n                }\r\n                if (answer && answer.length > 0) {\r\n                    $select.val(answer[0]);\r\n                }\r\n                //锁定\r\n                if (option.showLock) {\r\n                    $select.attr('disabled', 'disabled');\r\n                }\r\n            };\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                var $select = $view.find('.qp-inline-choice');\r\n                $select.change(function () {\r\n                    var answer = [];\r\n                    answer.push($select.val());\r\n                    that.setAnswer(answer);\r\n                });\r\n            };\r\n        }\r\n    };\r\n    //注册\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})(window, jQuery);\r\n\r\n\n// matchInteraction\r\n(function (window, $) {\r\n\r\n    var _utils = window.QtiPlayer.getUtils();\r\n    var _logger = window.QtiPlayer.getLogger();\r\n\r\n    var EXTEND_WIDTH = 5;\r\n    var LINE_WIDTH_PC = 8;\r\n    var LINE_WIDTH_MOBIEL = 15;\r\n\r\n    var _imgRegex = {\r\n        _imageRegex: /<img([\\s\\S]*?)\\/>/g,\r\n        _srcRegex: /src=\"([\\s\\S]*?)\"/,\r\n        _widthRegex: /width=\"([\\s\\S]*?)\"/,\r\n        _heightRegex: /height=\"([\\s\\S]*?)\"/\r\n    }\r\n\r\n\r\n    var HTML = {\r\n        SORT_ITEM: ' <li identifier=\"${identifier}\" class=\"nqti-base-connectLine-sort-list _nqti-js-sort-list\">' +\r\n        '               <span class=\"nqti-base-connectLine-sort-text\"><em class=\"nqti-base-connectLine-sort-text-word\">${index}</em></span>' +\r\n        '           </li>',\r\n        PIC_TEXT: '<li id=\"${id}\" matchMax=\"${max}\" class=\"nqti-base-connectLine-list nqti-base-connectLine-pic-text ${jscls}\">' +\r\n        '               <div class=\"nqti-base-connectLine-list-img\">${img}</div>' +\r\n        '               <span class=\"nqti-base-connectLine-list-btm\"><i class=\"opacity_black_bg\" style=\"display: none;\"></i><em class=\"nqti-base-connectLine-list-btm-word\">${text}</em></span>' +\r\n        '           </li>',\r\n        PIC: '<li id=\"${id}\" matchMax=\"${max}\"  class=\"nqti-base-connectLine-list nqti-base-connectLine-only-pic ${jscls}\"><div class=\"nqti-base-connectLine-list-img\">${img}</div></li>',\r\n        TEXT: '<li id=\"${id}\" matchMax=\"${max}\"  class=\"nqti-base-connectLine-list nqti-base-connectLine-only-text ${jscls}\">' +\r\n        '<em class=\"nqti-base-connectLine-only-text-word\">${text}</em>' +\r\n        '</li>',\r\n        ITEM_BODY: '<ul class=\"nqti-base-connectLine-list-ul\">${content}</ul>',\r\n        QUS_BODY: '<div class=\"nqti-base-connectLine-content \">' +\r\n        '               <div class=\"nqti-base-connectLine-container clearfix\">' +\r\n        '                   <ul class=\"nqti-base-connectLine-sort-num-ul _nqti-js-sort\">${sort}</ul>' +\r\n        '                   ${item}' +\r\n        '               </div>' +\r\n        '               <svg class=\"nqti-base-connectLine-svg _nqti-js-svg\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\"><defs></defs></svg> ' +\r\n        '          </div>'\r\n    };\r\n\r\n\r\n    var matchUtil = {\r\n        getScale: function ($dom) {\r\n            if ($dom && $dom.length > 0) {\r\n                var offWidth = $dom[0].offsetWidth;\r\n                return (offWidth > 0 ? ($dom[0].getBoundingClientRect().width / offWidth) : 1) || 1;\r\n            }\r\n            return 1;\r\n        },\r\n        getFill: function ($item) {\r\n            var fill = $item.attr('fill');\r\n            if (fill !== undefined && fill != '') {\r\n                return fill.split(',');\r\n            }\r\n            return [];\r\n        },\r\n        _removeFill: function ($item, fillId) {\r\n            var fill = this.getFill($item);\r\n            var index = fill.indexOf(fillId);\r\n            if (index >= 0) {\r\n                fill.splice(index, 1);\r\n                $item.attr('fill', fill.join(','));\r\n            }\r\n        },\r\n        removeFill: function ($view, id, fillId) {\r\n            var item1 = $view.find('#' + id);\r\n            var item2 = $view.find('#' + fillId);\r\n            this._removeFill(item1, fillId);\r\n            this._removeFill(item2, id);\r\n            this.updateItemLineStyle(item1);\r\n            this.updateItemLineStyle(item2);\r\n        },\r\n        removeAllFill: function ($view) {\r\n            var $boxs = $view.find('._nqti-js-resbox,._nqti-js-targetbox');\r\n            $boxs.attr('fill', '');\r\n            $view.find('._nqti-js-svg line').remove();\r\n            $boxs.removeClass('error');\r\n            $boxs.removeClass('correct');\r\n            $boxs.removeClass('on');\r\n        },\r\n        _addFill: function ($item, fillId) {\r\n            var fill = this.getFill($item);\r\n            var index = fill.indexOf(fillId);\r\n            if (index < 0) {\r\n                fill.push(fillId);\r\n                $item.attr('fill', fill.join(','));\r\n            }\r\n        },\r\n        addFill: function ($view, id, fillId) {\r\n            var item1 = $view.find('#' + id);\r\n            var item2 = $view.find('#' + fillId);\r\n            console.log('match', id, fillId);\r\n            this._addFill(item1, fillId);\r\n            this._addFill(item2, id);\r\n            this.updateItemLineStyle(item1);\r\n            this.updateItemLineStyle(item2);\r\n        },\r\n        hasFill: function ($item, fillId) {\r\n            var fill = this.getFill($item);\r\n            var index = fill.indexOf(fillId);\r\n            return index >= 0;\r\n        },\r\n        canFill: function ($item) {\r\n            var fill = this.getFill($item);\r\n            if (fill.length >= parseInt($item.attr('matchMax'))) {\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n        getRect: function ($box, res, scale) {\r\n            var w = $box.width() * scale,\r\n                h = $box.height() * scale,\r\n                offset = $box.offset();\r\n            var right = offset.left + w;\r\n            if (res) {\r\n                right = offset.left + w + EXTEND_WIDTH;\r\n            }\r\n            return {\r\n                l: offset.left,\r\n                t: offset.top,\r\n                r: right,\r\n                b: offset.top + h,\r\n                w: w,\r\n                h: h,\r\n                id: $box.attr('id'),\r\n                matchMax: parseInt($box.attr('matchMax'))\r\n            };\r\n        },\r\n        getLinePos: function ($view, absOffset, id, fillId) {\r\n            var scale = this.getScale($view);\r\n            var resRect = this.getRect($view.find('#' + id), true, scale);\r\n            var tRect = this.getRect($view.find('#' + fillId), false, scale);\r\n            var pos = {};\r\n            pos.y1 = (resRect.h) / 2 + resRect.t - absOffset.top;\r\n            pos.x1 = resRect.r - absOffset.left - EXTEND_WIDTH;\r\n            pos.x2 = tRect.l - absOffset.left;\r\n            pos.y2 = tRect.t - absOffset.top + (tRect.h / 2);\r\n            return pos;\r\n        },\r\n        getAnswer: function ($view) {\r\n            var answer = [];\r\n            var that = this;\r\n            $view.find('._nqti-js-resbox').each(function () {\r\n                var fill = that.getFill($(this));\r\n                var id = $(this).attr('id');\r\n                for (var i = 0; i < fill.length; i++) {\r\n                    if (fill[i] != '') {\r\n                        answer.push(id + ' ' + fill[i]);\r\n                    }\r\n                }\r\n            });\r\n            return answer;\r\n        },\r\n        isAnswerItemRight: function (correct, item) {\r\n            var flag = false;\r\n            for (var i = 0; i < correct.length; i++) {\r\n                var answer = correct[i];\r\n                if (answer === item) {\r\n                    flag = true;\r\n                    break;\r\n                }\r\n            }\r\n            return flag;\r\n        },\r\n        getEventPoint: function (e, absOffset) {\r\n            var point = {}, x, y;\r\n            var isTouch = e.originalEvent && (e.originalEvent.targetTouches || e.originalEvent.changedTouches);\r\n            if (isTouch) {\r\n                var event = (e.originalEvent.targetTouches && e.originalEvent.targetTouches.length > 0) ? e.originalEvent.targetTouches : e.originalEvent.changedTouches;\r\n                x = event[0].pageX - absOffset.left;\r\n                y = event[0].pageY - absOffset.top;\r\n                point = {x: x, y: y, touch: true};\r\n            } else {\r\n                var event = e.originalEvent || e;\r\n                x = event.pageX - absOffset.left;\r\n                y = event.pageY - absOffset.top;\r\n                point = {x: x, y: y, touch: false};\r\n            }\r\n            return point;\r\n        },\r\n        coordinate: function (e) {\r\n            switch (e.type) {\r\n                case 'touchstart':\r\n                case 'touchmove':\r\n                case 'touchend':\r\n                case 'touchcancel':\r\n                    var event = (e.originalEvent.targetTouches && e.originalEvent.targetTouches.length > 0) ? e.originalEvent.targetTouches : e.originalEvent.changedTouches;\r\n                    return event[0];\r\n                default:\r\n                    return e;\r\n            }\r\n        },\r\n        updateItemLineStyle: function ($item) {\r\n            var fill = this.getFill($item);\r\n            if (fill.length <= 0) {\r\n                $item.removeClass('on');\r\n            } else {\r\n                $item.addClass('on');\r\n            }\r\n        },\r\n        isRes: function ($item) {\r\n            return $item.hasClass('_nqti-js-resbox');\r\n        },\r\n        _intersectedRect: function (x, y, rects, absOffset) {\r\n            x = x + absOffset.left;\r\n            y = y + absOffset.top;\r\n\r\n            var intersected = false;\r\n            var inRect;\r\n            for (var i = 0; i < rects.length; i++) {\r\n                var rect = rects[i];\r\n                if (x > rect.l && x < rect.r && y > rect.t && y < rect.b) {\r\n                    intersected = true;\r\n                    inRect = rect;\r\n                    break;\r\n                }\r\n            }\r\n            return inRect;\r\n        },\r\n        intersectedRect: function ($view, pos, absOffset, resBoxRects) {\r\n            var rect = this._intersectedRect(pos.x, pos.y, resBoxRects, absOffset);\r\n            if (rect == null) {\r\n                return null;\r\n            }\r\n            return this.getFill($view.find('#' + rect.id)).length >= rect.matchMax ? null : rect;\r\n        },\r\n        renderAnswer: function ($view, answers, option, correctAnswers) {\r\n            //数字图标\r\n            var $qpNumber = $view.find('._nqti-js-sort');\r\n            //每个选项的容器\r\n            var $boxs = $view.find('._nqti-js-resbox,._nqti-js-targetbox');\r\n\r\n            var $svg = $view.find('._nqti-js-svg');\r\n            var svgdoc = _utils.Svg.getSVGDocument($svg[0]);\r\n            var svgRoot = _utils.Svg.getSVGRoot($svg[0]);\r\n            var scale = matchUtil.getScale($view);\r\n            //初始化答案属性\r\n            answers.forEach(function (answer) {\r\n                var answerArry = answer.split(\" \");\r\n                if (answerArry.length === 2) {\r\n                    matchUtil.addFill($view, answerArry[0], answerArry[1]);\r\n                }\r\n            });\r\n\r\n            if (option.showCheckedAnswer) {\r\n                //确认接入平台\r\n                var pptshell = _utils.getPlatForm().pptshell === option.platForm;\r\n                //隐藏左侧数字\r\n                if (!pptshell) {\r\n                    $qpNumber.hide();\r\n                }\r\n                //隐藏没有选中的项\r\n                $boxs.each(function () {\r\n                    var $box = $(this);\r\n                    var fill = $box.attr('fill');\r\n                    //是否有选中\r\n                    if (fill === undefined || fill.length <= 0) {\r\n                        if (!pptshell) {\r\n                            $box.hide();\r\n                        }\r\n                    }\r\n                })\r\n            }\r\n\r\n            var hide = false;\r\n            for (var i = 0; i < answers.length; i++) {\r\n                var answer = answers[i];\r\n                var answerArry = answer.split(' ');\r\n                if (answerArry.length !== 2) {\r\n                    continue;\r\n                }\r\n                var id = answerArry[0], tid = answerArry[1];\r\n                var pos = matchUtil.getLinePos($view, $svg.offset(), id, tid);\r\n                if (pos) {\r\n                    var line;\r\n                    if (option.showCheckedAnswer) {\r\n                        var fill = $view.find('#' + id).attr('fill');\r\n                        var iscorrect = matchUtil.isAnswerItemRight(correctAnswers, id + ' ' + fill);\r\n                        line = _utils.Svg.addLine(svgdoc, svgRoot, '', pos.x1 / scale, pos.y1 / scale, pos.x2 / scale, pos.y2 / scale, iscorrect ? 'nqti-base-connectLine-normal nqti-base-connectLine-correct' : 'nqti-base-connectLine-normal nqti-base-connectLine-error', '');\r\n                        var $qpItemContainer = $view.find('#' + id + ' ,#' + tid);\r\n                        if (iscorrect) {\r\n                            $qpItemContainer.addClass('correct');\r\n                        } else {\r\n                            $qpItemContainer.addClass('error');\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (option.showCorrectAnswer) {\r\n                            $view.find('#' + id + ',#' + tid).addClass('correct');\r\n                            line = _utils.Svg.addLine(svgdoc, svgRoot, '', pos.x1 / scale, pos.y1 / scale, pos.x2 / scale, pos.y2 / scale, 'nqti-base-connectLine-normal nqti-base-connectLine-correct', '');\r\n                        } else {\r\n                            $view.find('#' + id + ',#' + tid).addClass('on');\r\n                            line = _utils.Svg.addLine(svgdoc, svgRoot, '', pos.x1 / scale, pos.y1 / scale, pos.x2 / scale, pos.y2 / scale, 'nqti-base-connectLine-normal', '');\r\n                        }\r\n                    }\r\n                    $(line).attr('rid', id);\r\n                    $(line).attr('tid', tid);\r\n                    if (pos.x1 <= 5 || pos.x2 <= 5) {\r\n                        hide = true;\r\n                    }\r\n                }\r\n            }\r\n            if (hide === true) {\r\n                $view.find('line').hide();\r\n            } else {\r\n                $view.find('line').show();\r\n            }\r\n\r\n\r\n        }\r\n    };\r\n\r\n//创建\r\n    var _modelHandler = {\r\n        _name: 'matchInteraction',\r\n        //获取model名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n\r\n            var _model = modelItem.getModel();\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return _utils.getLangText('connection', this.getOption());\r\n            };\r\n            modelItem.getClassName = function () {\r\n                return 'nqti-connectLine';\r\n            };\r\n            modelItem.init = function () {\r\n            }\r\n            modelItem.createTitleHtml = function () {\r\n                return _model.prompt;\r\n            }\r\n            modelItem.createAnswerHtml = function (option) {\r\n                //如果图片有宽高属性，直接加载，防止resize事件触发\r\n                var resizeImg = function (html) {\r\n                    var resultHtml = html.replace(_imgRegex._imageRegex, function (imageInfo, $1) {\r\n                        var result = imageInfo;\r\n                        //使用框架图片加载服务\r\n                        result = result.replace(/\\<img/, '<img data-media-img-render=\"false\"').replace(/width=/, '').replace(/height=/, '');\r\n                        return result;\r\n                    });\r\n                    return resultHtml\r\n                };\r\n\r\n                var getImage = function (str) {\r\n                    var images = str.match(_imgRegex._imageRegex);\r\n                    if (images.length > 0) {\r\n                        return images[0];\r\n                    }\r\n                    return '';\r\n                };\r\n                var getText = function (str) {\r\n                    return str.replace(_imgRegex._imageRegex, function (imageInfo) {\r\n                        return '';\r\n                    });\r\n                };\r\n\r\n                var createItem = function (simpleMatchSet, res) {\r\n                    var html = '';\r\n                    var len = simpleMatchSet.length;\r\n                    var randomArry = _utils.Rd.getAnswerRandom((len * 2 - 1), len, option.randomSeed);\r\n                    if (res) {\r\n                        randomArry = _utils.Rd.getAnswerRandom((len - 1), 0, option.randomSeed);\r\n                    }\r\n                    var jscls = res ? '_nqti-js-resbox' : '_nqti-js-targetbox';\r\n                    for (var i = 0; i < simpleMatchSet.length; i++) {\r\n                        var simpleAC = simpleMatchSet[i];\r\n\r\n                        if (_model.shuffle) {\r\n                            simpleAC = simpleMatchSet[res ? randomArry[i] : (randomArry[i] - len)];\r\n                        }\r\n\r\n                        var content = resizeImg(simpleAC.content.trim());\r\n                        if (/^<img([^<>]*?)\\/>$/.test(content)) {\r\n                            html += _utils.template(HTML.PIC, {id: simpleAC.identifier, max: simpleAC.matchMax, img: content, jscls: jscls})\r\n                        } else if (/<img([^<>]*?)\\/>/.test(content)) {\r\n                            html += _utils.template(HTML.PIC_TEXT, {\r\n                                id: simpleAC.identifier,\r\n                                max: simpleAC.matchMax,\r\n                                img: getImage(content),\r\n                                text: getText(content),\r\n                                jscls: jscls\r\n                            })\r\n                        } else {\r\n                            html += _utils.template(HTML.TEXT, {id: simpleAC.identifier, max: simpleAC.matchMax, text: content, jscls: jscls})\r\n                        }\r\n                    }\r\n                    html = _utils.template(HTML.ITEM_BODY, {content: html});\r\n                    return html;\r\n                };\r\n                var item = createItem(_model.simpleMatchSet[0], true);\r\n                item += createItem(_model.simpleMatchSet[1], false);\r\n                var sort = '';\r\n                _model.simpleMatchSet[0].forEach(function (item, i) {\r\n                    sort += _utils.template(HTML.SORT_ITEM, {index: i + 1, identifier: item.identifier});\r\n                });\r\n\r\n                var html = _utils.template(HTML.QUS_BODY, {item: item, sort: sort});\r\n                return html;\r\n            }\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n                var qpNums = $view.find('._nqti-js-sort-list');\r\n                //点击序号回调，统计部分用到\r\n                $view.find('._nqti-js-svg').on('click', function (e) {\r\n                    var point = {\r\n                        x: e.pageX,\r\n                        y: e.pageY\r\n                    };\r\n                    var answers = that.getCorrectAnswer();\r\n                    qpNums.each(function () {\r\n                        var $qpNum = $(this);\r\n                        var offset = $qpNum.offset();\r\n                        var numWidth = $qpNum.width();\r\n                        var numHeight = $qpNum.height();\r\n                        var index = parseInt($qpNum.text()) - 1;\r\n                        var identifier = $qpNum.attr('identifier');\r\n                        if (point.x >= (offset.left - 20) && point.x <= (offset.left + numWidth + 20) && point.y >= (offset.top - 20) && point.y <= (offset.top + numHeight + 20)) {\r\n                            var val;\r\n                            for (var i = 0; i < answers.length; i++) {\r\n                                var answer = answers[i];\r\n                                var answerArry = answer.split(' ');\r\n                                if (answerArry.length !== 2) {\r\n                                    continue;\r\n                                }\r\n                                var id = answerArry[0];\r\n                                if (id == identifier) {\r\n                                    val = answer;\r\n                                    break;\r\n                                }\r\n                            }\r\n                            that.triggerOptionClick(index, val);\r\n                        }\r\n                    });\r\n                });\r\n            };\r\n\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                var $resBoxs = $view.find('._nqti-js-resbox');\r\n                var $targetBoxs = $view.find('._nqti-js-targetbox');\r\n                var $svg = $view.find('._nqti-js-svg');\r\n                var svg = $svg[0];\r\n                var svgdoc = _utils.Svg.getSVGDocument(svg);\r\n                var svgRoot = _utils.Svg.getSVGRoot(svg);\r\n                var resBoxRects = [];\r\n                var targetBoxsRects = [];\r\n                var scale = matchUtil.getScale($view);\r\n\r\n                /**\r\n                 * 初始化坐标数据\r\n                 */\r\n                var initDataCoor = function () {\r\n                    if (!($targetBoxs && $resBoxs)) {\r\n                        return;\r\n                    }\r\n                    resBoxRects = [];\r\n                    targetBoxsRects = [];\r\n                    $resBoxs.each(function () {\r\n                        var rect = matchUtil.getRect($(this), true, scale);\r\n                        resBoxRects.push(rect);\r\n                    });\r\n                    $targetBoxs.each(function () {\r\n                        targetBoxsRects.push(matchUtil.getRect($(this), false, scale));\r\n                    });\r\n                };\r\n\r\n                /**\r\n                 * 初始化画图事件\r\n                 */\r\n                var initDrawEvent = function () {\r\n                    var $line = null,\r\n                        isTargetRect = null;\r\n\r\n                    //获取触发的矩形区域和起点\r\n                    var getLinePoint = function (lastPoint, absOffset) {\r\n                        var downRect = {};\r\n                        isTargetRect = false;\r\n                        var rect = matchUtil.intersectedRect($view, lastPoint, absOffset, resBoxRects);\r\n                        if (!rect) {\r\n                            isTargetRect = true;\r\n                            rect = matchUtil.intersectedRect($view, lastPoint, absOffset, targetBoxsRects);\r\n                        }\r\n                        downRect.rect = rect;\r\n                        if (!rect) {\r\n                            lastPoint = null;\r\n                            return downRect;\r\n                        }\r\n\r\n                        downRect.y1 = (rect.b - rect.t) / 2 + rect.t - absOffset.top;\r\n                        if (isTargetRect) {\r\n                            downRect.x1 = rect.r - absOffset.left - rect.w;\r\n                        } else {\r\n                            downRect.x1 = rect.r - absOffset.left - EXTEND_WIDTH;\r\n                        }\r\n                        return downRect;\r\n                    };\r\n\r\n                    var downEvent = function (e, lastPoint, absOffset) {\r\n                        //重新计算坐标\r\n                        var downRect = getLinePoint(lastPoint, absOffset);\r\n                        if (!downRect.rect) {\r\n                            return;\r\n                        }\r\n                        var line = _utils.Svg.addLine(svgdoc, svgRoot, '', downRect.x1 / scale, downRect.y1 / scale, lastPoint.x / scale, lastPoint.y / scale, 'nqti-base-connectLine-normal', '');\r\n                        $line = $(line);\r\n                        $line.attr('rid', downRect.rect.id);\r\n                    };\r\n\r\n                    var moveEvent = function (e, lastPoint) {\r\n                        if ($line != null) {\r\n                            e.preventDefault();\r\n                            $line.attr('x2', lastPoint.x / scale);\r\n                            $line.attr('y2', lastPoint.y / scale);\r\n                        }\r\n                    };\r\n\r\n                    //动态高亮连线，返回当前点所在的直线\r\n                    var hoverLine = function (point, lineWidth) {\r\n                        var $lines = $view.find('.nqti-base-connectLine-normal');\r\n                        $lines.attr('class', 'nqti-base-connectLine-normal');\r\n                        var $line = null;\r\n                        var width = 100;\r\n                        $lines.each(function () {\r\n                            var x1 = this.x1.baseVal.value, y1 = this.y1.baseVal.value, x2 = this.x2.baseVal.value, y2 = this.y2.baseVal.value;\r\n                            var pwidth = _utils.Area.pointToLine(x1, y1, x2, y2, point.x / scale, point.y / scale);\r\n                            if (pwidth <= width) {\r\n                                width = pwidth;\r\n                                $line = $(this);\r\n                            }\r\n                        });\r\n                        if ($line) {\r\n                            if (width <= lineWidth) {\r\n                                $line.attr('class', 'nqti-base-connectLine-normal nqti-base-connectLine-hover')\r\n                            } else {\r\n                                $line = null;\r\n                            }\r\n                        }\r\n                        return $line;\r\n                    };\r\n\r\n                    var stopEvent = function (e, lastPoint, absOffset) {\r\n                        if ($line != null) {\r\n                            var id = $line.attr('rid');\r\n\r\n                            var tRect = matchUtil.intersectedRect($view, lastPoint, absOffset, isTargetRect ? resBoxRects : targetBoxsRects);\r\n                            if (!tRect || matchUtil.hasFill($view, id, tRect.id)) {\r\n                                $line.remove();\r\n                            } else {\r\n                                if (isTargetRect) {\r\n                                    $line.attr('x2', (tRect.r - absOffset.left - EXTEND_WIDTH) / scale);\r\n                                } else {\r\n                                    $line.attr('x2', (tRect.l - absOffset.left) / scale);\r\n                                }\r\n                                $line.attr('y2', (tRect.t - absOffset.top + ((tRect.b - tRect.t) / 2)) / scale);\r\n                                //绑定答案\r\n                                matchUtil.addFill($view, id, tRect.id);\r\n                                $line.attr('tid', tRect.id);\r\n                            }\r\n                            that.setAnswer(matchUtil.getAnswer($view));\r\n                        }\r\n                        $line = null;\r\n                    };\r\n\r\n                    var $lastTarget;\r\n\r\n                    var click = function (e) {\r\n                        var pos = matchUtil.getEventPoint(e, $svg.offset());\r\n                        var $line = hoverLine(pos, pos.touch ? LINE_WIDTH_MOBIEL : LINE_WIDTH_PC);\r\n                        if ($line) {\r\n                            $line.remove();\r\n                            matchUtil.removeFill($view, $line.attr('rid'), $line.attr('tid'));\r\n                            that.setAnswer(matchUtil.getAnswer($view));\r\n                        } else {\r\n                            var rect = matchUtil.intersectedRect($view, pos, $svg.offset(), resBoxRects);\r\n                            if (!rect) {\r\n                                rect = matchUtil.intersectedRect($view, pos, $svg.offset(), targetBoxsRects);\r\n                            }\r\n                            if (rect) {\r\n                                var $box = $view.find('#' + rect.id);\r\n\r\n                                var res = $box.hasClass('_nqti-js-resbox');\r\n                                if (!matchUtil.canFill($box)) {\r\n                                    return;\r\n                                }\r\n                                if ($lastTarget && matchUtil.canFill($lastTarget)) {\r\n\r\n                                    var lastIsRes = matchUtil.isRes($lastTarget);\r\n                                    var boxId = $box.attr('id');\r\n                                    var lastBoxId = $lastTarget.attr('id');\r\n\r\n                                    if ($lastTarget[0] == $box[0]) {\r\n                                        //和上一个相同，直接移除\r\n                                        $lastTarget = null;\r\n                                        $box.removeClass('on');\r\n                                    } else if (res === lastIsRes) {\r\n                                        //在同一侧，移除上一个的样式\r\n                                        $lastTarget.removeClass('on');\r\n                                        $lastTarget = $box;\r\n                                        $lastTarget.addClass('on');\r\n                                    } else if (!matchUtil.hasFill($lastTarget, boxId)) {\r\n\r\n                                        var pos = {};\r\n                                        if (lastIsRes) {\r\n                                            pos = matchUtil.getLinePos($view, $svg.offset(), lastBoxId, boxId);\r\n                                        } else {\r\n                                            pos = matchUtil.getLinePos($view, $svg.offset(), boxId, lastBoxId);\r\n                                        }\r\n                                        var line = _utils.Svg.addLine(svgdoc, svgRoot, '', pos.x1 / scale, pos.y1 / scale, pos.x2 / scale, pos.y2 / scale, 'nqti-base-connectLine-normal', '');\r\n                                        $(line).attr('tid', boxId);\r\n                                        $(line).attr('rid', lastBoxId);\r\n                                        matchUtil.addFill($view, boxId, lastBoxId);\r\n                                        that.setAnswer(matchUtil.getAnswer($view));\r\n                                        $lastTarget.addClass('on');\r\n                                        $box.addClass('on');\r\n                                        $lastTarget = null;\r\n                                    }\r\n                                } else {\r\n                                    $box.addClass('on');\r\n                                    $lastTarget = $box;\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n\r\n\r\n                    var _event = (function (e) {\r\n                        var _downTrigger = false;\r\n                        var _lastPoint = null;\r\n                        var _startPos = null;\r\n                        var _endPos = null;\r\n                        var _startTime;\r\n                        var _absOffset = null;\r\n                        var bodyRect = null;\r\n                        var __event = function (e) {\r\n                            if (that.isLock()) {\r\n                                return;\r\n                            }\r\n                            if (e.type !== 'touchmove' && e.type !== 'mousemove') {\r\n                                _logger.debug(e.type);\r\n                                //_logger.debug(e.type);\r\n                            }\r\n                            switch (e.type) {\r\n                                case 'touchstart':\r\n                                case 'mousedown':\r\n                                    //防止多点触控异常\r\n                                    if (_downTrigger) {\r\n                                        return;\r\n                                    }\r\n                                    _downTrigger = true;\r\n                                    var currentAbsOffset = $svg.offset();\r\n                                    //重新计算坐标\r\n                                    if (!_absOffset || currentAbsOffset.left !== _absOffset.left || currentAbsOffset.top !== _absOffset.top) {\r\n                                        initDataCoor();\r\n                                    }\r\n                                    _absOffset = currentAbsOffset;//获取offset的差额\r\n                                    _lastPoint = matchUtil.getEventPoint(e, _absOffset);\r\n                                    _startPos = _lastPoint;\r\n                                    _startTime = new Date().getTime();\r\n                                    _lastPoint.x = _lastPoint.x;\r\n                                    _lastPoint.y = _lastPoint.y;\r\n                                    downEvent(e, _lastPoint, _absOffset);\r\n                                    bodyRect = {\r\n                                        height: $(document.body).height(),\r\n                                        width: $(document.body).width()\r\n                                    };\r\n                                    break;\r\n                                case 'touchmove':\r\n                                case 'mousemove':\r\n                                    if (!_downTrigger) {\r\n                                        if (e.type === 'mousemove') {\r\n                                            hoverLine(matchUtil.getEventPoint(e, $svg.offset()), LINE_WIDTH_PC);\r\n                                        }\r\n                                        return;\r\n                                    }\r\n                                    _lastPoint = matchUtil.getEventPoint(e, _absOffset);\r\n                                    _lastPoint.x = _lastPoint.x;\r\n                                    _lastPoint.y = _lastPoint.y;\r\n                                    _endPos = _lastPoint;\r\n\r\n                                    var point = matchUtil.coordinate(e);\r\n\r\n                                    if (e.type === 'touchmove' &&\r\n                                        (Math.abs(point.clientY - bodyRect.height) <= 15\r\n                                        || Math.abs(point.clientX - bodyRect.width) <= 15\r\n                                        || point.clientX <= 12\r\n                                        || point.clientY <= 12)) {\r\n                                        stopEvent(e, _lastPoint, _absOffset);\r\n                                        _downTrigger = false;\r\n                                        _lastPoint = null;\r\n                                        return;\r\n                                    }\r\n                                    moveEvent(e, _lastPoint);\r\n                                    break;\r\n                                case 'touchend':\r\n                                case 'touchcancel':\r\n                                case 'mouseup':\r\n                                case 'mouseleave':\r\n                                    _lastPoint = matchUtil.getEventPoint(e, $svg.offset());\r\n                                    _endPos = _lastPoint;\r\n                                    stopEvent(e, _lastPoint, _absOffset);\r\n                                    _downTrigger = false;\r\n                                    _lastPoint = null;\r\n\r\n                                    if (_endPos && e.type === 'mouseup') {\r\n                                        var _holdTime = new Date().getTime() - _startTime;\r\n                                        var dx = Math.abs(_endPos.x - _startPos.x);\r\n                                        var dy = Math.abs(_endPos.y - _startPos.y);\r\n                                        if (_holdTime > 800 || dx >= 5 || dy >= 5) {\r\n                                            return;\r\n                                        }\r\n                                        click(e);\r\n                                    }\r\n                                    break;\r\n                                case 'qpTap':\r\n                                    //case 'click':\r\n                                    if (_endPos && e.type === 'click') {\r\n                                        var _holdTime = new Date().getTime() - _startTime;\r\n                                        var dx = Math.abs(_endPos.x - _startPos.x);\r\n                                        var dy = Math.abs(_endPos.y - _startPos.y);\r\n                                        if (_holdTime > 800 || dx >= 5 || dy >= 5) {\r\n                                            return;\r\n                                        }\r\n                                    }\r\n                                    click(e);\r\n                                    break;\r\n                            }\r\n                        };\r\n                        return __event;\r\n                    })();\r\n\r\n                    if (_utils.Broswer.any()) {\r\n                        $svg.on('qpTap touchstart touchmove touchend touchcancel ', _event);\r\n                    } else {\r\n                        $svg.on('click touchstart touchmove touchend touchcancel mousedown mousemove mouseup mouseleave ', _event);\r\n                    }\r\n\r\n                };\r\n\r\n                initDataCoor();\r\n                initDrawEvent();\r\n\r\n            };\r\n\r\n\r\n            modelItem.renderReset = function ($view, removeResize) {\r\n                var $qpNumber = $view.find('._nqti-js-sort');\r\n                var $boxs = $view.find('._nqti-js-resbox,._nqti-js-targetbox');\r\n                if (removeResize !== false) {\r\n                    $view.find('._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content').off('resize');\r\n                }\r\n                //显示放在后面，防止触发resize事件\r\n                $qpNumber.show();\r\n                $boxs.show();\r\n                matchUtil.removeAllFill($view);\r\n            };\r\n\r\n            modelItem.renderAnswer = function ($view) {\r\n                var that = this;\r\n                var answers = this.getAnswer();\r\n                var correctAnswers = this.getCorrectAnswer();\r\n                var option = that.getOption();\r\n                $view.find('._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content').off('resize');\r\n                var showAnswer = function () {\r\n                    that.renderReset($view, false);\r\n                    matchUtil.renderAnswer($view, answers, option, correctAnswers);\r\n                };\r\n\r\n                //列高度变化，或者整体高度变化触发显示答案\r\n                $view.find('._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content').resize(function () {\r\n                    showAnswer();\r\n                });\r\n                showAnswer();\r\n            };\r\n\r\n            modelItem.renderCheckedAnswer = function ($view) {\r\n                this.renderAnswer($view);\r\n            };\r\n\r\n            modelItem.renderCorrectAnswer = function ($view) {\r\n                var that = this;\r\n                var answers = this.getCorrectAnswer();\r\n                var option = that.getOption();\r\n                $view.find('._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content').off('resize');\r\n                var showAnswer = function () {\r\n                    that.renderReset($view, false);\r\n                    matchUtil.renderAnswer($view, answers, option, answers);\r\n                };\r\n\r\n                //列高度变化，或者整体高度变化触发显示答案\r\n                $view.find('._nqti-js-resbox,._nqti-js-targetbox,.nqti-base-connectLine-content').resize(function () {\r\n                    showAnswer();\r\n                });\r\n                showAnswer();\r\n            };\r\n\r\n            modelItem.destroy = function () {\r\n\r\n            }\r\n        }\r\n    };\r\n\r\n    //注册\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n\r\n})\r\n(window, jQuery);\r\n\r\n\n// choiceInteraction\r\n(function (window, $) {\r\n    var _utils = window.QtiPlayer.getUtils();\r\n\r\n\r\n    var HTML = {\r\n        PIC_TEXT: '<li data-id=\"${identifier}\" class=\"nqti-base-sequence-list nqti-base-sequence-pic-text\">' +\r\n        '               ${img}' +\r\n        '               <span class=\"nqti-base-sequence-list-btm-text\">' +\r\n        '                   <i class=\"opacity_black_bg\" style=\"display: none;\"></i>'+\r\n        '                   <em class=\"nqti-base-sequence-list-btm-word\">${text}</em>' +\r\n        '               </span>' +\r\n        '           </li>',\r\n        PIC: '<li data-id=\"${identifier}\" class=\"nqti-base-sequence-list nqti-base-sequence-only-pic\">${img}</li>',\r\n        TEXT: '<li data-id=\"${identifier}\" class=\"nqti-base-sequence-list nqti-base-sequence-only-text\">' +\r\n        '<em class=\"nqti-base-sequence-only-text-word\">${text}</em>' +\r\n        '</li>',\r\n        ITEM_BODY: '<ul class=\"nqti-base-sequence-list-ul clearfix _nqti-js-sequence-ul \">${content}</ul>'\r\n    };\r\n\r\n\r\n    var _modelHandler = {\r\n        _name: 'orderInteraction',\r\n        //获取modal名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n\r\n        //创建渲染的方法\r\n        create: function (modelItem) {\r\n            var _model = modelItem.getModel();\r\n            //选项数据处理,将排序项的中的图片分离出来\r\n            var simpleChoice = _model.simpleChoice;\r\n            var choice;\r\n            var imageRegex = /<img[\\s\\S]*?\\/>/g;\r\n            for (var index = 0; index < simpleChoice.length; index++) {\r\n                choice = simpleChoice[index];\r\n                //图片内容处理\r\n                var image = '';\r\n                choice.content = choice.content.replace(imageRegex, function (imageHtml) {\r\n                    //设置图片期望高宽属性\r\n                    var attr = imageHtml.substring(4, imageHtml.length - 2);\r\n                    image = '<img data-class=\"qp-order-image\" data-media-img-render=\\'{\"renderUI\":false,\"minWidth\":205,\"minHeight\":165}\\'  ' + attr + ' />'.replace(/width=/, '').replace(/height=/, '');\r\n                    return '';\r\n                });\r\n                choice.image = image;\r\n            }\r\n\r\n            var getAnswer = function ($paixuList) {\r\n                var answer = [];\r\n                $paixuList.children('li').each(function () {\r\n                    answer.push($(this).data('id'));\r\n                });\r\n                return answer;\r\n            };\r\n\r\n            var getRandomSimpleChoice = function (_model, correctAnswer, randomSeed) {\r\n                var simpleChoice = [];\r\n                simpleChoice.pushArray(_model.simpleChoice);\r\n                //答题模式\r\n                if (_model.shuffle) {\r\n                    //乱序\r\n                    simpleChoice = _utils.Rd.shuffleArray(simpleChoice, randomSeed);\r\n                    //排除正确答案\r\n                    var same = true;\r\n                    for (var i = 0; i < simpleChoice.length; i++) {\r\n                        if (simpleChoice[i].identifier != correctAnswer[i]) {\r\n                            same = false;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (same) {\r\n                        //如果乱序后还是正确答案，则取出第一个选项，插入到组后\r\n                        var firstChoice = simpleChoice.shift();\r\n                        simpleChoice.push(firstChoice);\r\n                    }\r\n                }\r\n                return simpleChoice;\r\n            };\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return _utils.getLangText('sort', this.getOption());\r\n            };\r\n            modelItem.getClassName = function () {\r\n                return 'nqti-sequence';\r\n            };\r\n            //创建model html片段\r\n            modelItem.createTitleHtml = function () {\r\n                return _model.prompt;\r\n            };\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var that = this;\r\n                var result;\r\n\r\n                var simpleChoice = getRandomSimpleChoice(_model, that.getCorrectAnswer(), option.randomSeed);\r\n                //渲染选项\r\n                var choice;\r\n                var itemHtml = '';\r\n                for (var index = 0; index < simpleChoice.length; index++) {\r\n                    choice = simpleChoice[index];\r\n                    if (choice.image === '') {\r\n                        itemHtml += _utils.template(HTML.TEXT, {text: choice.content, identifier: choice.identifier});\r\n                    } else if (choice.content && choice.content.trim() !== '') {\r\n                        itemHtml += _utils.template(HTML.PIC_TEXT, {img: choice.image, text: choice.content, identifier: choice.identifier});\r\n                    } else {\r\n                        itemHtml += _utils.template(HTML.PIC, {img: choice.image, identifier: choice.identifier});\r\n                    }\r\n                }\r\n                result = _utils.template(HTML.ITEM_BODY, {content: itemHtml});\r\n                return result;\r\n            };\r\n            modelItem.render = function ($view, option) {\r\n\r\n            };\r\n\r\n            modelItem.renderReset = function ($view) {\r\n                var simpleChoice = getRandomSimpleChoice(_model, this.getCorrectAnswer(), this.getOption().randomSeed);\r\n                var $paixuList = $view.find('._nqti-js-sequence-ul');\r\n                simpleChoice.forEach(function (choice) {\r\n                    $paixuList.find('[data-id=\"' + choice.identifier + '\"]').appendTo($paixuList);\r\n                });\r\n                return getAnswer($paixuList);\r\n            };\r\n\r\n            modelItem.renderAnswer = function ($view) {\r\n                var $paixuList = $view.find('._nqti-js-sequence-ul');\r\n                var answers = this.getAnswer();\r\n                answers.forEach(function (answer) {\r\n                    $paixuList.find('[data-id=\"' + answer + '\"]').appendTo($paixuList);\r\n                });\r\n                this.setAnswer(getAnswer($paixuList));\r\n            };\r\n\r\n            modelItem.renderCheckedAnswer = function ($view) {\r\n                this.renderAnswer($view);\r\n            };\r\n\r\n            modelItem.renderCorrectAnswer = function ($view) {\r\n                var $paixuList = $view.find('._nqti-js-sequence-ul');\r\n                var correctAnswer = this.getCorrectAnswer();\r\n                correctAnswer.forEach(function (answer) {\r\n                    $paixuList.find('[data-id=\"' + answer + '\"]').appendTo($paixuList);\r\n                });\r\n            };\r\n\r\n            modelItem.renderLock = function ($view) {\r\n                //重置内部option值\r\n                var $paixuList = $view.find('._nqti-js-sequence-ul');\r\n                if (this.isLock()) {\r\n                    $paixuList.dragsort(\"disabled\");\r\n                } else {\r\n                    $paixuList.dragsort(\"enable\");\r\n                }\r\n            };\r\n\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                var $paixuList = $view.find('._nqti-js-sequence-ul');\r\n                //\r\n                //初始化答案\r\n                if (option.showAnswerArea || option.showStatisAnswer) {\r\n                    that.setAnswer(getAnswer($paixuList));\r\n                }\r\n                //拖动事件\r\n                $paixuList.dragsort({\r\n                    draggable: {\r\n                        zIndex: 999,\r\n                        selector: 'li'\r\n                    },\r\n                    update: function () {\r\n                        that.setAnswer(getAnswer($paixuList));\r\n                    }\r\n                });\r\n            };\r\n        }\r\n    };\r\n    //注册\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})(window, jQuery);\r\n\r\n\n// textEntryInteraction\r\n(function (window, $) {\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    var _utils = _QtiPlayer.getUtils();\r\n\r\n    //创建\r\n    var _modelHandler = {\r\n        _name: 'textEntryInteraction',\r\n        //获取model名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        create: function (modelItem) {\r\n            //创建渲染方法\r\n            var _model = modelItem.getModel();\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return _utils.getLangText('blank_filling', this.getOption());\r\n            };\r\n            //该model没有小题编号\r\n            modelItem.hasNum = function () {\r\n                return false;\r\n            };\r\n            //该model没有提示\r\n            modelItem.hasHint = function () {\r\n                return false;\r\n            };\r\n            modelItem.hasTitle = function () {\r\n                return false;\r\n            };\r\n            modelItem.isBlock = function () {\r\n                return false;\r\n            };\r\n            //创建html对象的方法\r\n            modelItem.createTitleHtml = function () {\r\n                return '';\r\n            };\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var that = this;\r\n                var maxLangthAttr = '';\r\n                if (_model.expectedLength > 0) {\r\n                    maxLangthAttr = ' maxlength=\"' + _model.expectedLength + '\" ';\r\n                }\r\n                var modelId = _model.modelId;\r\n                var num = modelId.substring(modelId.lastIndexOf('-') + 1);\r\n                //显示填空区域\r\n                var result = '';\r\n\r\n                //显示正确答案\r\n                var answer = that.getCorrectAnswer();\r\n                var currentAnswer = '';\r\n                if (answer.length > 0) {\r\n                    currentAnswer = answer[0];\r\n                }\r\n                var showNum = option.showSubSequence && option.showCorrectAnswer;\r\n                var sequence = '<span class=\"nqti-base-fill-index _qp-text-showcorrectanswer-num ' + (showNum ? '' : 'nqti-hide-dom') + '\">' + num + '</span>';\r\n                result += '<span data-num=\"' + num + '\" class=\"nqti-base-fill-cell nqti-correct _qp-text-input _qp-text-showcorrectanswer ' + (option.showCorrectAnswer ? '' : 'nqti-hide-dom') + '\">'\r\n                    + sequence\r\n                    + currentAnswer\r\n                    + '</span>';\r\n\r\n                //checkedAnswer\r\n                result += '<span data-num=\"' + num + '\" class=\"nqti-base-fill-cell  _qp-text-input _qp-text-showcheckedanswer fill-cell-min-width ' + (option.showCheckedAnswer ? '' : 'nqti-hide-dom') + '\">'\r\n                    + '</span>';\r\n\r\n\r\n                //显示统计样式\r\n                result += '<span class=\"nqti-base-fill-cell _qp-text-input _qp-text-showstatisanswer ' + (option.showStatisAnswer ? '' : 'nqti-hide-dom') + '\"><span class=\"nqti-base-fill-index\">' + num + '</span></span>';\r\n\r\n                //其他模式显示\r\n                var showNormal = !option.showCorrectAnswer && !option.hideAnswerArea && !option.showStatisAnswer;\r\n                var type = _model.keyboard;\r\n                if ((typeof DigitalInput !== 'undefined') && _model.keyboard === 'number') {\r\n                    result += '<span data-index=\"0\" class=\"nqti-base-fill-cell span-to-div _qp-text-input qp-digital-container _qp-text-normal ' + (showNormal ? '' : 'nqti-hide-dom') + '\"  id=\"' + _utils.Rd.getRandom() + '\"></span>';\r\n                } else {\r\n                    var cls = '';\r\n                    if (_model.keyboard === 'number') {\r\n                        cls = 'input-number';\r\n                    }\r\n                    var step = '0.000000000001';\r\n                    if (_utils.Broswer.isIE()) {\r\n                        step = 'any';\r\n                    }\r\n                    result += '<input data-index=\"0\" step=\"' + step + '\" class=\"nqti-base-fill-cell ' + cls + ' _qp-text-input _qp-text-normal ' + (showNormal ? '' : 'nqti-hide-dom') + '\" '\r\n                        + ' data-type=\"' + type + '\"'\r\n                        + maxLangthAttr + '  type=\"' + type + '\"/>';\r\n                }\r\n                var result = '<span class=\"nqti-base-fill _qp-base-fill\">'\r\n                    + result\r\n                    + '<input style=\"position: absolute;left: -10000px;top: -10000px;\" class=\"nqti-base-fill-cell _qp-text-hidden \"  type=\"text\">'\r\n                    + '</span>';\r\n                return result;\r\n            };\r\n\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n                //填空点击回调\r\n                $view.find('._qp-base-fill').bind('qpTap', function () {\r\n                    var correctAnswer = that.getCorrectAnswer();\r\n                    that.triggerOptionClick(0, correctAnswer[0]);\r\n                });\r\n\r\n                that.__digitalReset = false;\r\n                //获取实际输入的文本框\r\n                var $input = $view.find('._qp-text-input._qp-text-normal');\r\n                if ($input.length <= 0) {\r\n                    return;\r\n                }\r\n                if ($input.attr('type') !== 'number') {\r\n                    $input.qtiAutogrow({\r\n                        maxWidth: '._qti-player',\r\n                        shadow: 'nqti-base-fill-cell',\r\n                        vertical: false,\r\n                        horizontal: true,\r\n                        postGrowCallback:function(ele){\r\n                            //解决pad上无法触发父节点重绘的问题\r\n                            ele.closest('._qp-model').css('-webkit-box-shadow', '0 0 1px rgba(0, 0, 0, 0)');\r\n                            setTimeout(function () {\r\n                                ele.closest('._qp-model').css('-webkit-box-shadow', '');\r\n                            }, 50);\r\n                        }\r\n                        //minWidth: $view.find('._qp-text-hidden')\r\n                        //, debugx: 00\r\n                        //, debugy: 100\r\n                    });\r\n                }\r\n                //是否数字键盘\r\n                var isDigital = $input.hasClass('qp-digital-container');\r\n                if (option.showAnswerArea) {\r\n                    if (_model.width) {\r\n                        var width = _model.width * 18;\r\n                        width = width < 60 ? 60 : width;\r\n                        $input.css('width', width + 'px');\r\n                    }\r\n                }\r\n                if (isDigital) {\r\n                    //注册数字键盘\r\n                    DigitalInput.InputManager.getInstance().register($input.get(0), function () {\r\n                        if (that.__digitalReset) {\r\n                            that.__digitalReset = false;\r\n                            return;\r\n                        }\r\n                        //实时更新回调答案\r\n                        var newValue = DigitalInput.InputManager.getInstance().getText4Dom($input.get(0));\r\n                        var answer = [];\r\n                        answer.push(newValue.toString());\r\n                        that.setAnswer(answer);\r\n                    });\r\n                }\r\n            };\r\n            //创建事件处理方法\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                var _$input = $view.find('._qp-text-input._qp-text-normal');\r\n                var isDigital = _$input.hasClass('qp-digital-container');\r\n                if (isDigital) {\r\n                    return;\r\n                }\r\n                var _timer = null;\r\n                var _lastValue = '';\r\n                //保存当前答案\r\n                var saveAnswer = function (newValue) {\r\n                    var answer = [];\r\n                    answer.push(newValue);\r\n                    that.setAnswer(answer);\r\n                };\r\n\r\n                //获取焦点时定时检测输入输入框变化\r\n                _$input.bind('focus', function () {\r\n                    _timer = setInterval(function () {\r\n                        var newValue = _$input.val().trim();\r\n                        if (newValue !== _lastValue) {\r\n                            //输入内容有变化\r\n                            _lastValue = newValue;\r\n                            saveAnswer(newValue);\r\n                        }\r\n                    }, 500);\r\n                });\r\n\r\n                //输入结束后保存答案\r\n                _$input.bind('blur', function () {\r\n                    //清空定时器\r\n                    clearInterval(_timer);\r\n                    _timer = null;\r\n                    //保存作答\r\n                    var newValue = _$input.val().trim();\r\n                    if (_$input.attr('data-type') === 'number' && _utils.Broswer.IEVersion() === 8) {\r\n                        if (newValue === '-' || newValue === '.') {\r\n                            newValue = '';\r\n                        }\r\n                    }\r\n                    _$input.val(newValue);\r\n                    _lastValue = newValue;\r\n                    saveAnswer(newValue);\r\n                });\r\n\r\n                if (_utils.Broswer.isIE() && _$input.attr('data-type') === 'number') {\r\n                    _$input.keydown(function (e) {\r\n                        return _utils.Dom.inputNumberKeydown(_$input, e);\r\n                    });\r\n                }\r\n            };\r\n\r\n            modelItem.renderReset = function ($view) {\r\n                var $input = $view.find('._qp-text-input._qp-text-normal');\r\n                $input.removeClass('nqti-error');\r\n                $input.removeClass('nqti-correct');\r\n                var isDigital = $input.hasClass('qp-digital-container');\r\n                if (isDigital) {\r\n                    this.__digitalReset = true;\r\n                    DigitalInput.InputManager.getInstance().setText4DOM('', $input.get(0));\r\n                } else {\r\n                    $input.val('');\r\n                    $input.trigger('input');\r\n                }\r\n                $view.find('._qp-text-showcorrectanswer').addClass('nqti-hide-dom');\r\n                $view.find('._qp-text-showcorrectanswer-num').addClass('nqti-hide-dom');\r\n                $view.find('._qp-text-showstatisanswer').addClass('nqti-hide-dom');\r\n                $view.find('._qp-text-normal').removeClass('nqti-hide-dom');\r\n                var $checkedAnswer = $view.find('._qp-text-showcheckedanswer');\r\n                $checkedAnswer.addClass('nqti-hide-dom');\r\n                $checkedAnswer.removeClass('nqti-error');\r\n                $checkedAnswer.removeClass('nqti-correct');\r\n                $checkedAnswer.addClass('fill-cell-min-width');\r\n\r\n            };\r\n\r\n            modelItem.renderAnswer = function ($view) {\r\n                //获取实际输入的文本框\r\n                var $input = $view.find('._qp-text-input._qp-text-normal');\r\n                //是否数字键盘\r\n                var isDigital = $input.hasClass('qp-digital-container');\r\n                var answer = this.getAnswer();\r\n                if (answer.length > 0) {\r\n                    if (isDigital) {\r\n                        DigitalInput.InputManager.getInstance().setText4DOM(answer[0], $input.get(0));\r\n                    } else {\r\n                        $input.val(answer[0]);\r\n                        $input.trigger('input');\r\n                    }\r\n                }\r\n            };\r\n\r\n            modelItem.renderCheckedAnswer = function ($view) {\r\n                var that = this;\r\n                //获取实际输入的文本框\r\n                var $answer = $view.find('._qp-text-showcheckedanswer');\r\n                $answer.removeClass('nqti-hide-dom');\r\n                $view.find('._qp-text-normal').addClass('nqti-hide-dom');\r\n\r\n                var answer = this.getAnswer();\r\n                var correctAnswer = this.getCorrectAnswer();\r\n                answer = answer.length > 0 ? answer[0] : '';\r\n                $answer.html(answer !== '' ? answer : '&nbsp;');\r\n\r\n                var checkedClass = this.checkTextAnswer(correctAnswer[0], answer) ? 'nqti-correct' : 'nqti-error';\r\n                $answer.addClass(checkedClass);\r\n                //渲染公式\r\n                if (typeof MathJax != typeof  undefined) {\r\n                    MathJax.Hub.Queue(['Typeset', MathJax.Hub, $answer[0]]);\r\n                }\r\n\r\n                this.__resizeCheckWidth($view);\r\n                $answer.resize(function () {\r\n                    that.__resizeCheckWidth($view);\r\n                });\r\n            };\r\n\r\n            modelItem.__resizeCheckWidth = function ($view) {\r\n                var inputWidth = $view.find('._qp-text-hidden')[0].clientWidth;\r\n                var $answer = $view.find('._qp-text-showcheckedanswer');\r\n                if ($answer.width() < (inputWidth + 5)) {\r\n                    $answer.addClass('fill-cell-min-width');\r\n                } else {\r\n                    $answer.removeClass('fill-cell-min-width');\r\n                }\r\n            };\r\n\r\n            modelItem.__unbindResize = function ($view) {\r\n                var $answer = $view.find('._qp-text-showcheckedanswer');\r\n                $answer.off('resize');\r\n            };\r\n\r\n            modelItem.renderStatisAnswer = function ($view) {\r\n                $view.find('._qp-text-showstatisanswer').removeClass('nqti-hide-dom');\r\n                $view.find('._qp-text-normal').addClass('nqti-hide-dom');\r\n            };\r\n\r\n            modelItem.renderCorrectAnswer = function ($view) {\r\n                $view.find('._qp-text-showcorrectanswer').removeClass('nqti-hide-dom');\r\n                if (this.getOption().showSubSequence) {\r\n                    $view.find('._qp-text-showcorrectanswer-num').removeClass('nqti-hide-dom');\r\n                }\r\n                $view.find('._qp-text-normal').addClass('nqti-hide-dom');\r\n            };\r\n\r\n            modelItem.renderLock = function ($view) {\r\n                var $input = $view.find('._qp-text-input._qp-text-normal');\r\n                //是否数字键盘\r\n                var isDigital = $input.hasClass('qp-digital-container');\r\n\r\n                if (this.isLock()) {\r\n                    if (isDigital) {\r\n                        DigitalInput.InputManager.getInstance().setDisabled4DOM($input.get(0), true);\r\n                    } else {\r\n                        $input.attr('disabled', 'disabled');\r\n                    }\r\n                } else {\r\n                    if (isDigital) {\r\n                        DigitalInput.InputManager.getInstance().setDisabled4DOM($input.get(0), false);\r\n                    } else {\r\n                        $input.removeAttr('disabled');\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    };\r\n    //注册\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})(window, jQuery);\r\n\r\n\n// choiceInteraction\r\n(function (window, $) {\r\n    var _QtiPlayer = window.QtiPlayer;\r\n    var _utils = _QtiPlayer.getUtils();\r\n    //创建\r\n    var _modelHandler = {\r\n        _name: 'textEntryMultipleInteraction',\r\n        //获取model名称\r\n        getName: function () {\r\n            return this._name;\r\n        },\r\n        create: function (modelItem) {\r\n            var _model = modelItem.getModel();\r\n            _model.textEntry = [];\r\n            var _initAnswer = [];\r\n            var _textEntryRegex = /<textEntry[\\s\\S]*?\\/>/g;\r\n            var keyboardRegex = /keyboard=\"([\\s\\S]*?)\"/;\r\n            var widthRegex = /width=\"(\\d+)\"/;\r\n            var textEntrys = _model.prompt.match(_textEntryRegex);\r\n            var expectedLengthRegex = /expectedLength=\"(\\d+)\"/;\r\n            var expectedLength;\r\n            var keyboard;\r\n            var width;\r\n            for (var i = 0; i < textEntrys.length; i++) {\r\n                expectedLength = _utils.getIntValue(textEntrys[i], expectedLengthRegex);\r\n                keyboard = _utils.getValue(textEntrys[i], keyboardRegex);\r\n                width = _utils.getIntValue(textEntrys[i], widthRegex);\r\n                if (!keyboard) {\r\n                    keyboard = 'text';\r\n                }\r\n                _model.textEntry.push({\r\n                    expectedLength: expectedLength,\r\n                    keyboard: keyboard,\r\n                    width: width\r\n                });\r\n                _initAnswer.push('');\r\n            }\r\n\r\n\r\n            var saveAnswer = function (that, index, newValue) {\r\n                var answer = that.getAnswer();\r\n                if (answer.length === 0) {\r\n                    answer = _initAnswer;\r\n                }\r\n                answer[index] = newValue;\r\n                that.setAnswer(answer);\r\n            };\r\n\r\n            //返回题目类型名称\r\n            modelItem.getName = function () {\r\n                return _utils.getLangText('blank_filling', this.getOption());\r\n            };\r\n\r\n            modelItem.createTitleHtml = function (option) {\r\n                return _utils.getLangText('text_title', option);\r\n            };\r\n            modelItem.createAnswerHtml = function (option) {\r\n                var that = this;\r\n                var textEntry = _model.textEntry;\r\n                var prompt = _model.prompt;\r\n                var index = 0;\r\n                prompt = prompt.replace(_textEntryRegex, function (m) {\r\n                    var num = index + 1;\r\n                    var object = textEntry[index];\r\n                    var maxLangthAttr = '';\r\n                    if (object.expectedLength > 0) {\r\n                        maxLangthAttr = ' maxlength=\"' + object.expectedLength + '\" ';\r\n                    }\r\n                    //显示填空区域\r\n\r\n                    //显示正确答案\r\n                    var answer = that.getCorrectAnswer();\r\n                    var currentAnswer = '';\r\n                    if (answer.length > 0) {\r\n                        currentAnswer = answer[index];\r\n                    }\r\n                    var sequence = '';\r\n                    var showNum = option.showSubSequence && option.showCorrectAnswer;\r\n                    if (option.showSubSequence) {\r\n                        sequence = '<span class=\"nqti-base-fill-index _qp-text-showcorrectanswer-num ' + (showNum ? '' : 'nqti-hide-dom') + '\">' + num + '</span>';\r\n                    }\r\n                    var input = '<span data-index=\"' + index + '\" class=\"nqti-base-fill-cell nqti-correct _qp-text-input _qp-text-showcorrectanswer ' + (option.showCorrectAnswer ? '' : 'nqti-hide-dom') + '\">'\r\n                        + sequence\r\n                        + currentAnswer\r\n                        + '</span>';\r\n\r\n\r\n                    //checkedAnswer\r\n                    input += '<span data-index=\"' + index + '\" class=\"nqti-base-fill-cell  _qp-text-input _qp-text-showcheckedanswer fill-cell-min-width ' + (option.showCheckedAnswer ? '' : 'nqti-hide-dom') + '\">'\r\n                        + '</span>';\r\n\r\n                    //显示统计样式\r\n                    input += '<span data-index=\"' + index + '\" class=\"nqti-base-fill-cell _qp-text-input _qp-text-showstatisanswer ' + (option.showStatisAnswer ? '' : 'nqti-hide-dom') + '\"><span class=\"nqti-base-fill-index\">' + num + '</span></span>';\r\n\r\n                    //其他模式显示\r\n                    var showNormal = !option.showCorrectAnswer && !option.hideAnswerArea && !option.showStatisAnswer;\r\n                    if ((typeof DigitalInput !== 'undefined') && object.keyboard === 'number') {\r\n                        input += '<span class=\"_qp-text-input nqti-base-fill-cell span-to-div qp-digital-container  _qp-text-normal ' + (showNormal ? '' : 'nqti-hide-dom') + '\"  data-index=\"' + index + '\" id=\"' + _utils.Rd.getRandom() + '\"></span>';\r\n                    } else {\r\n                        var cls = '';\r\n                        if (object.keyboard === 'number') {\r\n                            cls = 'input-number';\r\n                        }\r\n                        var step = '0.000000000001';\r\n                        if (_utils.Broswer.isIE()) {\r\n                            step = 'any';\r\n                        }\r\n                        input += '<input step=\"' + step + '\" class=\"nqti-base-fill-cell ' + cls + ' _qp-text-input  _qp-text-normal ' + (showNormal ? '' : 'nqti-hide-dom') + '\" '\r\n                            + maxLangthAttr\r\n                            + ' data-index=\"' + index + '\"'\r\n                            + ' data-type=\"' + object.keyboard + '\"'\r\n                            + ' type=\"' + object.keyboard + '\"/>';\r\n                    }\r\n                    index++;\r\n                    return input;\r\n                });\r\n                var result = '<div class=\"nqti-base-fill _qp-base-fill\">'\r\n                    + prompt\r\n                    + '<input style=\"position: absolute;left: -10000px;top: -10000px;\" class=\"nqti-base-fill-cell _qp-text-hidden \"  type=\"text\">'\r\n                    + '</div>';\r\n                return result;\r\n            };\r\n            modelItem.render = function ($view, option) {\r\n                var that = this;\r\n                that.__digitalResetCount = 0;\r\n\r\n                var $input = $view.find('._qp-text-input._qp-text-normal');\r\n\r\n                $input.each(function () {\r\n                    var $this = $(this);\r\n                    var index = $this.data('index');\r\n                    if (option.showAnswerArea) {\r\n                        if (_model.textEntry[index].width) {\r\n                            var width = _model.textEntry[index].width * 18;\r\n                            width = width < 60 ? 60 : width;\r\n                            $this.css('width', width + 'px');\r\n                        }\r\n                    }\r\n\r\n                    if ($this.hasClass('qp-digital-container')) {\r\n                        //初始化手写键盘\r\n                        DigitalInput.InputManager.getInstance().register($this.get(0), function () {\r\n                            if (that.__digitalResetCount > 0) {\r\n                                that.__digitalResetCount--;\r\n                                return;\r\n                            }\r\n                            //实时更新回调答案\r\n                            var newValue = DigitalInput.InputManager.getInstance().getText4Dom($this.get(0));\r\n                            var index = $this.data('index');\r\n                            saveAnswer(that, index, newValue.toString());\r\n                        });\r\n                    }\r\n                });\r\n\r\n                //填空点击回调\r\n                $view.find('._qp-base-fill').bind('qpTap', function (e) {\r\n                    var $target = $(e.target).closest('._qp-text-input');\r\n                    if ($target && $target.length > 0) {\r\n                        var index = $target.data('index');\r\n                        var correctAnswer = that.getCorrectAnswer();\r\n                        that.triggerOptionClick(index, correctAnswer[index]);\r\n                    }\r\n                });\r\n            };\r\n            modelItem.eventHandle = function ($view, option) {\r\n                var that = this;\r\n                var _$input = $view.find('._qp-text-input._qp-text-normal');\r\n                var _state = {};\r\n                //初始化状态数据\r\n                _$input.each(function () {\r\n                    var $this = $(this);\r\n                    var index = $this.data('index');\r\n                    _state[index] = {\r\n                        timer: null,\r\n                        lastValue: ''\r\n                    };\r\n                    if ($this.attr('type') !== 'number') {\r\n                        $this.qtiAutogrow({\r\n                            maxWidth: '._qti-player',\r\n                            shadow: 'nqti-base-fill-cell',\r\n                            vertical: false,\r\n                            horizontal: true,\r\n                            postGrowCallback: function (ele) {\r\n                                //解决pad上无法触发父节点重绘的问题\r\n                                ele.closest('._qp-model').css('-webkit-box-shadow', '0 0 1px rgba(0, 0, 0, 0)');\r\n                                setTimeout(function () {\r\n                                    ele.closest('._qp-model').css('-webkit-box-shadow', '');\r\n                                }, 50);\r\n\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n\r\n                _$input.each(function () {\r\n                    var $this = $(this);\r\n                    if (!$this.hasClass('qp-digital-container')) {\r\n                        //获取焦点时定时检测输入输入框变化\r\n                        $this.bind('focus', function () {\r\n                            //定时检测输入输入框变化\r\n                            var $this = $(this);\r\n                            var index = $this.data('index');\r\n                            var _thisState = _state[index];\r\n                            _thisState.timer = setInterval(function () {\r\n                                var newValue = $this.val().trim();\r\n                                if (newValue !== _thisState.lastValue) {\r\n                                    //输入内容有变化\r\n                                    _thisState.lastValue = newValue;\r\n                                    saveAnswer(that, index, newValue);\r\n                                }\r\n                            }, 500);\r\n                        });\r\n                        //输入结束后保存答案\r\n                        $this.bind('blur', function () {\r\n                            var $this = $(this);\r\n                            var index = $this.data('index');\r\n                            //清除定时器\r\n                            var _thisState = _state[index];\r\n                            clearInterval(_thisState.timer);\r\n                            _thisState.timer = null;\r\n                            //保存作答\r\n                            var newValue = $this.val().trim();\r\n                            if ($this.attr('data-type') === 'number' && _utils.Broswer.IEVersion() === 8) {\r\n                                if (newValue === '-' || newValue === '.') {\r\n                                    newValue = '';\r\n                                }\r\n                            }\r\n                            $this.val(newValue);\r\n                            _thisState.lastValue = newValue;\r\n                            saveAnswer(that, index, newValue);\r\n                        });\r\n\r\n                        if (_utils.Broswer.isIE() && $this.attr('data-type') === 'number') {\r\n\r\n                            $this.keydown(function (e) {\r\n                                return _utils.Dom.inputNumberKeydown($this, e);\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n\r\n            modelItem.renderReset = function ($view) {\r\n                var that = this;\r\n                var $input = $view.find('._qp-text-input._qp-text-normal');\r\n                $input.removeClass('nqti-error');\r\n                $input.removeClass('nqti-correct');\r\n                that.__digitalResetCount = 0;\r\n                $input.each(function () {\r\n                    var $this = $(this);\r\n                    var isDigital = $this.hasClass('qp-digital-container');\r\n                    if (isDigital) {\r\n                        that.__digitalResetCount++;\r\n                        DigitalInput.InputManager.getInstance().setText4DOM('', $this.get(0));\r\n                    } else {\r\n                        $this.val('');\r\n                        $this.trigger('input');\r\n                    }\r\n                });\r\n                $view.find('._qp-text-showcorrectanswer').addClass('nqti-hide-dom');\r\n                $view.find('._qp-text-showcorrectanswer-num').addClass('nqti-hide-dom');\r\n                $view.find('._qp-text-showstatisanswer').addClass('nqti-hide-dom');\r\n                $view.find('._qp-text-normal').removeClass('nqti-hide-dom');\r\n                var $checkedAnswer = $view.find('._qp-text-showcheckedanswer');\r\n                $checkedAnswer.addClass('nqti-hide-dom');\r\n                $checkedAnswer.removeClass('nqti-error');\r\n                $checkedAnswer.removeClass('nqti-correct');\r\n                $checkedAnswer.addClass('fill-cell-min-width');\r\n            };\r\n\r\n            modelItem.renderAnswer = function ($view) {\r\n                //获取实际输入的文本框\r\n                var $input = $view.find('._qp-text-input._qp-text-normal');\r\n                //是否数字键盘\r\n                var answer = this.getAnswer();\r\n                if (answer.length > 0 && answer.length === $input.length) {\r\n                    $input.each(function () {\r\n                        var $this = $(this);\r\n                        var index = $this.data('index');\r\n\r\n                        if ($this.hasClass('qp-digital-container')) {\r\n                            DigitalInput.InputManager.getInstance().setText4DOM(answer[index], $this.get(0));\r\n                        } else {\r\n                            $this.val(answer[index]);\r\n                            $this.trigger('input');\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n\r\n            modelItem.renderCheckedAnswer = function ($view) {\r\n                var that = this;\r\n                var $answer = $view.find('._qp-text-showcheckedanswer');\r\n                $answer.removeClass('nqti-hide-dom');\r\n                $view.find('._qp-text-normal').addClass('nqti-hide-dom');\r\n\r\n                var answer = this.getAnswer();\r\n                var correctAnswer = this.getCorrectAnswer();\r\n                //if (answer.length > 0 && answer.length === $answer.length) {\r\n                $answer.each(function () {\r\n                    var $this = $(this);\r\n                    var index = $this.data('index');\r\n                    var thisAnswer = answer[index] && answer[index] !== '' ? answer[index] : '';\r\n                    $this.html(thisAnswer !== '' ? thisAnswer : '&nbsp;');\r\n                    //答案反馈样式\r\n                    var checkedClass = that.checkTextAnswer(correctAnswer[index], thisAnswer) ? 'nqti-correct' : 'nqti-error';\r\n                    $this.addClass(checkedClass);\r\n                    //渲染公式\r\n                    if (typeof MathJax != typeof  undefined) {\r\n                        MathJax.Hub.Queue(['Typeset', MathJax.Hub, $this[0]]);\r\n                    }\r\n                });\r\n                //}\r\n\r\n                this.__resizeCheckWidth($view);\r\n                $answer.resize(function () {\r\n                    that.__resizeCheckWidth($view);\r\n                });\r\n            };\r\n\r\n            modelItem.__resizeCheckWidth = function ($view) {\r\n                var inputWidth = $view.find('._qp-text-hidden')[0].clientWidth;\r\n                var $answer = $view.find('._qp-text-showcheckedanswer');\r\n                $answer.each(function () {\r\n                    var $this = $(this);\r\n                    if ($this.width() < inputWidth + 5) {\r\n                        $this.addClass('fill-cell-min-width');\r\n                    } else {\r\n                        $this.removeClass('fill-cell-min-width');\r\n                    }\r\n                });\r\n            };\r\n\r\n            modelItem.__unbindResize = function ($view) {\r\n                var $answer = $view.find('._qp-text-showcheckedanswer');\r\n                $answer.off('resize');\r\n            };\r\n\r\n\r\n            modelItem.renderStatisAnswer = function ($view) {\r\n                $view.find('._qp-text-showstatisanswer').removeClass('nqti-hide-dom');\r\n                $view.find('._qp-text-normal').addClass('nqti-hide-dom');\r\n            };\r\n\r\n            modelItem.renderCorrectAnswer = function ($view) {\r\n                $view.find('._qp-text-showcorrectanswer').removeClass('nqti-hide-dom');\r\n                if (this.getOption().showSubSequence) {\r\n                    $view.find('._qp-text-showcorrectanswer-num').removeClass('nqti-hide-dom');\r\n                }\r\n                $view.find('._qp-text-normal').addClass('nqti-hide-dom');\r\n                //var correctAnswer = this.getCorrectAnswer();\r\n                //$view.find('._qp-text-showcorrectanswer').each(function () {\r\n                //    var $this = $(this);\r\n                //    var index = $this.data('index');\r\n                //    //答案反馈样式\r\n                //    $this.addClass('nqti-correct');\r\n                //});\r\n            };\r\n\r\n            modelItem.renderLock = function ($view) {\r\n                var $input = $view.find('._qp-text-input._qp-text-normal');\r\n                //是否数字键盘\r\n                if (this.isLock()) {\r\n                    $input.each(function () {\r\n                        var $this = $(this);\r\n                        var isDigital = $this.hasClass('qp-digital-container');\r\n                        if (isDigital) {\r\n                            DigitalInput.InputManager.getInstance().setDisabled4DOM($this.get(0), true);\r\n                        } else {\r\n                            $this.attr('disabled', 'disabled');\r\n                        }\r\n                    })\r\n\r\n                } else {\r\n                    $input.each(function () {\r\n                        var $this = $(this);\r\n                        var isDigital = $this.hasClass('qp-digital-container');\r\n                        if (isDigital) {\r\n                            DigitalInput.InputManager.getInstance().setDisabled4DOM($this.get(0), false);\r\n                        } else {\r\n                            $this.removeAttr('disabled');\r\n                        }\r\n                    });\r\n\r\n                }\r\n            };\r\n        }\r\n    };\r\n\r\n//注册\r\n    _QtiPlayer.registerModelHandler(_modelHandler);\r\n})(window, jQuery);\r\n\r\n\n/*!\r\n *  修复内存泄漏问题，修改为使用普通数组代替$([])  modify by ylf 2015/11/20\r\n * jQuery resize event - v1.1 - 3/14/2010\r\n * http://benalman.com/projects/jquery-resize-plugin/\r\n *\r\n * Copyright (c) 2010 \"Cowboy\" Ben Alman\r\n * Dual licensed under the MIT and GPL licenses.\r\n * http://benalman.com/about/license/\r\n */\r\n\r\n// Script: jQuery resize event\r\n//\r\n// *Version: 1.1, Last updated: 3/14/2010*\r\n//\r\n// Project Home - http://benalman.com/projects/jquery-resize-plugin/\r\n// GitHub       - http://github.com/cowboy/jquery-resize/\r\n// Source       - http://github.com/cowboy/jquery-resize/raw/master/jquery.ba-resize.js\r\n// (Minified)   - http://github.com/cowboy/jquery-resize/raw/master/jquery.ba-resize.min.js (1.0kb)\r\n//\r\n// About: License\r\n//\r\n// Copyright (c) 2010 \"Cowboy\" Ben Alman,\r\n// Dual licensed under the MIT and GPL licenses.\r\n// http://benalman.com/about/license/\r\n//\r\n// About: Examples\r\n//\r\n// This working example, complete with fully commented code, illustrates a few\r\n// ways in which this plugin can be used.\r\n//\r\n// resize event - http://benalman.com/code/projects/jquery-resize/examples/resize/\r\n//\r\n// About: Support and Testing\r\n//\r\n// Information about what version or versions of jQuery this plugin has been\r\n// tested with, what browsers it has been tested in, and where the unit tests\r\n// reside (so you can test it yourself).\r\n//\r\n// jQuery Versions - 1.3.2, 1.4.1, 1.4.2\r\n// Browsers Tested - Internet Explorer 6-8, Firefox 2-3.6, Safari 3-4, Chrome, Opera 9.6-10.1.\r\n// Unit Tests      - http://benalman.com/code/projects/jquery-resize/unit/\r\n//\r\n// About: Release History\r\n//\r\n// 1.1 - (3/14/2010) Fixed a minor bug that was causing the event to trigger\r\n//       immediately after bind in some circumstances. Also changed $.fn.data\r\n//       to $.data to improve performance.\r\n// 1.0 - (2/10/2010) Initial release\r\n\r\n(function ($, window, undefined) {\r\n    '$:nomunge'; // Used by YUI compressor.\r\n\r\n    // A jQuery object containing all non-window elements to which the resize\r\n    // event is bound.\r\n    var elems = [],\r\n\r\n    // Extend $.resize if it already exists, otherwise create it.\r\n        jq_resize = $.resize = $.extend($.resize, {}),\r\n\r\n        timeout_id,\r\n    // Reused strings.\r\n        str_setTimeout = 'setTimeout',\r\n        str_resize = 'resize',\r\n        str_data = str_resize + '-special-event',\r\n        str_delay = 'delay',\r\n        str_resize_key = 'data-resize',\r\n        str_throttle = 'throttleWindow',\r\n        time_count = 0;\r\n\r\n    // Property: jQuery.resize.delay\r\n    //\r\n    // The numeric interval (in milliseconds) at which the resize event polling\r\n    // loop executes. Defaults to 250.\r\n\r\n    jq_resize[str_delay] = 350;\r\n\r\n    // Property: jQuery.resize.throttleWindow\r\n    //\r\n    // Throttle the native window object resize event to fire no more than once\r\n    // every <jQuery.resize.delay> milliseconds. Defaults to true.\r\n    //\r\n    // Because the window object has its own resize event, it doesn't need to be\r\n    // provided by this plugin, and its execution can be left entirely up to the\r\n    // browser. However, since certain browsers fire the resize event continuously\r\n    // while others do not, enabling this will throttle the window resize event,\r\n    // making event behavior consistent across all elements in all browsers.\r\n    //\r\n    // While setting this property to false will disable window object resize\r\n    // event throttling, please note that this property must be changed before any\r\n    // window object resize event callbacks are bound.\r\n\r\n    jq_resize[str_throttle] = true;\r\n\r\n    // Event: resize event\r\n    //\r\n    // Fired when an element's width or height changes. Because browsers only\r\n    // provide this event for the window element, for other elements a polling\r\n    // loop is initialized, running every <jQuery.resize.delay> milliseconds\r\n    // to see if elements' dimensions have changed. You may bind with either\r\n    // .resize( fn ) or .bind( \"resize\", fn ), and unbind with .unbind( \"resize\" ).\r\n    //\r\n    // Usage:\r\n    //\r\n    // > jQuery('selector').bind( 'resize', function(e) {\r\n    // >   // element's width or height has changed!\r\n    // >   ...\r\n    // > });\r\n    //\r\n    // Additional Notes:\r\n    //\r\n    // * The polling loop is not created until at least one callback is actually\r\n    //   bound to the 'resize' event, and this single polling loop is shared\r\n    //   across all elements.\r\n    //\r\n    // Double firing issue in jQuery 1.3.2:\r\n    //\r\n    // While this plugin works in jQuery 1.3.2, if an element's event callbacks\r\n    // are manually triggered via .trigger( 'resize' ) or .resize() those\r\n    // callbacks may double-fire, due to limitations in the jQuery 1.3.2 special\r\n    // events system. This is not an issue when using jQuery 1.4+.\r\n    //\r\n    // > // While this works in jQuery 1.4+\r\n    // > $(elem).css({ width: new_w, height: new_h }).resize();\r\n    // >\r\n    // > // In jQuery 1.3.2, you need to do this:\r\n    // > var elem = $(elem);\r\n    // > elem.css({ width: new_w, height: new_h });\r\n    // > elem.data( 'resize-special-event', { width: elem.width(), height: elem.height() } );\r\n    // > elem.resize();\r\n    var getRandomId = function (name) {\r\n        return name + (Math.random() * 10 + new Date().getMilliseconds()).toString().replace(\".\", \"\")\r\n    };\r\n\r\n    var removeItem = function (arry, item) {\r\n        for (var i = 0; i < arry.length; i++) {\r\n            var temp = arry[i];\r\n            if (!isNaN(item)) {\r\n                temp = i;\r\n            }\r\n            if (temp[0] == item[0]) {\r\n                for (var j = i; j < arry.length; j++) {\r\n                    arry[j] = arry[j + 1];\r\n                }\r\n                arry.length = arry.length - 1;\r\n            }\r\n        }\r\n    }\r\n    $.event.special[str_resize] = {\r\n\r\n        // Called only when the first 'resize' event callback is bound per element.\r\n        setup: function () {\r\n            // Since window has its own native 'resize' event, return false so that\r\n            // jQuery will bind the event using DOM methods. Since only 'window'\r\n            // objects have a .setTimeout method, this should be a sufficient test.\r\n            // Unless, of course, we're throttling the 'resize' event for window.\r\n            if (!jq_resize[str_throttle] && this[str_setTimeout]) {\r\n                return false;\r\n            }\r\n\r\n            var elem = $(this);\r\n            elem.attr(str_resize_key, getRandomId(str_resize_key));\r\n            // Add this element to the list of internal elements to monitor.\r\n            elems.push(elem);\r\n\r\n            // Initialize data store on the element.\r\n            elem.data(str_data, {w: elem.width(), h: elem.height()});\r\n\r\n            // If this is the first element added, start the polling loop.\r\n            if (elems.length === 1) {\r\n                loopy();\r\n            }\r\n        },\r\n\r\n        // Called only when the last 'resize' event callback is unbound per element.\r\n        teardown: function () {\r\n            // Since window has its own native 'resize' event, return false so that\r\n            // jQuery will unbind the event using DOM methods. Since only 'window'\r\n            // objects have a .setTimeout method, this should be a sufficient test.\r\n            // Unless, of course, we're throttling the 'resize' event for window.\r\n            if (!jq_resize[str_throttle] && this[str_setTimeout]) {\r\n                return false;\r\n            }\r\n\r\n\r\n            var elem = $(this);\r\n\r\n            // Remove this element from the list of internal elements to monitor.\r\n            removeItem(elems, elem);\r\n            // Remove any data stored on the element.\r\n            elem.removeData(str_data);\r\n\r\n            // If this is the last element removed, stop the polling loop.\r\n            if (!elems.length) {\r\n                clearTimeout(timeout_id);\r\n            }\r\n        },\r\n\r\n        // Called every time a 'resize' event callback is bound per element (new in\r\n        // jQuery 1.4).\r\n        add: function (handleObj) {\r\n            // Since window has its own native 'resize' event, return false so that\r\n            // jQuery doesn't modify the event object. Unless, of course, we're\r\n            // throttling the 'resize' event for window.\r\n            if (!jq_resize[str_throttle] && this[str_setTimeout]) {\r\n                return false;\r\n            }\r\n\r\n            var old_handler;\r\n\r\n            // The new_handler function is executed every time the event is triggered.\r\n            // This is used to update the internal element data store with the width\r\n            // and height when the event is triggered manually, to avoid double-firing\r\n            // of the event callback. See the \"Double firing issue in jQuery 1.3.2\"\r\n            // comments above for more information.\r\n\r\n            function new_handler(e, w, h) {\r\n                var elem = $(this),\r\n                    data = elem.data(str_data);\r\n\r\n                // If called from the polling loop, w and h will be passed in as\r\n                // arguments. If called manually, via .trigger( 'resize' ) or .resize(),\r\n                // those values will need to be computed.\r\n                data.w = w !== undefined ? w : elem.width();\r\n                data.h = h !== undefined ? h : elem.height();\r\n\r\n                old_handler.apply(this, arguments);\r\n            };\r\n\r\n            // This may seem a little complicated, but it normalizes the special event\r\n            // .add method between jQuery 1.4/1.4.1 and 1.4.2+\r\n            if ($.isFunction(handleObj)) {\r\n                // 1.4, 1.4.1\r\n                old_handler = handleObj;\r\n                return new_handler;\r\n            } else {\r\n                // 1.4.2+\r\n                old_handler = handleObj.handler;\r\n                handleObj.handler = new_handler;\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    function loopy() {\r\n        // Start the polling loop, asynchronously.\r\n        timeout_id = window[str_setTimeout](function () {\r\n            time_count++;\r\n            // Iterate over all elements to which the 'resize' event is bound.\r\n            elems.forEach(function (elem) {\r\n                var width = elem.width(),\r\n                    height = elem.height(),\r\n                    data = elem.data(str_data);\r\n\r\n                // If element size has changed since the last time, update the element\r\n                // data store and trigger the 'resize' event.\r\n                if (width !== data.w || height !== data.h) {\r\n                    elem.trigger(str_resize, [data.w = width, data.h = height]);\r\n                }\r\n\r\n                if (time_count % 50 === 0) {\r\n                    if (elem.get(0) !== window && $('[' + str_resize_key + '=\"' + elem.attr(str_resize_key) + '\"]').length === 0) {\r\n                        removeItem(elems, elem);\r\n                        elem.removeData(str_data);\r\n                        elem.unbind(str_resize);\r\n                    }\r\n                }\r\n\r\n            });\r\n            if (!elems.length) {\r\n                clearTimeout(timeout_id);\r\n            } else {\r\n                // Loop.\r\n                loopy();\r\n            }\r\n\r\n        }, jq_resize[str_delay]);\r\n\r\n\r\n    };\r\n\r\n\r\n})(jQuery, this);\n/*!\r\n Non-Sucking Autogrow 1.1.1\r\n license: MIT\r\n author: Roman Pushkin\r\n https://github.com/ro31337/jquery.ns-autogrow\r\n modify by ylf 2016/6/29\r\n */\r\n(function () {\r\n    var getVerticalScrollbarWidth;\r\n\r\n    (function ($, window) {\r\n        return $.fn.qtiAutogrow = function (options) {\r\n            if (options == null) {\r\n                options = {};\r\n            }\r\n            if (options.horizontal == null) {\r\n                options.horizontal = true;\r\n            }\r\n            if (options.vertical == null) {\r\n                options.vertical = true;\r\n            }\r\n            if (options.debugx == null) {\r\n                options.debugx = -10000;\r\n            }\r\n            if (options.debugy == null) {\r\n                options.debugy = -10000;\r\n            }\r\n            if (options.debugcolor == null) {\r\n                options.debugcolor = 'yellow';\r\n            }\r\n            if (options.flickering == null) {\r\n                options.flickering = true;\r\n            }\r\n            if (options.postGrowCallback == null) {\r\n                options.postGrowCallback = function () {\r\n                };\r\n            }\r\n            if (options.verticalScrollbarWidth == null) {\r\n                options.verticalScrollbarWidth = getVerticalScrollbarWidth();\r\n            }\r\n            if (options.horizontal === false && options.vertical === false) {\r\n                return;\r\n            }\r\n            return this.filter('input,textarea').each(function () {\r\n                var $e, $shadow, heightPadding, minHeight, minWidth, update, maxWidth;\r\n                $e = $(this);\r\n                if ($e.data('autogrow-enabled')) {\r\n                    return;\r\n                }\r\n                $e.data('autogrow-enabled');\r\n                minHeight = parseInt($e.attr('data-minHeight')) || $e.height();\r\n                minWidth = parseInt($e.attr('data-minWidth')) || $e.width();\r\n                heightPadding = $e.css('lineHeight') * 1 || 0;\r\n                $e.hasVerticalScrollBar = function () {\r\n                    return $e[0].clientHeight < $e[0].scrollHeight;\r\n                };\r\n                maxWidth = parseInt($e.css('max-width'));\r\n                $shadow = $('<div class=\"' + options.shadow + '\"></div>').css({\r\n                    position: 'fixed',\r\n                    display: 'inline-block',\r\n                    //visibility: 'hidden',\r\n                    'background-color': options.debugcolor,\r\n                    top: options.debugy,\r\n                    left: options.debugx,\r\n                    'max-width': $e.css('max-width'),\r\n                    'padding': $e.css('padding'),\r\n                    'boxSizing': $e.css('boxSizing'),\r\n                    fontSize: $e.css('fontSize'),\r\n                    fontFamily: $e.css('fontFamily'),\r\n                    fontWeight: $e.css('fontWeight'),\r\n                    lineHeight: $e.css('lineHeight'),\r\n                    resize: 'none',\r\n                    'word-wrap': 'break-word',\r\n                    'word-break': 'break-all'\r\n                }).appendTo($e.parent());\r\n                if (options.horizontal === false) {\r\n                    $shadow.css({\r\n                        'width': $e.width()\r\n                    });\r\n                }\r\n                update = (function (_this) {\r\n                    return function (event) {\r\n                        if ((!minWidth || isNaN(minWidth))) {\r\n                            if (typeof  options.minWidth === 'object') {\r\n                                if (!options.minWidth instanceof jQuery) {\r\n                                    options.minWidth = $(options.minWidth);\r\n                                }\r\n                                minWidth = options.minWidth.width();\r\n                            }else{\r\n                                minWidth=$e.width();\r\n                            }\r\n\r\n                        }\r\n                        if ((!maxWidth || isNaN(maxWidth)) && typeof  options.maxWidth === 'string') {\r\n                            //maxWidth = minWidth * 3;\r\n                            var maxWidth = $shadow.closest(options.maxWidth).width() - 30;\r\n                            $shadow.css({'max-width': maxWidth + 'px'})\r\n                        }\r\n                        var height, val, width;\r\n                        val = _this.value.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\n /g, '<br/>&nbsp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;').replace(/\\n$/, '<br/>&nbsp;').replace(/\\n/g, '<br/>').replace(/ {2,}/g, function (space) {\r\n                            return Array(space.length - 1).join('&nbsp;') + ' ';\r\n                        });\r\n\r\n                        $shadow.html(val);\r\n                        if (options.vertical === true) {\r\n                            minHeight = parseInt($e.attr('data-minheight')) || $e.height();\r\n                            height = Math.max($shadow.height() + heightPadding, minHeight);\r\n                            $e.height(height);\r\n                        }\r\n                        if (options.horizontal === true) {\r\n                            minWidth = parseInt($e.attr('data-minwidth')) || minWidth;\r\n                            //width = Math.max($shadow.outerWidth(), minWidth);\r\n                            width = Math.max($shadow.width(), minWidth);\r\n                            $e.width(width);\r\n\r\n                        }\r\n                        return options.postGrowCallback($e);\r\n                    };\r\n                })(this);\r\n                $e.on('input', update);\r\n                $e.resize( update);\r\n                //$(window).resize(update);\r\n                return update();\r\n            });\r\n        };\r\n    })(window.jQuery, window);\r\n\r\n    getVerticalScrollbarWidth = function () {\r\n        var inner, outer, w1, w2;\r\n        inner = document.createElement('p');\r\n        inner.style.width = \"100%\";\r\n        inner.style.height = \"200px\";\r\n        outer = document.createElement('div');\r\n        outer.style.position = \"absolute\";\r\n        outer.style.top = \"0px\";\r\n        outer.style.left = \"0px\";\r\n        outer.style.visibility = \"hidden\";\r\n        outer.style.width = \"200px\";\r\n        outer.style.height = \"150px\";\r\n        outer.style.overflow = \"hidden\";\r\n        outer.appendChild(inner);\r\n        document.body.appendChild(outer);\r\n        w1 = inner.offsetWidth;\r\n        outer.style.overflow = 'scroll';\r\n        w2 = inner.offsetWidth;\r\n        if (w1 === w2) {\r\n            w2 = outer.clientWidth;\r\n        }\r\n        document.body.removeChild(outer);\r\n        return w1 - w2;\r\n    };\r\n\r\n}).call(this);\r\n\r\n })(window,document,jQuery)"]}